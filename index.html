<!DOCTYPE html>
<html data-init="no-js">
<head>
<meta charset="UTF-8" />
<title>Community Service</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<!--

SugarCube (v2.30.0): A free (gratis and libre) story format.

Copyright © 2013–2019 Thomas Michael Edwards <thomasmedwards@gmail.com>.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:

1. Redistributions of source code must retain the above copyright notice, this
   list of conditions and the following disclaimer.
2. Redistributions in binary form must reproduce the above copyright notice,
   this list of conditions and the following disclaimer in the documentation
   and/or other materials provided with the distribution.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

-->
<script id="script-libraries" type="text/javascript">
if(document.head&&document.addEventListener&&document.querySelector&&Object.create&&Object.freeze&&JSON){document.documentElement.setAttribute("data-init", "loading");
/*! @source http://purl.eligrey.com/github/classList.js/blob/master/classList.js */
if("document" in self){if(!("classList" in document.createElement("_"))){(function(j){"use strict";if(!("Element" in j)){return}var a="classList",f="prototype",m=j.Element[f],b=Object,k=String[f].trim||function(){return this.replace(/^\s+|\s+$/g,"")},c=Array[f].indexOf||function(q){var p=0,o=this.length;for(;p<o;p++){if(p in this&&this[p]===q){return p}}return -1},n=function(o,p){this.name=o;this.code=DOMException[o];this.message=p},g=function(p,o){if(o===""){throw new n("SYNTAX_ERR","An invalid or illegal string was specified")}if(/\s/.test(o)){throw new n("INVALID_CHARACTER_ERR","String contains an invalid character")}return c.call(p,o)},d=function(s){var r=k.call(s.getAttribute("class")||""),q=r?r.split(/\s+/):[],p=0,o=q.length;for(;p<o;p++){this.push(q[p])}this._updateClassName=function(){s.setAttribute("class",this.toString())}},e=d[f]=[],i=function(){return new d(this)};n[f]=Error[f];e.item=function(o){return this[o]||null};e.contains=function(o){o+="";return g(this,o)!==-1};e.add=function(){var s=arguments,r=0,p=s.length,q,o=false;do{q=s[r]+"";if(g(this,q)===-1){this.push(q);o=true}}while(++r<p);if(o){this._updateClassName()}};e.remove=function(){var t=arguments,s=0,p=t.length,r,o=false,q;do{r=t[s]+"";q=g(this,r);while(q!==-1){this.splice(q,1);o=true;q=g(this,r)}}while(++s<p);if(o){this._updateClassName()}};e.toggle=function(p,q){p+="";var o=this.contains(p),r=o?q!==true&&"remove":q!==false&&"add";if(r){this[r](p)}if(q===true||q===false){return q}else{return !o}};e.toString=function(){return this.join(" ")};if(b.defineProperty){var l={get:i,enumerable:true,configurable:true};try{b.defineProperty(m,a,l)}catch(h){if(h.number===-2146823252){l.enumerable=false;b.defineProperty(m,a,l)}}}else{if(b[f].__defineGetter__){m.__defineGetter__(a,i)}}}(self))}else{(function(){var b=document.createElement("_");b.classList.add("c1","c2");if(!b.classList.contains("c2")){var c=function(e){var d=DOMTokenList.prototype[e];DOMTokenList.prototype[e]=function(h){var g,f=arguments.length;for(g=0;g<f;g++){h=arguments[g];d.call(this,h)}}};c("add");c("remove")}b.classList.toggle("c3",false);if(b.classList.contains("c3")){var a=DOMTokenList.prototype.toggle;DOMTokenList.prototype.toggle=function(d,e){if(1 in arguments&&!this.contains(d)===!e){return e}else{return a.call(this,d)}}}b=null}())}};
/*!
 * https://github.com/es-shims/es5-shim
 * @license es5-shim Copyright 2009-2015 by contributors, MIT License
 * see https://github.com/es-shims/es5-shim/blob/v4.5.13/LICENSE
 */
(function(t,r){"use strict";if(typeof define==="function"&&define.amd){define(r)}else if(typeof exports==="object"){module.exports=r()}else{t.returnExports=r()}})(this,function(){var t=Array;var r=t.prototype;var e=Object;var n=e.prototype;var i=Function;var a=i.prototype;var o=String;var f=o.prototype;var u=Number;var l=u.prototype;var s=r.slice;var c=r.splice;var v=r.push;var h=r.unshift;var p=r.concat;var y=r.join;var d=a.call;var g=a.apply;var w=Math.max;var b=Math.min;var T=n.toString;var m=typeof Symbol==="function"&&typeof Symbol.toStringTag==="symbol";var D;var S=Function.prototype.toString,x=/^\s*class /,O=function isES6ClassFn(t){try{var r=S.call(t);var e=r.replace(/\/\/.*\n/g,"");var n=e.replace(/\/\*[.\s\S]*\*\//g,"");var i=n.replace(/\n/gm," ").replace(/ {2}/g," ");return x.test(i)}catch(a){return false}},E=function tryFunctionObject(t){try{if(O(t)){return false}S.call(t);return true}catch(r){return false}},j="[object Function]",I="[object GeneratorFunction]",D=function isCallable(t){if(!t){return false}if(typeof t!=="function"&&typeof t!=="object"){return false}if(m){return E(t)}if(O(t)){return false}var r=T.call(t);return r===j||r===I};var M;var U=RegExp.prototype.exec,$=function tryRegexExec(t){try{U.call(t);return true}catch(r){return false}},F="[object RegExp]";M=function isRegex(t){if(typeof t!=="object"){return false}return m?$(t):T.call(t)===F};var N;var C=String.prototype.valueOf,k=function tryStringObject(t){try{C.call(t);return true}catch(r){return false}},A="[object String]";N=function isString(t){if(typeof t==="string"){return true}if(typeof t!=="object"){return false}return m?k(t):T.call(t)===A};var R=e.defineProperty&&function(){try{var t={};e.defineProperty(t,"x",{enumerable:false,value:t});for(var r in t){return false}return t.x===t}catch(n){return false}}();var P=function(t){var r;if(R){r=function(t,r,n,i){if(!i&&r in t){return}e.defineProperty(t,r,{configurable:true,enumerable:false,writable:true,value:n})}}else{r=function(t,r,e,n){if(!n&&r in t){return}t[r]=e}}return function defineProperties(e,n,i){for(var a in n){if(t.call(n,a)){r(e,a,n[a],i)}}}}(n.hasOwnProperty);var J=function isPrimitive(t){var r=typeof t;return t===null||r!=="object"&&r!=="function"};var Y=u.isNaN||function isActualNaN(t){return t!==t};var z={ToInteger:function ToInteger(t){var r=+t;if(Y(r)){r=0}else if(r!==0&&r!==1/0&&r!==-(1/0)){r=(r>0||-1)*Math.floor(Math.abs(r))}return r},ToPrimitive:function ToPrimitive(t){var r,e,n;if(J(t)){return t}e=t.valueOf;if(D(e)){r=e.call(t);if(J(r)){return r}}n=t.toString;if(D(n)){r=n.call(t);if(J(r)){return r}}throw new TypeError},ToObject:function(t){if(t==null){throw new TypeError("can't convert "+t+" to object")}return e(t)},ToUint32:function ToUint32(t){return t>>>0}};var Z=function Empty(){};P(a,{bind:function bind(t){var r=this;if(!D(r)){throw new TypeError("Function.prototype.bind called on incompatible "+r)}var n=s.call(arguments,1);var a;var o=function(){if(this instanceof a){var i=g.call(r,this,p.call(n,s.call(arguments)));if(e(i)===i){return i}return this}else{return g.call(r,t,p.call(n,s.call(arguments)))}};var f=w(0,r.length-n.length);var u=[];for(var l=0;l<f;l++){v.call(u,"$"+l)}a=i("binder","return function ("+y.call(u,",")+"){ return binder.apply(this, arguments); }")(o);if(r.prototype){Z.prototype=r.prototype;a.prototype=new Z;Z.prototype=null}return a}});var G=d.bind(n.hasOwnProperty);var H=d.bind(n.toString);var W=d.bind(s);var B=g.bind(s);if(typeof document==="object"&&document&&document.documentElement){try{W(document.documentElement.childNodes)}catch(X){var L=W;var q=B;W=function arraySliceIE(t){var r=[];var e=t.length;while(e-- >0){r[e]=t[e]}return q(r,L(arguments,1))};B=function arraySliceApplyIE(t,r){return q(W(t),r)}}}var K=d.bind(f.slice);var Q=d.bind(f.split);var V=d.bind(f.indexOf);var _=d.bind(v);var tt=d.bind(n.propertyIsEnumerable);var rt=d.bind(r.sort);var et=t.isArray||function isArray(t){return H(t)==="[object Array]"};var nt=[].unshift(0)!==1;P(r,{unshift:function(){h.apply(this,arguments);return this.length}},nt);P(t,{isArray:et});var it=e("a");var at=it[0]!=="a"||!(0 in it);var ot=function properlyBoxed(t){var r=true;var e=true;var n=false;if(t){try{t.call("foo",function(t,e,n){if(typeof n!=="object"){r=false}});t.call([1],function(){"use strict";e=typeof this==="string"},"x")}catch(i){n=true}}return!!t&&!n&&r&&e};P(r,{forEach:function forEach(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=-1;var i=z.ToUint32(e.length);var a;if(arguments.length>1){a=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.forEach callback must be a function")}while(++n<i){if(n in e){if(typeof a==="undefined"){t(e[n],n,r)}else{t.call(a,e[n],n,r)}}}}},!ot(r.forEach));P(r,{map:function map(r){var e=z.ToObject(this);var n=at&&N(this)?Q(this,""):e;var i=z.ToUint32(n.length);var a=t(i);var o;if(arguments.length>1){o=arguments[1]}if(!D(r)){throw new TypeError("Array.prototype.map callback must be a function")}for(var f=0;f<i;f++){if(f in n){if(typeof o==="undefined"){a[f]=r(n[f],f,e)}else{a[f]=r.call(o,n[f],f,e)}}}return a}},!ot(r.map));P(r,{filter:function filter(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i=[];var a;var o;if(arguments.length>1){o=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.filter callback must be a function")}for(var f=0;f<n;f++){if(f in e){a=e[f];if(typeof o==="undefined"?t(a,f,r):t.call(o,a,f,r)){_(i,a)}}}return i}},!ot(r.filter));P(r,{every:function every(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.every callback must be a function")}for(var a=0;a<n;a++){if(a in e&&!(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return false}}return true}},!ot(r.every));P(r,{some:function some(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);var i;if(arguments.length>1){i=arguments[1]}if(!D(t)){throw new TypeError("Array.prototype.some callback must be a function")}for(var a=0;a<n;a++){if(a in e&&(typeof i==="undefined"?t(e[a],a,r):t.call(i,e[a],a,r))){return true}}return false}},!ot(r.some));var ft=false;if(r.reduce){ft=typeof r.reduce.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduce:function reduce(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduce callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduce of empty array with no initial value")}var i=0;var a;if(arguments.length>=2){a=arguments[1]}else{do{if(i in e){a=e[i++];break}if(++i>=n){throw new TypeError("reduce of empty array with no initial value")}}while(true)}for(;i<n;i++){if(i in e){a=t(a,e[i],i,r)}}return a}},!ft);var ut=false;if(r.reduceRight){ut=typeof r.reduceRight.call("es5",function(t,r,e,n){return n})==="object"}P(r,{reduceRight:function reduceRight(t){var r=z.ToObject(this);var e=at&&N(this)?Q(this,""):r;var n=z.ToUint32(e.length);if(!D(t)){throw new TypeError("Array.prototype.reduceRight callback must be a function")}if(n===0&&arguments.length===1){throw new TypeError("reduceRight of empty array with no initial value")}var i;var a=n-1;if(arguments.length>=2){i=arguments[1]}else{do{if(a in e){i=e[a--];break}if(--a<0){throw new TypeError("reduceRight of empty array with no initial value")}}while(true)}if(a<0){return i}do{if(a in e){i=t(i,e[a],a,r)}}while(a--);return i}},!ut);var lt=r.indexOf&&[0,1].indexOf(1,2)!==-1;P(r,{indexOf:function indexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=0;if(arguments.length>1){n=z.ToInteger(arguments[1])}n=n>=0?n:w(0,e+n);for(;n<e;n++){if(n in r&&r[n]===t){return n}}return-1}},lt);var st=r.lastIndexOf&&[0,1].lastIndexOf(0,-3)!==-1;P(r,{lastIndexOf:function lastIndexOf(t){var r=at&&N(this)?Q(this,""):z.ToObject(this);var e=z.ToUint32(r.length);if(e===0){return-1}var n=e-1;if(arguments.length>1){n=b(n,z.ToInteger(arguments[1]))}n=n>=0?n:e-Math.abs(n);for(;n>=0;n--){if(n in r&&t===r[n]){return n}}return-1}},st);var ct=function(){var t=[1,2];var r=t.splice();return t.length===2&&et(r)&&r.length===0}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}else{return c.apply(this,arguments)}}},!ct);var vt=function(){var t={};r.splice.call(t,0,0,1);return t.length===1}();P(r,{splice:function splice(t,r){if(arguments.length===0){return[]}var e=arguments;this.length=w(z.ToInteger(this.length),0);if(arguments.length>0&&typeof r!=="number"){e=W(arguments);if(e.length<2){_(e,this.length-t)}else{e[1]=z.ToInteger(r)}}return c.apply(this,e)}},!vt);var ht=function(){var r=new t(1e5);r[8]="x";r.splice(1,1);return r.indexOf("x")===7}();var pt=function(){var t=256;var r=[];r[t]="a";r.splice(t+1,0,"b");return r[t]==="a"}();P(r,{splice:function splice(t,r){var e=z.ToObject(this);var n=[];var i=z.ToUint32(e.length);var a=z.ToInteger(t);var f=a<0?w(i+a,0):b(a,i);var u=b(w(z.ToInteger(r),0),i-f);var l=0;var s;while(l<u){s=o(f+l);if(G(e,s)){n[l]=e[s]}l+=1}var c=W(arguments,2);var v=c.length;var h;if(v<u){l=f;var p=i-u;while(l<p){s=o(l+u);h=o(l+v);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l+=1}l=i;var y=i-u+v;while(l>y){delete e[l-1];l-=1}}else if(v>u){l=i-u;while(l>f){s=o(l+u-1);h=o(l+v-1);if(G(e,s)){e[h]=e[s]}else{delete e[h]}l-=1}}l=f;for(var d=0;d<c.length;++d){e[l]=c[d];l+=1}e.length=i-u+v;return n}},!ht||!pt);var yt=r.join;var dt;try{dt=Array.prototype.join.call("123",",")!=="1,2,3"}catch(X){dt=true}if(dt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(N(this)?Q(this,""):this,r)}},dt)}var gt=[1,2].join(undefined)!=="1,2";if(gt){P(r,{join:function join(t){var r=typeof t==="undefined"?",":t;return yt.call(this,r)}},gt)}var wt=function push(t){var r=z.ToObject(this);var e=z.ToUint32(r.length);var n=0;while(n<arguments.length){r[e+n]=arguments[n];n+=1}r.length=e+n;return e+n};var bt=function(){var t={};var r=Array.prototype.push.call(t,undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:function push(t){if(et(this)){return v.apply(this,arguments)}return wt.apply(this,arguments)}},bt);var Tt=function(){var t=[];var r=t.push(undefined);return r!==1||t.length!==1||typeof t[0]!=="undefined"||!G(t,0)}();P(r,{push:wt},Tt);P(r,{slice:function(t,r){var e=N(this)?Q(this,""):this;return B(e,arguments)}},at);var mt=function(){try{[1,2].sort(null)}catch(t){try{[1,2].sort({})}catch(r){return false}}return true}();var Dt=function(){try{[1,2].sort(/a/);return false}catch(t){}return true}();var St=function(){try{[1,2].sort(undefined);return true}catch(t){}return false}();P(r,{sort:function sort(t){if(typeof t==="undefined"){return rt(this)}if(!D(t)){throw new TypeError("Array.prototype.sort callback must be a function")}return rt(this,t)}},mt||!St||!Dt);var xt=!tt({toString:null},"toString");var Ot=tt(function(){},"prototype");var Et=!G("x","0");var jt=function(t){var r=t.constructor;return r&&r.prototype===t};var It={$applicationCache:true,$console:true,$external:true,$frame:true,$frameElement:true,$frames:true,$innerHeight:true,$innerWidth:true,$onmozfullscreenchange:true,$onmozfullscreenerror:true,$outerHeight:true,$outerWidth:true,$pageXOffset:true,$pageYOffset:true,$parent:true,$scrollLeft:true,$scrollTop:true,$scrollX:true,$scrollY:true,$self:true,$webkitIndexedDB:true,$webkitStorageInfo:true,$window:true,$width:true,$height:true,$top:true,$localStorage:true};var Mt=function(){if(typeof window==="undefined"){return false}for(var t in window){try{if(!It["$"+t]&&G(window,t)&&window[t]!==null&&typeof window[t]==="object"){jt(window[t])}}catch(r){return true}}return false}();var Ut=function(t){if(typeof window==="undefined"||!Mt){return jt(t)}try{return jt(t)}catch(r){return false}};var $t=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"];var Ft=$t.length;var Nt=function isArguments(t){return H(t)==="[object Arguments]"};var Ct=function isArguments(t){return t!==null&&typeof t==="object"&&typeof t.length==="number"&&t.length>=0&&!et(t)&&D(t.callee)};var kt=Nt(arguments)?Nt:Ct;P(e,{keys:function keys(t){var r=D(t);var e=kt(t);var n=t!==null&&typeof t==="object";var i=n&&N(t);if(!n&&!r&&!e){throw new TypeError("Object.keys called on a non-object")}var a=[];var f=Ot&&r;if(i&&Et||e){for(var u=0;u<t.length;++u){_(a,o(u))}}if(!e){for(var l in t){if(!(f&&l==="prototype")&&G(t,l)){_(a,o(l))}}}if(xt){var s=Ut(t);for(var c=0;c<Ft;c++){var v=$t[c];if(!(s&&v==="constructor")&&G(t,v)){_(a,v)}}}return a}});var At=e.keys&&function(){return e.keys(arguments).length===2}(1,2);var Rt=e.keys&&function(){var t=e.keys(arguments);return arguments.length!==1||t.length!==1||t[0]!==1}(1);var Pt=e.keys;P(e,{keys:function keys(t){if(kt(t)){return Pt(W(t))}else{return Pt(t)}}},!At||Rt);var Jt=new Date(-0xc782b5b342b24).getUTCMonth()!==0;var Yt=new Date(-0x55d318d56a724);var zt=new Date(14496624e5);var Zt=Yt.toUTCString()!=="Mon, 01 Jan -45875 11:59:59 GMT";var Gt;var Ht;var Wt=Yt.getTimezoneOffset();if(Wt<-720){Gt=Yt.toDateString()!=="Tue Jan 02 -45875";Ht=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}else{Gt=Yt.toDateString()!=="Mon Jan 01 -45875";Ht=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-+]\d\d\d\d(?: |$)/.test(String(zt))}var Bt=d.bind(Date.prototype.getFullYear);var Xt=d.bind(Date.prototype.getMonth);var Lt=d.bind(Date.prototype.getDate);var qt=d.bind(Date.prototype.getUTCFullYear);var Kt=d.bind(Date.prototype.getUTCMonth);var Qt=d.bind(Date.prototype.getUTCDate);var Vt=d.bind(Date.prototype.getUTCDay);var _t=d.bind(Date.prototype.getUTCHours);var tr=d.bind(Date.prototype.getUTCMinutes);var rr=d.bind(Date.prototype.getUTCSeconds);var er=d.bind(Date.prototype.getUTCMilliseconds);var nr=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];var ir=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];var ar=function daysInMonth(t,r){return Lt(new Date(r,t,0))};P(Date.prototype,{getFullYear:function getFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);if(t<0&&Xt(this)>11){return t+1}return t},getMonth:function getMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);if(t<0&&r>11){return 0}return r},getDate:function getDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Bt(this);var r=Xt(this);var e=Lt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e},getUTCFullYear:function getUTCFullYear(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);if(t<0&&Kt(this)>11){return t+1}return t},getUTCMonth:function getUTCMonth(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);if(t<0&&r>11){return 0}return r},getUTCDate:function getUTCDate(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=qt(this);var r=Kt(this);var e=Qt(this);if(t<0&&r>11){if(r===12){return e}var n=ar(0,t+1);return n-e+1}return e}},Jt);P(Date.prototype,{toUTCString:function toUTCString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=Vt(this);var r=Qt(this);var e=Kt(this);var n=qt(this);var i=_t(this);var a=tr(this);var o=rr(this);return nr[t]+", "+(r<10?"0"+r:r)+" "+ir[e]+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"}},Jt||Zt);P(Date.prototype,{toDateString:function toDateString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n}},Jt||Gt);if(Jt||Ht){Date.prototype.toString=function toString(){if(!this||!(this instanceof Date)){throw new TypeError("this is not a Date object.")}var t=this.getDay();var r=this.getDate();var e=this.getMonth();var n=this.getFullYear();var i=this.getHours();var a=this.getMinutes();var o=this.getSeconds();var f=this.getTimezoneOffset();var u=Math.floor(Math.abs(f)/60);var l=Math.floor(Math.abs(f)%60);return nr[t]+" "+ir[e]+" "+(r<10?"0"+r:r)+" "+n+" "+(i<10?"0"+i:i)+":"+(a<10?"0"+a:a)+":"+(o<10?"0"+o:o)+" GMT"+(f>0?"-":"+")+(u<10?"0"+u:u)+(l<10?"0"+l:l)};if(R){e.defineProperty(Date.prototype,"toString",{configurable:true,enumerable:false,writable:true})}}var or=-621987552e5;var fr="-000001";var ur=Date.prototype.toISOString&&new Date(or).toISOString().indexOf(fr)===-1;var lr=Date.prototype.toISOString&&new Date(-1).toISOString()!=="1969-12-31T23:59:59.999Z";var sr=d.bind(Date.prototype.getTime);P(Date.prototype,{toISOString:function toISOString(){if(!isFinite(this)||!isFinite(sr(this))){throw new RangeError("Date.prototype.toISOString called on non-finite value.")}var t=qt(this);var r=Kt(this);t+=Math.floor(r/12);r=(r%12+12)%12;var e=[r+1,Qt(this),_t(this),tr(this),rr(this)];t=(t<0?"-":t>9999?"+":"")+K("00000"+Math.abs(t),0<=t&&t<=9999?-4:-6);for(var n=0;n<e.length;++n){e[n]=K("00"+e[n],-2)}return t+"-"+W(e,0,2).join("-")+"T"+W(e,2).join(":")+"."+K("000"+er(this),-3)+"Z"}},ur||lr);var cr=function(){try{return Date.prototype.toJSON&&new Date(NaN).toJSON()===null&&new Date(or).toJSON().indexOf(fr)!==-1&&Date.prototype.toJSON.call({toISOString:function(){return true}})}catch(t){return false}}();if(!cr){Date.prototype.toJSON=function toJSON(t){var r=e(this);var n=z.ToPrimitive(r);if(typeof n==="number"&&!isFinite(n)){return null}var i=r.toISOString;if(!D(i)){throw new TypeError("toISOString property is not callable")}return i.call(r)}}var vr=Date.parse("+033658-09-27T01:46:40.000Z")===1e15;var hr=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));var pr=isNaN(Date.parse("2000-01-01T00:00:00.000Z"));if(pr||hr||!vr){var yr=Math.pow(2,31)-1;var dr=Y(new Date(1970,0,1,0,0,0,yr+1).getTime());Date=function(t){var r=function Date(e,n,i,a,f,u,l){var s=arguments.length;var c;if(this instanceof t){var v=u;var h=l;if(dr&&s>=7&&l>yr){var p=Math.floor(l/yr)*yr;var y=Math.floor(p/1e3);v+=y;h-=y*1e3}c=s===1&&o(e)===e?new t(r.parse(e)):s>=7?new t(e,n,i,a,f,v,h):s>=6?new t(e,n,i,a,f,v):s>=5?new t(e,n,i,a,f):s>=4?new t(e,n,i,a):s>=3?new t(e,n,i):s>=2?new t(e,n):s>=1?new t(e instanceof t?+e:e):new t}else{c=t.apply(this,arguments)}if(!J(c)){P(c,{constructor:r},true)}return c};var e=new RegExp("^"+"(\\d{4}|[+-]\\d{6})"+"(?:-(\\d{2})"+"(?:-(\\d{2})"+"(?:"+"T(\\d{2})"+":(\\d{2})"+"(?:"+":(\\d{2})"+"(?:(\\.\\d{1,}))?"+")?"+"("+"Z|"+"(?:"+"([-+])"+"(\\d{2})"+":(\\d{2})"+")"+")?)?)?)?"+"$");var n=[0,31,59,90,120,151,181,212,243,273,304,334,365];var i=function dayFromMonth(t,r){var e=r>1?1:0;return n[r]+Math.floor((t-1969+e)/4)-Math.floor((t-1901+e)/100)+Math.floor((t-1601+e)/400)+365*(t-1970)};var a=function toUTC(r){var e=0;var n=r;if(dr&&n>yr){var i=Math.floor(n/yr)*yr;var a=Math.floor(i/1e3);e+=a;n-=a*1e3}return u(new t(1970,0,1,0,0,e,n))};for(var f in t){if(G(t,f)){r[f]=t[f]}}P(r,{now:t.now,UTC:t.UTC},true);r.prototype=t.prototype;P(r.prototype,{constructor:r},true);var l=function parse(r){var n=e.exec(r);if(n){var o=u(n[1]),f=u(n[2]||1)-1,l=u(n[3]||1)-1,s=u(n[4]||0),c=u(n[5]||0),v=u(n[6]||0),h=Math.floor(u(n[7]||0)*1e3),p=Boolean(n[4]&&!n[8]),y=n[9]==="-"?1:-1,d=u(n[10]||0),g=u(n[11]||0),w;var b=c>0||v>0||h>0;if(s<(b?24:25)&&c<60&&v<60&&h<1e3&&f>-1&&f<12&&d<24&&g<60&&l>-1&&l<i(o,f+1)-i(o,f)){w=((i(o,f)+l)*24+s+d*y)*60;w=((w+c+g*y)*60+v)*1e3+h;if(p){w=a(w)}if(-864e13<=w&&w<=864e13){return w}}return NaN}return t.parse.apply(this,arguments)};P(r,{parse:l});return r}(Date)}if(!Date.now){Date.now=function now(){return(new Date).getTime()}}var gr=l.toFixed&&(8e-5.toFixed(3)!=="0.000"||.9.toFixed(0)!=="1"||1.255.toFixed(2)!=="1.25"||(1000000000000000128).toFixed(0)!=="1000000000000000128");var wr={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function multiply(t,r){var e=-1;var n=r;while(++e<wr.size){n+=t*wr.data[e];wr.data[e]=n%wr.base;n=Math.floor(n/wr.base)}},divide:function divide(t){var r=wr.size;var e=0;while(--r>=0){e+=wr.data[r];wr.data[r]=Math.floor(e/t);e=e%t*wr.base}},numToString:function numToString(){var t=wr.size;var r="";while(--t>=0){if(r!==""||t===0||wr.data[t]!==0){var e=o(wr.data[t]);if(r===""){r=e}else{r+=K("0000000",0,7-e.length)+e}}}return r},pow:function pow(t,r,e){return r===0?e:r%2===1?pow(t,r-1,e*t):pow(t*t,r/2,e)},log:function log(t){var r=0;var e=t;while(e>=4096){r+=12;e/=4096}while(e>=2){r+=1;e/=2}return r}};var br=function toFixed(t){var r,e,n,i,a,f,l,s;r=u(t);r=Y(r)?0:Math.floor(r);if(r<0||r>20){throw new RangeError("Number.toFixed called with invalid number of decimals")}e=u(this);if(Y(e)){return"NaN"}if(e<=-1e21||e>=1e21){return o(e)}n="";if(e<0){n="-";e=-e}i="0";if(e>1e-21){a=wr.log(e*wr.pow(2,69,1))-69;f=a<0?e*wr.pow(2,-a,1):e/wr.pow(2,a,1);f*=4503599627370496;a=52-a;if(a>0){wr.multiply(0,f);l=r;while(l>=7){wr.multiply(1e7,0);l-=7}wr.multiply(wr.pow(10,l,1),0);l=a-1;while(l>=23){wr.divide(1<<23);l-=23}wr.divide(1<<l);wr.multiply(1,1);wr.divide(2);i=wr.numToString()}else{wr.multiply(0,f);wr.multiply(1<<-a,0);i=wr.numToString()+K("0.00000000000000000000",2,2+r)}}if(r>0){s=i.length;if(s<=r){i=n+K("0.0000000000000000000",0,r-s+2)+i}else{i=n+K(i,0,s-r)+"."+K(i,s-r)}}else{i=n+i}return i};P(l,{toFixed:br},gr);var Tr=function(){try{return 1..toPrecision(undefined)==="1"}catch(t){return true}}();var mr=l.toPrecision;P(l,{toPrecision:function toPrecision(t){return typeof t==="undefined"?mr.call(this):mr.call(this,t)}},Tr);if("ab".split(/(?:ab)*/).length!==2||".".split(/(.?)(.?)/).length!==4||"tesst".split(/(s)*/)[1]==="t"||"test".split(/(?:)/,-1).length!==4||"".split(/.?/).length||".".split(/()()/).length>1){(function(){var t=typeof/()??/.exec("")[1]==="undefined";var r=Math.pow(2,32)-1;f.split=function(e,n){var i=String(this);if(typeof e==="undefined"&&n===0){return[]}if(!M(e)){return Q(this,e,n)}var a=[];var o=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),f=0,u,l,s,c;var h=new RegExp(e.source,o+"g");if(!t){u=new RegExp("^"+h.source+"$(?!\\s)",o)}var p=typeof n==="undefined"?r:z.ToUint32(n);l=h.exec(i);while(l){s=l.index+l[0].length;if(s>f){_(a,K(i,f,l.index));if(!t&&l.length>1){l[0].replace(u,function(){for(var t=1;t<arguments.length-2;t++){if(typeof arguments[t]==="undefined"){l[t]=void 0}}})}if(l.length>1&&l.index<i.length){v.apply(a,W(l,1))}c=l[0].length;f=s;if(a.length>=p){break}}if(h.lastIndex===l.index){h.lastIndex++}l=h.exec(i)}if(f===i.length){if(c||!h.test("")){_(a,"")}}else{_(a,K(i,f))}return a.length>p?W(a,0,p):a}})()}else if("0".split(void 0,0).length){f.split=function split(t,r){if(typeof t==="undefined"&&r===0){return[]}return Q(this,t,r)}}var Dr=f.replace;var Sr=function(){var t=[];"x".replace(/x(.)?/g,function(r,e){_(t,e)});return t.length===1&&typeof t[0]==="undefined"}();if(!Sr){f.replace=function replace(t,r){var e=D(r);var n=M(t)&&/\)[*?]/.test(t.source);if(!e||!n){return Dr.call(this,t,r)}else{var i=function(e){var n=arguments.length;var i=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];t.lastIndex=i;_(a,arguments[n-2],arguments[n-1]);return r.apply(this,a)};return Dr.call(this,t,i)}}}var xr=f.substr;var Or="".substr&&"0b".substr(-1)!=="b";P(f,{substr:function substr(t,r){var e=t;if(t<0){e=w(this.length+t,0)}return xr.call(this,e,r)}},Or);var Er="\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003"+"\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028"+"\u2029\ufeff";var jr="\u200b";var Ir="["+Er+"]";var Mr=new RegExp("^"+Ir+Ir+"*");var Ur=new RegExp(Ir+Ir+"*$");var $r=f.trim&&(Er.trim()||!jr.trim());P(f,{trim:function trim(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}return o(this).replace(Mr,"").replace(Ur,"")}},$r);var Fr=d.bind(String.prototype.trim);var Nr=f.lastIndexOf&&"abc\u3042\u3044".lastIndexOf("\u3042\u3044",2)!==-1;P(f,{lastIndexOf:function lastIndexOf(t){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var r=o(this);var e=o(t);var n=arguments.length>1?u(arguments[1]):NaN;var i=Y(n)?Infinity:z.ToInteger(n);var a=b(w(i,0),r.length);var f=e.length;var l=a+f;while(l>0){l=w(0,l-f);var s=V(K(r,l,a+f),e);if(s!==-1){return l+s}}return-1}},Nr);var Cr=f.lastIndexOf;P(f,{lastIndexOf:function lastIndexOf(t){return Cr.apply(this,arguments)}},f.lastIndexOf.length!==1);if(parseInt(Er+"08")!==8||parseInt(Er+"0x16")!==22){parseInt=function(t){var r=/^[-+]?0[xX]/;return function parseInt(e,n){if(typeof e==="symbol"){""+e}var i=Fr(String(e));var a=u(n)||(r.test(i)?16:10);return t(i,a)}}(parseInt)}if(1/parseFloat("-0")!==-Infinity){parseFloat=function(t){return function parseFloat(r){var e=Fr(String(r));var n=t(e);return n===0&&K(e,0,1)==="-"?-0:n}}(parseFloat)}if(String(new RangeError("test"))!=="RangeError: test"){var kr=function toString(){if(typeof this==="undefined"||this===null){throw new TypeError("can't convert "+this+" to object")}var t=this.name;if(typeof t==="undefined"){t="Error"}else if(typeof t!=="string"){t=o(t)}var r=this.message;if(typeof r==="undefined"){r=""}else if(typeof r!=="string"){r=o(r)}if(!t){return r}if(!r){return t}return t+": "+r};Error.prototype.toString=kr}if(R){var Ar=function(t,r){if(tt(t,r)){var e=Object.getOwnPropertyDescriptor(t,r);if(e.configurable){e.enumerable=false;Object.defineProperty(t,r,e)}}};Ar(Error.prototype,"message");if(Error.prototype.message!==""){Error.prototype.message=""}Ar(Error.prototype,"name")}if(String(/a/gim)!=="/a/gim"){var Rr=function toString(){var t="/"+this.source+"/";if(this.global){t+="g"}if(this.ignoreCase){t+="i"}if(this.multiline){t+="m"}return t};RegExp.prototype.toString=Rr}});
//# sourceMappingURL=es5-shim.map
/*!
 * https://github.com/paulmillr/es6-shim
 * @license es6-shim Copyright 2013-2016 by Paul Miller (http://paulmillr.com)
 *   and contributors,  MIT License
 * es6-shim: v0.35.4
 * see https://github.com/paulmillr/es6-shim/blob/0.35.4/LICENSE
 * Details and documentation:
 * https://github.com/paulmillr/es6-shim/
 */
(function(e,t){if(typeof define==="function"&&define.amd){define(t)}else if(typeof exports==="object"){module.exports=t()}else{e.returnExports=t()}})(this,function(){"use strict";var e=Function.call.bind(Function.apply);var t=Function.call.bind(Function.call);var r=Array.isArray;var n=Object.keys;var o=function notThunker(t){return function notThunk(){return!e(t,this,arguments)}};var i=function(e){try{e();return false}catch(t){return true}};var a=function valueOrFalseIfThrows(e){try{return e()}catch(t){return false}};var u=o(i);var f=function(){return!i(function(){return Object.defineProperty({},"x",{get:function(){}})})};var s=!!Object.defineProperty&&f();var c=function foo(){}.name==="foo";var l=Function.call.bind(Array.prototype.forEach);var p=Function.call.bind(Array.prototype.reduce);var v=Function.call.bind(Array.prototype.filter);var y=Function.call.bind(Array.prototype.some);var h=function(e,t,r,n){if(!n&&t in e){return}if(s){Object.defineProperty(e,t,{configurable:true,enumerable:false,writable:true,value:r})}else{e[t]=r}};var b=function(e,t,r){l(n(t),function(n){var o=t[n];h(e,n,o,!!r)})};var g=Function.call.bind(Object.prototype.toString);var d=typeof/abc/==="function"?function IsCallableSlow(e){return typeof e==="function"&&g(e)==="[object Function]"}:function IsCallableFast(e){return typeof e==="function"};var m={getter:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}Object.defineProperty(e,t,{configurable:true,enumerable:false,get:r})},proxy:function(e,t,r){if(!s){throw new TypeError("getters require true ES5 support")}var n=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(r,t,{configurable:n.configurable,enumerable:n.enumerable,get:function getKey(){return e[t]},set:function setKey(r){e[t]=r}})},redefine:function(e,t,r){if(s){var n=Object.getOwnPropertyDescriptor(e,t);n.value=r;Object.defineProperty(e,t,n)}else{e[t]=r}},defineByDescriptor:function(e,t,r){if(s){Object.defineProperty(e,t,r)}else if("value"in r){e[t]=r.value}},preserveToString:function(e,t){if(t&&d(t.toString)){h(e,"toString",t.toString.bind(t),true)}}};var O=Object.create||function(e,t){var r=function Prototype(){};r.prototype=e;var o=new r;if(typeof t!=="undefined"){n(t).forEach(function(e){m.defineByDescriptor(o,e,t[e])})}return o};var w=function(e,t){if(!Object.setPrototypeOf){return false}return a(function(){var r=function Subclass(t){var r=new e(t);Object.setPrototypeOf(r,Subclass.prototype);return r};Object.setPrototypeOf(r,e);r.prototype=O(e.prototype,{constructor:{value:r}});return t(r)})};var j=function(){if(typeof self!=="undefined"){return self}if(typeof window!=="undefined"){return window}if(typeof global!=="undefined"){return global}throw new Error("unable to locate global object")};var S=j();var T=S.isFinite;var I=Function.call.bind(String.prototype.indexOf);var E=Function.apply.bind(Array.prototype.indexOf);var P=Function.call.bind(Array.prototype.concat);var C=Function.call.bind(String.prototype.slice);var M=Function.call.bind(Array.prototype.push);var x=Function.apply.bind(Array.prototype.push);var N=Function.call.bind(Array.prototype.shift);var A=Math.max;var R=Math.min;var _=Math.floor;var k=Math.abs;var L=Math.exp;var F=Math.log;var D=Math.sqrt;var z=Function.call.bind(Object.prototype.hasOwnProperty);var q;var W=function(){};var G=S.Map;var H=G&&G.prototype["delete"];var V=G&&G.prototype.get;var B=G&&G.prototype.has;var U=G&&G.prototype.set;var $=S.Symbol||{};var J=$.species||"@@species";var X=Number.isNaN||function isNaN(e){return e!==e};var K=Number.isFinite||function isFinite(e){return typeof e==="number"&&T(e)};var Z=d(Math.sign)?Math.sign:function sign(e){var t=Number(e);if(t===0){return t}if(X(t)){return t}return t<0?-1:1};var Y=function log1p(e){var t=Number(e);if(t<-1||X(t)){return NaN}if(t===0||t===Infinity){return t}if(t===-1){return-Infinity}return 1+t-1===0?t:t*(F(1+t)/(1+t-1))};var Q=function isArguments(e){return g(e)==="[object Arguments]"};var ee=function isArguments(e){return e!==null&&typeof e==="object"&&typeof e.length==="number"&&e.length>=0&&g(e)!=="[object Array]"&&g(e.callee)==="[object Function]"};var te=Q(arguments)?Q:ee;var re={primitive:function(e){return e===null||typeof e!=="function"&&typeof e!=="object"},string:function(e){return g(e)==="[object String]"},regex:function(e){return g(e)==="[object RegExp]"},symbol:function(e){return typeof S.Symbol==="function"&&typeof e==="symbol"}};var ne=function overrideNative(e,t,r){var n=e[t];h(e,t,r,true);m.preserveToString(e[t],n)};var oe=typeof $==="function"&&typeof $["for"]==="function"&&re.symbol($());var ie=re.symbol($.iterator)?$.iterator:"_es6-shim iterator_";if(S.Set&&typeof(new S.Set)["@@iterator"]==="function"){ie="@@iterator"}if(!S.Reflect){h(S,"Reflect",{},true)}var ae=S.Reflect;var ue=String;var fe=typeof document==="undefined"||!document?null:document.all;var se=fe==null?function isNullOrUndefined(e){return e==null}:function isNullOrUndefinedAndNotDocumentAll(e){return e==null&&e!==fe};var ce={Call:function Call(t,r){var n=arguments.length>2?arguments[2]:[];if(!ce.IsCallable(t)){throw new TypeError(t+" is not a function")}return e(t,r,n)},RequireObjectCoercible:function(e,t){if(se(e)){throw new TypeError(t||"Cannot call method on "+e)}return e},TypeIsObject:function(e){if(e===void 0||e===null||e===true||e===false){return false}return typeof e==="function"||typeof e==="object"||e===fe},ToObject:function(e,t){return Object(ce.RequireObjectCoercible(e,t))},IsCallable:d,IsConstructor:function(e){return ce.IsCallable(e)},ToInt32:function(e){return ce.ToNumber(e)>>0},ToUint32:function(e){return ce.ToNumber(e)>>>0},ToNumber:function(e){if(g(e)==="[object Symbol]"){throw new TypeError("Cannot convert a Symbol value to a number")}return+e},ToInteger:function(e){var t=ce.ToNumber(e);if(X(t)){return 0}if(t===0||!K(t)){return t}return(t>0?1:-1)*_(k(t))},ToLength:function(e){var t=ce.ToInteger(e);if(t<=0){return 0}if(t>Number.MAX_SAFE_INTEGER){return Number.MAX_SAFE_INTEGER}return t},SameValue:function(e,t){if(e===t){if(e===0){return 1/e===1/t}return true}return X(e)&&X(t)},SameValueZero:function(e,t){return e===t||X(e)&&X(t)},IsIterable:function(e){return ce.TypeIsObject(e)&&(typeof e[ie]!=="undefined"||te(e))},GetIterator:function(e){if(te(e)){return new q(e,"value")}var t=ce.GetMethod(e,ie);if(!ce.IsCallable(t)){throw new TypeError("value is not an iterable")}var r=ce.Call(t,e);if(!ce.TypeIsObject(r)){throw new TypeError("bad iterator")}return r},GetMethod:function(e,t){var r=ce.ToObject(e)[t];if(se(r)){return void 0}if(!ce.IsCallable(r)){throw new TypeError("Method not callable: "+t)}return r},IteratorComplete:function(e){return!!e.done},IteratorClose:function(e,t){var r=ce.GetMethod(e,"return");if(r===void 0){return}var n,o;try{n=ce.Call(r,e)}catch(i){o=i}if(t){return}if(o){throw o}if(!ce.TypeIsObject(n)){throw new TypeError("Iterator's return method returned a non-object.")}},IteratorNext:function(e){var t=arguments.length>1?e.next(arguments[1]):e.next();if(!ce.TypeIsObject(t)){throw new TypeError("bad iterator")}return t},IteratorStep:function(e){var t=ce.IteratorNext(e);var r=ce.IteratorComplete(t);return r?false:t},Construct:function(e,t,r,n){var o=typeof r==="undefined"?e:r;if(!n&&ae.construct){return ae.construct(e,t,o)}var i=o.prototype;if(!ce.TypeIsObject(i)){i=Object.prototype}var a=O(i);var u=ce.Call(e,a,t);return ce.TypeIsObject(u)?u:a},SpeciesConstructor:function(e,t){var r=e.constructor;if(r===void 0){return t}if(!ce.TypeIsObject(r)){throw new TypeError("Bad constructor")}var n=r[J];if(se(n)){return t}if(!ce.IsConstructor(n)){throw new TypeError("Bad @@species")}return n},CreateHTML:function(e,t,r,n){var o=ce.ToString(e);var i="<"+t;if(r!==""){var a=ce.ToString(n);var u=a.replace(/"/g,"&quot;");i+=" "+r+'="'+u+'"'}var f=i+">";var s=f+o;return s+"</"+t+">"},IsRegExp:function IsRegExp(e){if(!ce.TypeIsObject(e)){return false}var t=e[$.match];if(typeof t!=="undefined"){return!!t}return re.regex(e)},ToString:function ToString(e){return ue(e)}};if(s&&oe){var le=function defineWellKnownSymbol(e){if(re.symbol($[e])){return $[e]}var t=$["for"]("Symbol."+e);Object.defineProperty($,e,{configurable:false,enumerable:false,writable:false,value:t});return t};if(!re.symbol($.search)){var pe=le("search");var ve=String.prototype.search;h(RegExp.prototype,pe,function search(e){return ce.Call(ve,e,[this])});var ye=function search(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,pe);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(ve,t,[ce.ToString(e)])};ne(String.prototype,"search",ye)}if(!re.symbol($.replace)){var he=le("replace");var be=String.prototype.replace;h(RegExp.prototype,he,function replace(e,t){return ce.Call(be,e,[this,t])});var ge=function replace(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,he);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(be,r,[ce.ToString(e),t])};ne(String.prototype,"replace",ge)}if(!re.symbol($.split)){var de=le("split");var me=String.prototype.split;h(RegExp.prototype,de,function split(e,t){return ce.Call(me,e,[this,t])});var Oe=function split(e,t){var r=ce.RequireObjectCoercible(this);if(!se(e)){var n=ce.GetMethod(e,de);if(typeof n!=="undefined"){return ce.Call(n,e,[r,t])}}return ce.Call(me,r,[ce.ToString(e),t])};ne(String.prototype,"split",Oe)}var we=re.symbol($.match);var je=we&&function(){var e={};e[$.match]=function(){return 42};return"a".match(e)!==42}();if(!we||je){var Se=le("match");var Te=String.prototype.match;h(RegExp.prototype,Se,function match(e){return ce.Call(Te,e,[this])});var Ie=function match(e){var t=ce.RequireObjectCoercible(this);if(!se(e)){var r=ce.GetMethod(e,Se);if(typeof r!=="undefined"){return ce.Call(r,e,[t])}}return ce.Call(Te,t,[ce.ToString(e)])};ne(String.prototype,"match",Ie)}}var Ee=function wrapConstructor(e,t,r){m.preserveToString(t,e);if(Object.setPrototypeOf){Object.setPrototypeOf(e,t)}if(s){l(Object.getOwnPropertyNames(e),function(n){if(n in W||r[n]){return}m.proxy(e,n,t)})}else{l(Object.keys(e),function(n){if(n in W||r[n]){return}t[n]=e[n]})}t.prototype=e.prototype;m.redefine(e.prototype,"constructor",t)};var Pe=function(){return this};var Ce=function(e){if(s&&!z(e,J)){m.getter(e,J,Pe)}};var Me=function(e,t){var r=t||function iterator(){return this};h(e,ie,r);if(!e[ie]&&re.symbol(ie)){e[ie]=r}};var xe=function createDataProperty(e,t,r){if(s){Object.defineProperty(e,t,{configurable:true,enumerable:true,writable:true,value:r})}else{e[t]=r}};var Ne=function createDataPropertyOrThrow(e,t,r){xe(e,t,r);if(!ce.SameValue(e[t],r)){throw new TypeError("property is nonconfigurable")}};var Ae=function(e,t,r,n){if(!ce.TypeIsObject(e)){throw new TypeError("Constructor requires `new`: "+t.name)}var o=t.prototype;if(!ce.TypeIsObject(o)){o=r}var i=O(o);for(var a in n){if(z(n,a)){var u=n[a];h(i,a,u,true)}}return i};if(String.fromCodePoint&&String.fromCodePoint.length!==1){var Re=String.fromCodePoint;ne(String,"fromCodePoint",function fromCodePoint(e){return ce.Call(Re,this,arguments)})}var _e={fromCodePoint:function fromCodePoint(e){var t=[];var r;for(var n=0,o=arguments.length;n<o;n++){r=Number(arguments[n]);if(!ce.SameValue(r,ce.ToInteger(r))||r<0||r>1114111){throw new RangeError("Invalid code point "+r)}if(r<65536){M(t,String.fromCharCode(r))}else{r-=65536;M(t,String.fromCharCode((r>>10)+55296));M(t,String.fromCharCode(r%1024+56320))}}return t.join("")},raw:function raw(e){var t=ce.ToObject(e,"bad callSite");var r=ce.ToObject(t.raw,"bad raw value");var n=r.length;var o=ce.ToLength(n);if(o<=0){return""}var i=[];var a=0;var u,f,s,c;while(a<o){u=ce.ToString(a);s=ce.ToString(r[u]);M(i,s);if(a+1>=o){break}f=a+1<arguments.length?arguments[a+1]:"";c=ce.ToString(f);M(i,c);a+=1}return i.join("")}};if(String.raw&&String.raw({raw:{0:"x",1:"y",length:2}})!=="xy"){ne(String,"raw",_e.raw)}b(String,_e);var ke=function repeat(e,t){if(t<1){return""}if(t%2){return repeat(e,t-1)+e}var r=repeat(e,t/2);return r+r};var Le=Infinity;var Fe={repeat:function repeat(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);if(r<0||r>=Le){throw new RangeError("repeat count must be less than infinity and not overflow maximum string size")}return ke(t,r)},startsWith:function startsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "startsWith" with a regex')}var r=ce.ToString(e);var n;if(arguments.length>1){n=arguments[1]}var o=A(ce.ToInteger(n),0);return C(t,o,o+r.length)===r},endsWith:function endsWith(e){var t=ce.ToString(ce.RequireObjectCoercible(this));if(ce.IsRegExp(e)){throw new TypeError('Cannot call method "endsWith" with a regex')}var r=ce.ToString(e);var n=t.length;var o;if(arguments.length>1){o=arguments[1]}var i=typeof o==="undefined"?n:ce.ToInteger(o);var a=R(A(i,0),n);return C(t,a-r.length,a)===r},includes:function includes(e){if(ce.IsRegExp(e)){throw new TypeError('"includes" does not accept a RegExp')}var t=ce.ToString(e);var r;if(arguments.length>1){r=arguments[1]}return I(this,t,r)!==-1},codePointAt:function codePointAt(e){var t=ce.ToString(ce.RequireObjectCoercible(this));var r=ce.ToInteger(e);var n=t.length;if(r>=0&&r<n){var o=t.charCodeAt(r);var i=r+1===n;if(o<55296||o>56319||i){return o}var a=t.charCodeAt(r+1);if(a<56320||a>57343){return o}return(o-55296)*1024+(a-56320)+65536}}};if(String.prototype.includes&&"a".includes("a",Infinity)!==false){ne(String.prototype,"includes",Fe.includes)}if(String.prototype.startsWith&&String.prototype.endsWith){var De=i(function(){return"/a/".startsWith(/a/)});var ze=a(function(){return"abc".startsWith("a",Infinity)===false});if(!De||!ze){ne(String.prototype,"startsWith",Fe.startsWith);ne(String.prototype,"endsWith",Fe.endsWith)}}if(oe){var qe=a(function(){var e=/a/;e[$.match]=false;return"/a/".startsWith(e)});if(!qe){ne(String.prototype,"startsWith",Fe.startsWith)}var We=a(function(){var e=/a/;e[$.match]=false;return"/a/".endsWith(e)});if(!We){ne(String.prototype,"endsWith",Fe.endsWith)}var Ge=a(function(){var e=/a/;e[$.match]=false;return"/a/".includes(e)});if(!Ge){ne(String.prototype,"includes",Fe.includes)}}b(String.prototype,Fe);var He=["\t\n\x0B\f\r \xa0\u1680\u180e\u2000\u2001\u2002\u2003","\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028","\u2029\ufeff"].join("");var Ve=new RegExp("(^["+He+"]+)|(["+He+"]+$)","g");var Be=function trim(){return ce.ToString(ce.RequireObjectCoercible(this)).replace(Ve,"")};var Ue=["\x85","\u200b","\ufffe"].join("");var $e=new RegExp("["+Ue+"]","g");var Je=/^[-+]0x[0-9a-f]+$/i;var Xe=Ue.trim().length!==Ue.length;h(String.prototype,"trim",Be,Xe);var Ke=function(e){return{value:e,done:arguments.length===0}};var Ze=function(e){ce.RequireObjectCoercible(e);this._s=ce.ToString(e);this._i=0};Ze.prototype.next=function(){var e=this._s;var t=this._i;if(typeof e==="undefined"||t>=e.length){this._s=void 0;return Ke()}var r=e.charCodeAt(t);var n,o;if(r<55296||r>56319||t+1===e.length){o=1}else{n=e.charCodeAt(t+1);o=n<56320||n>57343?1:2}this._i=t+o;return Ke(e.substr(t,o))};Me(Ze.prototype);Me(String.prototype,function(){return new Ze(this)});var Ye={from:function from(e){var r=this;var n;if(arguments.length>1){n=arguments[1]}var o,i;if(typeof n==="undefined"){o=false}else{if(!ce.IsCallable(n)){throw new TypeError("Array.from: when provided, the second argument must be a function")}if(arguments.length>2){i=arguments[2]}o=true}var a=typeof(te(e)||ce.GetMethod(e,ie))!=="undefined";var u,f,s;if(a){f=ce.IsConstructor(r)?Object(new r):[];var c=ce.GetIterator(e);var l,p;s=0;while(true){l=ce.IteratorStep(c);if(l===false){break}p=l.value;try{if(o){p=typeof i==="undefined"?n(p,s):t(n,i,p,s)}f[s]=p}catch(v){ce.IteratorClose(c,true);throw v}s+=1}u=s}else{var y=ce.ToObject(e);u=ce.ToLength(y.length);f=ce.IsConstructor(r)?Object(new r(u)):new Array(u);var h;for(s=0;s<u;++s){h=y[s];if(o){h=typeof i==="undefined"?n(h,s):t(n,i,h,s)}Ne(f,s,h)}}f.length=u;return f},of:function of(){var e=arguments.length;var t=this;var n=r(t)||!ce.IsCallable(t)?new Array(e):ce.Construct(t,[e]);for(var o=0;o<e;++o){Ne(n,o,arguments[o])}n.length=e;return n}};b(Array,Ye);Ce(Array);q=function(e,t){this.i=0;this.array=e;this.kind=t};b(q.prototype,{next:function(){var e=this.i;var t=this.array;if(!(this instanceof q)){throw new TypeError("Not an ArrayIterator")}if(typeof t!=="undefined"){var r=ce.ToLength(t.length);for(;e<r;e++){var n=this.kind;var o;if(n==="key"){o=e}else if(n==="value"){o=t[e]}else if(n==="entry"){o=[e,t[e]]}this.i=e+1;return Ke(o)}}this.array=void 0;return Ke()}});Me(q.prototype);var Qe=Array.of===Ye.of||function(){var e=function Foo(e){this.length=e};e.prototype=[];var t=Array.of.apply(e,[1,2]);return t instanceof e&&t.length===2}();if(!Qe){ne(Array,"of",Ye.of)}var et={copyWithin:function copyWithin(e,t){var r=ce.ToObject(this);var n=ce.ToLength(r.length);var o=ce.ToInteger(e);var i=ce.ToInteger(t);var a=o<0?A(n+o,0):R(o,n);var u=i<0?A(n+i,0):R(i,n);var f;if(arguments.length>2){f=arguments[2]}var s=typeof f==="undefined"?n:ce.ToInteger(f);var c=s<0?A(n+s,0):R(s,n);var l=R(c-u,n-a);var p=1;if(u<a&&a<u+l){p=-1;u+=l-1;a+=l-1}while(l>0){if(u in r){r[a]=r[u]}else{delete r[a]}u+=p;a+=p;l-=1}return r},fill:function fill(e){var t;if(arguments.length>1){t=arguments[1]}var r;if(arguments.length>2){r=arguments[2]}var n=ce.ToObject(this);var o=ce.ToLength(n.length);t=ce.ToInteger(typeof t==="undefined"?0:t);r=ce.ToInteger(typeof r==="undefined"?o:r);var i=t<0?A(o+t,0):R(t,o);var a=r<0?o+r:r;for(var u=i;u<o&&u<a;++u){n[u]=e}return n},find:function find(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#find: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0,a;i<n;i++){a=r[i];if(o){if(t(e,o,a,i,r)){return a}}else if(e(a,i,r)){return a}}},findIndex:function findIndex(e){var r=ce.ToObject(this);var n=ce.ToLength(r.length);if(!ce.IsCallable(e)){throw new TypeError("Array#findIndex: predicate must be a function")}var o=arguments.length>1?arguments[1]:null;for(var i=0;i<n;i++){if(o){if(t(e,o,r[i],i,r)){return i}}else if(e(r[i],i,r)){return i}}return-1},keys:function keys(){return new q(this,"key")},values:function values(){return new q(this,"value")},entries:function entries(){return new q(this,"entry")}};if(Array.prototype.keys&&!ce.IsCallable([1].keys().next)){delete Array.prototype.keys}if(Array.prototype.entries&&!ce.IsCallable([1].entries().next)){delete Array.prototype.entries}if(Array.prototype.keys&&Array.prototype.entries&&!Array.prototype.values&&Array.prototype[ie]){b(Array.prototype,{values:Array.prototype[ie]});if(re.symbol($.unscopables)){Array.prototype[$.unscopables].values=true}}if(c&&Array.prototype.values&&Array.prototype.values.name!=="values"){var tt=Array.prototype.values;ne(Array.prototype,"values",function values(){return ce.Call(tt,this,arguments)});h(Array.prototype,ie,Array.prototype.values,true)}b(Array.prototype,et);if(1/[true].indexOf(true,-0)<0){h(Array.prototype,"indexOf",function indexOf(e){var t=E(this,arguments);if(t===0&&1/t<0){return 0}return t},true)}Me(Array.prototype,function(){return this.values()});if(Object.getPrototypeOf){Me(Object.getPrototypeOf([].values()))}var rt=function(){return a(function(){return Array.from({length:-1}).length===0})}();var nt=function(){var e=Array.from([0].entries());return e.length===1&&r(e[0])&&e[0][0]===0&&e[0][1]===0}();if(!rt||!nt){ne(Array,"from",Ye.from)}var ot=function(){return a(function(){return Array.from([0],void 0)})}();if(!ot){var it=Array.from;ne(Array,"from",function from(e){if(arguments.length>1&&typeof arguments[1]!=="undefined"){return ce.Call(it,this,arguments)}else{return t(it,this,e)}})}var at=-(Math.pow(2,32)-1);var ut=function(e,r){var n={length:at};n[r?(n.length>>>0)-1:0]=true;return a(function(){t(e,n,function(){throw new RangeError("should not reach here")},[]);return true})};if(!ut(Array.prototype.forEach)){var ft=Array.prototype.forEach;ne(Array.prototype,"forEach",function forEach(e){return ce.Call(ft,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.map)){var st=Array.prototype.map;ne(Array.prototype,"map",function map(e){return ce.Call(st,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.filter)){var ct=Array.prototype.filter;ne(Array.prototype,"filter",function filter(e){return ce.Call(ct,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.some)){var lt=Array.prototype.some;ne(Array.prototype,"some",function some(e){return ce.Call(lt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.every)){var pt=Array.prototype.every;ne(Array.prototype,"every",function every(e){return ce.Call(pt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduce)){var vt=Array.prototype.reduce;ne(Array.prototype,"reduce",function reduce(e){return ce.Call(vt,this.length>=0?this:[],arguments)},true)}if(!ut(Array.prototype.reduceRight,true)){var yt=Array.prototype.reduceRight;ne(Array.prototype,"reduceRight",function reduceRight(e){return ce.Call(yt,this.length>=0?this:[],arguments)},true)}var ht=Number("0o10")!==8;var bt=Number("0b10")!==2;var gt=y(Ue,function(e){return Number(e+0+e)===0});if(ht||bt||gt){var dt=Number;var mt=/^0b[01]+$/i;var Ot=/^0o[0-7]+$/i;var wt=mt.test.bind(mt);var jt=Ot.test.bind(Ot);var St=function(e){var t;if(typeof e.valueOf==="function"){t=e.valueOf();if(re.primitive(t)){return t}}if(typeof e.toString==="function"){t=e.toString();if(re.primitive(t)){return t}}throw new TypeError("No default value")};var Tt=$e.test.bind($e);var It=Je.test.bind(Je);var Et=function(){var e=function Number(t){var r;if(arguments.length>0){r=re.primitive(t)?t:St(t,"number")}else{r=0}if(typeof r==="string"){r=ce.Call(Be,r);if(wt(r)){r=parseInt(C(r,2),2)}else if(jt(r)){r=parseInt(C(r,2),8)}else if(Tt(r)||It(r)){r=NaN}}var n=this;var o=a(function(){dt.prototype.valueOf.call(n);return true});if(n instanceof e&&!o){return new dt(r)}return dt(r)};return e}();Ee(dt,Et,{});b(Et,{NaN:dt.NaN,MAX_VALUE:dt.MAX_VALUE,MIN_VALUE:dt.MIN_VALUE,NEGATIVE_INFINITY:dt.NEGATIVE_INFINITY,POSITIVE_INFINITY:dt.POSITIVE_INFINITY});Number=Et;m.redefine(S,"Number",Et)}var Pt=Math.pow(2,53)-1;b(Number,{MAX_SAFE_INTEGER:Pt,MIN_SAFE_INTEGER:-Pt,EPSILON:2.220446049250313e-16,parseInt:S.parseInt,parseFloat:S.parseFloat,isFinite:K,isInteger:function isInteger(e){return K(e)&&ce.ToInteger(e)===e},isSafeInteger:function isSafeInteger(e){return Number.isInteger(e)&&k(e)<=Number.MAX_SAFE_INTEGER},isNaN:X});h(Number,"parseInt",S.parseInt,Number.parseInt!==S.parseInt);if([,1].find(function(){return true})===1){ne(Array.prototype,"find",et.find)}if([,1].findIndex(function(){return true})!==0){ne(Array.prototype,"findIndex",et.findIndex)}var Ct=Function.bind.call(Function.bind,Object.prototype.propertyIsEnumerable);var Mt=function ensureEnumerable(e,t){if(s&&Ct(e,t)){Object.defineProperty(e,t,{enumerable:false})}};var xt=function sliceArgs(){var e=Number(this);var t=arguments.length;var r=t-e;var n=new Array(r<0?0:r);for(var o=e;o<t;++o){n[o-e]=arguments[o]}return n};var Nt=function assignTo(e){return function assignToSource(t,r){t[r]=e[r];return t}};var At=function(e,t){var r=n(Object(t));var o;if(ce.IsCallable(Object.getOwnPropertySymbols)){o=v(Object.getOwnPropertySymbols(Object(t)),Ct(t))}return p(P(r,o||[]),Nt(t),e)};var Rt={assign:function(e,t){var r=ce.ToObject(e,"Cannot convert undefined or null to object");return p(ce.Call(xt,1,arguments),At,r)},is:function is(e,t){return ce.SameValue(e,t)}};var _t=Object.assign&&Object.preventExtensions&&function(){var e=Object.preventExtensions({1:2});try{Object.assign(e,"xy")}catch(t){return e[1]==="y"}}();if(_t){ne(Object,"assign",Rt.assign)}b(Object,Rt);if(s){var kt={setPrototypeOf:function(e,r){var n;var o=function(e,t){if(!ce.TypeIsObject(e)){throw new TypeError("cannot set prototype on a non-object")}if(!(t===null||ce.TypeIsObject(t))){throw new TypeError("can only set prototype to an object or null"+t)}};var i=function(e,r){o(e,r);t(n,e,r);return e};try{n=e.getOwnPropertyDescriptor(e.prototype,r).set;t(n,{},null)}catch(a){if(e.prototype!=={}[r]){return}n=function(e){this[r]=e};i.polyfill=i(i({},null),e.prototype)instanceof e}return i}(Object,"__proto__")};b(Object,kt)}if(Object.setPrototypeOf&&Object.getPrototypeOf&&Object.getPrototypeOf(Object.setPrototypeOf({},null))!==null&&Object.getPrototypeOf(Object.create(null))===null){(function(){var e=Object.create(null);var t=Object.getPrototypeOf;var r=Object.setPrototypeOf;Object.getPrototypeOf=function(r){var n=t(r);return n===e?null:n};Object.setPrototypeOf=function(t,n){var o=n===null?e:n;return r(t,o)};Object.setPrototypeOf.polyfill=false})()}var Lt=!i(function(){return Object.keys("foo")});if(!Lt){var Ft=Object.keys;ne(Object,"keys",function keys(e){return Ft(ce.ToObject(e))});n=Object.keys}var Dt=i(function(){return Object.keys(/a/g)});if(Dt){var zt=Object.keys;ne(Object,"keys",function keys(e){if(re.regex(e)){var t=[];for(var r in e){if(z(e,r)){M(t,r)}}return t}return zt(e)});n=Object.keys}if(Object.getOwnPropertyNames){var qt=!i(function(){return Object.getOwnPropertyNames("foo")});if(!qt){var Wt=typeof window==="object"?Object.getOwnPropertyNames(window):[];var Gt=Object.getOwnPropertyNames;ne(Object,"getOwnPropertyNames",function getOwnPropertyNames(e){var t=ce.ToObject(e);if(g(t)==="[object Window]"){try{return Gt(t)}catch(r){return P([],Wt)}}return Gt(t)})}}if(Object.getOwnPropertyDescriptor){var Ht=!i(function(){return Object.getOwnPropertyDescriptor("foo","bar")});if(!Ht){var Vt=Object.getOwnPropertyDescriptor;ne(Object,"getOwnPropertyDescriptor",function getOwnPropertyDescriptor(e,t){return Vt(ce.ToObject(e),t)})}}if(Object.seal){var Bt=!i(function(){return Object.seal("foo")});if(!Bt){var Ut=Object.seal;ne(Object,"seal",function seal(e){if(!ce.TypeIsObject(e)){return e}return Ut(e)})}}if(Object.isSealed){var $t=!i(function(){return Object.isSealed("foo")});if(!$t){var Jt=Object.isSealed;ne(Object,"isSealed",function isSealed(e){if(!ce.TypeIsObject(e)){return true}return Jt(e)})}}if(Object.freeze){var Xt=!i(function(){return Object.freeze("foo")});if(!Xt){var Kt=Object.freeze;ne(Object,"freeze",function freeze(e){if(!ce.TypeIsObject(e)){return e}return Kt(e)})}}if(Object.isFrozen){var Zt=!i(function(){return Object.isFrozen("foo")});if(!Zt){var Yt=Object.isFrozen;ne(Object,"isFrozen",function isFrozen(e){if(!ce.TypeIsObject(e)){return true}return Yt(e)})}}if(Object.preventExtensions){var Qt=!i(function(){return Object.preventExtensions("foo")});if(!Qt){var er=Object.preventExtensions;ne(Object,"preventExtensions",function preventExtensions(e){if(!ce.TypeIsObject(e)){return e}return er(e)})}}if(Object.isExtensible){var tr=!i(function(){return Object.isExtensible("foo")});if(!tr){var rr=Object.isExtensible;ne(Object,"isExtensible",function isExtensible(e){if(!ce.TypeIsObject(e)){return false}return rr(e)})}}if(Object.getPrototypeOf){var nr=!i(function(){return Object.getPrototypeOf("foo")});if(!nr){var or=Object.getPrototypeOf;ne(Object,"getPrototypeOf",function getPrototypeOf(e){return or(ce.ToObject(e))})}}var ir=s&&function(){var e=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags");return e&&ce.IsCallable(e.get)}();if(s&&!ir){var ar=function flags(){if(!ce.TypeIsObject(this)){throw new TypeError("Method called on incompatible type: must be an object.")}var e="";if(this.global){e+="g"}if(this.ignoreCase){e+="i"}if(this.multiline){e+="m"}if(this.unicode){e+="u"}if(this.sticky){e+="y"}return e};m.getter(RegExp.prototype,"flags",ar)}var ur=s&&a(function(){return String(new RegExp(/a/g,"i"))==="/a/i"});var fr=oe&&s&&function(){var e=/./;e[$.match]=false;return RegExp(e)===e}();var sr=a(function(){return RegExp.prototype.toString.call({source:"abc"})==="/abc/"});var cr=sr&&a(function(){return RegExp.prototype.toString.call({source:"a",flags:"b"})==="/a/b"});if(!sr||!cr){var lr=RegExp.prototype.toString;h(RegExp.prototype,"toString",function toString(){var e=ce.RequireObjectCoercible(this);if(re.regex(e)){return t(lr,e)}var r=ue(e.source);var n=ue(e.flags);return"/"+r+"/"+n},true);m.preserveToString(RegExp.prototype.toString,lr)}if(s&&(!ur||fr)){var pr=Object.getOwnPropertyDescriptor(RegExp.prototype,"flags").get;var vr=Object.getOwnPropertyDescriptor(RegExp.prototype,"source")||{};var yr=function(){return this.source};var hr=ce.IsCallable(vr.get)?vr.get:yr;var br=RegExp;var gr=function(){return function RegExp(e,t){var r=ce.IsRegExp(e);var n=this instanceof RegExp;if(!n&&r&&typeof t==="undefined"&&e.constructor===RegExp){return e}var o=e;var i=t;if(re.regex(e)){o=ce.Call(hr,e);i=typeof t==="undefined"?ce.Call(pr,e):t;return new RegExp(o,i)}else if(r){o=e.source;i=typeof t==="undefined"?e.flags:t}return new br(e,t)}}();Ee(br,gr,{$input:true});RegExp=gr;m.redefine(S,"RegExp",gr)}if(s){var dr={input:"$_",lastMatch:"$&",lastParen:"$+",leftContext:"$`",rightContext:"$'"};l(n(dr),function(e){if(e in RegExp&&!(dr[e]in RegExp)){m.getter(RegExp,dr[e],function get(){return RegExp[e]})}})}Ce(RegExp);var mr=1/Number.EPSILON;var Or=function roundTiesToEven(e){return e+mr-mr};var wr=Math.pow(2,-23);var jr=Math.pow(2,127)*(2-wr);var Sr=Math.pow(2,-126);var Tr=Math.E;var Ir=Math.LOG2E;var Er=Math.LOG10E;var Pr=Number.prototype.clz;delete Number.prototype.clz;var Cr={acosh:function acosh(e){var t=Number(e);if(X(t)||e<1){return NaN}if(t===1){return 0}if(t===Infinity){return t}var r=1/(t*t);if(t<2){return Y(t-1+D(1-r)*t)}var n=t/2;return Y(n+D(1-r)*n-1)+1/Ir},asinh:function asinh(e){var t=Number(e);if(t===0||!T(t)){return t}var r=k(t);var n=r*r;var o=Z(t);if(r<1){return o*Y(r+n/(D(n+1)+1))}return o*(Y(r/2+D(1+1/n)*r/2-1)+1/Ir)},atanh:function atanh(e){var t=Number(e);if(t===0){return t}if(t===-1){return-Infinity}if(t===1){return Infinity}if(X(t)||t<-1||t>1){return NaN}var r=k(t);return Z(t)*Y(2*r/(1-r))/2},cbrt:function cbrt(e){var t=Number(e);if(t===0){return t}var r=t<0;var n;if(r){t=-t}if(t===Infinity){n=Infinity}else{n=L(F(t)/3);n=(t/(n*n)+2*n)/3}return r?-n:n},clz32:function clz32(e){var t=Number(e);var r=ce.ToUint32(t);if(r===0){return 32}return Pr?ce.Call(Pr,r):31-_(F(r+.5)*Ir)},cosh:function cosh(e){var t=Number(e);if(t===0){return 1}if(X(t)){return NaN}if(!T(t)){return Infinity}var r=L(k(t)-1);return(r+1/(r*Tr*Tr))*(Tr/2)},expm1:function expm1(e){var t=Number(e);if(t===-Infinity){return-1}if(!T(t)||t===0){return t}if(k(t)>.5){return L(t)-1}var r=t;var n=0;var o=1;while(n+r!==n){n+=r;o+=1;r*=t/o}return n},hypot:function hypot(e,t){var r=0;var n=0;for(var o=0;o<arguments.length;++o){var i=k(Number(arguments[o]));if(n<i){r*=n/i*(n/i);r+=1;n=i}else{r+=i>0?i/n*(i/n):i}}return n===Infinity?Infinity:n*D(r)},log2:function log2(e){return F(e)*Ir},log10:function log10(e){return F(e)*Er},log1p:Y,sign:Z,sinh:function sinh(e){var t=Number(e);if(!T(t)||t===0){return t}var r=k(t);if(r<1){var n=Math.expm1(r);return Z(t)*n*(1+1/(n+1))/2}var o=L(r-1);return Z(t)*(o-1/(o*Tr*Tr))*(Tr/2)},tanh:function tanh(e){var t=Number(e);if(X(t)||t===0){return t}if(t>=20){return 1}if(t<=-20){return-1}return(Math.expm1(t)-Math.expm1(-t))/(L(t)+L(-t))},trunc:function trunc(e){var t=Number(e);return t<0?-_(-t):_(t)},imul:function imul(e,t){var r=ce.ToUint32(e);var n=ce.ToUint32(t);var o=r>>>16&65535;var i=r&65535;var a=n>>>16&65535;var u=n&65535;return i*u+(o*u+i*a<<16>>>0)|0},fround:function fround(e){var t=Number(e);if(t===0||t===Infinity||t===-Infinity||X(t)){return t}var r=Z(t);var n=k(t);if(n<Sr){return r*Or(n/Sr/wr)*Sr*wr}var o=(1+wr/Number.EPSILON)*n;var i=o-(o-n);if(i>jr||X(i)){return r*Infinity}return r*i}};var Mr=function withinULPDistance(e,t,r){return k(1-e/t)/Number.EPSILON<(r||8)};b(Math,Cr);h(Math,"sinh",Cr.sinh,Math.sinh(710)===Infinity);h(Math,"cosh",Cr.cosh,Math.cosh(710)===Infinity);h(Math,"log1p",Cr.log1p,Math.log1p(-1e-17)!==-1e-17);h(Math,"asinh",Cr.asinh,Math.asinh(-1e7)!==-Math.asinh(1e7));h(Math,"asinh",Cr.asinh,Math.asinh(1e300)===Infinity);h(Math,"atanh",Cr.atanh,Math.atanh(1e-300)===0);h(Math,"tanh",Cr.tanh,Math.tanh(-2e-17)!==-2e-17);
h(Math,"acosh",Cr.acosh,Math.acosh(Number.MAX_VALUE)===Infinity);h(Math,"acosh",Cr.acosh,!Mr(Math.acosh(1+Number.EPSILON),Math.sqrt(2*Number.EPSILON)));h(Math,"cbrt",Cr.cbrt,!Mr(Math.cbrt(1e-300),1e-100));h(Math,"sinh",Cr.sinh,Math.sinh(-2e-17)!==-2e-17);var xr=Math.expm1(10);h(Math,"expm1",Cr.expm1,xr>22025.465794806718||xr<22025.465794806718);var Nr=Math.round;var Ar=Math.round(.5-Number.EPSILON/4)===0&&Math.round(-.5+Number.EPSILON/3.99)===1;var Rr=mr+1;var _r=2*mr-1;var kr=[Rr,_r].every(function(e){return Math.round(e)===e});h(Math,"round",function round(e){var t=_(e);var r=t===-1?-0:t+1;return e-t<.5?t:r},!Ar||!kr);m.preserveToString(Math.round,Nr);var Lr=Math.imul;if(Math.imul(4294967295,5)!==-5){Math.imul=Cr.imul;m.preserveToString(Math.imul,Lr)}if(Math.imul.length!==2){ne(Math,"imul",function imul(e,t){return ce.Call(Lr,Math,arguments)})}var Fr=function(){var e=S.setTimeout;if(typeof e!=="function"&&typeof e!=="object"){return}ce.IsPromise=function(e){if(!ce.TypeIsObject(e)){return false}if(typeof e._promise==="undefined"){return false}return true};var r=function(e){if(!ce.IsConstructor(e)){throw new TypeError("Bad promise constructor")}var t=this;var r=function(e,r){if(t.resolve!==void 0||t.reject!==void 0){throw new TypeError("Bad Promise implementation!")}t.resolve=e;t.reject=r};t.resolve=void 0;t.reject=void 0;t.promise=new e(r);if(!(ce.IsCallable(t.resolve)&&ce.IsCallable(t.reject))){throw new TypeError("Bad promise constructor")}};var n;if(typeof window!=="undefined"&&ce.IsCallable(window.postMessage)){n=function(){var e=[];var t="zero-timeout-message";var r=function(r){M(e,r);window.postMessage(t,"*")};var n=function(r){if(r.source===window&&r.data===t){r.stopPropagation();if(e.length===0){return}var n=N(e);n()}};window.addEventListener("message",n,true);return r}}var o=function(){var e=S.Promise;var t=e&&e.resolve&&e.resolve();return t&&function(e){return t.then(e)}};var i=ce.IsCallable(S.setImmediate)?S.setImmediate:typeof process==="object"&&process.nextTick?process.nextTick:o()||(ce.IsCallable(n)?n():function(t){e(t,0)});var a=function(e){return e};var u=function(e){throw e};var f=0;var s=1;var c=2;var l=0;var p=1;var v=2;var y={};var h=function(e,t,r){i(function(){g(e,t,r)})};var g=function(e,t,r){var n,o;if(t===y){return e(r)}try{n=e(r);o=t.resolve}catch(i){n=i;o=t.reject}o(n)};var d=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.fulfillReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+l],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=s;r.reactionLength=0};var m=function(e,t){var r=e._promise;var n=r.reactionLength;if(n>0){h(r.rejectReactionHandler0,r.reactionCapability0,t);r.fulfillReactionHandler0=void 0;r.rejectReactions0=void 0;r.reactionCapability0=void 0;if(n>1){for(var o=1,i=0;o<n;o++,i+=3){h(r[i+p],r[i+v],t);e[i+l]=void 0;e[i+p]=void 0;e[i+v]=void 0}}}r.result=t;r.state=c;r.reactionLength=0};var O=function(e){var t=false;var r=function(r){var n;if(t){return}t=true;if(r===e){return m(e,new TypeError("Self resolution"))}if(!ce.TypeIsObject(r)){return d(e,r)}try{n=r.then}catch(o){return m(e,o)}if(!ce.IsCallable(n)){return d(e,r)}i(function(){j(e,r,n)})};var n=function(r){if(t){return}t=true;return m(e,r)};return{resolve:r,reject:n}};var w=function(e,r,n,o){if(e===I){t(e,r,n,o,y)}else{t(e,r,n,o)}};var j=function(e,t,r){var n=O(e);var o=n.resolve;var i=n.reject;try{w(r,t,o,i)}catch(a){i(a)}};var T,I;var E=function(){var e=function Promise(t){if(!(this instanceof e)){throw new TypeError('Constructor Promise requires "new"')}if(this&&this._promise){throw new TypeError("Bad construction")}if(!ce.IsCallable(t)){throw new TypeError("not a valid resolver")}var r=Ae(this,e,T,{_promise:{result:void 0,state:f,reactionLength:0,fulfillReactionHandler0:void 0,rejectReactionHandler0:void 0,reactionCapability0:void 0}});var n=O(r);var o=n.reject;try{t(n.resolve,o)}catch(i){o(i)}return r};return e}();T=E.prototype;var P=function(e,t,r,n){var o=false;return function(i){if(o){return}o=true;t[e]=i;if(--n.count===0){var a=r.resolve;a(t)}}};var C=function(e,t,r){var n=e.iterator;var o=[];var i={count:1};var a,u;var f=0;while(true){try{a=ce.IteratorStep(n);if(a===false){e.done=true;break}u=a.value}catch(s){e.done=true;throw s}o[f]=void 0;var c=t.resolve(u);var l=P(f,o,r,i);i.count+=1;w(c.then,c,l,r.reject);f+=1}if(--i.count===0){var p=r.resolve;p(o)}return r.promise};var x=function(e,t,r){var n=e.iterator;var o,i,a;while(true){try{o=ce.IteratorStep(n);if(o===false){e.done=true;break}i=o.value}catch(u){e.done=true;throw u}a=t.resolve(i);w(a.then,a,r.resolve,r.reject)}return r.promise};b(E,{all:function all(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return C(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},race:function race(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Promise is not object")}var n=new r(t);var o,i;try{o=ce.GetIterator(e);i={iterator:o,done:false};return x(i,t,n)}catch(a){var u=a;if(i&&!i.done){try{ce.IteratorClose(o,true)}catch(f){u=f}}var s=n.reject;s(u);return n.promise}},reject:function reject(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}var n=new r(t);var o=n.reject;o(e);return n.promise},resolve:function resolve(e){var t=this;if(!ce.TypeIsObject(t)){throw new TypeError("Bad promise constructor")}if(ce.IsPromise(e)){var n=e.constructor;if(n===t){return e}}var o=new r(t);var i=o.resolve;i(e);return o.promise}});b(T,{"catch":function(e){return this.then(null,e)},then:function then(e,t){var n=this;if(!ce.IsPromise(n)){throw new TypeError("not a promise")}var o=ce.SpeciesConstructor(n,E);var i;var b=arguments.length>2&&arguments[2]===y;if(b&&o===E){i=y}else{i=new r(o)}var g=ce.IsCallable(e)?e:a;var d=ce.IsCallable(t)?t:u;var m=n._promise;var O;if(m.state===f){if(m.reactionLength===0){m.fulfillReactionHandler0=g;m.rejectReactionHandler0=d;m.reactionCapability0=i}else{var w=3*(m.reactionLength-1);m[w+l]=g;m[w+p]=d;m[w+v]=i}m.reactionLength+=1}else if(m.state===s){O=m.result;h(g,i,O)}else if(m.state===c){O=m.result;h(d,i,O)}else{throw new TypeError("unexpected Promise state")}return i.promise}});y=new r(E);I=T.then;return E}();if(S.Promise){delete S.Promise.accept;delete S.Promise.defer;delete S.Promise.prototype.chain}if(typeof Fr==="function"){b(S,{Promise:Fr});var Dr=w(S.Promise,function(e){return e.resolve(42).then(function(){})instanceof e});var zr=!i(function(){return S.Promise.reject(42).then(null,5).then(null,W)});var qr=i(function(){return S.Promise.call(3,W)});var Wr=function(e){var t=e.resolve(5);t.constructor={};var r=e.resolve(t);try{r.then(null,W).then(null,W)}catch(n){return true}return t===r}(S.Promise);var Gr=s&&function(){var e=0;var t=Object.defineProperty({},"then",{get:function(){e+=1}});Promise.resolve(t);return e===1}();var Hr=function BadResolverPromise(e){var t=new Promise(e);e(3,function(){});this.then=t.then;this.constructor=BadResolverPromise};Hr.prototype=Promise.prototype;Hr.all=Promise.all;var Vr=a(function(){return!!Hr.all([1,2])});if(!Dr||!zr||!qr||Wr||!Gr||Vr){Promise=Fr;ne(S,"Promise",Fr)}if(Promise.all.length!==1){var Br=Promise.all;ne(Promise,"all",function all(e){return ce.Call(Br,this,arguments)})}if(Promise.race.length!==1){var Ur=Promise.race;ne(Promise,"race",function race(e){return ce.Call(Ur,this,arguments)})}if(Promise.resolve.length!==1){var $r=Promise.resolve;ne(Promise,"resolve",function resolve(e){return ce.Call($r,this,arguments)})}if(Promise.reject.length!==1){var Jr=Promise.reject;ne(Promise,"reject",function reject(e){return ce.Call(Jr,this,arguments)})}Mt(Promise,"all");Mt(Promise,"race");Mt(Promise,"resolve");Mt(Promise,"reject");Ce(Promise)}var Xr=function(e){var t=n(p(e,function(e,t){e[t]=true;return e},{}));return e.join(":")===t.join(":")};var Kr=Xr(["z","a","bb"]);var Zr=Xr(["z",1,"a","3",2]);if(s){var Yr=function fastkey(e,t){if(!t&&!Kr){return null}if(se(e)){return"^"+ce.ToString(e)}else if(typeof e==="string"){return"$"+e}else if(typeof e==="number"){if(!Zr){return"n"+e}return e}else if(typeof e==="boolean"){return"b"+e}return null};var Qr=function emptyObject(){return Object.create?Object.create(null):{}};var en=function addIterableToMap(e,n,o){if(r(o)||re.string(o)){l(o,function(e){if(!ce.TypeIsObject(e)){throw new TypeError("Iterator value "+e+" is not an entry object")}n.set(e[0],e[1])})}else if(o instanceof e){t(e.prototype.forEach,o,function(e,t){n.set(t,e)})}else{var i,a;if(!se(o)){a=n.set;if(!ce.IsCallable(a)){throw new TypeError("bad map")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{if(!ce.TypeIsObject(f)){throw new TypeError("Iterator value "+f+" is not an entry object")}t(a,n,f[0],f[1])}catch(s){ce.IteratorClose(i,true);throw s}}}}};var tn=function addIterableToSet(e,n,o){if(r(o)||re.string(o)){l(o,function(e){n.add(e)})}else if(o instanceof e){t(e.prototype.forEach,o,function(e){n.add(e)})}else{var i,a;if(!se(o)){a=n.add;if(!ce.IsCallable(a)){throw new TypeError("bad set")}i=ce.GetIterator(o)}if(typeof i!=="undefined"){while(true){var u=ce.IteratorStep(i);if(u===false){break}var f=u.value;try{t(a,n,f)}catch(s){ce.IteratorClose(i,true);throw s}}}}};var rn={Map:function(){var e={};var r=function MapEntry(e,t){this.key=e;this.value=t;this.next=null;this.prev=null};r.prototype.isRemoved=function isRemoved(){return this.key===e};var n=function isMap(e){return!!e._es6map};var o=function requireMapSlot(e,t){if(!ce.TypeIsObject(e)||!n(e)){throw new TypeError("Method Map.prototype."+t+" called on incompatible receiver "+ce.ToString(e))}};var i=function MapIterator(e,t){o(e,"[[MapIterator]]");this.head=e._head;this.i=this.head;this.kind=t};i.prototype={isMapIterator:true,next:function next(){if(!this.isMapIterator){throw new TypeError("Not a MapIterator")}var e=this.i;var t=this.kind;var r=this.head;if(typeof this.i==="undefined"){return Ke()}while(e.isRemoved()&&e!==r){e=e.prev}var n;while(e.next!==r){e=e.next;if(!e.isRemoved()){if(t==="key"){n=e.key}else if(t==="value"){n=e.value}else{n=[e.key,e.value]}this.i=e;return Ke(n)}}this.i=void 0;return Ke()}};Me(i.prototype);var a;var u=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}if(this&&this._es6map){throw new TypeError("Bad construction")}var e=Ae(this,Map,a,{_es6map:true,_head:null,_map:G?new G:null,_size:0,_storage:Qr()});var t=new r(null,null);t.next=t.prev=t;e._head=t;if(arguments.length>0){en(Map,e,arguments[0])}return e};a=u.prototype;m.getter(a,"size",function(){if(typeof this._size==="undefined"){throw new TypeError("size method called on incompatible Map")}return this._size});b(a,{get:function get(e){o(this,"get");var t;var r=Yr(e,true);if(r!==null){t=this._storage[r];if(t){return t.value}else{return}}if(this._map){t=V.call(this._map,e);if(t){return t.value}else{return}}var n=this._head;var i=n;while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){return i.value}}},has:function has(e){o(this,"has");var t=Yr(e,true);if(t!==null){return typeof this._storage[t]!=="undefined"}if(this._map){return B.call(this._map,e)}var r=this._head;var n=r;while((n=n.next)!==r){if(ce.SameValueZero(n.key,e)){return true}}return false},set:function set(e,t){o(this,"set");var n=this._head;var i=n;var a;var u=Yr(e,true);if(u!==null){if(typeof this._storage[u]!=="undefined"){this._storage[u].value=t;return this}else{a=this._storage[u]=new r(e,t);i=n.prev}}else if(this._map){if(B.call(this._map,e)){V.call(this._map,e).value=t}else{a=new r(e,t);U.call(this._map,e,a);i=n.prev}}while((i=i.next)!==n){if(ce.SameValueZero(i.key,e)){i.value=t;return this}}a=a||new r(e,t);if(ce.SameValue(-0,e)){a.key=+0}a.next=this._head;a.prev=this._head.prev;a.prev.next=a;a.next.prev=a;this._size+=1;return this},"delete":function(t){o(this,"delete");var r=this._head;var n=r;var i=Yr(t,true);if(i!==null){if(typeof this._storage[i]==="undefined"){return false}n=this._storage[i].prev;delete this._storage[i]}else if(this._map){if(!B.call(this._map,t)){return false}n=V.call(this._map,t).prev;H.call(this._map,t)}while((n=n.next)!==r){if(ce.SameValueZero(n.key,t)){n.key=e;n.value=e;n.prev.next=n.next;n.next.prev=n.prev;this._size-=1;return true}}return false},clear:function clear(){o(this,"clear");this._map=G?new G:null;this._size=0;this._storage=Qr();var t=this._head;var r=t;var n=r.next;while((r=n)!==t){r.key=e;r.value=e;n=r.next;r.next=r.prev=t}t.next=t.prev=t},keys:function keys(){o(this,"keys");return new i(this,"key")},values:function values(){o(this,"values");return new i(this,"value")},entries:function entries(){o(this,"entries");return new i(this,"key+value")},forEach:function forEach(e){o(this,"forEach");var r=arguments.length>1?arguments[1]:null;var n=this.entries();for(var i=n.next();!i.done;i=n.next()){if(r){t(e,r,i.value[1],i.value[0],this)}else{e(i.value[1],i.value[0],this)}}}});Me(a,a.entries);return u}(),Set:function(){var e=function isSet(e){return e._es6set&&typeof e._storage!=="undefined"};var r=function requireSetSlot(t,r){if(!ce.TypeIsObject(t)||!e(t)){throw new TypeError("Set.prototype."+r+" called on incompatible receiver "+ce.ToString(t))}};var o;var i=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}if(this&&this._es6set){throw new TypeError("Bad construction")}var e=Ae(this,Set,o,{_es6set:true,"[[SetData]]":null,_storage:Qr()});if(!e._es6set){throw new TypeError("bad set")}if(arguments.length>0){tn(Set,e,arguments[0])}return e};o=i.prototype;var a=function(e){var t=e;if(t==="^null"){return null}else if(t==="^undefined"){return void 0}else{var r=t.charAt(0);if(r==="$"){return C(t,1)}else if(r==="n"){return+C(t,1)}else if(r==="b"){return t==="btrue"}}return+t};var u=function ensureMap(e){if(!e["[[SetData]]"]){var t=new rn.Map;e["[[SetData]]"]=t;l(n(e._storage),function(e){var r=a(e);t.set(r,r)});e["[[SetData]]"]=t}e._storage=null};m.getter(i.prototype,"size",function(){r(this,"size");if(this._storage){return n(this._storage).length}u(this);return this["[[SetData]]"].size});b(i.prototype,{has:function has(e){r(this,"has");var t;if(this._storage&&(t=Yr(e))!==null){return!!this._storage[t]}u(this);return this["[[SetData]]"].has(e)},add:function add(e){r(this,"add");var t;if(this._storage&&(t=Yr(e))!==null){this._storage[t]=true;return this}u(this);this["[[SetData]]"].set(e,e);return this},"delete":function(e){r(this,"delete");var t;if(this._storage&&(t=Yr(e))!==null){var n=z(this._storage,t);return delete this._storage[t]&&n}u(this);return this["[[SetData]]"]["delete"](e)},clear:function clear(){r(this,"clear");if(this._storage){this._storage=Qr()}if(this["[[SetData]]"]){this["[[SetData]]"].clear()}},values:function values(){r(this,"values");u(this);return new f(this["[[SetData]]"].values())},entries:function entries(){r(this,"entries");u(this);return new f(this["[[SetData]]"].entries())},forEach:function forEach(e){r(this,"forEach");var n=arguments.length>1?arguments[1]:null;var o=this;u(o);this["[[SetData]]"].forEach(function(r,i){if(n){t(e,n,i,i,o)}else{e(i,i,o)}})}});h(i.prototype,"keys",i.prototype.values,true);Me(i.prototype,i.prototype.values);var f=function SetIterator(e){this.it=e};f.prototype={isSetIterator:true,next:function next(){if(!this.isSetIterator){throw new TypeError("Not a SetIterator")}return this.it.next()}};Me(f.prototype);return i}()};var nn=S.Set&&!Set.prototype["delete"]&&Set.prototype.remove&&Set.prototype.items&&Set.prototype.map&&Array.isArray((new Set).keys);if(nn){S.Set=rn.Set}if(S.Map||S.Set){var on=a(function(){return new Map([[1,2]]).get(1)===2});if(!on){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,S.Map.prototype);return e};S.Map.prototype=O(G.prototype);h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var an=new Map;var un=function(){var e=new Map([[1,0],[2,0],[3,0],[4,0]]);e.set(-0,e);return e.get(0)===e&&e.get(-0)===e&&e.has(0)&&e.has(-0)}();var fn=an.set(1,2)===an;if(!un||!fn){ne(Map.prototype,"set",function set(e,r){t(U,this,e===0?0:e,r);return this})}if(!un){b(Map.prototype,{get:function get(e){return t(V,this,e===0?0:e)},has:function has(e){return t(B,this,e===0?0:e)}},true);m.preserveToString(Map.prototype.get,V);m.preserveToString(Map.prototype.has,B)}var sn=new Set;var cn=Set.prototype["delete"]&&Set.prototype.add&&Set.prototype.has&&function(e){e["delete"](0);e.add(-0);return!e.has(0)}(sn);var ln=sn.add(1)===sn;if(!cn||!ln){var pn=Set.prototype.add;Set.prototype.add=function add(e){t(pn,this,e===0?0:e);return this};m.preserveToString(Set.prototype.add,pn)}if(!cn){var vn=Set.prototype.has;Set.prototype.has=function has(e){return t(vn,this,e===0?0:e)};m.preserveToString(Set.prototype.has,vn);var yn=Set.prototype["delete"];Set.prototype["delete"]=function SetDelete(e){return t(yn,this,e===0?0:e)};m.preserveToString(Set.prototype["delete"],yn)}var hn=w(S.Map,function(e){var t=new e([]);t.set(42,42);return t instanceof e});var bn=Object.setPrototypeOf&&!hn;var gn=function(){try{return!(S.Map()instanceof S.Map)}catch(e){return e instanceof TypeError}}();if(S.Map.length!==0||bn||!gn){S.Map=function Map(){if(!(this instanceof Map)){throw new TypeError('Constructor Map requires "new"')}var e=new G;if(arguments.length>0){en(Map,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Map.prototype);return e};S.Map.prototype=G.prototype;h(S.Map.prototype,"constructor",S.Map,true);m.preserveToString(S.Map,G)}var dn=w(S.Set,function(e){var t=new e([]);t.add(42,42);return t instanceof e});var mn=Object.setPrototypeOf&&!dn;var On=function(){try{return!(S.Set()instanceof S.Set)}catch(e){return e instanceof TypeError}}();if(S.Set.length!==0||mn||!On){var wn=S.Set;S.Set=function Set(){if(!(this instanceof Set)){throw new TypeError('Constructor Set requires "new"')}var e=new wn;if(arguments.length>0){tn(Set,e,arguments[0])}delete e.constructor;Object.setPrototypeOf(e,Set.prototype);return e};S.Set.prototype=wn.prototype;h(S.Set.prototype,"constructor",S.Set,true);m.preserveToString(S.Set,wn)}var jn=new S.Map;var Sn=!a(function(){return jn.keys().next().done});if(typeof S.Map.prototype.clear!=="function"||(new S.Set).size!==0||jn.size!==0||typeof S.Map.prototype.keys!=="function"||typeof S.Set.prototype.keys!=="function"||typeof S.Map.prototype.forEach!=="function"||typeof S.Set.prototype.forEach!=="function"||u(S.Map)||u(S.Set)||typeof jn.keys().next!=="function"||Sn||!hn){b(S,{Map:rn.Map,Set:rn.Set},true)}if(S.Set.prototype.keys!==S.Set.prototype.values){h(S.Set.prototype,"keys",S.Set.prototype.values,true)}Me(Object.getPrototypeOf((new S.Map).keys()));Me(Object.getPrototypeOf((new S.Set).keys()));if(c&&S.Set.prototype.has.name!=="has"){var Tn=S.Set.prototype.has;ne(S.Set.prototype,"has",function has(e){return t(Tn,this,e)})}}b(S,rn);Ce(S.Map);Ce(S.Set)}var In=function throwUnlessTargetIsObject(e){if(!ce.TypeIsObject(e)){throw new TypeError("target must be an object")}};var En={apply:function apply(){return ce.Call(ce.Call,null,arguments)},construct:function construct(e,t){if(!ce.IsConstructor(e)){throw new TypeError("First argument must be a constructor.")}var r=arguments.length>2?arguments[2]:e;if(!ce.IsConstructor(r)){throw new TypeError("new.target must be a constructor.")}return ce.Construct(e,t,r,"internal")},deleteProperty:function deleteProperty(e,t){In(e);if(s){var r=Object.getOwnPropertyDescriptor(e,t);if(r&&!r.configurable){return false}}return delete e[t]},has:function has(e,t){In(e);return t in e}};if(Object.getOwnPropertyNames){Object.assign(En,{ownKeys:function ownKeys(e){In(e);var t=Object.getOwnPropertyNames(e);if(ce.IsCallable(Object.getOwnPropertySymbols)){x(t,Object.getOwnPropertySymbols(e))}return t}})}var Pn=function ConvertExceptionToBoolean(e){return!i(e)};if(Object.preventExtensions){Object.assign(En,{isExtensible:function isExtensible(e){In(e);return Object.isExtensible(e)},preventExtensions:function preventExtensions(e){In(e);return Pn(function(){return Object.preventExtensions(e)})}})}if(s){var Cn=function get(e,t,r){var n=Object.getOwnPropertyDescriptor(e,t);if(!n){var o=Object.getPrototypeOf(e);if(o===null){return void 0}return Cn(o,t,r)}if("value"in n){return n.value}if(n.get){return ce.Call(n.get,r)}return void 0};var Mn=function set(e,r,n,o){var i=Object.getOwnPropertyDescriptor(e,r);if(!i){var a=Object.getPrototypeOf(e);if(a!==null){return Mn(a,r,n,o)}i={value:void 0,writable:true,enumerable:true,configurable:true}}if("value"in i){if(!i.writable){return false}if(!ce.TypeIsObject(o)){return false}var u=Object.getOwnPropertyDescriptor(o,r);if(u){return ae.defineProperty(o,r,{value:n})}else{return ae.defineProperty(o,r,{value:n,writable:true,enumerable:true,configurable:true})}}if(i.set){t(i.set,o,n);return true}return false};Object.assign(En,{defineProperty:function defineProperty(e,t,r){In(e);return Pn(function(){return Object.defineProperty(e,t,r)})},getOwnPropertyDescriptor:function getOwnPropertyDescriptor(e,t){In(e);return Object.getOwnPropertyDescriptor(e,t)},get:function get(e,t){In(e);var r=arguments.length>2?arguments[2]:e;return Cn(e,t,r)},set:function set(e,t,r){In(e);var n=arguments.length>3?arguments[3]:e;return Mn(e,t,r,n)}})}if(Object.getPrototypeOf){var xn=Object.getPrototypeOf;En.getPrototypeOf=function getPrototypeOf(e){In(e);return xn(e)}}if(Object.setPrototypeOf&&En.getPrototypeOf){var Nn=function(e,t){var r=t;while(r){if(e===r){return true}r=En.getPrototypeOf(r)}return false};Object.assign(En,{setPrototypeOf:function setPrototypeOf(e,t){In(e);if(t!==null&&!ce.TypeIsObject(t)){throw new TypeError("proto must be an object or null")}if(t===ae.getPrototypeOf(e)){return true}if(ae.isExtensible&&!ae.isExtensible(e)){return false}if(Nn(e,t)){return false}Object.setPrototypeOf(e,t);return true}})}var An=function(e,t){if(!ce.IsCallable(S.Reflect[e])){h(S.Reflect,e,t)}else{var r=a(function(){S.Reflect[e](1);S.Reflect[e](NaN);S.Reflect[e](true);return true});if(r){ne(S.Reflect,e,t)}}};Object.keys(En).forEach(function(e){An(e,En[e])});var Rn=S.Reflect.getPrototypeOf;if(c&&Rn&&Rn.name!=="getPrototypeOf"){ne(S.Reflect,"getPrototypeOf",function getPrototypeOf(e){return t(Rn,S.Reflect,e)})}if(S.Reflect.setPrototypeOf){if(a(function(){S.Reflect.setPrototypeOf(1,{});return true})){ne(S.Reflect,"setPrototypeOf",En.setPrototypeOf)}}if(S.Reflect.defineProperty){if(!a(function(){var e=!S.Reflect.defineProperty(1,"test",{value:1});var t=typeof Object.preventExtensions!=="function"||!S.Reflect.defineProperty(Object.preventExtensions({}),"test",{});return e&&t})){ne(S.Reflect,"defineProperty",En.defineProperty)}}if(S.Reflect.construct){if(!a(function(){var e=function F(){};return S.Reflect.construct(function(){},[],e)instanceof e})){ne(S.Reflect,"construct",En.construct)}}if(String(new Date(NaN))!=="Invalid Date"){var _n=Date.prototype.toString;var kn=function toString(){var e=+this;if(e!==e){return"Invalid Date"}return ce.Call(_n,this)};ne(Date.prototype,"toString",kn)}var Ln={anchor:function anchor(e){return ce.CreateHTML(this,"a","name",e)},big:function big(){return ce.CreateHTML(this,"big","","")},blink:function blink(){return ce.CreateHTML(this,"blink","","")},bold:function bold(){return ce.CreateHTML(this,"b","","")},fixed:function fixed(){return ce.CreateHTML(this,"tt","","")},fontcolor:function fontcolor(e){return ce.CreateHTML(this,"font","color",e)},fontsize:function fontsize(e){return ce.CreateHTML(this,"font","size",e)},italics:function italics(){return ce.CreateHTML(this,"i","","")},link:function link(e){return ce.CreateHTML(this,"a","href",e)},small:function small(){return ce.CreateHTML(this,"small","","")},strike:function strike(){return ce.CreateHTML(this,"strike","","")},sub:function sub(){return ce.CreateHTML(this,"sub","","")},sup:function sub(){return ce.CreateHTML(this,"sup","","")}};l(Object.keys(Ln),function(e){var r=String.prototype[e];var n=false;if(ce.IsCallable(r)){var o=t(r,"",' " ');var i=P([],o.match(/"/g)).length;n=o!==o.toLowerCase()||i>2}else{n=true}if(n){ne(String.prototype,e,Ln[e])}});var Fn=function(){if(!oe){return false}var e=typeof JSON==="object"&&typeof JSON.stringify==="function"?JSON.stringify:null;if(!e){return false}if(typeof e($())!=="undefined"){return true}if(e([$()])!=="[null]"){return true}var t={a:$()};t[$()]=true;if(e(t)!=="{}"){return true}return false}();var Dn=a(function(){if(!oe){return true}return JSON.stringify(Object($()))==="{}"&&JSON.stringify([Object($())])==="[{}]"});if(Fn||!Dn){var zn=JSON.stringify;ne(JSON,"stringify",function stringify(e){if(typeof e==="symbol"){return}var n;if(arguments.length>1){n=arguments[1]}var o=[e];if(!r(n)){var i=ce.IsCallable(n)?n:null;var a=function(e,r){var n=i?t(i,this,e,r):r;if(typeof n!=="symbol"){if(re.symbol(n)){return Nt({})(n)}else{return n}}};o.push(a)}else{o.push(n)}if(arguments.length>2){o.push(arguments[2])}return zn.apply(this,o)})}return S});
//# sourceMappingURL=es6-shim.map
/*! jQuery v3.4.1 | (c) JS Foundation and other contributors | jquery.org/license */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t(e,!0):function(e){if(!e.document)throw new Error("jQuery requires a window with a document");return t(e)}:t(e)}("undefined"!=typeof window?window:this,function(C,e){"use strict";var t=[],E=C.document,r=Object.getPrototypeOf,s=t.slice,g=t.concat,u=t.push,i=t.indexOf,n={},o=n.toString,v=n.hasOwnProperty,a=v.toString,l=a.call(Object),y={},m=function(e){return"function"==typeof e&&"number"!=typeof e.nodeType},x=function(e){return null!=e&&e===e.window},c={type:!0,src:!0,nonce:!0,noModule:!0};function b(e,t,n){var r,i,o=(n=n||E).createElement("script");if(o.text=e,t)for(r in c)(i=t[r]||t.getAttribute&&t.getAttribute(r))&&o.setAttribute(r,i);n.head.appendChild(o).parentNode.removeChild(o)}function w(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?n[o.call(e)]||"object":typeof e}var f="3.4.1",k=function(e,t){return new k.fn.init(e,t)},p=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;function d(e){var t=!!e&&"length"in e&&e.length,n=w(e);return!m(e)&&!x(e)&&("array"===n||0===t||"number"==typeof t&&0<t&&t-1 in e)}k.fn=k.prototype={jquery:f,constructor:k,length:0,toArray:function(){return s.call(this)},get:function(e){return null==e?s.call(this):e<0?this[e+this.length]:this[e]},pushStack:function(e){var t=k.merge(this.constructor(),e);return t.prevObject=this,t},each:function(e){return k.each(this,e)},map:function(n){return this.pushStack(k.map(this,function(e,t){return n.call(e,t,e)}))},slice:function(){return this.pushStack(s.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(e<0?t:0);return this.pushStack(0<=n&&n<t?[this[n]]:[])},end:function(){return this.prevObject||this.constructor()},push:u,sort:t.sort,splice:t.splice},k.extend=k.fn.extend=function(){var e,t,n,r,i,o,a=arguments[0]||{},s=1,u=arguments.length,l=!1;for("boolean"==typeof a&&(l=a,a=arguments[s]||{},s++),"object"==typeof a||m(a)||(a={}),s===u&&(a=this,s--);s<u;s++)if(null!=(e=arguments[s]))for(t in e)r=e[t],"__proto__"!==t&&a!==r&&(l&&r&&(k.isPlainObject(r)||(i=Array.isArray(r)))?(n=a[t],o=i&&!Array.isArray(n)?[]:i||k.isPlainObject(n)?n:{},i=!1,a[t]=k.extend(l,o,r)):void 0!==r&&(a[t]=r));return a},k.extend({expando:"jQuery"+(f+Math.random()).replace(/\D/g,""),isReady:!0,error:function(e){throw new Error(e)},noop:function(){},isPlainObject:function(e){var t,n;return!(!e||"[object Object]"!==o.call(e))&&(!(t=r(e))||"function"==typeof(n=v.call(t,"constructor")&&t.constructor)&&a.call(n)===l)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},globalEval:function(e,t){b(e,{nonce:t&&t.nonce})},each:function(e,t){var n,r=0;if(d(e)){for(n=e.length;r<n;r++)if(!1===t.call(e[r],r,e[r]))break}else for(r in e)if(!1===t.call(e[r],r,e[r]))break;return e},trim:function(e){return null==e?"":(e+"").replace(p,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(d(Object(e))?k.merge(n,"string"==typeof e?[e]:e):u.call(n,e)),n},inArray:function(e,t,n){return null==t?-1:i.call(t,e,n)},merge:function(e,t){for(var n=+t.length,r=0,i=e.length;r<n;r++)e[i++]=t[r];return e.length=i,e},grep:function(e,t,n){for(var r=[],i=0,o=e.length,a=!n;i<o;i++)!t(e[i],i)!==a&&r.push(e[i]);return r},map:function(e,t,n){var r,i,o=0,a=[];if(d(e))for(r=e.length;o<r;o++)null!=(i=t(e[o],o,n))&&a.push(i);else for(o in e)null!=(i=t(e[o],o,n))&&a.push(i);return g.apply([],a)},guid:1,support:y}),"function"==typeof Symbol&&(k.fn[Symbol.iterator]=t[Symbol.iterator]),k.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(e,t){n["[object "+t+"]"]=t.toLowerCase()});var h=function(n){var e,d,b,o,i,h,f,g,w,u,l,T,C,a,E,v,s,c,y,k="sizzle"+1*new Date,m=n.document,S=0,r=0,p=ue(),x=ue(),N=ue(),A=ue(),D=function(e,t){return e===t&&(l=!0),0},j={}.hasOwnProperty,t=[],q=t.pop,L=t.push,H=t.push,O=t.slice,P=function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n]===t)return n;return-1},R="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",M="[\\x20\\t\\r\\n\\f]",I="(?:\\\\.|[\\w-]|[^\0-\\xa0])+",W="\\["+M+"*("+I+")(?:"+M+"*([*^$|!~]?=)"+M+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+I+"))|)"+M+"*\\]",$=":("+I+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+W+")*)|.*)\\)|)",F=new RegExp(M+"+","g"),B=new RegExp("^"+M+"+|((?:^|[^\\\\])(?:\\\\.)*)"+M+"+$","g"),_=new RegExp("^"+M+"*,"+M+"*"),z=new RegExp("^"+M+"*([>+~]|"+M+")"+M+"*"),U=new RegExp(M+"|>"),X=new RegExp($),V=new RegExp("^"+I+"$"),G={ID:new RegExp("^#("+I+")"),CLASS:new RegExp("^\\.("+I+")"),TAG:new RegExp("^("+I+"|[*])"),ATTR:new RegExp("^"+W),PSEUDO:new RegExp("^"+$),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+M+"*(even|odd|(([+-]|)(\\d*)n|)"+M+"*(?:([+-]|)"+M+"*(\\d+)|))"+M+"*\\)|)","i"),bool:new RegExp("^(?:"+R+")$","i"),needsContext:new RegExp("^"+M+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+M+"*((?:-\\d)?\\d*)"+M+"*\\)|)(?=[^-]|$)","i")},Y=/HTML$/i,Q=/^(?:input|select|textarea|button)$/i,J=/^h\d$/i,K=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,ee=/[+~]/,te=new RegExp("\\\\([\\da-f]{1,6}"+M+"?|("+M+")|.)","ig"),ne=function(e,t,n){var r="0x"+t-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)},re=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\0-\x1f\x7f-\uFFFF\w-]/g,ie=function(e,t){return t?"\0"===e?"\ufffd":e.slice(0,-1)+"\\"+e.charCodeAt(e.length-1).toString(16)+" ":"\\"+e},oe=function(){T()},ae=be(function(e){return!0===e.disabled&&"fieldset"===e.nodeName.toLowerCase()},{dir:"parentNode",next:"legend"});try{H.apply(t=O.call(m.childNodes),m.childNodes),t[m.childNodes.length].nodeType}catch(e){H={apply:t.length?function(e,t){L.apply(e,O.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}function se(t,e,n,r){var i,o,a,s,u,l,c,f=e&&e.ownerDocument,p=e?e.nodeType:9;if(n=n||[],"string"!=typeof t||!t||1!==p&&9!==p&&11!==p)return n;if(!r&&((e?e.ownerDocument||e:m)!==C&&T(e),e=e||C,E)){if(11!==p&&(u=Z.exec(t)))if(i=u[1]){if(9===p){if(!(a=e.getElementById(i)))return n;if(a.id===i)return n.push(a),n}else if(f&&(a=f.getElementById(i))&&y(e,a)&&a.id===i)return n.push(a),n}else{if(u[2])return H.apply(n,e.getElementsByTagName(t)),n;if((i=u[3])&&d.getElementsByClassName&&e.getElementsByClassName)return H.apply(n,e.getElementsByClassName(i)),n}if(d.qsa&&!A[t+" "]&&(!v||!v.test(t))&&(1!==p||"object"!==e.nodeName.toLowerCase())){if(c=t,f=e,1===p&&U.test(t)){(s=e.getAttribute("id"))?s=s.replace(re,ie):e.setAttribute("id",s=k),o=(l=h(t)).length;while(o--)l[o]="#"+s+" "+xe(l[o]);c=l.join(","),f=ee.test(t)&&ye(e.parentNode)||e}try{return H.apply(n,f.querySelectorAll(c)),n}catch(e){A(t,!0)}finally{s===k&&e.removeAttribute("id")}}}return g(t.replace(B,"$1"),e,n,r)}function ue(){var r=[];return function e(t,n){return r.push(t+" ")>b.cacheLength&&delete e[r.shift()],e[t+" "]=n}}function le(e){return e[k]=!0,e}function ce(e){var t=C.createElement("fieldset");try{return!!e(t)}catch(e){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function fe(e,t){var n=e.split("|"),r=n.length;while(r--)b.attrHandle[n[r]]=t}function pe(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&e.sourceIndex-t.sourceIndex;if(r)return r;if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function de(t){return function(e){return"input"===e.nodeName.toLowerCase()&&e.type===t}}function he(n){return function(e){var t=e.nodeName.toLowerCase();return("input"===t||"button"===t)&&e.type===n}}function ge(t){return function(e){return"form"in e?e.parentNode&&!1===e.disabled?"label"in e?"label"in e.parentNode?e.parentNode.disabled===t:e.disabled===t:e.isDisabled===t||e.isDisabled!==!t&&ae(e)===t:e.disabled===t:"label"in e&&e.disabled===t}}function ve(a){return le(function(o){return o=+o,le(function(e,t){var n,r=a([],e.length,o),i=r.length;while(i--)e[n=r[i]]&&(e[n]=!(t[n]=e[n]))})})}function ye(e){return e&&"undefined"!=typeof e.getElementsByTagName&&e}for(e in d=se.support={},i=se.isXML=function(e){var t=e.namespaceURI,n=(e.ownerDocument||e).documentElement;return!Y.test(t||n&&n.nodeName||"HTML")},T=se.setDocument=function(e){var t,n,r=e?e.ownerDocument||e:m;return r!==C&&9===r.nodeType&&r.documentElement&&(a=(C=r).documentElement,E=!i(C),m!==C&&(n=C.defaultView)&&n.top!==n&&(n.addEventListener?n.addEventListener("unload",oe,!1):n.attachEvent&&n.attachEvent("onunload",oe)),d.attributes=ce(function(e){return e.className="i",!e.getAttribute("className")}),d.getElementsByTagName=ce(function(e){return e.appendChild(C.createComment("")),!e.getElementsByTagName("*").length}),d.getElementsByClassName=K.test(C.getElementsByClassName),d.getById=ce(function(e){return a.appendChild(e).id=k,!C.getElementsByName||!C.getElementsByName(k).length}),d.getById?(b.filter.ID=function(e){var t=e.replace(te,ne);return function(e){return e.getAttribute("id")===t}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n=t.getElementById(e);return n?[n]:[]}}):(b.filter.ID=function(e){var n=e.replace(te,ne);return function(e){var t="undefined"!=typeof e.getAttributeNode&&e.getAttributeNode("id");return t&&t.value===n}},b.find.ID=function(e,t){if("undefined"!=typeof t.getElementById&&E){var n,r,i,o=t.getElementById(e);if(o){if((n=o.getAttributeNode("id"))&&n.value===e)return[o];i=t.getElementsByName(e),r=0;while(o=i[r++])if((n=o.getAttributeNode("id"))&&n.value===e)return[o]}return[]}}),b.find.TAG=d.getElementsByTagName?function(e,t){return"undefined"!=typeof t.getElementsByTagName?t.getElementsByTagName(e):d.qsa?t.querySelectorAll(e):void 0}:function(e,t){var n,r=[],i=0,o=t.getElementsByTagName(e);if("*"===e){while(n=o[i++])1===n.nodeType&&r.push(n);return r}return o},b.find.CLASS=d.getElementsByClassName&&function(e,t){if("undefined"!=typeof t.getElementsByClassName&&E)return t.getElementsByClassName(e)},s=[],v=[],(d.qsa=K.test(C.querySelectorAll))&&(ce(function(e){a.appendChild(e).innerHTML="<a id='"+k+"'></a><select id='"+k+"-\r\\' msallowcapture=''><option selected=''></option></select>",e.querySelectorAll("[msallowcapture^='']").length&&v.push("[*^$]="+M+"*(?:''|\"\")"),e.querySelectorAll("[selected]").length||v.push("\\["+M+"*(?:value|"+R+")"),e.querySelectorAll("[id~="+k+"-]").length||v.push("~="),e.querySelectorAll(":checked").length||v.push(":checked"),e.querySelectorAll("a#"+k+"+*").length||v.push(".#.+[+~]")}),ce(function(e){e.innerHTML="<a href='' disabled='disabled'></a><select disabled='disabled'><option/></select>";var t=C.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("name","D"),e.querySelectorAll("[name=d]").length&&v.push("name"+M+"*[*^$|!~]?="),2!==e.querySelectorAll(":enabled").length&&v.push(":enabled",":disabled"),a.appendChild(e).disabled=!0,2!==e.querySelectorAll(":disabled").length&&v.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),v.push(",.*:")})),(d.matchesSelector=K.test(c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.oMatchesSelector||a.msMatchesSelector))&&ce(function(e){d.disconnectedMatch=c.call(e,"*"),c.call(e,"[s!='']:x"),s.push("!=",$)}),v=v.length&&new RegExp(v.join("|")),s=s.length&&new RegExp(s.join("|")),t=K.test(a.compareDocumentPosition),y=t||K.test(a.contains)?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!(!r||1!==r.nodeType||!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r)))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},D=t?function(e,t){if(e===t)return l=!0,0;var n=!e.compareDocumentPosition-!t.compareDocumentPosition;return n||(1&(n=(e.ownerDocument||e)===(t.ownerDocument||t)?e.compareDocumentPosition(t):1)||!d.sortDetached&&t.compareDocumentPosition(e)===n?e===C||e.ownerDocument===m&&y(m,e)?-1:t===C||t.ownerDocument===m&&y(m,t)?1:u?P(u,e)-P(u,t):0:4&n?-1:1)}:function(e,t){if(e===t)return l=!0,0;var n,r=0,i=e.parentNode,o=t.parentNode,a=[e],s=[t];if(!i||!o)return e===C?-1:t===C?1:i?-1:o?1:u?P(u,e)-P(u,t):0;if(i===o)return pe(e,t);n=e;while(n=n.parentNode)a.unshift(n);n=t;while(n=n.parentNode)s.unshift(n);while(a[r]===s[r])r++;return r?pe(a[r],s[r]):a[r]===m?-1:s[r]===m?1:0}),C},se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){if((e.ownerDocument||e)!==C&&T(e),d.matchesSelector&&E&&!A[t+" "]&&(!s||!s.test(t))&&(!v||!v.test(t)))try{var n=c.call(e,t);if(n||d.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(e){A(t,!0)}return 0<se(t,C,null,[e]).length},se.contains=function(e,t){return(e.ownerDocument||e)!==C&&T(e),y(e,t)},se.attr=function(e,t){(e.ownerDocument||e)!==C&&T(e);var n=b.attrHandle[t.toLowerCase()],r=n&&j.call(b.attrHandle,t.toLowerCase())?n(e,t,!E):void 0;return void 0!==r?r:d.attributes||!E?e.getAttribute(t):(r=e.getAttributeNode(t))&&r.specified?r.value:null},se.escape=function(e){return(e+"").replace(re,ie)},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},se.uniqueSort=function(e){var t,n=[],r=0,i=0;if(l=!d.detectDuplicates,u=!d.sortStable&&e.slice(0),e.sort(D),l){while(t=e[i++])t===e[i]&&(r=n.push(i));while(r--)e.splice(n[r],1)}return u=null,e},o=se.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else while(t=e[r++])n+=o(t);return n},(b=se.selectors={cacheLength:50,createPseudo:le,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(te,ne),e[3]=(e[3]||e[4]||e[5]||"").replace(te,ne),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||se.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&se.error(e[0]),e},PSEUDO:function(e){var t,n=!e[6]&&e[2];return G.CHILD.test(e[0])?null:(e[3]?e[2]=e[4]||e[5]||"":n&&X.test(n)&&(t=h(n,!0))&&(t=n.indexOf(")",n.length-t)-n.length)&&(e[0]=e[0].slice(0,t),e[2]=n.slice(0,t)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(te,ne).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=p[e+" "];return t||(t=new RegExp("(^|"+M+")"+e+"("+M+"|$)"))&&p(e,function(e){return t.test("string"==typeof e.className&&e.className||"undefined"!=typeof e.getAttribute&&e.getAttribute("class")||"")})},ATTR:function(n,r,i){return function(e){var t=se.attr(e,n);return null==t?"!="===r:!r||(t+="","="===r?t===i:"!="===r?t!==i:"^="===r?i&&0===t.indexOf(i):"*="===r?i&&-1<t.indexOf(i):"$="===r?i&&t.slice(-i.length)===i:"~="===r?-1<(" "+t.replace(F," ")+" ").indexOf(i):"|="===r&&(t===i||t.slice(0,i.length+1)===i+"-"))}},CHILD:function(h,e,t,g,v){var y="nth"!==h.slice(0,3),m="last"!==h.slice(-4),x="of-type"===e;return 1===g&&0===v?function(e){return!!e.parentNode}:function(e,t,n){var r,i,o,a,s,u,l=y!==m?"nextSibling":"previousSibling",c=e.parentNode,f=x&&e.nodeName.toLowerCase(),p=!n&&!x,d=!1;if(c){if(y){while(l){a=e;while(a=a[l])if(x?a.nodeName.toLowerCase()===f:1===a.nodeType)return!1;u=l="only"===h&&!u&&"nextSibling"}return!0}if(u=[m?c.firstChild:c.lastChild],m&&p){d=(s=(r=(i=(o=(a=c)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1])&&r[2],a=s&&c.childNodes[s];while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if(1===a.nodeType&&++d&&a===e){i[h]=[S,s,d];break}}else if(p&&(d=s=(r=(i=(o=(a=e)[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]||[])[0]===S&&r[1]),!1===d)while(a=++s&&a&&a[l]||(d=s=0)||u.pop())if((x?a.nodeName.toLowerCase()===f:1===a.nodeType)&&++d&&(p&&((i=(o=a[k]||(a[k]={}))[a.uniqueID]||(o[a.uniqueID]={}))[h]=[S,d]),a===e))break;return(d-=v)===g||d%g==0&&0<=d/g}}},PSEUDO:function(e,o){var t,a=b.pseudos[e]||b.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return a[k]?a(o):1<a.length?(t=[e,e,"",o],b.setFilters.hasOwnProperty(e.toLowerCase())?le(function(e,t){var n,r=a(e,o),i=r.length;while(i--)e[n=P(e,r[i])]=!(t[n]=r[i])}):function(e){return a(e,0,t)}):a}},pseudos:{not:le(function(e){var r=[],i=[],s=f(e.replace(B,"$1"));return s[k]?le(function(e,t,n,r){var i,o=s(e,null,r,[]),a=e.length;while(a--)(i=o[a])&&(e[a]=!(t[a]=i))}):function(e,t,n){return r[0]=e,s(r,null,n,i),r[0]=null,!i.pop()}}),has:le(function(t){return function(e){return 0<se(t,e).length}}),contains:le(function(t){return t=t.replace(te,ne),function(e){return-1<(e.textContent||o(e)).indexOf(t)}}),lang:le(function(n){return V.test(n||"")||se.error("unsupported lang: "+n),n=n.replace(te,ne).toLowerCase(),function(e){var t;do{if(t=E?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return(t=t.toLowerCase())===n||0===t.indexOf(n+"-")}while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var t=n.location&&n.location.hash;return t&&t.slice(1)===e.id},root:function(e){return e===a},focus:function(e){return e===C.activeElement&&(!C.hasFocus||C.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:ge(!1),disabled:ge(!0),checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeType<6)return!1;return!0},parent:function(e){return!b.pseudos.empty(e)},header:function(e){return J.test(e.nodeName)},input:function(e){return Q.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||"text"===t.toLowerCase())},first:ve(function(){return[0]}),last:ve(function(e,t){return[t-1]}),eq:ve(function(e,t,n){return[n<0?n+t:n]}),even:ve(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ve(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ve(function(e,t,n){for(var r=n<0?n+t:t<n?t:n;0<=--r;)e.push(r);return e}),gt:ve(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}}).pseudos.nth=b.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})b.pseudos[e]=de(e);for(e in{submit:!0,reset:!0})b.pseudos[e]=he(e);function me(){}function xe(e){for(var t=0,n=e.length,r="";t<n;t++)r+=e[t].value;return r}function be(s,e,t){var u=e.dir,l=e.next,c=l||u,f=t&&"parentNode"===c,p=r++;return e.first?function(e,t,n){while(e=e[u])if(1===e.nodeType||f)return s(e,t,n);return!1}:function(e,t,n){var r,i,o,a=[S,p];if(n){while(e=e[u])if((1===e.nodeType||f)&&s(e,t,n))return!0}else while(e=e[u])if(1===e.nodeType||f)if(i=(o=e[k]||(e[k]={}))[e.uniqueID]||(o[e.uniqueID]={}),l&&l===e.nodeName.toLowerCase())e=e[u]||e;else{if((r=i[c])&&r[0]===S&&r[1]===p)return a[2]=r[2];if((i[c]=a)[2]=s(e,t,n))return!0}return!1}}function we(i){return 1<i.length?function(e,t,n){var r=i.length;while(r--)if(!i[r](e,t,n))return!1;return!0}:i[0]}function Te(e,t,n,r,i){for(var o,a=[],s=0,u=e.length,l=null!=t;s<u;s++)(o=e[s])&&(n&&!n(o,r,i)||(a.push(o),l&&t.push(s)));return a}function Ce(d,h,g,v,y,e){return v&&!v[k]&&(v=Ce(v)),y&&!y[k]&&(y=Ce(y,e)),le(function(e,t,n,r){var i,o,a,s=[],u=[],l=t.length,c=e||function(e,t,n){for(var r=0,i=t.length;r<i;r++)se(e,t[r],n);return n}(h||"*",n.nodeType?[n]:n,[]),f=!d||!e&&h?c:Te(c,s,d,n,r),p=g?y||(e?d:l||v)?[]:t:f;if(g&&g(f,p,n,r),v){i=Te(p,u),v(i,[],n,r),o=i.length;while(o--)(a=i[o])&&(p[u[o]]=!(f[u[o]]=a))}if(e){if(y||d){if(y){i=[],o=p.length;while(o--)(a=p[o])&&i.push(f[o]=a);y(null,p=[],i,r)}o=p.length;while(o--)(a=p[o])&&-1<(i=y?P(e,a):s[o])&&(e[i]=!(t[i]=a))}}else p=Te(p===t?p.splice(l,p.length):p),y?y(null,t,p,r):H.apply(t,p)})}function Ee(e){for(var i,t,n,r=e.length,o=b.relative[e[0].type],a=o||b.relative[" "],s=o?1:0,u=be(function(e){return e===i},a,!0),l=be(function(e){return-1<P(i,e)},a,!0),c=[function(e,t,n){var r=!o&&(n||t!==w)||((i=t).nodeType?u(e,t,n):l(e,t,n));return i=null,r}];s<r;s++)if(t=b.relative[e[s].type])c=[be(we(c),t)];else{if((t=b.filter[e[s].type].apply(null,e[s].matches))[k]){for(n=++s;n<r;n++)if(b.relative[e[n].type])break;return Ce(1<s&&we(c),1<s&&xe(e.slice(0,s-1).concat({value:" "===e[s-2].type?"*":""})).replace(B,"$1"),t,s<n&&Ee(e.slice(s,n)),n<r&&Ee(e=e.slice(n)),n<r&&xe(e))}c.push(t)}return we(c)}return me.prototype=b.filters=b.pseudos,b.setFilters=new me,h=se.tokenize=function(e,t){var n,r,i,o,a,s,u,l=x[e+" "];if(l)return t?0:l.slice(0);a=e,s=[],u=b.preFilter;while(a){for(o in n&&!(r=_.exec(a))||(r&&(a=a.slice(r[0].length)||a),s.push(i=[])),n=!1,(r=z.exec(a))&&(n=r.shift(),i.push({value:n,type:r[0].replace(B," ")}),a=a.slice(n.length)),b.filter)!(r=G[o].exec(a))||u[o]&&!(r=u[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?se.error(e):x(e,s).slice(0)},f=se.compile=function(e,t){var n,v,y,m,x,r,i=[],o=[],a=N[e+" "];if(!a){t||(t=h(e)),n=t.length;while(n--)(a=Ee(t[n]))[k]?i.push(a):o.push(a);(a=N(e,(v=o,m=0<(y=i).length,x=0<v.length,r=function(e,t,n,r,i){var o,a,s,u=0,l="0",c=e&&[],f=[],p=w,d=e||x&&b.find.TAG("*",i),h=S+=null==p?1:Math.random()||.1,g=d.length;for(i&&(w=t===C||t||i);l!==g&&null!=(o=d[l]);l++){if(x&&o){a=0,t||o.ownerDocument===C||(T(o),n=!E);while(s=v[a++])if(s(o,t||C,n)){r.push(o);break}i&&(S=h)}m&&((o=!s&&o)&&u--,e&&c.push(o))}if(u+=l,m&&l!==u){a=0;while(s=y[a++])s(c,f,t,n);if(e){if(0<u)while(l--)c[l]||f[l]||(f[l]=q.call(r));f=Te(f)}H.apply(r,f),i&&!e&&0<f.length&&1<u+y.length&&se.uniqueSort(r)}return i&&(S=h,w=p),c},m?le(r):r))).selector=e}return a},g=se.select=function(e,t,n,r){var i,o,a,s,u,l="function"==typeof e&&e,c=!r&&h(e=l.selector||e);if(n=n||[],1===c.length){if(2<(o=c[0]=c[0].slice(0)).length&&"ID"===(a=o[0]).type&&9===t.nodeType&&E&&b.relative[o[1].type]){if(!(t=(b.find.ID(a.matches[0].replace(te,ne),t)||[])[0]))return n;l&&(t=t.parentNode),e=e.slice(o.shift().value.length)}i=G.needsContext.test(e)?0:o.length;while(i--){if(a=o[i],b.relative[s=a.type])break;if((u=b.find[s])&&(r=u(a.matches[0].replace(te,ne),ee.test(o[0].type)&&ye(t.parentNode)||t))){if(o.splice(i,1),!(e=r.length&&xe(o)))return H.apply(n,r),n;break}}}return(l||f(e,c))(r,t,!E,n,!t||ee.test(e)&&ye(t.parentNode)||t),n},d.sortStable=k.split("").sort(D).join("")===k,d.detectDuplicates=!!l,T(),d.sortDetached=ce(function(e){return 1&e.compareDocumentPosition(C.createElement("fieldset"))}),ce(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||fe("type|href|height|width",function(e,t,n){if(!n)return e.getAttribute(t,"type"===t.toLowerCase()?1:2)}),d.attributes&&ce(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||fe("value",function(e,t,n){if(!n&&"input"===e.nodeName.toLowerCase())return e.defaultValue}),ce(function(e){return null==e.getAttribute("disabled")})||fe(R,function(e,t,n){var r;if(!n)return!0===e[t]?t.toLowerCase():(r=e.getAttributeNode(t))&&r.specified?r.value:null}),se}(C);k.find=h,k.expr=h.selectors,k.expr[":"]=k.expr.pseudos,k.uniqueSort=k.unique=h.uniqueSort,k.text=h.getText,k.isXMLDoc=h.isXML,k.contains=h.contains,k.escapeSelector=h.escape;var T=function(e,t,n){var r=[],i=void 0!==n;while((e=e[t])&&9!==e.nodeType)if(1===e.nodeType){if(i&&k(e).is(n))break;r.push(e)}return r},S=function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n},N=k.expr.match.needsContext;function A(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()}var D=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function j(e,n,r){return m(n)?k.grep(e,function(e,t){return!!n.call(e,t,e)!==r}):n.nodeType?k.grep(e,function(e){return e===n!==r}):"string"!=typeof n?k.grep(e,function(e){return-1<i.call(n,e)!==r}):k.filter(n,e,r)}k.filter=function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?k.find.matchesSelector(r,e)?[r]:[]:k.find.matches(e,k.grep(t,function(e){return 1===e.nodeType}))},k.fn.extend({find:function(e){var t,n,r=this.length,i=this;if("string"!=typeof e)return this.pushStack(k(e).filter(function(){for(t=0;t<r;t++)if(k.contains(i[t],this))return!0}));for(n=this.pushStack([]),t=0;t<r;t++)k.find(e,i[t],n);return 1<r?k.uniqueSort(n):n},filter:function(e){return this.pushStack(j(this,e||[],!1))},not:function(e){return this.pushStack(j(this,e||[],!0))},is:function(e){return!!j(this,"string"==typeof e&&N.test(e)?k(e):e||[],!1).length}});var q,L=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(k.fn.init=function(e,t,n){var r,i;if(!e)return this;if(n=n||q,"string"==typeof e){if(!(r="<"===e[0]&&">"===e[e.length-1]&&3<=e.length?[null,e,null]:L.exec(e))||!r[1]&&t)return!t||t.jquery?(t||n).find(e):this.constructor(t).find(e);if(r[1]){if(t=t instanceof k?t[0]:t,k.merge(this,k.parseHTML(r[1],t&&t.nodeType?t.ownerDocument||t:E,!0)),D.test(r[1])&&k.isPlainObject(t))for(r in t)m(this[r])?this[r](t[r]):this.attr(r,t[r]);return this}return(i=E.getElementById(r[2]))&&(this[0]=i,this.length=1),this}return e.nodeType?(this[0]=e,this.length=1,this):m(e)?void 0!==n.ready?n.ready(e):e(k):k.makeArray(e,this)}).prototype=k.fn,q=k(E);var H=/^(?:parents|prev(?:Until|All))/,O={children:!0,contents:!0,next:!0,prev:!0};function P(e,t){while((e=e[t])&&1!==e.nodeType);return e}k.fn.extend({has:function(e){var t=k(e,this),n=t.length;return this.filter(function(){for(var e=0;e<n;e++)if(k.contains(this,t[e]))return!0})},closest:function(e,t){var n,r=0,i=this.length,o=[],a="string"!=typeof e&&k(e);if(!N.test(e))for(;r<i;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(n.nodeType<11&&(a?-1<a.index(n):1===n.nodeType&&k.find.matchesSelector(n,e))){o.push(n);break}return this.pushStack(1<o.length?k.uniqueSort(o):o)},index:function(e){return e?"string"==typeof e?i.call(k(e),this[0]):i.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){return this.pushStack(k.uniqueSort(k.merge(this.get(),k(e,t))))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),k.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return T(e,"parentNode")},parentsUntil:function(e,t,n){return T(e,"parentNode",n)},next:function(e){return P(e,"nextSibling")},prev:function(e){return P(e,"previousSibling")},nextAll:function(e){return T(e,"nextSibling")},prevAll:function(e){return T(e,"previousSibling")},nextUntil:function(e,t,n){return T(e,"nextSibling",n)},prevUntil:function(e,t,n){return T(e,"previousSibling",n)},siblings:function(e){return S((e.parentNode||{}).firstChild,e)},children:function(e){return S(e.firstChild)},contents:function(e){return"undefined"!=typeof e.contentDocument?e.contentDocument:(A(e,"template")&&(e=e.content||e),k.merge([],e.childNodes))}},function(r,i){k.fn[r]=function(e,t){var n=k.map(this,i,e);return"Until"!==r.slice(-5)&&(t=e),t&&"string"==typeof t&&(n=k.filter(t,n)),1<this.length&&(O[r]||k.uniqueSort(n),H.test(r)&&n.reverse()),this.pushStack(n)}});var R=/[^\x20\t\r\n\f]+/g;function M(e){return e}function I(e){throw e}function W(e,t,n,r){var i;try{e&&m(i=e.promise)?i.call(e).done(t).fail(n):e&&m(i=e.then)?i.call(e,t,n):t.apply(void 0,[e].slice(r))}catch(e){n.apply(void 0,[e])}}k.Callbacks=function(r){var e,n;r="string"==typeof r?(e=r,n={},k.each(e.match(R)||[],function(e,t){n[t]=!0}),n):k.extend({},r);var i,t,o,a,s=[],u=[],l=-1,c=function(){for(a=a||r.once,o=i=!0;u.length;l=-1){t=u.shift();while(++l<s.length)!1===s[l].apply(t[0],t[1])&&r.stopOnFalse&&(l=s.length,t=!1)}r.memory||(t=!1),i=!1,a&&(s=t?[]:"")},f={add:function(){return s&&(t&&!i&&(l=s.length-1,u.push(t)),function n(e){k.each(e,function(e,t){m(t)?r.unique&&f.has(t)||s.push(t):t&&t.length&&"string"!==w(t)&&n(t)})}(arguments),t&&!i&&c()),this},remove:function(){return k.each(arguments,function(e,t){var n;while(-1<(n=k.inArray(t,s,n)))s.splice(n,1),n<=l&&l--}),this},has:function(e){return e?-1<k.inArray(e,s):0<s.length},empty:function(){return s&&(s=[]),this},disable:function(){return a=u=[],s=t="",this},disabled:function(){return!s},lock:function(){return a=u=[],t||i||(s=t=""),this},locked:function(){return!!a},fireWith:function(e,t){return a||(t=[e,(t=t||[]).slice?t.slice():t],u.push(t),i||c()),this},fire:function(){return f.fireWith(this,arguments),this},fired:function(){return!!o}};return f},k.extend({Deferred:function(e){var o=[["notify","progress",k.Callbacks("memory"),k.Callbacks("memory"),2],["resolve","done",k.Callbacks("once memory"),k.Callbacks("once memory"),0,"resolved"],["reject","fail",k.Callbacks("once memory"),k.Callbacks("once memory"),1,"rejected"]],i="pending",a={state:function(){return i},always:function(){return s.done(arguments).fail(arguments),this},"catch":function(e){return a.then(null,e)},pipe:function(){var i=arguments;return k.Deferred(function(r){k.each(o,function(e,t){var n=m(i[t[4]])&&i[t[4]];s[t[1]](function(){var e=n&&n.apply(this,arguments);e&&m(e.promise)?e.promise().progress(r.notify).done(r.resolve).fail(r.reject):r[t[0]+"With"](this,n?[e]:arguments)})}),i=null}).promise()},then:function(t,n,r){var u=0;function l(i,o,a,s){return function(){var n=this,r=arguments,e=function(){var e,t;if(!(i<u)){if((e=a.apply(n,r))===o.promise())throw new TypeError("Thenable self-resolution");t=e&&("object"==typeof e||"function"==typeof e)&&e.then,m(t)?s?t.call(e,l(u,o,M,s),l(u,o,I,s)):(u++,t.call(e,l(u,o,M,s),l(u,o,I,s),l(u,o,M,o.notifyWith))):(a!==M&&(n=void 0,r=[e]),(s||o.resolveWith)(n,r))}},t=s?e:function(){try{e()}catch(e){k.Deferred.exceptionHook&&k.Deferred.exceptionHook(e,t.stackTrace),u<=i+1&&(a!==I&&(n=void 0,r=[e]),o.rejectWith(n,r))}};i?t():(k.Deferred.getStackHook&&(t.stackTrace=k.Deferred.getStackHook()),C.setTimeout(t))}}return k.Deferred(function(e){o[0][3].add(l(0,e,m(r)?r:M,e.notifyWith)),o[1][3].add(l(0,e,m(t)?t:M)),o[2][3].add(l(0,e,m(n)?n:I))}).promise()},promise:function(e){return null!=e?k.extend(e,a):a}},s={};return k.each(o,function(e,t){var n=t[2],r=t[5];a[t[1]]=n.add,r&&n.add(function(){i=r},o[3-e][2].disable,o[3-e][3].disable,o[0][2].lock,o[0][3].lock),n.add(t[3].fire),s[t[0]]=function(){return s[t[0]+"With"](this===s?void 0:this,arguments),this},s[t[0]+"With"]=n.fireWith}),a.promise(s),e&&e.call(s,s),s},when:function(e){var n=arguments.length,t=n,r=Array(t),i=s.call(arguments),o=k.Deferred(),a=function(t){return function(e){r[t]=this,i[t]=1<arguments.length?s.call(arguments):e,--n||o.resolveWith(r,i)}};if(n<=1&&(W(e,o.done(a(t)).resolve,o.reject,!n),"pending"===o.state()||m(i[t]&&i[t].then)))return o.then();while(t--)W(i[t],a(t),o.reject);return o.promise()}});var $=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;k.Deferred.exceptionHook=function(e,t){C.console&&C.console.warn&&e&&$.test(e.name)&&C.console.warn("jQuery.Deferred exception: "+e.message,e.stack,t)},k.readyException=function(e){C.setTimeout(function(){throw e})};var F=k.Deferred();function B(){E.removeEventListener("DOMContentLoaded",B),C.removeEventListener("load",B),k.ready()}k.fn.ready=function(e){return F.then(e)["catch"](function(e){k.readyException(e)}),this},k.extend({isReady:!1,readyWait:1,ready:function(e){(!0===e?--k.readyWait:k.isReady)||(k.isReady=!0)!==e&&0<--k.readyWait||F.resolveWith(E,[k])}}),k.ready.then=F.then,"complete"===E.readyState||"loading"!==E.readyState&&!E.documentElement.doScroll?C.setTimeout(k.ready):(E.addEventListener("DOMContentLoaded",B),C.addEventListener("load",B));var _=function(e,t,n,r,i,o,a){var s=0,u=e.length,l=null==n;if("object"===w(n))for(s in i=!0,n)_(e,t,s,n[s],!0,o,a);else if(void 0!==r&&(i=!0,m(r)||(a=!0),l&&(a?(t.call(e,r),t=null):(l=t,t=function(e,t,n){return l.call(k(e),n)})),t))for(;s<u;s++)t(e[s],n,a?r:r.call(e[s],s,t(e[s],n)));return i?e:l?t.call(e):u?t(e[0],n):o},z=/^-ms-/,U=/-([a-z])/g;function X(e,t){return t.toUpperCase()}function V(e){return e.replace(z,"ms-").replace(U,X)}var G=function(e){return 1===e.nodeType||9===e.nodeType||!+e.nodeType};function Y(){this.expando=k.expando+Y.uid++}Y.uid=1,Y.prototype={cache:function(e){var t=e[this.expando];return t||(t={},G(e)&&(e.nodeType?e[this.expando]=t:Object.defineProperty(e,this.expando,{value:t,configurable:!0}))),t},set:function(e,t,n){var r,i=this.cache(e);if("string"==typeof t)i[V(t)]=n;else for(r in t)i[V(r)]=t[r];return i},get:function(e,t){return void 0===t?this.cache(e):e[this.expando]&&e[this.expando][V(t)]},access:function(e,t,n){return void 0===t||t&&"string"==typeof t&&void 0===n?this.get(e,t):(this.set(e,t,n),void 0!==n?n:t)},remove:function(e,t){var n,r=e[this.expando];if(void 0!==r){if(void 0!==t){n=(t=Array.isArray(t)?t.map(V):(t=V(t))in r?[t]:t.match(R)||[]).length;while(n--)delete r[t[n]]}(void 0===t||k.isEmptyObject(r))&&(e.nodeType?e[this.expando]=void 0:delete e[this.expando])}},hasData:function(e){var t=e[this.expando];return void 0!==t&&!k.isEmptyObject(t)}};var Q=new Y,J=new Y,K=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Z=/[A-Z]/g;function ee(e,t,n){var r,i;if(void 0===n&&1===e.nodeType)if(r="data-"+t.replace(Z,"-$&").toLowerCase(),"string"==typeof(n=e.getAttribute(r))){try{n="true"===(i=n)||"false"!==i&&("null"===i?null:i===+i+""?+i:K.test(i)?JSON.parse(i):i)}catch(e){}J.set(e,t,n)}else n=void 0;return n}k.extend({hasData:function(e){return J.hasData(e)||Q.hasData(e)},data:function(e,t,n){return J.access(e,t,n)},removeData:function(e,t){J.remove(e,t)},_data:function(e,t,n){return Q.access(e,t,n)},_removeData:function(e,t){Q.remove(e,t)}}),k.fn.extend({data:function(n,e){var t,r,i,o=this[0],a=o&&o.attributes;if(void 0===n){if(this.length&&(i=J.get(o),1===o.nodeType&&!Q.get(o,"hasDataAttrs"))){t=a.length;while(t--)a[t]&&0===(r=a[t].name).indexOf("data-")&&(r=V(r.slice(5)),ee(o,r,i[r]));Q.set(o,"hasDataAttrs",!0)}return i}return"object"==typeof n?this.each(function(){J.set(this,n)}):_(this,function(e){var t;if(o&&void 0===e)return void 0!==(t=J.get(o,n))?t:void 0!==(t=ee(o,n))?t:void 0;this.each(function(){J.set(this,n,e)})},null,e,1<arguments.length,null,!0)},removeData:function(e){return this.each(function(){J.remove(this,e)})}}),k.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=Q.get(e,t),n&&(!r||Array.isArray(n)?r=Q.access(e,t,k.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=k.queue(e,t),r=n.length,i=n.shift(),o=k._queueHooks(e,t);"inprogress"===i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete o.stop,i.call(e,function(){k.dequeue(e,t)},o)),!r&&o&&o.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return Q.get(e,n)||Q.access(e,n,{empty:k.Callbacks("once memory").add(function(){Q.remove(e,[t+"queue",n])})})}}),k.fn.extend({queue:function(t,n){var e=2;return"string"!=typeof t&&(n=t,t="fx",e--),arguments.length<e?k.queue(this[0],t):void 0===n?this:this.each(function(){var e=k.queue(this,t,n);k._queueHooks(this,t),"fx"===t&&"inprogress"!==e[0]&&k.dequeue(this,t)})},dequeue:function(e){return this.each(function(){k.dequeue(this,e)})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,t){var n,r=1,i=k.Deferred(),o=this,a=this.length,s=function(){--r||i.resolveWith(o,[o])};"string"!=typeof e&&(t=e,e=void 0),e=e||"fx";while(a--)(n=Q.get(o[a],e+"queueHooks"))&&n.empty&&(r++,n.empty.add(s));return s(),i.promise(t)}});var te=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,ne=new RegExp("^(?:([+-])=|)("+te+")([a-z%]*)$","i"),re=["Top","Right","Bottom","Left"],ie=E.documentElement,oe=function(e){return k.contains(e.ownerDocument,e)},ae={composed:!0};ie.getRootNode&&(oe=function(e){return k.contains(e.ownerDocument,e)||e.getRootNode(ae)===e.ownerDocument});var se=function(e,t){return"none"===(e=t||e).style.display||""===e.style.display&&oe(e)&&"none"===k.css(e,"display")},ue=function(e,t,n,r){var i,o,a={};for(o in t)a[o]=e.style[o],e.style[o]=t[o];for(o in i=n.apply(e,r||[]),t)e.style[o]=a[o];return i};function le(e,t,n,r){var i,o,a=20,s=r?function(){return r.cur()}:function(){return k.css(e,t,"")},u=s(),l=n&&n[3]||(k.cssNumber[t]?"":"px"),c=e.nodeType&&(k.cssNumber[t]||"px"!==l&&+u)&&ne.exec(k.css(e,t));if(c&&c[3]!==l){u/=2,l=l||c[3],c=+u||1;while(a--)k.style(e,t,c+l),(1-o)*(1-(o=s()/u||.5))<=0&&(a=0),c/=o;c*=2,k.style(e,t,c+l),n=n||[]}return n&&(c=+c||+u||0,i=n[1]?c+(n[1]+1)*n[2]:+n[2],r&&(r.unit=l,r.start=c,r.end=i)),i}var ce={};function fe(e,t){for(var n,r,i,o,a,s,u,l=[],c=0,f=e.length;c<f;c++)(r=e[c]).style&&(n=r.style.display,t?("none"===n&&(l[c]=Q.get(r,"display")||null,l[c]||(r.style.display="")),""===r.style.display&&se(r)&&(l[c]=(u=a=o=void 0,a=(i=r).ownerDocument,s=i.nodeName,(u=ce[s])||(o=a.body.appendChild(a.createElement(s)),u=k.css(o,"display"),o.parentNode.removeChild(o),"none"===u&&(u="block"),ce[s]=u)))):"none"!==n&&(l[c]="none",Q.set(r,"display",n)));for(c=0;c<f;c++)null!=l[c]&&(e[c].style.display=l[c]);return e}k.fn.extend({show:function(){return fe(this,!0)},hide:function(){return fe(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){se(this)?k(this).show():k(this).hide()})}});var pe=/^(?:checkbox|radio)$/i,de=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,he=/^$|^module$|\/(?:java|ecma)script/i,ge={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function ve(e,t){var n;return n="undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t||"*"):"undefined"!=typeof e.querySelectorAll?e.querySelectorAll(t||"*"):[],void 0===t||t&&A(e,t)?k.merge([e],n):n}function ye(e,t){for(var n=0,r=e.length;n<r;n++)Q.set(e[n],"globalEval",!t||Q.get(t[n],"globalEval"))}ge.optgroup=ge.option,ge.tbody=ge.tfoot=ge.colgroup=ge.caption=ge.thead,ge.th=ge.td;var me,xe,be=/<|&#?\w+;/;function we(e,t,n,r,i){for(var o,a,s,u,l,c,f=t.createDocumentFragment(),p=[],d=0,h=e.length;d<h;d++)if((o=e[d])||0===o)if("object"===w(o))k.merge(p,o.nodeType?[o]:o);else if(be.test(o)){a=a||f.appendChild(t.createElement("div")),s=(de.exec(o)||["",""])[1].toLowerCase(),u=ge[s]||ge._default,a.innerHTML=u[1]+k.htmlPrefilter(o)+u[2],c=u[0];while(c--)a=a.lastChild;k.merge(p,a.childNodes),(a=f.firstChild).textContent=""}else p.push(t.createTextNode(o));f.textContent="",d=0;while(o=p[d++])if(r&&-1<k.inArray(o,r))i&&i.push(o);else if(l=oe(o),a=ve(f.appendChild(o),"script"),l&&ye(a),n){c=0;while(o=a[c++])he.test(o.type||"")&&n.push(o)}return f}me=E.createDocumentFragment().appendChild(E.createElement("div")),(xe=E.createElement("input")).setAttribute("type","radio"),xe.setAttribute("checked","checked"),xe.setAttribute("name","t"),me.appendChild(xe),y.checkClone=me.cloneNode(!0).cloneNode(!0).lastChild.checked,me.innerHTML="<textarea>x</textarea>",y.noCloneChecked=!!me.cloneNode(!0).lastChild.defaultValue;var Te=/^key/,Ce=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Ee=/^([^.]*)(?:\.(.+)|)/;function ke(){return!0}function Se(){return!1}function Ne(e,t){return e===function(){try{return E.activeElement}catch(e){}}()==("focus"===t)}function Ae(e,t,n,r,i,o){var a,s;if("object"==typeof t){for(s in"string"!=typeof n&&(r=r||n,n=void 0),t)Ae(e,s,n,r,t[s],o);return e}if(null==r&&null==i?(i=n,r=n=void 0):null==i&&("string"==typeof n?(i=r,r=void 0):(i=r,r=n,n=void 0)),!1===i)i=Se;else if(!i)return e;return 1===o&&(a=i,(i=function(e){return k().off(e),a.apply(this,arguments)}).guid=a.guid||(a.guid=k.guid++)),e.each(function(){k.event.add(this,t,i,r,n)})}function De(e,i,o){o?(Q.set(e,i,!1),k.event.add(e,i,{namespace:!1,handler:function(e){var t,n,r=Q.get(this,i);if(1&e.isTrigger&&this[i]){if(r.length)(k.event.special[i]||{}).delegateType&&e.stopPropagation();else if(r=s.call(arguments),Q.set(this,i,r),t=o(this,i),this[i](),r!==(n=Q.get(this,i))||t?Q.set(this,i,!1):n={},r!==n)return e.stopImmediatePropagation(),e.preventDefault(),n.value}else r.length&&(Q.set(this,i,{value:k.event.trigger(k.extend(r[0],k.Event.prototype),r.slice(1),this)}),e.stopImmediatePropagation())}})):void 0===Q.get(e,i)&&k.event.add(e,i,ke)}k.event={global:{},add:function(t,e,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.get(t);if(v){n.handler&&(n=(o=n).handler,i=o.selector),i&&k.find.matchesSelector(ie,i),n.guid||(n.guid=k.guid++),(u=v.events)||(u=v.events={}),(a=v.handle)||(a=v.handle=function(e){return"undefined"!=typeof k&&k.event.triggered!==e.type?k.event.dispatch.apply(t,arguments):void 0}),l=(e=(e||"").match(R)||[""]).length;while(l--)d=g=(s=Ee.exec(e[l])||[])[1],h=(s[2]||"").split(".").sort(),d&&(f=k.event.special[d]||{},d=(i?f.delegateType:f.bindType)||d,f=k.event.special[d]||{},c=k.extend({type:d,origType:g,data:r,handler:n,guid:n.guid,selector:i,needsContext:i&&k.expr.match.needsContext.test(i),namespace:h.join(".")},o),(p=u[d])||((p=u[d]=[]).delegateCount=0,f.setup&&!1!==f.setup.call(t,r,h,a)||t.addEventListener&&t.addEventListener(d,a)),f.add&&(f.add.call(t,c),c.handler.guid||(c.handler.guid=n.guid)),i?p.splice(p.delegateCount++,0,c):p.push(c),k.event.global[d]=!0)}},remove:function(e,t,n,r,i){var o,a,s,u,l,c,f,p,d,h,g,v=Q.hasData(e)&&Q.get(e);if(v&&(u=v.events)){l=(t=(t||"").match(R)||[""]).length;while(l--)if(d=g=(s=Ee.exec(t[l])||[])[1],h=(s[2]||"").split(".").sort(),d){f=k.event.special[d]||{},p=u[d=(r?f.delegateType:f.bindType)||d]||[],s=s[2]&&new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=o=p.length;while(o--)c=p[o],!i&&g!==c.origType||n&&n.guid!==c.guid||s&&!s.test(c.namespace)||r&&r!==c.selector&&("**"!==r||!c.selector)||(p.splice(o,1),c.selector&&p.delegateCount--,f.remove&&f.remove.call(e,c));a&&!p.length&&(f.teardown&&!1!==f.teardown.call(e,h,v.handle)||k.removeEvent(e,d,v.handle),delete u[d])}else for(d in u)k.event.remove(e,d+t[l],n,r,!0);k.isEmptyObject(u)&&Q.remove(e,"handle events")}},dispatch:function(e){var t,n,r,i,o,a,s=k.event.fix(e),u=new Array(arguments.length),l=(Q.get(this,"events")||{})[s.type]||[],c=k.event.special[s.type]||{};for(u[0]=s,t=1;t<arguments.length;t++)u[t]=arguments[t];if(s.delegateTarget=this,!c.preDispatch||!1!==c.preDispatch.call(this,s)){a=k.event.handlers.call(this,s,l),t=0;while((i=a[t++])&&!s.isPropagationStopped()){s.currentTarget=i.elem,n=0;while((o=i.handlers[n++])&&!s.isImmediatePropagationStopped())s.rnamespace&&!1!==o.namespace&&!s.rnamespace.test(o.namespace)||(s.handleObj=o,s.data=o.data,void 0!==(r=((k.event.special[o.origType]||{}).handle||o.handler).apply(i.elem,u))&&!1===(s.result=r)&&(s.preventDefault(),s.stopPropagation()))}return c.postDispatch&&c.postDispatch.call(this,s),s.result}},handlers:function(e,t){var n,r,i,o,a,s=[],u=t.delegateCount,l=e.target;if(u&&l.nodeType&&!("click"===e.type&&1<=e.button))for(;l!==this;l=l.parentNode||this)if(1===l.nodeType&&("click"!==e.type||!0!==l.disabled)){for(o=[],a={},n=0;n<u;n++)void 0===a[i=(r=t[n]).selector+" "]&&(a[i]=r.needsContext?-1<k(i,this).index(l):k.find(i,this,null,[l]).length),a[i]&&o.push(r);o.length&&s.push({elem:l,handlers:o})}return l=this,u<t.length&&s.push({elem:l,handlers:t.slice(u)}),s},addProp:function(t,e){Object.defineProperty(k.Event.prototype,t,{enumerable:!0,configurable:!0,get:m(e)?function(){if(this.originalEvent)return e(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[t]},set:function(e){Object.defineProperty(this,t,{enumerable:!0,configurable:!0,writable:!0,value:e})}})},fix:function(e){return e[k.expando]?e:new k.Event(e)},special:{load:{noBubble:!0},click:{setup:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click",ke),!1},trigger:function(e){var t=this||e;return pe.test(t.type)&&t.click&&A(t,"input")&&De(t,"click"),!0},_default:function(e){var t=e.target;return pe.test(t.type)&&t.click&&A(t,"input")&&Q.get(t,"click")||A(t,"a")}},beforeunload:{postDispatch:function(e){void 0!==e.result&&e.originalEvent&&(e.originalEvent.returnValue=e.result)}}}},k.removeEvent=function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n)},k.Event=function(e,t){if(!(this instanceof k.Event))return new k.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||void 0===e.defaultPrevented&&!1===e.returnValue?ke:Se,this.target=e.target&&3===e.target.nodeType?e.target.parentNode:e.target,this.currentTarget=e.currentTarget,this.relatedTarget=e.relatedTarget):this.type=e,t&&k.extend(this,t),this.timeStamp=e&&e.timeStamp||Date.now(),this[k.expando]=!0},k.Event.prototype={constructor:k.Event,isDefaultPrevented:Se,isPropagationStopped:Se,isImmediatePropagationStopped:Se,isSimulated:!1,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=ke,e&&!this.isSimulated&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=ke,e&&!this.isSimulated&&e.stopPropagation()},stopImmediatePropagation:function(){var e=this.originalEvent;this.isImmediatePropagationStopped=ke,e&&!this.isSimulated&&e.stopImmediatePropagation(),this.stopPropagation()}},k.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,"char":!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:function(e){var t=e.button;return null==e.which&&Te.test(e.type)?null!=e.charCode?e.charCode:e.keyCode:!e.which&&void 0!==t&&Ce.test(e.type)?1&t?1:2&t?3:4&t?2:0:e.which}},k.event.addProp),k.each({focus:"focusin",blur:"focusout"},function(e,t){k.event.special[e]={setup:function(){return De(this,e,Ne),!1},trigger:function(){return De(this,e),!0},delegateType:t}}),k.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(e,i){k.event.special[e]={delegateType:i,bindType:i,handle:function(e){var t,n=e.relatedTarget,r=e.handleObj;return n&&(n===this||k.contains(this,n))||(e.type=r.origType,t=r.handler.apply(this,arguments),e.type=i),t}}}),k.fn.extend({on:function(e,t,n,r){return Ae(this,e,t,n,r)},one:function(e,t,n,r){return Ae(this,e,t,n,r,1)},off:function(e,t,n){var r,i;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,k(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(i in e)this.off(i,t,e[i]);return this}return!1!==t&&"function"!=typeof t||(n=t,t=void 0),!1===n&&(n=Se),this.each(function(){k.event.remove(this,e,n,t)})}});var je=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([a-z][^\/\0>\x20\t\r\n\f]*)[^>]*)\/>/gi,qe=/<script|<style|<link/i,Le=/checked\s*(?:[^=]|=\s*.checked.)/i,He=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g;function Oe(e,t){return A(e,"table")&&A(11!==t.nodeType?t:t.firstChild,"tr")&&k(e).children("tbody")[0]||e}function Pe(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function Re(e){return"true/"===(e.type||"").slice(0,5)?e.type=e.type.slice(5):e.removeAttribute("type"),e}function Me(e,t){var n,r,i,o,a,s,u,l;if(1===t.nodeType){if(Q.hasData(e)&&(o=Q.access(e),a=Q.set(t,o),l=o.events))for(i in delete a.handle,a.events={},l)for(n=0,r=l[i].length;n<r;n++)k.event.add(t,i,l[i][n]);J.hasData(e)&&(s=J.access(e),u=k.extend({},s),J.set(t,u))}}function Ie(n,r,i,o){r=g.apply([],r);var e,t,a,s,u,l,c=0,f=n.length,p=f-1,d=r[0],h=m(d);if(h||1<f&&"string"==typeof d&&!y.checkClone&&Le.test(d))return n.each(function(e){var t=n.eq(e);h&&(r[0]=d.call(this,e,t.html())),Ie(t,r,i,o)});if(f&&(t=(e=we(r,n[0].ownerDocument,!1,n,o)).firstChild,1===e.childNodes.length&&(e=t),t||o)){for(s=(a=k.map(ve(e,"script"),Pe)).length;c<f;c++)u=e,c!==p&&(u=k.clone(u,!0,!0),s&&k.merge(a,ve(u,"script"))),i.call(n[c],u,c);if(s)for(l=a[a.length-1].ownerDocument,k.map(a,Re),c=0;c<s;c++)u=a[c],he.test(u.type||"")&&!Q.access(u,"globalEval")&&k.contains(l,u)&&(u.src&&"module"!==(u.type||"").toLowerCase()?k._evalUrl&&!u.noModule&&k._evalUrl(u.src,{nonce:u.nonce||u.getAttribute("nonce")}):b(u.textContent.replace(He,""),u,l))}return n}function We(e,t,n){for(var r,i=t?k.filter(t,e):e,o=0;null!=(r=i[o]);o++)n||1!==r.nodeType||k.cleanData(ve(r)),r.parentNode&&(n&&oe(r)&&ye(ve(r,"script")),r.parentNode.removeChild(r));return e}k.extend({htmlPrefilter:function(e){return e.replace(je,"<$1></$2>")},clone:function(e,t,n){var r,i,o,a,s,u,l,c=e.cloneNode(!0),f=oe(e);if(!(y.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||k.isXMLDoc(e)))for(a=ve(c),r=0,i=(o=ve(e)).length;r<i;r++)s=o[r],u=a[r],void 0,"input"===(l=u.nodeName.toLowerCase())&&pe.test(s.type)?u.checked=s.checked:"input"!==l&&"textarea"!==l||(u.defaultValue=s.defaultValue);if(t)if(n)for(o=o||ve(e),a=a||ve(c),r=0,i=o.length;r<i;r++)Me(o[r],a[r]);else Me(e,c);return 0<(a=ve(c,"script")).length&&ye(a,!f&&ve(e,"script")),c},cleanData:function(e){for(var t,n,r,i=k.event.special,o=0;void 0!==(n=e[o]);o++)if(G(n)){if(t=n[Q.expando]){if(t.events)for(r in t.events)i[r]?k.event.remove(n,r):k.removeEvent(n,r,t.handle);n[Q.expando]=void 0}n[J.expando]&&(n[J.expando]=void 0)}}}),k.fn.extend({detach:function(e){return We(this,e,!0)},remove:function(e){return We(this,e)},text:function(e){return _(this,function(e){return void 0===e?k.text(this):this.empty().each(function(){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||(this.textContent=e)})},null,e,arguments.length)},append:function(){return Ie(this,arguments,function(e){1!==this.nodeType&&11!==this.nodeType&&9!==this.nodeType||Oe(this,e).appendChild(e)})},prepend:function(){return Ie(this,arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Oe(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return Ie(this,arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(k.cleanData(ve(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return k.clone(this,e,t)})},html:function(e){return _(this,function(e){var t=this[0]||{},n=0,r=this.length;if(void 0===e&&1===t.nodeType)return t.innerHTML;if("string"==typeof e&&!qe.test(e)&&!ge[(de.exec(e)||["",""])[1].toLowerCase()]){e=k.htmlPrefilter(e);try{for(;n<r;n++)1===(t=this[n]||{}).nodeType&&(k.cleanData(ve(t,!1)),t.innerHTML=e);t=0}catch(e){}}t&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var n=[];return Ie(this,arguments,function(e){var t=this.parentNode;k.inArray(this,n)<0&&(k.cleanData(ve(this)),t&&t.replaceChild(e,this))},n)}}),k.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,a){k.fn[e]=function(e){for(var t,n=[],r=k(e),i=r.length-1,o=0;o<=i;o++)t=o===i?this:this.clone(!0),k(r[o])[a](t),u.apply(n,t.get());return this.pushStack(n)}});var $e=new RegExp("^("+te+")(?!px)[a-z%]+$","i"),Fe=function(e){var t=e.ownerDocument.defaultView;return t&&t.opener||(t=C),t.getComputedStyle(e)},Be=new RegExp(re.join("|"),"i");function _e(e,t,n){var r,i,o,a,s=e.style;return(n=n||Fe(e))&&(""!==(a=n.getPropertyValue(t)||n[t])||oe(e)||(a=k.style(e,t)),!y.pixelBoxStyles()&&$e.test(a)&&Be.test(t)&&(r=s.width,i=s.minWidth,o=s.maxWidth,s.minWidth=s.maxWidth=s.width=a,a=n.width,s.width=r,s.minWidth=i,s.maxWidth=o)),void 0!==a?a+"":a}function ze(e,t){return{get:function(){if(!e())return(this.get=t).apply(this,arguments);delete this.get}}}!function(){function e(){if(u){s.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",u.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ie.appendChild(s).appendChild(u);var e=C.getComputedStyle(u);n="1%"!==e.top,a=12===t(e.marginLeft),u.style.right="60%",o=36===t(e.right),r=36===t(e.width),u.style.position="absolute",i=12===t(u.offsetWidth/3),ie.removeChild(s),u=null}}function t(e){return Math.round(parseFloat(e))}var n,r,i,o,a,s=E.createElement("div"),u=E.createElement("div");u.style&&(u.style.backgroundClip="content-box",u.cloneNode(!0).style.backgroundClip="",y.clearCloneStyle="content-box"===u.style.backgroundClip,k.extend(y,{boxSizingReliable:function(){return e(),r},pixelBoxStyles:function(){return e(),o},pixelPosition:function(){return e(),n},reliableMarginLeft:function(){return e(),a},scrollboxSize:function(){return e(),i}}))}();var Ue=["Webkit","Moz","ms"],Xe=E.createElement("div").style,Ve={};function Ge(e){var t=k.cssProps[e]||Ve[e];return t||(e in Xe?e:Ve[e]=function(e){var t=e[0].toUpperCase()+e.slice(1),n=Ue.length;while(n--)if((e=Ue[n]+t)in Xe)return e}(e)||e)}var Ye=/^(none|table(?!-c[ea]).+)/,Qe=/^--/,Je={position:"absolute",visibility:"hidden",display:"block"},Ke={letterSpacing:"0",fontWeight:"400"};function Ze(e,t,n){var r=ne.exec(t);return r?Math.max(0,r[2]-(n||0))+(r[3]||"px"):t}function et(e,t,n,r,i,o){var a="width"===t?1:0,s=0,u=0;if(n===(r?"border":"content"))return 0;for(;a<4;a+=2)"margin"===n&&(u+=k.css(e,n+re[a],!0,i)),r?("content"===n&&(u-=k.css(e,"padding"+re[a],!0,i)),"margin"!==n&&(u-=k.css(e,"border"+re[a]+"Width",!0,i))):(u+=k.css(e,"padding"+re[a],!0,i),"padding"!==n?u+=k.css(e,"border"+re[a]+"Width",!0,i):s+=k.css(e,"border"+re[a]+"Width",!0,i));return!r&&0<=o&&(u+=Math.max(0,Math.ceil(e["offset"+t[0].toUpperCase()+t.slice(1)]-o-u-s-.5))||0),u}function tt(e,t,n){var r=Fe(e),i=(!y.boxSizingReliable()||n)&&"border-box"===k.css(e,"boxSizing",!1,r),o=i,a=_e(e,t,r),s="offset"+t[0].toUpperCase()+t.slice(1);if($e.test(a)){if(!n)return a;a="auto"}return(!y.boxSizingReliable()&&i||"auto"===a||!parseFloat(a)&&"inline"===k.css(e,"display",!1,r))&&e.getClientRects().length&&(i="border-box"===k.css(e,"boxSizing",!1,r),(o=s in e)&&(a=e[s])),(a=parseFloat(a)||0)+et(e,t,n||(i?"border":"content"),o,r,a)+"px"}function nt(e,t,n,r,i){return new nt.prototype.init(e,t,n,r,i)}k.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=_e(e,"opacity");return""===n?"1":n}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{},style:function(e,t,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var i,o,a,s=V(t),u=Qe.test(t),l=e.style;if(u||(t=Ge(s)),a=k.cssHooks[t]||k.cssHooks[s],void 0===n)return a&&"get"in a&&void 0!==(i=a.get(e,!1,r))?i:l[t];"string"===(o=typeof n)&&(i=ne.exec(n))&&i[1]&&(n=le(e,t,i),o="number"),null!=n&&n==n&&("number"!==o||u||(n+=i&&i[3]||(k.cssNumber[s]?"":"px")),y.clearCloneStyle||""!==n||0!==t.indexOf("background")||(l[t]="inherit"),a&&"set"in a&&void 0===(n=a.set(e,n,r))||(u?l.setProperty(t,n):l[t]=n))}},css:function(e,t,n,r){var i,o,a,s=V(t);return Qe.test(t)||(t=Ge(s)),(a=k.cssHooks[t]||k.cssHooks[s])&&"get"in a&&(i=a.get(e,!0,n)),void 0===i&&(i=_e(e,t,r)),"normal"===i&&t in Ke&&(i=Ke[t]),""===n||n?(o=parseFloat(i),!0===n||isFinite(o)?o||0:i):i}}),k.each(["height","width"],function(e,u){k.cssHooks[u]={get:function(e,t,n){if(t)return!Ye.test(k.css(e,"display"))||e.getClientRects().length&&e.getBoundingClientRect().width?tt(e,u,n):ue(e,Je,function(){return tt(e,u,n)})},set:function(e,t,n){var r,i=Fe(e),o=!y.scrollboxSize()&&"absolute"===i.position,a=(o||n)&&"border-box"===k.css(e,"boxSizing",!1,i),s=n?et(e,u,n,a,i):0;return a&&o&&(s-=Math.ceil(e["offset"+u[0].toUpperCase()+u.slice(1)]-parseFloat(i[u])-et(e,u,"border",!1,i)-.5)),s&&(r=ne.exec(t))&&"px"!==(r[3]||"px")&&(e.style[u]=t,t=k.css(e,u)),Ze(0,t,s)}}}),k.cssHooks.marginLeft=ze(y.reliableMarginLeft,function(e,t){if(t)return(parseFloat(_e(e,"marginLeft"))||e.getBoundingClientRect().left-ue(e,{marginLeft:0},function(){return e.getBoundingClientRect().left}))+"px"}),k.each({margin:"",padding:"",border:"Width"},function(i,o){k.cssHooks[i+o]={expand:function(e){for(var t=0,n={},r="string"==typeof e?e.split(" "):[e];t<4;t++)n[i+re[t]+o]=r[t]||r[t-2]||r[0];return n}},"margin"!==i&&(k.cssHooks[i+o].set=Ze)}),k.fn.extend({css:function(e,t){return _(this,function(e,t,n){var r,i,o={},a=0;if(Array.isArray(t)){for(r=Fe(e),i=t.length;a<i;a++)o[t[a]]=k.css(e,t[a],!1,r);return o}return void 0!==n?k.style(e,t,n):k.css(e,t)},e,t,1<arguments.length)}}),((k.Tween=nt).prototype={constructor:nt,init:function(e,t,n,r,i,o){this.elem=e,this.prop=n,this.easing=i||k.easing._default,this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=o||(k.cssNumber[n]?"":"px")},cur:function(){var e=nt.propHooks[this.prop];return e&&e.get?e.get(this):nt.propHooks._default.get(this)},run:function(e){var t,n=nt.propHooks[this.prop];return this.options.duration?this.pos=t=k.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):nt.propHooks._default.set(this),this}}).init.prototype=nt.prototype,(nt.propHooks={_default:{get:function(e){var t;return 1!==e.elem.nodeType||null!=e.elem[e.prop]&&null==e.elem.style[e.prop]?e.elem[e.prop]:(t=k.css(e.elem,e.prop,""))&&"auto"!==t?t:0},set:function(e){k.fx.step[e.prop]?k.fx.step[e.prop](e):1!==e.elem.nodeType||!k.cssHooks[e.prop]&&null==e.elem.style[Ge(e.prop)]?e.elem[e.prop]=e.now:k.style(e.elem,e.prop,e.now+e.unit)}}}).scrollTop=nt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},k.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},_default:"swing"},k.fx=nt.prototype.init,k.fx.step={};var rt,it,ot,at,st=/^(?:toggle|show|hide)$/,ut=/queueHooks$/;function lt(){it&&(!1===E.hidden&&C.requestAnimationFrame?C.requestAnimationFrame(lt):C.setTimeout(lt,k.fx.interval),k.fx.tick())}function ct(){return C.setTimeout(function(){rt=void 0}),rt=Date.now()}function ft(e,t){var n,r=0,i={height:e};for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=re[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}function pt(e,t,n){for(var r,i=(dt.tweeners[t]||[]).concat(dt.tweeners["*"]),o=0,a=i.length;o<a;o++)if(r=i[o].call(n,t,e))return r}function dt(o,e,t){var n,a,r=0,i=dt.prefilters.length,s=k.Deferred().always(function(){delete u.elem}),u=function(){if(a)return!1;for(var e=rt||ct(),t=Math.max(0,l.startTime+l.duration-e),n=1-(t/l.duration||0),r=0,i=l.tweens.length;r<i;r++)l.tweens[r].run(n);return s.notifyWith(o,[l,n,t]),n<1&&i?t:(i||s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l]),!1)},l=s.promise({elem:o,props:k.extend({},e),opts:k.extend(!0,{specialEasing:{},easing:k.easing._default},t),originalProperties:e,originalOptions:t,startTime:rt||ct(),duration:t.duration,tweens:[],createTween:function(e,t){var n=k.Tween(o,l.opts,e,t,l.opts.specialEasing[e]||l.opts.easing);return l.tweens.push(n),n},stop:function(e){var t=0,n=e?l.tweens.length:0;if(a)return this;for(a=!0;t<n;t++)l.tweens[t].run(1);return e?(s.notifyWith(o,[l,1,0]),s.resolveWith(o,[l,e])):s.rejectWith(o,[l,e]),this}}),c=l.props;for(!function(e,t){var n,r,i,o,a;for(n in e)if(i=t[r=V(n)],o=e[n],Array.isArray(o)&&(i=o[1],o=e[n]=o[0]),n!==r&&(e[r]=o,delete e[n]),(a=k.cssHooks[r])&&"expand"in a)for(n in o=a.expand(o),delete e[r],o)n in e||(e[n]=o[n],t[n]=i);else t[r]=i}(c,l.opts.specialEasing);r<i;r++)if(n=dt.prefilters[r].call(l,o,c,l.opts))return m(n.stop)&&(k._queueHooks(l.elem,l.opts.queue).stop=n.stop.bind(n)),n;return k.map(c,pt,l),m(l.opts.start)&&l.opts.start.call(o,l),l.progress(l.opts.progress).done(l.opts.done,l.opts.complete).fail(l.opts.fail).always(l.opts.always),k.fx.timer(k.extend(u,{elem:o,anim:l,queue:l.opts.queue})),l}k.Animation=k.extend(dt,{tweeners:{"*":[function(e,t){var n=this.createTween(e,t);return le(n.elem,e,ne.exec(t),n),n}]},tweener:function(e,t){m(e)?(t=e,e=["*"]):e=e.match(R);for(var n,r=0,i=e.length;r<i;r++)n=e[r],dt.tweeners[n]=dt.tweeners[n]||[],dt.tweeners[n].unshift(t)},prefilters:[function(e,t,n){var r,i,o,a,s,u,l,c,f="width"in t||"height"in t,p=this,d={},h=e.style,g=e.nodeType&&se(e),v=Q.get(e,"fxshow");for(r in n.queue||(null==(a=k._queueHooks(e,"fx")).unqueued&&(a.unqueued=0,s=a.empty.fire,a.empty.fire=function(){a.unqueued||s()}),a.unqueued++,p.always(function(){p.always(function(){a.unqueued--,k.queue(e,"fx").length||a.empty.fire()})})),t)if(i=t[r],st.test(i)){if(delete t[r],o=o||"toggle"===i,i===(g?"hide":"show")){if("show"!==i||!v||void 0===v[r])continue;g=!0}d[r]=v&&v[r]||k.style(e,r)}if((u=!k.isEmptyObject(t))||!k.isEmptyObject(d))for(r in f&&1===e.nodeType&&(n.overflow=[h.overflow,h.overflowX,h.overflowY],null==(l=v&&v.display)&&(l=Q.get(e,"display")),"none"===(c=k.css(e,"display"))&&(l?c=l:(fe([e],!0),l=e.style.display||l,c=k.css(e,"display"),fe([e]))),("inline"===c||"inline-block"===c&&null!=l)&&"none"===k.css(e,"float")&&(u||(p.done(function(){h.display=l}),null==l&&(c=h.display,l="none"===c?"":c)),h.display="inline-block")),n.overflow&&(h.overflow="hidden",p.always(function(){h.overflow=n.overflow[0],h.overflowX=n.overflow[1],h.overflowY=n.overflow[2]})),u=!1,d)u||(v?"hidden"in v&&(g=v.hidden):v=Q.access(e,"fxshow",{display:l}),o&&(v.hidden=!g),g&&fe([e],!0),p.done(function(){for(r in g||fe([e]),Q.remove(e,"fxshow"),d)k.style(e,r,d[r])})),u=pt(g?v[r]:0,r,p),r in v||(v[r]=u.start,g&&(u.end=u.start,u.start=0))}],prefilter:function(e,t){t?dt.prefilters.unshift(e):dt.prefilters.push(e)}}),k.speed=function(e,t,n){var r=e&&"object"==typeof e?k.extend({},e):{complete:n||!n&&t||m(e)&&e,duration:e,easing:n&&t||t&&!m(t)&&t};return k.fx.off?r.duration=0:"number"!=typeof r.duration&&(r.duration in k.fx.speeds?r.duration=k.fx.speeds[r.duration]:r.duration=k.fx.speeds._default),null!=r.queue&&!0!==r.queue||(r.queue="fx"),r.old=r.complete,r.complete=function(){m(r.old)&&r.old.call(this),r.queue&&k.dequeue(this,r.queue)},r},k.fn.extend({fadeTo:function(e,t,n,r){return this.filter(se).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(t,e,n,r){var i=k.isEmptyObject(t),o=k.speed(e,n,r),a=function(){var e=dt(this,k.extend({},t),o);(i||Q.get(this,"finish"))&&e.stop(!0)};return a.finish=a,i||!1===o.queue?this.each(a):this.queue(o.queue,a)},stop:function(i,e,o){var a=function(e){var t=e.stop;delete e.stop,t(o)};return"string"!=typeof i&&(o=e,e=i,i=void 0),e&&!1!==i&&this.queue(i||"fx",[]),this.each(function(){var e=!0,t=null!=i&&i+"queueHooks",n=k.timers,r=Q.get(this);if(t)r[t]&&r[t].stop&&a(r[t]);else for(t in r)r[t]&&r[t].stop&&ut.test(t)&&a(r[t]);for(t=n.length;t--;)n[t].elem!==this||null!=i&&n[t].queue!==i||(n[t].anim.stop(o),e=!1,n.splice(t,1));!e&&o||k.dequeue(this,i)})},finish:function(a){return!1!==a&&(a=a||"fx"),this.each(function(){var e,t=Q.get(this),n=t[a+"queue"],r=t[a+"queueHooks"],i=k.timers,o=n?n.length:0;for(t.finish=!0,k.queue(this,a,[]),r&&r.stop&&r.stop.call(this,!0),e=i.length;e--;)i[e].elem===this&&i[e].queue===a&&(i[e].anim.stop(!0),i.splice(e,1));for(e=0;e<o;e++)n[e]&&n[e].finish&&n[e].finish.call(this);delete t.finish})}}),k.each(["toggle","show","hide"],function(e,r){var i=k.fn[r];k.fn[r]=function(e,t,n){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(ft(r,!0),e,t,n)}}),k.each({slideDown:ft("show"),slideUp:ft("hide"),slideToggle:ft("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,r){k.fn[e]=function(e,t,n){return this.animate(r,e,t,n)}}),k.timers=[],k.fx.tick=function(){var e,t=0,n=k.timers;for(rt=Date.now();t<n.length;t++)(e=n[t])()||n[t]!==e||n.splice(t--,1);n.length||k.fx.stop(),rt=void 0},k.fx.timer=function(e){k.timers.push(e),k.fx.start()},k.fx.interval=13,k.fx.start=function(){it||(it=!0,lt())},k.fx.stop=function(){it=null},k.fx.speeds={slow:600,fast:200,_default:400},k.fn.delay=function(r,e){return r=k.fx&&k.fx.speeds[r]||r,e=e||"fx",this.queue(e,function(e,t){var n=C.setTimeout(e,r);t.stop=function(){C.clearTimeout(n)}})},ot=E.createElement("input"),at=E.createElement("select").appendChild(E.createElement("option")),ot.type="checkbox",y.checkOn=""!==ot.value,y.optSelected=at.selected,(ot=E.createElement("input")).value="t",ot.type="radio",y.radioValue="t"===ot.value;var ht,gt=k.expr.attrHandle;k.fn.extend({attr:function(e,t){return _(this,k.attr,e,t,1<arguments.length)},removeAttr:function(e){return this.each(function(){k.removeAttr(this,e)})}}),k.extend({attr:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return"undefined"==typeof e.getAttribute?k.prop(e,t,n):(1===o&&k.isXMLDoc(e)||(i=k.attrHooks[t.toLowerCase()]||(k.expr.match.bool.test(t)?ht:void 0)),void 0!==n?null===n?void k.removeAttr(e,t):i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:(e.setAttribute(t,n+""),n):i&&"get"in i&&null!==(r=i.get(e,t))?r:null==(r=k.find.attr(e,t))?void 0:r)},attrHooks:{type:{set:function(e,t){if(!y.radioValue&&"radio"===t&&A(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},removeAttr:function(e,t){var n,r=0,i=t&&t.match(R);if(i&&1===e.nodeType)while(n=i[r++])e.removeAttribute(n)}}),ht={set:function(e,t,n){return!1===t?k.removeAttr(e,n):e.setAttribute(n,n),n}},k.each(k.expr.match.bool.source.match(/\w+/g),function(e,t){var a=gt[t]||k.find.attr;gt[t]=function(e,t,n){var r,i,o=t.toLowerCase();return n||(i=gt[o],gt[o]=r,r=null!=a(e,t,n)?o:null,gt[o]=i),r}});var vt=/^(?:input|select|textarea|button)$/i,yt=/^(?:a|area)$/i;function mt(e){return(e.match(R)||[]).join(" ")}function xt(e){return e.getAttribute&&e.getAttribute("class")||""}function bt(e){return Array.isArray(e)?e:"string"==typeof e&&e.match(R)||[]}k.fn.extend({prop:function(e,t){return _(this,k.prop,e,t,1<arguments.length)},removeProp:function(e){return this.each(function(){delete this[k.propFix[e]||e]})}}),k.extend({prop:function(e,t,n){var r,i,o=e.nodeType;if(3!==o&&8!==o&&2!==o)return 1===o&&k.isXMLDoc(e)||(t=k.propFix[t]||t,i=k.propHooks[t]),void 0!==n?i&&"set"in i&&void 0!==(r=i.set(e,n,t))?r:e[t]=n:i&&"get"in i&&null!==(r=i.get(e,t))?r:e[t]},propHooks:{tabIndex:{get:function(e){var t=k.find.attr(e,"tabindex");return t?parseInt(t,10):vt.test(e.nodeName)||yt.test(e.nodeName)&&e.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),y.optSelected||(k.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null},set:function(e){var t=e.parentNode;t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex)}}),k.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){k.propFix[this.toLowerCase()]=this}),k.fn.extend({addClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).addClass(t.call(this,e,xt(this)))});if((e=bt(t)).length)while(n=this[u++])if(i=xt(n),r=1===n.nodeType&&" "+mt(i)+" "){a=0;while(o=e[a++])r.indexOf(" "+o+" ")<0&&(r+=o+" ");i!==(s=mt(r))&&n.setAttribute("class",s)}return this},removeClass:function(t){var e,n,r,i,o,a,s,u=0;if(m(t))return this.each(function(e){k(this).removeClass(t.call(this,e,xt(this)))});if(!arguments.length)return this.attr("class","");if((e=bt(t)).length)while(n=this[u++])if(i=xt(n),r=1===n.nodeType&&" "+mt(i)+" "){a=0;while(o=e[a++])while(-1<r.indexOf(" "+o+" "))r=r.replace(" "+o+" "," ");i!==(s=mt(r))&&n.setAttribute("class",s)}return this},toggleClass:function(i,t){var o=typeof i,a="string"===o||Array.isArray(i);return"boolean"==typeof t&&a?t?this.addClass(i):this.removeClass(i):m(i)?this.each(function(e){k(this).toggleClass(i.call(this,e,xt(this),t),t)}):this.each(function(){var e,t,n,r;if(a){t=0,n=k(this),r=bt(i);while(e=r[t++])n.hasClass(e)?n.removeClass(e):n.addClass(e)}else void 0!==i&&"boolean"!==o||((e=xt(this))&&Q.set(this,"__className__",e),this.setAttribute&&this.setAttribute("class",e||!1===i?"":Q.get(this,"__className__")||""))})},hasClass:function(e){var t,n,r=0;t=" "+e+" ";while(n=this[r++])if(1===n.nodeType&&-1<(" "+mt(xt(n))+" ").indexOf(t))return!0;return!1}});var wt=/\r/g;k.fn.extend({val:function(n){var r,e,i,t=this[0];return arguments.length?(i=m(n),this.each(function(e){var t;1===this.nodeType&&(null==(t=i?n.call(this,e,k(this).val()):n)?t="":"number"==typeof t?t+="":Array.isArray(t)&&(t=k.map(t,function(e){return null==e?"":e+""})),(r=k.valHooks[this.type]||k.valHooks[this.nodeName.toLowerCase()])&&"set"in r&&void 0!==r.set(this,t,"value")||(this.value=t))})):t?(r=k.valHooks[t.type]||k.valHooks[t.nodeName.toLowerCase()])&&"get"in r&&void 0!==(e=r.get(t,"value"))?e:"string"==typeof(e=t.value)?e.replace(wt,""):null==e?"":e:void 0}}),k.extend({valHooks:{option:{get:function(e){var t=k.find.attr(e,"value");return null!=t?t:mt(k.text(e))}},select:{get:function(e){var t,n,r,i=e.options,o=e.selectedIndex,a="select-one"===e.type,s=a?null:[],u=a?o+1:i.length;for(r=o<0?u:a?o:0;r<u;r++)if(((n=i[r]).selected||r===o)&&!n.disabled&&(!n.parentNode.disabled||!A(n.parentNode,"optgroup"))){if(t=k(n).val(),a)return t;s.push(t)}return s},set:function(e,t){var n,r,i=e.options,o=k.makeArray(t),a=i.length;while(a--)((r=i[a]).selected=-1<k.inArray(k.valHooks.option.get(r),o))&&(n=!0);return n||(e.selectedIndex=-1),o}}}}),k.each(["radio","checkbox"],function(){k.valHooks[this]={set:function(e,t){if(Array.isArray(t))return e.checked=-1<k.inArray(k(e).val(),t)}},y.checkOn||(k.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})}),y.focusin="onfocusin"in C;var Tt=/^(?:focusinfocus|focusoutblur)$/,Ct=function(e){e.stopPropagation()};k.extend(k.event,{trigger:function(e,t,n,r){var i,o,a,s,u,l,c,f,p=[n||E],d=v.call(e,"type")?e.type:e,h=v.call(e,"namespace")?e.namespace.split("."):[];if(o=f=a=n=n||E,3!==n.nodeType&&8!==n.nodeType&&!Tt.test(d+k.event.triggered)&&(-1<d.indexOf(".")&&(d=(h=d.split(".")).shift(),h.sort()),u=d.indexOf(":")<0&&"on"+d,(e=e[k.expando]?e:new k.Event(d,"object"==typeof e&&e)).isTrigger=r?2:3,e.namespace=h.join("."),e.rnamespace=e.namespace?new RegExp("(^|\\.)"+h.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=n),t=null==t?[e]:k.makeArray(t,[e]),c=k.event.special[d]||{},r||!c.trigger||!1!==c.trigger.apply(n,t))){if(!r&&!c.noBubble&&!x(n)){for(s=c.delegateType||d,Tt.test(s+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(n.ownerDocument||E)&&p.push(a.defaultView||a.parentWindow||C)}i=0;while((o=p[i++])&&!e.isPropagationStopped())f=o,e.type=1<i?s:c.bindType||d,(l=(Q.get(o,"events")||{})[e.type]&&Q.get(o,"handle"))&&l.apply(o,t),(l=u&&o[u])&&l.apply&&G(o)&&(e.result=l.apply(o,t),!1===e.result&&e.preventDefault());return e.type=d,r||e.isDefaultPrevented()||c._default&&!1!==c._default.apply(p.pop(),t)||!G(n)||u&&m(n[d])&&!x(n)&&((a=n[u])&&(n[u]=null),k.event.triggered=d,e.isPropagationStopped()&&f.addEventListener(d,Ct),n[d](),e.isPropagationStopped()&&f.removeEventListener(d,Ct),k.event.triggered=void 0,a&&(n[u]=a)),e.result}},simulate:function(e,t,n){var r=k.extend(new k.Event,n,{type:e,isSimulated:!0});k.event.trigger(r,null,t)}}),k.fn.extend({trigger:function(e,t){return this.each(function(){k.event.trigger(e,t,this)})},triggerHandler:function(e,t){var n=this[0];if(n)return k.event.trigger(e,t,n,!0)}}),y.focusin||k.each({focus:"focusin",blur:"focusout"},function(n,r){var i=function(e){k.event.simulate(r,e.target,k.event.fix(e))};k.event.special[r]={setup:function(){var e=this.ownerDocument||this,t=Q.access(e,r);t||e.addEventListener(n,i,!0),Q.access(e,r,(t||0)+1)},teardown:function(){var e=this.ownerDocument||this,t=Q.access(e,r)-1;t?Q.access(e,r,t):(e.removeEventListener(n,i,!0),Q.remove(e,r))}}});var Et=C.location,kt=Date.now(),St=/\?/;k.parseXML=function(e){var t;if(!e||"string"!=typeof e)return null;try{t=(new C.DOMParser).parseFromString(e,"text/xml")}catch(e){t=void 0}return t&&!t.getElementsByTagName("parsererror").length||k.error("Invalid XML: "+e),t};var Nt=/\[\]$/,At=/\r?\n/g,Dt=/^(?:submit|button|image|reset|file)$/i,jt=/^(?:input|select|textarea|keygen)/i;function qt(n,e,r,i){var t;if(Array.isArray(e))k.each(e,function(e,t){r||Nt.test(n)?i(n,t):qt(n+"["+("object"==typeof t&&null!=t?e:"")+"]",t,r,i)});else if(r||"object"!==w(e))i(n,e);else for(t in e)qt(n+"["+t+"]",e[t],r,i)}k.param=function(e,t){var n,r=[],i=function(e,t){var n=m(t)?t():t;r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(null==n?"":n)};if(null==e)return"";if(Array.isArray(e)||e.jquery&&!k.isPlainObject(e))k.each(e,function(){i(this.name,this.value)});else for(n in e)qt(n,e[n],t,i);return r.join("&")},k.fn.extend({serialize:function(){return k.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=k.prop(this,"elements");return e?k.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!k(this).is(":disabled")&&jt.test(this.nodeName)&&!Dt.test(e)&&(this.checked||!pe.test(e))}).map(function(e,t){var n=k(this).val();return null==n?null:Array.isArray(n)?k.map(n,function(e){return{name:t.name,value:e.replace(At,"\r\n")}}):{name:t.name,value:n.replace(At,"\r\n")}}).get()}});var Lt=/%20/g,Ht=/#.*$/,Ot=/([?&])_=[^&]*/,Pt=/^(.*?):[ \t]*([^\r\n]*)$/gm,Rt=/^(?:GET|HEAD)$/,Mt=/^\/\//,It={},Wt={},$t="*/".concat("*"),Ft=E.createElement("a");function Bt(o){return function(e,t){"string"!=typeof e&&(t=e,e="*");var n,r=0,i=e.toLowerCase().match(R)||[];if(m(t))while(n=i[r++])"+"===n[0]?(n=n.slice(1)||"*",(o[n]=o[n]||[]).unshift(t)):(o[n]=o[n]||[]).push(t)}}function _t(t,i,o,a){var s={},u=t===Wt;function l(e){var r;return s[e]=!0,k.each(t[e]||[],function(e,t){var n=t(i,o,a);return"string"!=typeof n||u||s[n]?u?!(r=n):void 0:(i.dataTypes.unshift(n),l(n),!1)}),r}return l(i.dataTypes[0])||!s["*"]&&l("*")}function zt(e,t){var n,r,i=k.ajaxSettings.flatOptions||{};for(n in t)void 0!==t[n]&&((i[n]?e:r||(r={}))[n]=t[n]);return r&&k.extend(!0,e,r),e}Ft.href=Et.href,k.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Et.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(Et.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":$t,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":k.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?zt(zt(e,k.ajaxSettings),t):zt(k.ajaxSettings,e)},ajaxPrefilter:Bt(It),ajaxTransport:Bt(Wt),ajax:function(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};var c,f,p,n,d,r,h,g,i,o,v=k.ajaxSetup({},t),y=v.context||v,m=v.context&&(y.nodeType||y.jquery)?k(y):k.event,x=k.Deferred(),b=k.Callbacks("once memory"),w=v.statusCode||{},a={},s={},u="canceled",T={readyState:0,getResponseHeader:function(e){var t;if(h){if(!n){n={};while(t=Pt.exec(p))n[t[1].toLowerCase()+" "]=(n[t[1].toLowerCase()+" "]||[]).concat(t[2])}t=n[e.toLowerCase()+" "]}return null==t?null:t.join(", ")},getAllResponseHeaders:function(){return h?p:null},setRequestHeader:function(e,t){return null==h&&(e=s[e.toLowerCase()]=s[e.toLowerCase()]||e,a[e]=t),this},overrideMimeType:function(e){return null==h&&(v.mimeType=e),this},statusCode:function(e){var t;if(e)if(h)T.always(e[T.status]);else for(t in e)w[t]=[w[t],e[t]];return this},abort:function(e){var t=e||u;return c&&c.abort(t),l(0,t),this}};if(x.promise(T),v.url=((e||v.url||Et.href)+"").replace(Mt,Et.protocol+"//"),v.type=t.method||t.type||v.method||v.type,v.dataTypes=(v.dataType||"*").toLowerCase().match(R)||[""],null==v.crossDomain){r=E.createElement("a");try{r.href=v.url,r.href=r.href,v.crossDomain=Ft.protocol+"//"+Ft.host!=r.protocol+"//"+r.host}catch(e){v.crossDomain=!0}}if(v.data&&v.processData&&"string"!=typeof v.data&&(v.data=k.param(v.data,v.traditional)),_t(It,v,t,T),h)return T;for(i in(g=k.event&&v.global)&&0==k.active++&&k.event.trigger("ajaxStart"),v.type=v.type.toUpperCase(),v.hasContent=!Rt.test(v.type),f=v.url.replace(Ht,""),v.hasContent?v.data&&v.processData&&0===(v.contentType||"").indexOf("application/x-www-form-urlencoded")&&(v.data=v.data.replace(Lt,"+")):(o=v.url.slice(f.length),v.data&&(v.processData||"string"==typeof v.data)&&(f+=(St.test(f)?"&":"?")+v.data,delete v.data),!1===v.cache&&(f=f.replace(Ot,"$1"),o=(St.test(f)?"&":"?")+"_="+kt+++o),v.url=f+o),v.ifModified&&(k.lastModified[f]&&T.setRequestHeader("If-Modified-Since",k.lastModified[f]),k.etag[f]&&T.setRequestHeader("If-None-Match",k.etag[f])),(v.data&&v.hasContent&&!1!==v.contentType||t.contentType)&&T.setRequestHeader("Content-Type",v.contentType),T.setRequestHeader("Accept",v.dataTypes[0]&&v.accepts[v.dataTypes[0]]?v.accepts[v.dataTypes[0]]+("*"!==v.dataTypes[0]?", "+$t+"; q=0.01":""):v.accepts["*"]),v.headers)T.setRequestHeader(i,v.headers[i]);if(v.beforeSend&&(!1===v.beforeSend.call(y,T,v)||h))return T.abort();if(u="abort",b.add(v.complete),T.done(v.success),T.fail(v.error),c=_t(Wt,v,t,T)){if(T.readyState=1,g&&m.trigger("ajaxSend",[T,v]),h)return T;v.async&&0<v.timeout&&(d=C.setTimeout(function(){T.abort("timeout")},v.timeout));try{h=!1,c.send(a,l)}catch(e){if(h)throw e;l(-1,e)}}else l(-1,"No Transport");function l(e,t,n,r){var i,o,a,s,u,l=t;h||(h=!0,d&&C.clearTimeout(d),c=void 0,p=r||"",T.readyState=0<e?4:0,i=200<=e&&e<300||304===e,n&&(s=function(e,t,n){var r,i,o,a,s=e.contents,u=e.dataTypes;while("*"===u[0])u.shift(),void 0===r&&(r=e.mimeType||t.getResponseHeader("Content-Type"));if(r)for(i in s)if(s[i]&&s[i].test(r)){u.unshift(i);break}if(u[0]in n)o=u[0];else{for(i in n){if(!u[0]||e.converters[i+" "+u[0]]){o=i;break}a||(a=i)}o=o||a}if(o)return o!==u[0]&&u.unshift(o),n[o]}(v,T,n)),s=function(e,t,n,r){var i,o,a,s,u,l={},c=e.dataTypes.slice();if(c[1])for(a in e.converters)l[a.toLowerCase()]=e.converters[a];o=c.shift();while(o)if(e.responseFields[o]&&(n[e.responseFields[o]]=t),!u&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),u=o,o=c.shift())if("*"===o)o=u;else if("*"!==u&&u!==o){if(!(a=l[u+" "+o]||l["* "+o]))for(i in l)if((s=i.split(" "))[1]===o&&(a=l[u+" "+s[0]]||l["* "+s[0]])){!0===a?a=l[i]:!0!==l[i]&&(o=s[0],c.unshift(s[1]));break}if(!0!==a)if(a&&e["throws"])t=a(t);else try{t=a(t)}catch(e){return{state:"parsererror",error:a?e:"No conversion from "+u+" to "+o}}}return{state:"success",data:t}}(v,s,T,i),i?(v.ifModified&&((u=T.getResponseHeader("Last-Modified"))&&(k.lastModified[f]=u),(u=T.getResponseHeader("etag"))&&(k.etag[f]=u)),204===e||"HEAD"===v.type?l="nocontent":304===e?l="notmodified":(l=s.state,o=s.data,i=!(a=s.error))):(a=l,!e&&l||(l="error",e<0&&(e=0))),T.status=e,T.statusText=(t||l)+"",i?x.resolveWith(y,[o,l,T]):x.rejectWith(y,[T,l,a]),T.statusCode(w),w=void 0,g&&m.trigger(i?"ajaxSuccess":"ajaxError",[T,v,i?o:a]),b.fireWith(y,[T,l]),g&&(m.trigger("ajaxComplete",[T,v]),--k.active||k.event.trigger("ajaxStop")))}return T},getJSON:function(e,t,n){return k.get(e,t,n,"json")},getScript:function(e,t){return k.get(e,void 0,t,"script")}}),k.each(["get","post"],function(e,i){k[i]=function(e,t,n,r){return m(t)&&(r=r||n,n=t,t=void 0),k.ajax(k.extend({url:e,type:i,dataType:r,data:t,success:n},k.isPlainObject(e)&&e))}}),k._evalUrl=function(e,t){return k.ajax({url:e,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(e){k.globalEval(e,t)}})},k.fn.extend({wrapAll:function(e){var t;return this[0]&&(m(e)&&(e=e.call(this[0])),t=k(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstElementChild)e=e.firstElementChild;return e}).append(this)),this},wrapInner:function(n){return m(n)?this.each(function(e){k(this).wrapInner(n.call(this,e))}):this.each(function(){var e=k(this),t=e.contents();t.length?t.wrapAll(n):e.append(n)})},wrap:function(t){var n=m(t);return this.each(function(e){k(this).wrapAll(n?t.call(this,e):t)})},unwrap:function(e){return this.parent(e).not("body").each(function(){k(this).replaceWith(this.childNodes)}),this}}),k.expr.pseudos.hidden=function(e){return!k.expr.pseudos.visible(e)},k.expr.pseudos.visible=function(e){return!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length)},k.ajaxSettings.xhr=function(){try{return new C.XMLHttpRequest}catch(e){}};var Ut={0:200,1223:204},Xt=k.ajaxSettings.xhr();y.cors=!!Xt&&"withCredentials"in Xt,y.ajax=Xt=!!Xt,k.ajaxTransport(function(i){var o,a;if(y.cors||Xt&&!i.crossDomain)return{send:function(e,t){var n,r=i.xhr();if(r.open(i.type,i.url,i.async,i.username,i.password),i.xhrFields)for(n in i.xhrFields)r[n]=i.xhrFields[n];for(n in i.mimeType&&r.overrideMimeType&&r.overrideMimeType(i.mimeType),i.crossDomain||e["X-Requested-With"]||(e["X-Requested-With"]="XMLHttpRequest"),e)r.setRequestHeader(n,e[n]);o=function(e){return function(){o&&(o=a=r.onload=r.onerror=r.onabort=r.ontimeout=r.onreadystatechange=null,"abort"===e?r.abort():"error"===e?"number"!=typeof r.status?t(0,"error"):t(r.status,r.statusText):t(Ut[r.status]||r.status,r.statusText,"text"!==(r.responseType||"text")||"string"!=typeof r.responseText?{binary:r.response}:{text:r.responseText},r.getAllResponseHeaders()))}},r.onload=o(),a=r.onerror=r.ontimeout=o("error"),void 0!==r.onabort?r.onabort=a:r.onreadystatechange=function(){4===r.readyState&&C.setTimeout(function(){o&&a()})},o=o("abort");try{r.send(i.hasContent&&i.data||null)}catch(e){if(o)throw e}},abort:function(){o&&o()}}}),k.ajaxPrefilter(function(e){e.crossDomain&&(e.contents.script=!1)}),k.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(e){return k.globalEval(e),e}}}),k.ajaxPrefilter("script",function(e){void 0===e.cache&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),k.ajaxTransport("script",function(n){var r,i;if(n.crossDomain||n.scriptAttrs)return{send:function(e,t){r=k("<script>").attr(n.scriptAttrs||{}).prop({charset:n.scriptCharset,src:n.url}).on("load error",i=function(e){r.remove(),i=null,e&&t("error"===e.type?404:200,e.type)}),E.head.appendChild(r[0])},abort:function(){i&&i()}}});var Vt,Gt=[],Yt=/(=)\?(?=&|$)|\?\?/;k.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Gt.pop()||k.expando+"_"+kt++;return this[e]=!0,e}}),k.ajaxPrefilter("json jsonp",function(e,t,n){var r,i,o,a=!1!==e.jsonp&&(Yt.test(e.url)?"url":"string"==typeof e.data&&0===(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&Yt.test(e.data)&&"data");if(a||"jsonp"===e.dataTypes[0])return r=e.jsonpCallback=m(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(Yt,"$1"+r):!1!==e.jsonp&&(e.url+=(St.test(e.url)?"&":"?")+e.jsonp+"="+r),e.converters["script json"]=function(){return o||k.error(r+" was not called"),o[0]},e.dataTypes[0]="json",i=C[r],C[r]=function(){o=arguments},n.always(function(){void 0===i?k(C).removeProp(r):C[r]=i,e[r]&&(e.jsonpCallback=t.jsonpCallback,Gt.push(r)),o&&m(i)&&i(o[0]),o=i=void 0}),"script"}),y.createHTMLDocument=((Vt=E.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",2===Vt.childNodes.length),k.parseHTML=function(e,t,n){return"string"!=typeof e?[]:("boolean"==typeof t&&(n=t,t=!1),t||(y.createHTMLDocument?((r=(t=E.implementation.createHTMLDocument("")).createElement("base")).href=E.location.href,t.head.appendChild(r)):t=E),o=!n&&[],(i=D.exec(e))?[t.createElement(i[1])]:(i=we([e],t,o),o&&o.length&&k(o).remove(),k.merge([],i.childNodes)));var r,i,o},k.fn.load=function(e,t,n){var r,i,o,a=this,s=e.indexOf(" ");return-1<s&&(r=mt(e.slice(s)),e=e.slice(0,s)),m(t)?(n=t,t=void 0):t&&"object"==typeof t&&(i="POST"),0<a.length&&k.ajax({url:e,type:i||"GET",dataType:"html",data:t}).done(function(e){o=arguments,a.html(r?k("<div>").append(k.parseHTML(e)).find(r):e)}).always(n&&function(e,t){a.each(function(){n.apply(this,o||[e.responseText,t,e])})}),this},k.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){k.fn[t]=function(e){return this.on(t,e)}}),k.expr.pseudos.animated=function(t){return k.grep(k.timers,function(e){return t===e.elem}).length},k.offset={setOffset:function(e,t,n){var r,i,o,a,s,u,l=k.css(e,"position"),c=k(e),f={};"static"===l&&(e.style.position="relative"),s=c.offset(),o=k.css(e,"top"),u=k.css(e,"left"),("absolute"===l||"fixed"===l)&&-1<(o+u).indexOf("auto")?(a=(r=c.position()).top,i=r.left):(a=parseFloat(o)||0,i=parseFloat(u)||0),m(t)&&(t=t.call(e,n,k.extend({},s))),null!=t.top&&(f.top=t.top-s.top+a),null!=t.left&&(f.left=t.left-s.left+i),"using"in t?t.using.call(e,f):c.css(f)}},k.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){k.offset.setOffset(this,t,e)});var e,n,r=this[0];return r?r.getClientRects().length?(e=r.getBoundingClientRect(),n=r.ownerDocument.defaultView,{top:e.top+n.pageYOffset,left:e.left+n.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var e,t,n,r=this[0],i={top:0,left:0};if("fixed"===k.css(r,"position"))t=r.getBoundingClientRect();else{t=this.offset(),n=r.ownerDocument,e=r.offsetParent||n.documentElement;while(e&&(e===n.body||e===n.documentElement)&&"static"===k.css(e,"position"))e=e.parentNode;e&&e!==r&&1===e.nodeType&&((i=k(e).offset()).top+=k.css(e,"borderTopWidth",!0),i.left+=k.css(e,"borderLeftWidth",!0))}return{top:t.top-i.top-k.css(r,"marginTop",!0),left:t.left-i.left-k.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent;while(e&&"static"===k.css(e,"position"))e=e.offsetParent;return e||ie})}}),k.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(t,i){var o="pageYOffset"===i;k.fn[t]=function(e){return _(this,function(e,t,n){var r;if(x(e)?r=e:9===e.nodeType&&(r=e.defaultView),void 0===n)return r?r[i]:e[t];r?r.scrollTo(o?r.pageXOffset:n,o?n:r.pageYOffset):e[t]=n},t,e,arguments.length)}}),k.each(["top","left"],function(e,n){k.cssHooks[n]=ze(y.pixelPosition,function(e,t){if(t)return t=_e(e,n),$e.test(t)?k(e).position()[n]+"px":t})}),k.each({Height:"height",Width:"width"},function(a,s){k.each({padding:"inner"+a,content:s,"":"outer"+a},function(r,o){k.fn[o]=function(e,t){var n=arguments.length&&(r||"boolean"!=typeof e),i=r||(!0===e||!0===t?"margin":"border");return _(this,function(e,t,n){var r;return x(e)?0===o.indexOf("outer")?e["inner"+a]:e.document.documentElement["client"+a]:9===e.nodeType?(r=e.documentElement,Math.max(e.body["scroll"+a],r["scroll"+a],e.body["offset"+a],r["offset"+a],r["client"+a])):void 0===n?k.css(e,t,i):k.style(e,t,n,i)},s,n?e:void 0,n)}})}),k.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(e,n){k.fn[n]=function(e,t){return 0<arguments.length?this.on(n,null,e,t):this.trigger(n)}}),k.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),k.fn.extend({bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}}),k.proxy=function(e,t){var n,r,i;if("string"==typeof t&&(n=e[t],t=e,e=n),m(e))return r=s.call(arguments,2),(i=function(){return e.apply(t||this,r.concat(s.call(arguments)))}).guid=e.guid=e.guid||k.guid++,i},k.holdReady=function(e){e?k.readyWait++:k.ready(!0)},k.isArray=Array.isArray,k.parseJSON=JSON.parse,k.nodeName=A,k.isFunction=m,k.isWindow=x,k.camelCase=V,k.type=w,k.now=Date.now,k.isNumeric=function(e){var t=k.type(e);return("number"===t||"string"===t)&&!isNaN(e-parseFloat(e))},"function"==typeof define&&define.amd&&define("jquery",[],function(){return k});var Qt=C.jQuery,Jt=C.$;return k.noConflict=function(e){return C.$===k&&(C.$=Jt),e&&C.jQuery===k&&(C.jQuery=Qt),k},e||(C.jQuery=C.$=k),k});
/*
 * jQuery throttle / debounce - v1.1 - 3/7/2010
 * http://benalman.com/projects/jquery-throttle-debounce-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function(b,c){var $=b.jQuery||b.Cowboy||(b.Cowboy={}),a;$.throttle=a=function(e,f,j,i){var h,d=0;if(typeof f!=="boolean"){i=j;j=f;f=c}function g(){var o=this,m=+new Date()-d,n=arguments;function l(){d=+new Date();j.apply(o,n)}function k(){h=c}if(i&&!h){l()}h&&clearTimeout(h);if(i===c&&m>e){l()}else{if(f!==true){h=setTimeout(i?k:l,i===c?e-m:e)}}}if($.guid){g.guid=j.guid=j.guid||$.guid++}return g};$.debounce=function(d,e,f){return f===c?a(d,e,false):a(d,f,e!==false)}})(this);
/*!
 * imagesLoaded PACKAGED v4.1.0
 * JavaScript is all like "You images are done yet or what?"
 * MIT License
 */
!function(t,e){"function"==typeof define&&define.amd?define("ev-emitter/ev-emitter",e):"object"==typeof module&&module.exports?module.exports=e():t.EvEmitter=e()}(this,function(){function t(){}var e=t.prototype;return e.on=function(t,e){if(t&&e){var i=this._events=this._events||{},n=i[t]=i[t]||[];return-1==n.indexOf(e)&&n.push(e),this}},e.once=function(t,e){if(t&&e){this.on(t,e);var i=this._onceEvents=this._onceEvents||{},n=i[t]=i[t]||[];return n[e]=!0,this}},e.off=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=i.indexOf(e);return-1!=n&&i.splice(n,1),this}},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(i&&i.length){var n=0,o=i[n];e=e||[];for(var r=this._onceEvents&&this._onceEvents[t];o;){var s=r&&r[o];s&&(this.off(t,o),delete r[o]),o.apply(this,e),n+=s?0:1,o=i[n]}return this}},t}),function(t,e){"use strict";"function"==typeof define&&define.amd?define(["ev-emitter/ev-emitter"],function(i){return e(t,i)}):"object"==typeof module&&module.exports?module.exports=e(t,require("ev-emitter")):t.imagesLoaded=e(t,t.EvEmitter)}(window,function(t,e){function i(t,e){for(var i in e)t[i]=e[i];return t}function n(t){var e=[];if(Array.isArray(t))e=t;else if("number"==typeof t.length)for(var i=0;i<t.length;i++)e.push(t[i]);else e.push(t);return e}function o(t,e,r){return this instanceof o?("string"==typeof t&&(t=document.querySelectorAll(t)),this.elements=n(t),this.options=i({},this.options),"function"==typeof e?r=e:i(this.options,e),r&&this.on("always",r),this.getImages(),h&&(this.jqDeferred=new h.Deferred),void setTimeout(function(){this.check()}.bind(this))):new o(t,e,r)}function r(t){this.img=t}function s(t,e){this.url=t,this.element=e,this.img=new Image}var h=t.jQuery,a=t.console;o.prototype=Object.create(e.prototype),o.prototype.options={},o.prototype.getImages=function(){this.images=[],this.elements.forEach(this.addElementImages,this)},o.prototype.addElementImages=function(t){"IMG"==t.nodeName&&this.addImage(t),this.options.background===!0&&this.addElementBackgroundImages(t);var e=t.nodeType;if(e&&d[e]){for(var i=t.querySelectorAll("img"),n=0;n<i.length;n++){var o=i[n];this.addImage(o)}if("string"==typeof this.options.background){var r=t.querySelectorAll(this.options.background);for(n=0;n<r.length;n++){var s=r[n];this.addElementBackgroundImages(s)}}}};var d={1:!0,9:!0,11:!0};return o.prototype.addElementBackgroundImages=function(t){var e=getComputedStyle(t);if(e)for(var i=/url\((['"])?(.*?)\1\)/gi,n=i.exec(e.backgroundImage);null!==n;){var o=n&&n[2];o&&this.addBackground(o,t),n=i.exec(e.backgroundImage)}},o.prototype.addImage=function(t){var e=new r(t);this.images.push(e)},o.prototype.addBackground=function(t,e){var i=new s(t,e);this.images.push(i)},o.prototype.check=function(){function t(t,i,n){setTimeout(function(){e.progress(t,i,n)})}var e=this;return this.progressedCount=0,this.hasAnyBroken=!1,this.images.length?void this.images.forEach(function(e){e.once("progress",t),e.check()}):void this.complete()},o.prototype.progress=function(t,e,i){this.progressedCount++,this.hasAnyBroken=this.hasAnyBroken||!t.isLoaded,this.emitEvent("progress",[this,t,e]),this.jqDeferred&&this.jqDeferred.notify&&this.jqDeferred.notify(this,t),this.progressedCount==this.images.length&&this.complete(),this.options.debug&&a&&a.log("progress: "+i,t,e)},o.prototype.complete=function(){var t=this.hasAnyBroken?"fail":"done";if(this.isComplete=!0,this.emitEvent(t,[this]),this.emitEvent("always",[this]),this.jqDeferred){var e=this.hasAnyBroken?"reject":"resolve";this.jqDeferred[e](this)}},r.prototype=Object.create(e.prototype),r.prototype.check=function(){var t=this.getIsImageComplete();return t?void this.confirm(0!==this.img.naturalWidth,"naturalWidth"):(this.proxyImage=new Image,this.proxyImage.addEventListener("load",this),this.proxyImage.addEventListener("error",this),this.img.addEventListener("load",this),this.img.addEventListener("error",this),void(this.proxyImage.src=this.img.src))},r.prototype.getIsImageComplete=function(){return this.img.complete&&void 0!==this.img.naturalWidth},r.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.img,e])},r.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},r.prototype.onload=function(){this.confirm(!0,"onload"),this.unbindEvents()},r.prototype.onerror=function(){this.confirm(!1,"onerror"),this.unbindEvents()},r.prototype.unbindEvents=function(){this.proxyImage.removeEventListener("load",this),this.proxyImage.removeEventListener("error",this),this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype=Object.create(r.prototype),s.prototype.check=function(){this.img.addEventListener("load",this),this.img.addEventListener("error",this),this.img.src=this.url;var t=this.getIsImageComplete();t&&(this.confirm(0!==this.img.naturalWidth,"naturalWidth"),this.unbindEvents())},s.prototype.unbindEvents=function(){this.img.removeEventListener("load",this),this.img.removeEventListener("error",this)},s.prototype.confirm=function(t,e){this.isLoaded=t,this.emitEvent("progress",[this,this.element,e])},o.makeJQueryPlugin=function(e){e=e||t.jQuery,e&&(h=e,h.fn.imagesLoaded=function(t,e){var i=new o(this,t,e);return i.jqDeferred.promise(h(this))})},o.makeJQueryPlugin(),o});
/*! lz-string-1.3.3-min.js | (c) 2013 Pieroxy | Licensed under a WTFPL license */
var LZString={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_f:String.fromCharCode,compressToBase64:function(e){if(e==null)return"";var t="";var n,r,i,s,o,u,a;var f=0;e=LZString.compress(e);while(f<e.length*2){if(f%2==0){n=e.charCodeAt(f/2)>>8;r=e.charCodeAt(f/2)&255;if(f/2+1<e.length)i=e.charCodeAt(f/2+1)>>8;else i=NaN}else{n=e.charCodeAt((f-1)/2)&255;if((f+1)/2<e.length){r=e.charCodeAt((f+1)/2)>>8;i=e.charCodeAt((f+1)/2)&255}else r=i=NaN}f+=3;s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+LZString._keyStr.charAt(s)+LZString._keyStr.charAt(o)+LZString._keyStr.charAt(u)+LZString._keyStr.charAt(a)}return t},decompressFromBase64:function(e){if(e==null)return"";var t="",n=0,r,i,s,o,u,a,f,l,c=0,h=LZString._f;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(c<e.length){u=LZString._keyStr.indexOf(e.charAt(c++));a=LZString._keyStr.indexOf(e.charAt(c++));f=LZString._keyStr.indexOf(e.charAt(c++));l=LZString._keyStr.indexOf(e.charAt(c++));i=u<<2|a>>4;s=(a&15)<<4|f>>2;o=(f&3)<<6|l;if(n%2==0){r=i<<8;if(f!=64){t+=h(r|s)}if(l!=64){r=o<<8}}else{t=t+h(r|i);if(f!=64){r=s<<8}if(l!=64){t+=h(r|o)}}n+=3}return LZString.decompress(t)},compressToUTF16:function(e){if(e==null)return"";var t="",n,r,i,s=0,o=LZString._f;e=LZString.compress(e);for(n=0;n<e.length;n++){r=e.charCodeAt(n);switch(s++){case 0:t+=o((r>>1)+32);i=(r&1)<<14;break;case 1:t+=o(i+(r>>2)+32);i=(r&3)<<13;break;case 2:t+=o(i+(r>>3)+32);i=(r&7)<<12;break;case 3:t+=o(i+(r>>4)+32);i=(r&15)<<11;break;case 4:t+=o(i+(r>>5)+32);i=(r&31)<<10;break;case 5:t+=o(i+(r>>6)+32);i=(r&63)<<9;break;case 6:t+=o(i+(r>>7)+32);i=(r&127)<<8;break;case 7:t+=o(i+(r>>8)+32);i=(r&255)<<7;break;case 8:t+=o(i+(r>>9)+32);i=(r&511)<<6;break;case 9:t+=o(i+(r>>10)+32);i=(r&1023)<<5;break;case 10:t+=o(i+(r>>11)+32);i=(r&2047)<<4;break;case 11:t+=o(i+(r>>12)+32);i=(r&4095)<<3;break;case 12:t+=o(i+(r>>13)+32);i=(r&8191)<<2;break;case 13:t+=o(i+(r>>14)+32);i=(r&16383)<<1;break;case 14:t+=o(i+(r>>15)+32,(r&32767)+32);s=0;break}}return t+o(i+32)},decompressFromUTF16:function(e){if(e==null)return"";var t="",n,r,i=0,s=0,o=LZString._f;while(s<e.length){r=e.charCodeAt(s)-32;switch(i++){case 0:n=r<<1;break;case 1:t+=o(n|r>>14);n=(r&16383)<<2;break;case 2:t+=o(n|r>>13);n=(r&8191)<<3;break;case 3:t+=o(n|r>>12);n=(r&4095)<<4;break;case 4:t+=o(n|r>>11);n=(r&2047)<<5;break;case 5:t+=o(n|r>>10);n=(r&1023)<<6;break;case 6:t+=o(n|r>>9);n=(r&511)<<7;break;case 7:t+=o(n|r>>8);n=(r&255)<<8;break;case 8:t+=o(n|r>>7);n=(r&127)<<9;break;case 9:t+=o(n|r>>6);n=(r&63)<<10;break;case 10:t+=o(n|r>>5);n=(r&31)<<11;break;case 11:t+=o(n|r>>4);n=(r&15)<<12;break;case 12:t+=o(n|r>>3);n=(r&7)<<13;break;case 13:t+=o(n|r>>2);n=(r&3)<<14;break;case 14:t+=o(n|r>>1);n=(r&1)<<15;break;case 15:t+=o(n|r);i=0;break}s++}return LZString.decompress(t)},compress:function(e){if(e==null)return"";var t,n,r={},i={},s="",o="",u="",a=2,f=3,l=2,c="",h=0,p=0,d,v=LZString._f;for(d=0;d<e.length;d+=1){s=e.charAt(d);if(!Object.prototype.hasOwnProperty.call(r,s)){r[s]=f++;i[s]=true}o=u+s;if(Object.prototype.hasOwnProperty.call(r,o)){u=o}else{if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}r[o]=f++;u=String(s)}}if(u!==""){if(Object.prototype.hasOwnProperty.call(i,u)){if(u.charCodeAt(0)<256){for(t=0;t<l;t++){h=h<<1;if(p==15){p=0;c+=v(h);h=0}else{p++}}n=u.charCodeAt(0);for(t=0;t<8;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}else{n=1;for(t=0;t<l;t++){h=h<<1|n;if(p==15){p=0;c+=v(h);h=0}else{p++}n=0}n=u.charCodeAt(0);for(t=0;t<16;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}delete i[u]}else{n=r[u];for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}}a--;if(a==0){a=Math.pow(2,l);l++}}n=2;for(t=0;t<l;t++){h=h<<1|n&1;if(p==15){p=0;c+=v(h);h=0}else{p++}n=n>>1}while(true){h=h<<1;if(p==15){c+=v(h);break}else p++}return c},decompress:function(e){if(e==null)return"";if(e=="")return null;var t=[],n,r=4,i=4,s=3,o="",u="",a,f,l,c,h,p,d,v=LZString._f,m={string:e,val:e.charCodeAt(0),position:32768,index:1};for(a=0;a<3;a+=1){t[a]=a}l=0;h=Math.pow(2,2);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(n=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}d=v(l);break;case 2:return""}t[3]=d;f=u=d;while(true){if(m.index>m.string.length){return""}l=0;h=Math.pow(2,s);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}switch(d=l){case 0:l=0;h=Math.pow(2,8);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 1:l=0;h=Math.pow(2,16);p=1;while(p!=h){c=m.val&m.position;m.position>>=1;if(m.position==0){m.position=32768;m.val=m.string.charCodeAt(m.index++)}l|=(c>0?1:0)*p;p<<=1}t[i++]=v(l);d=i-1;r--;break;case 2:return u}if(r==0){r=Math.pow(2,s);s++}if(t[d]){o=t[d]}else{if(d===i){o=f+f.charAt(0)}else{return null}}u+=o;t[i++]=f+o.charAt(0);r--;f=o;if(r==0){r=Math.pow(2,s);s++}}}};if(typeof module!=="undefined"&&module!=null){module.exports=LZString}
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){"use strict";var t=e.document,n=function(){return e.URL||e.webkitURL||e},r=e.URL||e.webkitURL||e,i=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s="download"in i,o=function(n){var r=t.createEvent("MouseEvents");r.initMouseEvent("click",true,false,e,0,0,0,0,0,false,false,false,false,0,null);n.dispatchEvent(r)},u=e.webkitRequestFileSystem,a=e.requestFileSystem||u||e.mozRequestFileSystem,f=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",c=0,h=[],p=function(){var e=h.length;while(e--){var t=h[e];if(typeof t==="string"){r.revokeObjectURL(t)}else{t.remove()}}h.length=0},d=function(e,t,n){t=[].concat(t);var r=t.length;while(r--){var i=e["on"+t[r]];if(typeof i==="function"){try{i.call(e,n||e)}catch(s){f(s)}}}},v=function(t,r){var f=this,p=t.type,v=false,m,g,y=function(){var e=n().createObjectURL(t);h.push(e);return e},b=function(){d(f,"writestart progress write writeend".split(" "))},w=function(){if(v||!m){m=y(t)}if(g){g.location.href=m}else{window.open(m,"_blank")}f.readyState=f.DONE;b()},E=function(e){return function(){if(f.readyState!==f.DONE){return e.apply(this,arguments)}}},S={create:true,exclusive:false},x;f.readyState=f.INIT;if(!r){r="download"}if(s){m=y(t);i.href=m;i.download=r;o(i);f.readyState=f.DONE;b();return}if(e.chrome&&p&&p!==l){x=t.slice||t.webkitSlice;t=x.call(t,0,t.size,l);v=true}if(u&&r!=="download"){r+=".download"}if(p===l||u){g=e}if(!a){w();return}c+=t.size;a(e.TEMPORARY,c,E(function(e){e.root.getDirectory("saved",S,E(function(e){var n=function(){e.getFile(r,S,E(function(e){e.createWriter(E(function(n){n.onwriteend=function(t){g.location.href=e.toURL();h.push(e);f.readyState=f.DONE;d(f,"writeend",t)};n.onerror=function(){var e=n.error;if(e.code!==e.ABORT_ERR){w()}};"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=f["on"+e]});n.write(t);f.abort=function(){n.abort();f.readyState=f.DONE};f.readyState=f.WRITING}),w)}),w)};e.getFile(r,{create:false},E(function(e){e.remove();n()}),E(function(e){if(e.code===e.NOT_FOUND_ERR){n()}else{w()}}))}),w)}),w)},m=v.prototype,g=function(e,t){return new v(e,t)};m.abort=function(){var e=this;e.readyState=e.DONE;d(e,"abort")};m.readyState=m.INIT=0;m.WRITING=1;m.DONE=2;m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null;e.addEventListener("unload",p,false);return g}(self)
/*! seedrandom.js v2.3.3 | (c) 2013 David Bau, all rights reserved. | Licensed under a BSD-style license */
!function(a,b,c,d,e,f,g,h,i){function j(a){var b,c=a.length,e=this,f=0,g=e.i=e.j=0,h=e.S=[];for(c||(a=[c++]);d>f;)h[f]=f++;for(f=0;d>f;f++)h[f]=h[g=r&g+a[f%c]+(b=h[f])],h[g]=b;(e.g=function(a){for(var b,c=0,f=e.i,g=e.j,h=e.S;a--;)b=h[f=r&f+1],c=c*d+h[r&(h[f]=h[g=r&g+b])+(h[g]=b)];return e.i=f,e.j=g,c})(d)}function k(a,b){var c,d=[],e=typeof a;if(b&&"object"==e)for(c in a)try{d.push(k(a[c],b-1))}catch(f){}return d.length?d:"string"==e?a:a+"\0"}function l(a,b){for(var c,d=a+"",e=0;e<d.length;)b[r&e]=r&(c^=19*b[r&e])+d.charCodeAt(e++);return n(b)}function m(c){try{return a.crypto.getRandomValues(c=new Uint8Array(d)),n(c)}catch(e){return[+new Date,a,(c=a.navigator)&&c.plugins,a.screen,n(b)]}}function n(a){return String.fromCharCode.apply(0,a)}var o=c.pow(d,e),p=c.pow(2,f),q=2*p,r=d-1,s=c["seed"+i]=function(a,f,g){var h=[],r=l(k(f?[a,n(b)]:null==a?m():a,3),h),s=new j(h);return l(n(s.S),b),(g||function(a,b,d){return d?(c[i]=a,b):a})(function(){for(var a=s.g(e),b=o,c=0;p>a;)a=(a+c)*d,b*=d,c=s.g(1);for(;a>=q;)a/=2,b/=2,c>>>=1;return(a+c)/b},r,this==c)};l(c[i](),b),g&&g.exports?g.exports=s:h&&h.amd&&h(function(){return s})}(this,[],Math,256,6,52,"object"==typeof module&&module,"function"==typeof define&&define,"random");
/*! console_hack.js | (c) 2015 Thomas Michael Edwards | Licensed under SugarCube's Simple BSD license */
!function(){for(var methods=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],length=methods.length,noop=function(){},console=window.console=window.console||{};length--;){var method=methods[length];console[method]||(console[method]=noop)}}();
}else{document.documentElement.setAttribute("data-init", "lacking");}
</script>
<style id="style-normalize" type="text/css">/*! normalize.css v3.0.3 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{color:inherit;font:inherit;margin:0}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}input{line-height:normal}input[type=checkbox],input[type=radio]{box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-appearance:textfield;box-sizing:content-box}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{border:0;padding:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-collapse:collapse;border-spacing:0}td,th{padding:0}</style>
<style id="style-init-screen" type="text/css">@-webkit-keyframes init-loading-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes init-loading-spin{0%{-o-transform:rotate(0);transform:rotate(0)}100%{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes init-loading-spin{0%{-webkit-transform:rotate(0);-o-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}#init-screen{display:none;z-index:100000;position:fixed;top:0;left:0;height:100%;width:100%;font:28px/1 Helmet,Freesans,sans-serif;font-weight:700;color:#eee;background-color:#111;text-align:center}#init-screen>div{display:none;position:relative;margin:0 auto;max-width:1136px;top:25%}html[data-init=lacking] #init-screen,html[data-init=loading] #init-screen,html[data-init=no-js] #init-screen{display:block}html[data-init=lacking] #init-lacking,html[data-init=no-js] #init-no-js{display:block;padding:0 1em}html[data-init=no-js] #init-no-js{color:red}html[data-init=loading] #init-loading{display:block;border:24px solid transparent;border-radius:50%;border-top-color:#7f7f7f;border-bottom-color:#7f7f7f;width:100px;height:100px;-webkit-animation:init-loading-spin 2s linear infinite;-o-animation:init-loading-spin 2s linear infinite;animation:init-loading-spin 2s linear infinite}html[data-init=loading] #init-loading>div{text-indent:9999em;overflow:hidden;white-space:nowrap}html[data-init=loading] #passages,html[data-init=loading] #ui-bar{display:none}</style>
<style id="style-font" type="text/css">@font-face{font-family:tme-fa-icons;src:url(data:application/octet-stream;base64,d09GRgABAAAAACWoAA4AAAAAQhQAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAABPUy8yAAABRAAAAEQAAABWPihI/2NtYXAAAAGIAAAAOgAAAUrQXRm3Y3Z0IAAAAcQAAAAKAAAACgAAAABmcGdtAAAB0AAABZQAAAtwiJCQWWdhc3AAAAdkAAAACAAAAAgAAAAQZ2x5ZgAAB2wAABjCAAAq+uJ4WNtoZWFkAAAgMAAAADQAAAA2BZlJs2hoZWEAACBkAAAAIAAAACQIJwQZaG10eAAAIIQAAABuAAABOPTeAABsb2NhAAAg9AAAAJ4AAACeojKW6m1heHAAACGUAAAAIAAAACAA6gvwbmFtZQAAIbQAAAGPAAAC/eLsyKlwb3N0AAAjRAAAAfwAAAM0412SIHByZXAAACVAAAAAZQAAAHvdawOFeJxjYGRWYZzAwMrAwVTFtIeBgaEHQjM+YDBkZGJgYGJgZWbACgLSXFMYHF4wvPBhDvqfxRDFHMQwDSjMCJIDANLeC6V4nGNgYGBmgGAZBkYGEHAB8hjBfBYGDSDNBqQZGZgYGF74/P8PUvCCAURLMELVAwEjG8OIBwC4Ywb6AAAAAAAAAAAAAAAAAAB4nK1WaXMTRxCd1WHLNj6CDxI2gVnGcox2VpjLCBDG7EoW4BzylexCjl1Ldu6LT/wG/ZpekVSRb/y0vB4d2GAnVVQoSv2m9+1M9+ueXpPQksReWI+k3HwpprY2aWTnSUg3bFqO4kPZ2QspU0z+LoiCaLXUvu04JCISgap1hSWC2PfI0iTjQ48yWrYlvWpSbulJd9kaD+qt+vbT0FGO3QklNZuhQ+uRLanCqBJFMu2RkjYtw9VfSVrh5yvMfNUMJYLoJJLGm2EMj+Rn44xWGa3GdhxFkU2WG0WKRDM8iCKPslpin1wxQUD5oBlSXvk0onyEH5EVe5TTCnHJdprf9yU/6R3OvyTieouyJQf+QHZkB3unK/ki0toK46adbEehivB0fSfEI5uT6p/sUV7TaOB2RaYnzQiWyleQWPkJZfYPyWrhfMqXPBrVkoOcCFovc2Jf8g60HkdMiWsmyILujk6IoO6XnKHYY/q4+OO9XSwXIQTIOJb1jkq4EEYpYbOaJG0EOYiSskWV1HpHTJzyOi3iLWG/Tu3oS2e0Sag7MZ6th46tnKjkeDSp00ymTu2k5tGUBlFKOhM85tcBlB/RJK+2sZrEyqNpbDNjJJFQoIVzaSqIZSeWNAXRPJrRm7thmmvXokWaPFDPPXpPb26Fmzs9p+3AP2v8Z3UqpoO9MJ2eDshKfJp2uUnRun56hn8m8UPWAiqRLTbDlMVDtn4H5eVjS47CawNs957zK+h99kTIpIH4G/AeL9UpBUyFmFVQC9201rUsy9RqVotUZOq7IU0rX9ZpAk05Dn1jX8Y4/q+ZGUtMCd/vxOnZEZeeufYlyDSH3GZdj+Z1arFdgM5sz+k0y/Z9nebYfqDTPNvzOh1ha+t0lO2HOi2w/UinY2wvaEGT7jsEchGBXMAGEoGwdRAI20sIhK1CIGwXEQjbIgJhu4RA2H6MQNguIxC2l7Wsmn4qaRw7E8sARYgDoznuyGVuKldTyaUSrotGpzbkKXKrpKJ4Vv0rA/3ikTesgbVAukTW/IpJrnxUleOPrmh508S5Ao5Vf3tzXJ8TD2W/WPhT8L/amqqkV6x5ZHIVeSPQk+NE1yYVj67p8rmqR9f/i4oOa4F+A6UQC0VZlg2+mZDwUafTUA1c5RAzGzMP1/W6Zc3P4fybGCEL6H78NxQaC9yDTllJWe1gr9XXj2W5twflsCdYkmK+zOtb4YuMzEr7RWYpez7yecAVMCqVYasNXK3gzXsS85DpTfJMELcVZYOkjceZILGBYx4wb76TICRMXbWB2imcsIG8YMwp2O+EQ1RvlOVwe6F9Ho2Uf2tX7MgZFU0Q+G32Rtjrs1DyW6yBhCe/1NdAVSFNxbipgEsj5YZq8GFcrdtGMk6gr6jYDcuyig8fR9x3So5lIPlIEatHRz+tvUKd1Ln9yihu3zv9CIJBaWL+9r6Z4qCUd7WSZVZtA1O3GpVT15rDxasO3c2j7nvH2Sdy1jTddE/c9L6mVbeDg7lZEO3bHJSlTC6o68MOG6jLzaXQ6mVckt52DzAsMKDfoRUb/1f3cfg8V6oKo+NIvZ2oH6PPYgzyDzh/R/UF6OcxTLmGlOd7lxOfbtzD2TJdxV2sn+LfwKy15mbpGnBD0w2Yh6xaHbrKDXynBjo90tyO9BDwse4K8QBgE8Bi8InuWsbzKYDxfMYcH+Bz5jBoMofBFnMYbDNnDWCHOQx2mcNgjzkMvmDOOsCXzGEQModBxBwGT5gTADxlDoOvmMPga+Yw+IY59wG+ZQ6DmDkMEuYw2Nd0ayhzixd0F6htUBXowPQTFvewONRUGbK/44Vhf28Qs38wiKk/aro9pP7EC0P92SCm/mIQU3/VdGdI/Y0Xhvq7QUz9wyCmPtMvxnKZwV9GvkuFA8ouNp/z98T7B8IaQLYAAQAB//8AD3icrToNcBzVefe9/b3dvd29u909/dyd7ke6k86yLEunOyHJsrCxJWyJGmEcLMDYxBhHNsZQBzOAkjQmFDrGIq5gHEIcCILOAGZq3IQO04RkIGkgaUMKMbQznSlJW0wgJtOQHxRr1e+93TvJwq7JTD3y2/f//bzvfX/vAhAIzL3KPcYNBFIB8UR9EJYuAcuAqGNbOiwDSczkuorlaJ6WTeVSRwMIDveY8aN20GztjzMhW4P2H+kNUPM5NaVNQE0K3tWM77vv8rJqgnT33VJE4WWIfd/QbKHZjcXcZiFAqjCDgUJA/mZTWOIIwi0vAwNiUjkW9THIZs6DAbnj6ffGP/P+0y2vv+5SXGLKuXHJPJH92c+yT7x3883wnI9W/DxI4T9+bm7uOL+MUwNywAg0BJYFQgNKa2NDzFBEjqeM0SFXLHU4YKe7yjFoSmdEKWw5nemOUj5czMXCliilM7lyuFgqp3HaDf1j/fhH+s6cfm4MEpA8c0BSQBO5CUkD5fJi05kDjSUoNnETTUUSXtpPVm0aGHDdmV0nNkPiMUWeHZMVRSZPSlp0dqypCKVG8iT9IK5AEeamyZGAjecW5tm5SSBm8ojiSqBsYoXDTRtuymw13V8axjB+p2EPlsMGcRzTTRkGOLRpmk/AzSZ+A97ecx+QN8g9gUbc26F7N+GJiN5pLGMA8hUo7EQcHI455A0PwrS3I37N+bZhTE8bex1aeeIJ4+MTjTY6gcH+iIvgGWQRdh2TR9sS81kspCzytguLfBcyuBOLXuhwYnZnh8NFUs6plLPLScGpWBKwkYztwsop7Hie9r7rYK/9brWXTg9U+RiBX+GJiyc0rgIv7UNJe3vPjrFdyZOV/byNUkyW/0AuIi/h+h6U5a64SmW5ieGcya2AYimG+EUtnZN08ImgveV+KOYykiiJVMrbkI+dHUkC9+nyPUFdD94j639r1uTq7FiSNrR1hXS8uLbGapYUSbpaJvzmp5aODbU9iJNBU1gJa5LFTCqihNpDigmWWtc2GjUy7Y2m3hHk14qmPJXp2cTInZudO85dhzw2AuXAJQHl+Yt7l0RVjkO8u4q5JZARE2A5yNxStNgGWcQSj7izA1HucCgJOsRsb7xYWgn9XAwvRqaN4HAS4ENF3kXFFovJ/muW3zsYDK3jxaCQbOouOPXZPmBDNZG4krS0N2/9wakf7hHv+IcPX/jcaGWZAp9fvrFtv66UeSlXn4zYdZo5kLNwIJJRTbEu3jz62Zf37Xv5l7RAeugZfAQ7kJ5koA3PoJB1eP8MpHRVWqpygyITpiKz4DCoHMENlun+wrDA0bNZ9jmJZdZwhhx9UnewMKztg2yAlie9j6O7Lzrks7tYdRdOO4u/FJ9e5G93RyFTJ1f5G17IZDs7z25uEfuFBYwlvYpUUuTnKJO6umg5IymD88yGGxbycjN2JOkIVk6wUoEzm/0O5T/Owb92Jg8NyL/6qFrl30IZ5nSgMp3nch7DkvOMCaMeoQ1U4JZxQncenmAMmcAei/S7V9CvAccW8mczwtMCceSQ8nwhXWuKAeQPJbRCc9RnhoSyhvBL+WgxTzsk0Y567IFj+35wa4Xq7ykS5YIm7UIdq4iCfKcsiIoSvFFWONUnFovZoXHKhXE69R9hTOIEgZPcJ0VZRrx+i3j9hhtFPqQDnYjX8uaEpS2+F4twiVkOylSJAwfvBZO3XBnoTaEHtltSWAGKIEl3SJIQ1CRESIRnLFtJRc88GckEbQuOBTO5zBXziL0JIPKiyMtzggwiMc+czmbDEbDMbJaLhC3LPzPuFOKaD6zEM+tt15gNxTPLIg5dvglCfGmbmakYmqmKsEfRVOWWAXjqvEzVeamT6botq9321Vu2rIb7KOrufmZ24LWmoiI3yspJJ65e704JprBSFGH3pxXLhAQe9fBzbM1rq7YAm1dsctvZSiqu8G94rxwS/LQ7JYorRR0XXq/GmSh4dJADKAsSk70ajQ8gHdE0MhzVjOCbVDSvKINd1PhKVN+fgMTG2zYCvIaq+V2mmsNTP36IRLD6xO7ejWTDisfc7zCVD6tQW+/eMTW1Y3fSt20foe+hBZpQ3zfGfH3vyzmCZNvHFoJFVPrRjj7m6I26M3r7KHQxgD5c2H/4tQdIeJLJ+yQDvTsZOwv4jYfJQxVaxxmtKtNTTVaQnRmS6kkWvfBoNvCeIT55jt41PJZwpg3YYeJYGK+dppgK/sF+R/8ggZIOBlnyNoK/qpwokLZ6uCFRKCTKV8HeGaYksPg2Xj/3fyQZb6dhGWv2QLLQU4DW7lZwf77Hw+vb3AjzexKIVywkEXoGlB1JUqr4FW3A7BZlDzgzhZ5W0tyfI1da7mmn13JvsZOFxLuJIRsmLXJVskByA41iu/uvSds9bWOnPZQ4lSgANm+xqQ6gMPlGH2YR79rSDIXLXQBujHZSxkCpSIeynwCdNxEFJ2HVmSDaFPxQYoIN2BfCM8E6zTCu66VDSQ97KkPfIa8i7nGUITNAZagDhYFJjeg5rXh+bcBuYamT/JWmRVE8Iopeb/3ud1ZdSIs4TkQLcaogJ63Z5dGUxEfefz8qSKko+Qm2PB/ZgyEEMngmjkjovYB0GBog+n9COzD7MiQ73pfOA5S8NLseIst+QWbPC9y/J8dRv7QFliCNWcnzAYlI3fE8hdNVbBPY1WEeZxm8m5mKOdypQRG1qhiRgQBnZbr7N20qT1ipoPsLVYWEGq8hE3BoLPn2tV8PhWVe0WTB4nIN3WMD7cmIiDZEhaSSROulWMbk2+sX4LIs0Iq4NNdUfV3mDeqCbaEOligmbYSFCaU0VRVULrhTKoKlIMubNvV3ZyyOByWMilXkBpNjcIjihTjBrwzF/bmKF1iMJNsHxrobcnxElDVF0C3u69fevP5txIsEcUrVZyR96DPqiI/C+zGTp0uZGkXVP6PG1RncET7Ey/eKjnX885QeWw83krsCIVyvMp8TD9P3rEvMFUkFZxS6Rw25ytWQJ/52/tqLyQSDrc7Dpiq/H2XDgYsVBgjnK7BF95EwLKLNKLh0bg5x74VXPNwJO1fq7raB588j7pbhat78pDKjPE1td1Jl6Hhn8Q73LdISsCrrgwuijljQ28Tinnavx+Xu9ap6jYqn2QzNaly7RoVJ99MoBl/DvmtU1X0Lu3FCnO37XXKEW832Nai8BYnDKKvIF92W3F9dotK94ahCNyJPuW+5b2L1WrQ2X6fSc1TBejLg77uvsm8FX2b1ghWk6cbjuB1FUIVm9y0f6aMKfMbdhjshNGihFKgIgE7044ZvkbXz+zbh3chXN/f35Z6mOyF2b/m7H6V7HVV3XYOYtiDOig/J25bh+xPuAPMdxRPRc8V1YU8Z2mEv9OIO2O6DTg8Wtt2C3+lCcjBRmEaNVbDhi0nLnUK1ttvqdVpsexruQ93WGnf3T9s47N+te7nN5FeohRGeChUfIvZx5htAPYTNjQl/ea/tTlkW7LZ7nIK3dyNsGUwWpq0+a4k/ALvozB5nurkCqwthUdrq5mnzBD/tu5rpfPVYuC6L0VZwnMfd/YnGxgTc97jjFNjGFvRQ6iyrYPfZjyPVyQJM233YRF5YVb1xgLzjwVMX3NOwZ/K7wtJZx4W8pGRNNzf4ZOBeCKgPCxuKcUYmxQNycbjP5wGlEJGk8OZc369tR3gtaZ+X6CbmVkIONRVJcugpluk1TQL1Fqmfy1ELVi4hYy1zJhYNj4zu7RkfbuebN17fv+q2Fj4sDgtE7Hv2uk89uneIH7j9yNWjR1YMmUvJSzO6s9QcGWkbHt83PtzW0yWCMMLr4roNcMm+o88e3XdJ/0VDkWiFDxSv5YhXq8d3nVAryjjtoDXp7Ojn2gg6ijGHIUxDpQZ0Y2lQym2+5NZHN219to8XhsUw33Lb6p6dG9DVGN598/bmkXA0NoPeR2t4qO/h0U8d3bcKtmB5yeilos6PCCB29fgINjeNmEsdfaYmGhm6qB9RrPhEx7mrEbfGwCDauZXNJo09wLJ1oAhSe1NxWkUDKKJofMqeE+szt8S4K9JYmjbLXRRtylOU1vWN//mVy4/0DVGNqM9QJT7SvL287ot5MSZoGC/oyHTWO7p3vdd5s6RB439/5fKH6aIaEDh46AVkpMqWo1YdaWpe1690hzT4e79jxGuLvD+R0iUwuiJ+TLUM4+yrA8aAdsVAsX1JFgMsTkCF4ceBdtgLZ8oXaENnPpfPipLA6A57nn4+XI1hUbCoYmig1KP5pH44Kybnq4cUyatKivvTmXpeOC7y8J4il3yHncWVz+SDrc5zTqucPyYro3Af7XP30/I8ddJxsQAgXIFbz37QdsmqNhJl0K6145C0rkWzExAX8aM3sDpwYyA8oF83PNBXWu7xRPQMIT1E6syw7M4F2tFwOmyhVKQ7+uH/lz9DribLBF4jsuze94lYBc+7LzLOXMw4c+66u52EZz/QLEWxyA0XZFuA9+OVUfSTwyzWCw0o3a0Jx9BYTrKp2AZiEi9qGSs6OFhZkPboRDXesZKpbcd3UOjV8dMgNNQhr1pJh0Qy5petVIQ48Zq1KefMj7zIhluf3pQeBs5JfUuJMGcgHFRik16gP1mzHX2EmroaYhmVysETLOo54aSGU/gHzbEwdRvCMXuGhUczHj3HkZ42Rk9LYIDS07c8YRuqSBg91Pmnwo8VghFR2Y9oKTmxziSwi0HTN2I1cMvT3E7Fezk/Pae1UnYyUwqdRnqCNZPoXSJSk6hxGWmRBKqBSMqyTP97/wmaJcQCGpqbG5Iw6vhEtHpEVWihepULpFG3rqG0rOha2qTxJIC0YOSYFjrxEtP8nlSlIxvu7PLcRKmS76mk04Sq0HoTqJ04CcfcK+DDIU34mhCX/dByaAiDy58ibicVeRdNJrNyezI2G/ESlUKsZDxiOtLJk/ChXCc9Imp+1nO2xL6QZIkkWiizM7SHIF9q9K8ZpQDx8zOjgWaMzORvdrSGPJ2sEzRYZer9O2gmWD4zSTr6sSuH8Uc/IGjmyLIMOHUV0G48840967ixy2v6zIhcU+pr3bDj9u0bc1xfqUbO9sUuH3O/iqEbFPqaPbOBZuFTO57rx7mxvnDL7avRFLah/ei55LZCpKddjqz4OxhyH6YRLuzA0rcfY5yC8rQTcb08JdLYleZW8TZ0lGgSCyVfQoQtRDiPV6BqKLryzL7kqRmkuoGdE5UzlKWy39mJQlU1OChf1KrEHOYcsdMhvaO3j5JN+zZBXJZ2Kmq0WRSMDSFJGqmtC0q8eZesmfWxPxNNca3DC3KzYsg7MBBXhJ2yHmvy5sojNXVBmQvfhUdoxJ0NgiENWTzfqwd3SOjC927ceNvGjbfTUTNp13eIumhvAKEvJA/HTUW6Maj1CeJAUtBFrcOI1xugSWxubV1qqaRJ1gZvqiHLbKqwOo5TR9hELw7/iBsjL/t6WXl+SWN9VOO5RfnTtJcwreTFY35bWthGB+bMB+yOcGEDg4bztxbkUR0wh1h2kJWgV0awMR+Hjvn5mlrmu9BMCMpYsZynmQC8KR2xco4maZIg5jN5CU86ViJ/s27nzqlxgFc6167fuXP92s5XYOdDO8j4pYNYw16IjR8eH79U0ra3Y6V9uyat20l2P7AbsKpjJ81Tzs39nt9PXgqYeL9LNB+Yi9uMN1BEZ0knnvijDiZLEDg6dJ30NuA9oQEVh9U0uk/kgO8A+R94pvWy8YveWn0ZWbfmLepJXdqz5Z5B94qhu7d2k75r7l0Lx2gVtvTMr6FXgDY7p56d6qSNS+/e0ke6r//CQ1/YXiTdW++u+FK/529HfC3klvzNhK3Te4txIUFlkuQ8tIjguXrUG6WAPWgMsIcDF664d3v3DHXwhQ07YMul2I9QDvtQXz+bokoej3uUo5mt1Qi7f/m58pGoIAyavsnnFiUl8cbhKTpRmI+CKw9Y1oKc5GvZZJCT6kWJcCHNzzDS3KTQKEocr/6Fe1GoUf+1rq/QG/W/hs9goz8E649Xc5M6HxXjAnDV9OT9spBFuwOC26Prv2bzQ3RhCHfwaYpW8+LxqOzlYOZR7/Kf/RbmXMktCzAr3jWP/Kqt5KUqZDq4uTqyBbYGfL17HcuL19KcjykyePSoAP2bNgILH1qOXXFwA9l471P3bOIvOwRXL8j+k0OjB6cPjrLCfe2sXP/824QcsAMZlOmGWiMo0rwb4K1qo+mH/LkBVlXdA+cFXFFWvz0//AXvbZ6+ac3GoyzHHvXfzCqvNILfLi9qV7KBJ/03OPbql/A+XlcDa3g9C1/rnPPU/XzkR4E3q/4p6kHES6V3vVx1M7x3EG4RnpwfhuT9B8mTF4BG6w/vZp7SbtoL4oJBkCuYe2+LL3GT6CtdzGKjNas6FGaHETyqOIeljCSdy4azYTwkLxFIL08OHSKaM+7sonl9vERpGguhHaS5bUgz24xu3ETTPsVKqntkIZfpqR1MdBfQKd6hmiFHviU1QZ260MQ2FSOcbfDmVoyFeHkb9rq/db9KFWsP6uutqz6LgZW6R+JrIjp86Gp6jSXL+7RoUv38yjEracH0NiVpKdu2ISBl27QDRdTKAT9WHoc/IL/p7w4sptcdmtpFR6IcZRnNXDnaT909x7Ykjj6PwmlFdP9FMuWgQvb8nAiKpHB7iS4/r+pk678LRCWOGpq9QwfOlOGlbpDkEPwThngKL7puibAY5LvMl+ZQQ8Yx4mxF/wZjkGJ7a3NjKl5jyjiJ/hAhLzVVExN+9qMpZsAyWImhu/eF2NlfcmS6bxq6lNlO9CZvxpjon/G7R5k1SqVwuFwOv3HTTZn0TTelSQs2wtjpPkNH8D/RH++b3mkosx0KLkzSlfi92qSrzPKX2arMTe692ChjJ7T5I75t3I487EIe5jXKQ6pg6Q83qs/lEn3noSFynmb4aOrBF9sEoBuHhKFYcL11up41emofLCQGE60wVdeDClSvn5qqM41Go7t+iuWUHqzrNrOGWTsFst5TtwLXXPk0Syc9fSX2rsBFmzadY6C/Fge8d+e5uXHkfyiQRc6vwTu2Ylkhz95Fq2/8+YVv/CxSqb7xxyqhDjDBRxFBxcQnSYzeBfrYNqGJjej4TLDfWEywII42hqZ+/BB/6I2DkCn0WS9uv3PD4Z0DpG/3oemDe7u5NS/aMOWtol60t2qCusYTSi19uHn1iHiQOpz2i2v6xx/4xqE9PfyqHQ+N3Ln9RftsmoxADcYAyvMt9Y73lr7wdwTUmb8g/u53GOaw6pPizJC9MJrEj7noG9sG1CNhmWN2BcF2dpRzGBfz5XrojEWZRxuj6aCYY0tiLJOTMmK2uJJQjxj/8hjKEB1iGHCj4JTpxczQzEtehAevG+5pUO12twtCjfG4I979yJB4a7RlZbDdVGV1OMgDQPZQY+ERm1wqiVyYJwJHMrGaP+o9YKbUlE2ApL6YEiyylNT9ESff74qtvCgqNSZcBVOa+2Hr9q9E70rVikGTcxRJ4BSQa6ImzpQIEXk+OFbqhvQRQ4souDWotqAiL2Xqm+AZ/Yz0kXcCOnvfqg1779vzOXtqtvPMii9Ig5+dwj87Kf4bQ6EJfdRt4PyQZYFY0/NXERbE5vPzi+As2njhToFqfp7h6ufXYTFiZ6MCryyG/xQX5qIBFddLfr6b+SYsHc3P1ocikRD5rxCMuNslxeBKuiZjzQpUY6kFvwNgPtyioHRxkEr9fv+HE5AwHFc9q0neOXOa/kiAi9ByQX3et1fZb2+q7yCL914QN5y1GVt/DOVaR29JPCECXV9iGaI84A7sQ9W3Y4dLZe4vVR1Mxd3Hc7rq7lNVOKjqHM9xqmiceVWXNTgoiO6fswpN0R/EfnefyHtnMvcsdw1nzMOJiSzGpQ+SPmclxmVRqlVM0HG5wNFSQYAIRhjE3ZDTsobwJbifVegTxj7sx7mCRwvp5XSWh6/QYs/TwjyMahKsVCYZVaeECMTR56MplPyzCfrSPO/dL0m8RwvpQ1oS56aF7i/58Mpn0eOHaKxcTNGd84cLd4oCvXPu3B+4a8kPUA7rmSzJ7E3Zy7OzuJEm/Mt+7Eh/pyDPMx7xF7luuh/CY9hDe4WZYLqvW+YhFlJiWX1PO0aOB6L0t3AVOUK7V/XSqP8Dx/CavHCY8erwC3jhyKHZR2nu9wXvpz4vKN4dwOIA22sZ/S1RTbhyBxbvF/XeXzEQpfEUTa0hLTTE+RigN9vzQhBp0RzT5OUaKazwlhEU8u0fx8D9XmGdwVmmZmpavDGuichhJJUz1nn5pp9yj5H3GG7DgZtovmnn5YNFiiT/JyIZqw6Uvd+i0TRIFwumFw7SVEg/TYvQDM/8hE9O4uTWEVlECuyU2tLW1oKK3jIk+bItDxy6TZKw36mttdZgKDxo1fIRzrFMSbrt0J/Cl8KVh1OcozuqGUyO7RxLBk3UrA6XfmDTF97qwAErpOl655GnjnTqOidyIQsHO08G/hcLt/j/AAB4nGNgZGBgAOLaW41M8fw2Xxm4mV8ARRguss1QhNC5H/9//Z/FUsEcBORyMDCBRAFTFwxveJxjYGRgYA76n8UQxVLGwPD/FUsFA1AEBfgBAHyYBUh4nGN+wcDAvACCWfSBNIgviMBM1kA6koGBMRWVBqsDYqYmiF4wHQkxg+kUBMPVWEP0gTDYvBdoahZAzYxEY0ciuWUBFjkoZimDYLC8IKpehmsQccYvSGYgYZB7YBhFL5o8cxTQjDUI/wIArpclrwAAAAAAAAA6AIYA3AEKAUgBgAGgAfoCYgKqAwIDOgOGA9wEQAR4BLYFAgU8BZoFzAYMBlIGmga6BtgG+AcYB0QHcAecB8gIAAg2CG4IpgjyCUAJrAo0CtALOAueDAoMYA0ADVANjg3mDiQOjg7GDvgPOA+ED84QPBB2EN4RNhGgEfISchKoEsgS6BMGEz4TXhOSE8QT+BQsFGIUiBTWFX0AAAABAAAATgBuAAYAAAAAAAIAAAAQAHMAAAAiC3AAAAAAeJx1kctOGzEUhn9DoIKgLloJdcdZIRDK5CKhSqyoogJrhLJDwgyeSzpjRx4HlGfgLcoz8Dp9j+76Z2KhqFJmZM93Ph/bxx4AX/AHCqvnnG3FCgeMVryFT/gReZv+JnKHfBd5B108RN6l/xV5H2d4idzFV/zmCqqzx2iK98gK39RR5C18Vt8jb9P/jNwh30fewaGaR96lf428j4l6i9zFsfo7drOFL/MiyMn4VEaD4bk8LsRRlVZXouehcL6RS8mcDaaqXJK6OtSml+lemTrb3Jp8Xmm/rtZ5YnxTOivDZLCur401XgfztNytec5HIWSSeVfLVdxHZt5NTRqSIoTZRb+/vj/GcJhhAY8SOQoECE5oT/kdYYAhf4zgkRnCzFVWCQuNikZjzhlFO9IwvmTLGFlaw4yKnCBlX9PUdD2Oa/Zlay1n3dLmXKei9xuzNvkJ7XLvso2F9SaselP2Na1tZ+i2wqePszV4ZhUj2sBZy1P4tmrB1X/nEd7XcmxKk9In7a0F2gv0+W44/z/KQo7lAHicbZLnlpswEIW5Bgy4bLLpvfeE9N57z76DLARWEJKOEEucpw8CO/kTncOdT6PhnlHxRt4wJt7/x47nYQQfAUKMESFGggmmmGGOLezBXmxjH/bjAA7iEA7jCI7iGI7jBE7iFE7jDM7iHM7jAi7iEi7jCq7iGq7jBlLcxC3cxh3cxT3cxwM8xCM8xhM8xTM8xwu8xCu8xhu8xTu8xwd8xCd8xhd8xTd8xw/sBLUlZuIkZZW2q0hzahvDRqocUyIpE4EWTR1WXDZ1sGRCz5yklBsqWBZwmauZk01mTqxl0nIlUyLs9r/Zej35m4kFl2XKftlAKFomTlKlmfQ1l74lRdB9dbxQqqyIKbc2MPQZGqbFKsqVaYnJ4ky1Ms24iQXLrYPE8GLZ07jRfaIvcf5JX+NoMhQ5jLoqFwenBS8Gpw7WTh05py6MaOtT2ibEGNXWKW1Da0i9nPY6dNe7CEWy7pc+5EJpvfJVnvtUFUHFZBPWS2LYxKqiECztVpINypAuGS2nvQ6Gs+H0hsk0U3ZznDETguua1/MNpLvMWH/RFGEuuobCihScxqS2zPC6jH4rVaVcxn1UjQ1yJW1QK2MTJ6nrPOqp0d3Vk1WoSVOz7p0oHeWdTbpoh5i3sVWpezp23AGTWch+Mmonu0o0Vb+l6RqdabLmRnveH9ru7j54nGPw3sFwIihiIyNjX+QGxp0cDBwMyQUbGVidNjIwaEFoDhR6JwMDAycyi5nBZaMKY0dgxAaHjoiNzCkuG9VAvF0cDQyMLA4dySERICWRQLCRgUdrB+P/1g0svRuZGFwAB9MiuAAAAA==) format('woff')}</style>
<style id="style-core" type="text/css">html{font:16px/1 Helmet,Freesans,sans-serif}#store-area,tw-storydata{display:none!important;z-index:0}.no-transition{-o-transition:none!important;transition:none!important}:focus{outline:thin dotted}:disabled{cursor:not-allowed!important}body{color:#eee;background-color:#111}a{cursor:pointer;color:#68d;text-decoration:none;-o-transition-duration:.2s;transition-duration:.2s}a:hover{color:#8af;text-decoration:underline}a.link-broken{color:#c22}a.link-broken:hover{color:#e44}a[disabled],span.link-disabled{color:#aaa;cursor:not-allowed!important;text-decoration:none}area{cursor:pointer}button{cursor:pointer;color:#eee;background-color:#35a;border:1px solid #57c;line-height:normal;padding:.4em;-o-transition-duration:.2s;transition-duration:.2s;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}button:hover{background-color:#57c;border-color:#79e}button:disabled{background-color:#444;border:1px solid #666}input,select,textarea{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}select{padding:.34em .4em}input[type=text]{min-width:18em}textarea{min-width:30em;resize:vertical}input[type=checkbox],input[type=file],input[type=radio],select{cursor:pointer}input[type=range]{-webkit-appearance:none;min-height:1.2em}input[type=range]:focus{outline:0}input[type=range]::-webkit-slider-runnable-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;margin-top:-5px;width:33px}input[type=range]:focus::-webkit-slider-runnable-track{background:#222}input[type=range]::-moz-range-track{background:#222;border:1px solid #444;border-radius:0;cursor:pointer;height:10px;width:100%}input[type=range]::-moz-range-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:18px;width:33px}input[type=range]::-ms-track{background:0 0;border-color:transparent;color:transparent;cursor:pointer;height:10px;width:calc(100% - 1px)}input[type=range]::-ms-fill-lower{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-fill-upper{background:#222;border:1px solid #444;border-radius:0}input[type=range]::-ms-thumb{background:#35a;border:1px solid #57c;border-radius:0;cursor:pointer;height:16px;width:33px}input:not(:disabled):focus,input:not(:disabled):hover,select:not(:disabled):focus,select:not(:disabled):hover,textarea:not(:disabled):focus,textarea:not(:disabled):hover{background-color:#333;border-color:#eee}hr{display:block;height:1px;border:none;border-top:1px solid #eee;margin:1em 0;padding:0}audio,canvas,progress,video{max-width:100%;vertical-align:middle}.error-view{background-color:#511;border-left:.5em solid #c22;display:inline-block;margin:.1em;max-width:100%;padding:0 .25em;position:relative}.error-view>.error-toggle{background-color:transparent;border:none;line-height:inherit;left:0;padding:0;position:absolute;top:0;width:1.75em}.error-view>.error{display:inline-block;margin-left:.25em}.error-view>.error-toggle+.error{margin-left:1.5em}.error-view>.error-source[hidden]{display:none}.error-view>.error-source:not([hidden]){background-color:rgba(0,0,0,.2);display:block;margin:0 0 .25em;overflow-x:auto;padding:.25em}.highlight,.marked{color:#ff0;font-weight:700;font-style:italic}.nobr{white-space:nowrap}.error-view>.error-toggle:before,.error-view>.error:before,[data-icon-after]:after,[data-icon-before]:before,[data-icon]:before,a.link-external:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}[data-icon]:before{content:attr(data-icon)}[data-icon-before]:before{content:attr(data-icon-before) "\00a0"}[data-icon-after]:after{content:"\00a0" attr(data-icon-after)}.error-view>.error-toggle:before{content:"\e81a"}.error-view>.error-toggle.enabled:before{content:"\e818"}.error-view>.error:before{content:"\e80d\00a0\00a0"}a.link-external:after{content:"\00a0\e80e"}</style>
<style id="style-core-display" type="text/css">#story{z-index:10;margin:2.5em}@media screen and (max-width:1136px){#story{margin-right:1.5em}}#passages{max-width:54em;margin:0 auto}</style>
<style id="style-core-passage" type="text/css">.passage{line-height:1.75;text-align:left;-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.passage-in{opacity:0}.passage ol,.passage ul{margin-left:.5em;padding-left:1.5em}.passage table{margin:1em 0;border-collapse:collapse;font-size:100%}.passage caption,.passage td,.passage th,.passage tr{padding:3px}</style>
<style id="style-core-macro" type="text/css">.macro-append-insert,.macro-linkappend-insert,.macro-linkprepend-insert,.macro-linkreplace-insert,.macro-prepend-insert,.macro-repeat-insert,.macro-replace-insert,.macro-timed-insert{-o-transition:opacity .4s ease-in;transition:opacity .4s ease-in}.macro-append-in,.macro-linkappend-in,.macro-linkprepend-in,.macro-linkreplace-in,.macro-prepend-in,.macro-repeat-in,.macro-replace-in,.macro-timed-in{opacity:0}</style>
<style id="style-ui-dialog" type="text/css">html[data-dialog] body{overflow:hidden}#ui-overlay.open{visibility:visible;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-overlay:not(.open){-o-transition:visibility .2s step-end,opacity .2s ease-in;transition:visibility .2s step-end,opacity .2s ease-in}#ui-overlay{visibility:hidden;opacity:0;z-index:100000;position:fixed;top:-50%;left:-50%;height:200%;width:200%}#ui-dialog.open{display:block;-o-transition:opacity .2s ease-in;transition:opacity .2s ease-in}#ui-dialog{display:none;opacity:0;z-index:100100;position:fixed;top:50px;margin:0;padding:0}#ui-dialog>*{box-sizing:border-box}#ui-dialog-titlebar{position:relative}#ui-dialog-close{display:block;position:absolute;right:0;top:0;white-space:nowrap}#ui-dialog-body{overflow:auto;min-width:280px;height:92%;height:calc(100% - 2.1em)}#ui-overlay{background-color:#000}#ui-overlay.open{opacity:.8}#ui-dialog{max-width:66em}#ui-dialog.open{opacity:1}#ui-dialog-titlebar{background-color:#444;min-height:24px}#ui-dialog-title{margin:0;padding:.2em 3.5em .2em .5em;font-size:1.5em;text-align:center;text-transform:uppercase}#ui-dialog-close{cursor:pointer;font-size:120%;margin:0;padding:0;width:3.6em;height:92%;background-color:transparent;border:1px solid transparent;-o-transition-duration:.2s;transition-duration:.2s}#ui-dialog-close:hover{background-color:#b44;border-color:#d66}#ui-dialog-body{background-color:#111;border:1px solid #444;text-align:left;line-height:1.5;padding:1em}#ui-dialog-body>:first-child{margin-top:0}#ui-dialog-body hr{background-color:#444}#ui-dialog-body ul.buttons{margin:0;padding:0;list-style:none}#ui-dialog-body ul.buttons li{display:inline-block;margin:0;padding:.4em .4em 0 0}#ui-dialog-body ul.buttons>li+li>button{margin-left:1em}#ui-dialog-close{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-close{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}</style>
<style id="style-ui" type="text/css">#ui-dialog-body.settings [id|=setting-body]>div:first-child{display:table;width:100%}#ui-dialog-body.settings [id|=setting-label]{display:table-cell;padding:.4em 2em .4em 0}#ui-dialog-body.settings [id|=setting-label]+div{display:table-cell;min-width:8em;text-align:right;vertical-align:middle;white-space:nowrap}#ui-dialog-body.list{padding:0}#ui-dialog-body.list ul{margin:0;padding:0;list-style:none;border:1px solid transparent}#ui-dialog-body.list li{margin:0}#ui-dialog-body.list li:not(:first-child){border-top:1px solid #444}#ui-dialog-body.list li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-decoration:none}#ui-dialog-body.list li a:hover{background-color:#333;border-color:#eee}#ui-dialog-body.saves{padding:0 0 1px}#ui-dialog-body.saves>:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves table{border-spacing:0;width:100%}#ui-dialog-body.saves tr:not(:first-child){border-top:1px solid #444}#ui-dialog-body.saves td{padding:.33em .33em}#ui-dialog-body.saves td:first-child{min-width:1.5em;text-align:center}#ui-dialog-body.saves td:nth-child(3){line-height:1.2}#ui-dialog-body.saves td:last-child{text-align:right}#ui-dialog-body.saves .empty{color:#999;speak:none;text-align:center;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves .datestamp{font-size:75%;margin-left:1em}#ui-dialog-body.saves ul.buttons li{padding:.4em}#ui-dialog-body.saves ul.buttons>li+li>button{margin-left:.2em}#ui-dialog-body.saves ul.buttons li:last-child{float:right}#ui-dialog-body.settings div[id|=header-body]{margin:1em 0}#ui-dialog-body.settings div[id|=header-body]:first-child{margin-top:0}#ui-dialog-body.settings div[id|=header-body]:not(:first-child){border-top:1px solid #444;padding-top:1em}#ui-dialog-body.settings div[id|=header-body]>*{margin:0}#ui-dialog-body.settings h2[id|=header-heading]{font-size:1.375em}#ui-dialog-body.settings p[id|=header-desc],#ui-dialog-body.settings p[id|=setting-desc]{font-size:87.5%;margin:0 0 0 .5em}#ui-dialog-body.settings div[id|=setting-body]+div[id|=setting-body]{margin:1em 0}#ui-dialog-body.settings [id|=setting-control]{white-space:nowrap}#ui-dialog-body.settings button[id|=setting-control]{color:#eee;background-color:transparent;border:1px solid #444;padding:.4em}#ui-dialog-body.settings button[id|=setting-control]:hover{background-color:#333;border-color:#eee}#ui-dialog-body.settings button[id|=setting-control].enabled{background-color:#282;border-color:#4a4}#ui-dialog-body.settings button[id|=setting-control].enabled:hover{background-color:#4a4;border-color:#6c6}#ui-dialog-body.settings input[type=range][id|=setting-control]{max-width:35vw}#ui-dialog-body.list a,#ui-dialog-body.settings span[id|=setting-input]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#ui-dialog-body.saves button[id=saves-clear]:before,#ui-dialog-body.saves button[id=saves-export]:before,#ui-dialog-body.saves button[id=saves-import]:before,#ui-dialog-body.settings button[id|=setting-control].enabled:after,#ui-dialog-body.settings button[id|=setting-control]:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-dialog-body.saves button[id=saves-export]:before{content:"\e829\00a0"}#ui-dialog-body.saves button[id=saves-import]:before{content:"\e82a\00a0"}#ui-dialog-body.saves button[id=saves-clear]:before{content:"\e827\00a0"}#ui-dialog-body.settings button[id|=setting-control]:after{content:"\00a0\00a0\e830"}#ui-dialog-body.settings button[id|=setting-control].enabled:after{content:"\00a0\00a0\e831"}</style>
<style id="style-ui-bar" type="text/css">#story{margin-left:20em;-o-transition:margin-left .2s ease-in;transition:margin-left .2s ease-in}#ui-bar.stowed~#story{margin-left:4.5em}@media screen and (max-width:1136px){#story{margin-left:19em}#ui-bar.stowed~#story{margin-left:3.5em}}@media screen and (max-width:768px){#story{margin-left:3.5em}}#ui-bar{position:fixed;z-index:50;top:0;left:0;width:17.5em;height:100%;margin:0;padding:0;-o-transition:left .2s ease-in;transition:left .2s ease-in}#ui-bar.stowed{left:-15.5em}#ui-bar-body{height:90%;height:calc(100% - 2.5em);margin:2.5em 0;padding:0 1.5em}#ui-bar.stowed #ui-bar-body,#ui-bar.stowed #ui-bar-history{visibility:hidden;-o-transition:visibility .2s step-end;transition:visibility .2s step-end}#ui-bar{background-color:#222;border-right:1px solid #444;text-align:center}#ui-bar-tray{position:absolute;top:.2em;left:0;right:0}#ui-bar a{text-decoration:none}#ui-bar hr{border-color:#444}#ui-bar-history [id|=history],#ui-bar-toggle{font-size:1.2em;line-height:inherit;color:#eee;background-color:transparent;border:1px solid #444}#ui-bar-toggle{display:block;position:absolute;top:0;right:0;border-right:none;padding:.3em .45em .25em}#ui-bar.stowed #ui-bar-toggle{padding:.3em .35em .25em .55em}#ui-bar-toggle:hover{background-color:#444;border-color:#eee}#ui-bar-history{margin:0 auto}#ui-bar-history [id|=history]{padding:.2em .45em .35em}#ui-bar-history #history-jumpto{padding:.2em .665em .35em}#ui-bar-history [id|=history]:not(:first-child){margin-left:1.2em}#ui-bar-history [id|=history]:hover{background-color:#444;border-color:#eee}#ui-bar-history [id|=history]:disabled{color:#444;background-color:transparent;border-color:#444}#ui-bar-body{line-height:1.5;overflow:auto}#ui-bar-body>:not(:first-child){margin-top:2em}#story-title{margin:0;font-size:162.5%}#story-author{margin-top:2em;font-weight:700}#menu ul{margin:1em 0 0;padding:0;list-style:none;border:1px solid #444}#menu ul:empty{display:none}#menu li{margin:0}#menu li:not(:first-child){border-top:1px solid #444}#menu li a{display:block;padding:.25em .75em;border:1px solid transparent;color:#eee;text-transform:uppercase}#menu li a:hover{background-color:#444;border-color:#eee}#menu a,#ui-bar-history [id|=history],#ui-bar-toggle{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}#menu-core li[id|=menu-item] a:before,#ui-bar-history [id|=history],#ui-bar-toggle:before{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#ui-bar-toggle:before{content:"\e81d"}#ui-bar.stowed #ui-bar-toggle:before{content:"\e81e"}#menu-item-saves a:before{content:"\e82b\00a0"}#menu-item-settings a:before{content:"\e82d\00a0"}#menu-item-restart a:before{content:"\e82c\00a0"}#menu-item-share a:before{content:"\e82f\00a0"}</style>
<style id="style-ui-debug" type="text/css">#debug-bar{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:0;margin:0;max-height:75%;padding:.5em;position:fixed;right:0;z-index:99900}#debug-bar>div:not([id])+div{margin-top:.5em}#debug-bar>div>label{margin-right:.5em}#debug-bar>div>input[type=text]{min-width:0;width:8em}#debug-bar>div>select{width:15em}#debug-bar-toggle{color:#eee;background-color:#222;border:1px solid #444;height:101%;height:calc(100% + 1px);left:-2em;left:calc(-2em - 1px);position:absolute;top:-1px;width:2em}#debug-bar-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-hint{bottom:.175em;font-size:4.5em;opacity:.33;pointer-events:none;position:fixed;right:.6em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;white-space:nowrap}#debug-bar-watch{background-color:#222;border-left:1px solid #444;border-top:1px solid #444;bottom:102%;bottom:calc(100% + 1px);font-size:.9em;left:-1px;max-height:650%;max-height:65vh;position:absolute;overflow-x:hidden;overflow-y:scroll;right:0;z-index:99800}#debug-bar-watch[hidden]{display:none}#debug-bar-watch div{color:#999;font-style:italic;margin:1em auto;text-align:center}#debug-bar-watch table{width:100%}#debug-bar-watch tr:nth-child(2n){background-color:rgba(127,127,127,.15)}#debug-bar-watch td{padding:.2em 0}#debug-bar-watch td:first-child+td{padding:.2em .3em .2em .1em}#debug-bar-watch .watch-delete{background-color:transparent;border:none;color:#c00}#debug-bar-watch-all,#debug-bar-watch-none{margin-left:.5em}#debug-bar-views-toggle,#debug-bar-watch-toggle{color:#eee;background-color:transparent;border:1px solid #444;margin-right:1em;padding:.4em}#debug-bar-views-toggle:hover,#debug-bar-watch-toggle:hover{background-color:#333;border-color:#eee}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle,html[data-debug-view] #debug-bar-views-toggle{background-color:#282;border-color:#4a4}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:hover,html[data-debug-view] #debug-bar-views-toggle:hover{background-color:#4a4;border-color:#6c6}#debug-bar-hint:after,#debug-bar-toggle:before,#debug-bar-views-toggle:after,#debug-bar-watch .watch-delete:before,#debug-bar-watch-add:before,#debug-bar-watch-all:before,#debug-bar-watch-none:before,#debug-bar-watch-toggle:after{font-family:tme-fa-icons;font-style:normal;font-weight:400;font-variant:normal;text-transform:none;line-height:1;speak:none}#debug-bar-toggle:before{content:"\e838"}#debug-bar-hint:after{content:"\e838\202f\e822"}#debug-bar-watch .watch-delete:before{content:"\e804"}#debug-bar-watch-add:before{content:"\e805"}#debug-bar-watch-all:before{content:"\e83a"}#debug-bar-watch-none:before{content:"\e827"}#debug-bar-views-toggle:after,#debug-bar-watch-toggle:after{content:"\00a0\00a0\e830"}#debug-bar-watch:not([hidden])~div #debug-bar-watch-toggle:after,html[data-debug-view] #debug-bar-views-toggle:after{content:"\00a0\00a0\e831"}html[data-debug-view] .debug{padding:.25em;background-color:#234}html[data-debug-view] .debug[title]{cursor:help}html[data-debug-view] .debug.block{display:inline-block;vertical-align:middle}html[data-debug-view] .debug.invalid{text-decoration:line-through}html[data-debug-view] .debug.hidden,html[data-debug-view] .debug.hidden .debug{background-color:#555}html:not([data-debug-view]) .debug.hidden{display:none}html[data-debug-view] .debug[data-name][data-type].nonvoid:after,html[data-debug-view] .debug[data-name][data-type]:before{background-color:rgba(0,0,0,.25);font-family:monospace,monospace;white-space:pre}html[data-debug-view] .debug[data-name][data-type]:before{content:attr(data-name)}html[data-debug-view] .debug[data-name][data-type|=macro]:before{content:"<<" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=macro].nonvoid:after{content:"<</" attr(data-name) ">>"}html[data-debug-view] .debug[data-name][data-type|=html]:before{content:"<" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type|=html].nonvoid:after{content:"</" attr(data-name) ">"}html[data-debug-view] .debug[data-name][data-type]:not(:empty):before{margin-right:.25em}html[data-debug-view] .debug[data-name][data-type].nonvoid:not(:empty):after{margin-left:.25em}html[data-debug-view] .debug[data-name][data-type|=special],html[data-debug-view] .debug[data-name][data-type|=special]:before{display:block}</style>
</head>
<body>
	<div id="init-screen">
		<div id="init-no-js"><noscript>JavaScript is required. Please enable it to continue.</noscript></div>
		<div id="init-lacking">Your browser lacks required capabilities. Please upgrade it or switch to another to continue.</div>
		<div id="init-loading"><div>Loading&hellip;</div></div>
	</div>
	<!-- UUID://F27062CA-5A07-4478-873B-12A1026BEEAA// --><tw-storydata name="Community Service" startnode="181" creator="Tweego" creator-version="2.1.1+81d1d71" ifid="F27062CA-5A07-4478-873B-12A1026BEEAA" zoom="1" format="SugarCube" format-version="2.30.0" options="" hidden><style role="stylesheet" id="twine-user-stylesheet" type="text/twine-css">.theme-light {
	--story-bg: #E8DFDB;
	--story-text: #19231A;
	--ui-bg: #D8CBC7;
	--ui-bg-hover: #C4B7B3;
	--ui-bg-active: #7A6E6B;
	--ui-text: #33673B;
	--ui-border: #565857;
	--link-color: #CC3F0C;
	--link-hover-color: #8A2006;
	--title-color: #66C3FF;
	--tooltip-warning: #FFD131;
	--tooltip-warning-bg: #A76E1C;
	--tooltip-info: #214365;
	--tooltip-info-bg: #82C1D8;
	--tooltip-comment: #D3D3D3;
	--tooltip-comment-bg: #2D2A36;
}

.theme-dark {
	--story-bg: #040403;
	--story-text: #F0F7EE;
	--ui-bg: #191A16;
	--ui-bg-hover: #30312D;
	--ui-bg-active: #5E5F5B;
	--ui-text: #ACD5A1;
	--ui-border: #339989;
	--link-color: #E17A79;
	--link-hover-color: #D15159;
	--title-color: #42BFDD;
	--tooltip-warning: #FFD131;
	--tooltip-warning-bg: #A76E1C;
	--tooltip-info: #82C1D8;
	--tooltip-info-bg: #214365;
	--tooltip-comment: #D3D3D3;
	--tooltip-comment-bg: #2D2A36;
}

.theme-green {
	--story-bg: #000401;
	--story-text: #F0F7EE;
	--ui-bg: #020D04;
	--ui-bg-hover: #30312D;
	--ui-bg-active: #0A3318;
	--ui-text: #518244;
	--ui-border: #298c7d;
	--link-color: #AA211F;	
	--link-hover-color: #C68589;
	--title-color: #42BFDD;
	--tooltip-warning: #FFD131;
	--tooltip-warning-bg: #A76E1C;
	--tooltip-info: #82C1D8;
	--tooltip-info-bg: #214365;
	--tooltip-comment: #D3D3D3;
	--tooltip-comment-bg: #2D2A36;
}

body {
	background-color: var(--story-bg);
	color: var(--story-text);
}

#ui-bar, 
#ui-dialog-title, 
#ui-dialog-body {
	background: var(--ui-bg);
	color: var(--ui-text);
}

#ui-dialog-body select, 
#ui-dialog-body button,
#ui-dialog-body.settings button[id|="setting-control"] {
	background: var(--ui-bg);
	color: var(--ui-text);
	border-color: var(--ui-border);
}

#ui-dialog-body select:hover, 
#ui-dialog-body button:hover,
#ui-dialog-body.settings button[id|="setting-control"]:hover {
	background: var(--ui-bg-hover);
}

#ui-dialog-body button.enabled,
#ui-dialog-body.settings button[id|="setting-control"].enabled { /* Some buttons are extra pissy about when to be selected*/
	background: var(--ui-bg-active);
}

#menu li a {
	color: var(--ui-text);
}

#ui-bar-history [id|="history"] {
	color: var(--ui-text);
	background-color: var(--story-bg);
}

#ui-bar-history [id|="history"]:disabled {
	color: var(--link-color);
	background-color: var(--ui-bg);
	border-width: 0px;
}

#menuInfo {
	text-align: center;
	width: 100%;
	border-collapse: separate;
	border-spacing: 20px;
	/*margin-left:-25px; 
    margin-right:-25px;*/
}

#menuInfo tr + tr {
	border-top: solid 2px var(--ui-text);
}

#time td {
	font-size: 30px;
	background-color: #580C0E;
	color: #C85A63;
	padding: 0px;
	margin: 0px 40px;
	border-radius: 10px;
	border: solid 2px #C85A63;
}

#cuff a {
	font-size: 20px;
	color: var(--ui-text);
	padding: 10px;
	margin: 0px;
	border: dotted 2px var(--ui-text);
	border-radius: 10px;
}

#cuff a:hover {
	padding: 5px;
	margin: 5px;
}

input, hr {
	color: var(--link-color);
}

a {
	padding: 5px;
	border: solid 1px var(--link-color);
	border-radius: 5px;
	color: var(--link-color);
}

li .chore-short a {
	padding: 5px;
	border: solid 0px var(--link-color);
	color: var(--link-color);
}

!li .chore-short a {
	border: solid 1px var(--link-color);
	border-radius: 5px;
	color: var(--link-color);
	margin-top: 5px;
}

!li .short.done a {
	border: solid 0px var(--story-text);
	color: var(--story-text);
}

a:hover {
	color: var(--link-hover-color);
}

img {
	max-width: 100%;
	object-fit: contain;
	border-radius: 15px;
	border: solid 4px var(--link-color); 
}

.shop-display {
	display: grid;
	grid-template-columns: auto;
	grid-row-gap: 10px;
}

.inventory-display {
	display: grid;
	grid-template-columns: repeat(var(--inventoryRow), 1fr);
	grid-column: 1fr;
	grid-gap: 10px 10px;
}

.inventory-name {
	grid-column: 1 / span var(--inventoryRow);
	border: dotted 2px var(--link-color);
	border-radius: 30px;
	text-align: center;
	padding: auto auto;
}

.item-display, .inventory-display-empty {
	display: grid;
	grid-template-columns: 1;
	border: dotted 2px var(--link-color);
	border-radius: 30px;
	text-align: center;
}

.item-display-img {
	height: 100%;
}

.item-display-button button, .chore-button a, .toggleButton button{
	background: var(--link-color-hover);
	color: var(--link-color);
	border: solid 2px var(--link-color);
	border-radius: 5px;
	margin: 5px;
}

.chore-done:before {
	content: "\2713 "
}

.estateRoom {
	font-size: 32px;
	color: var(--link-color);
}

/* Main menu */

#game-title-info {
	margin-top: 60px;
	text-align: center;
}

#game-title {
	font-size: 40px;
	line-height: 0;
}

#game-author {
	padding-top: 0;
	font-size: 10px;
}

.warning {
	border: dashed 5px var(--link-color);
	border-radius: 50px;
	padding: 30px;
}

.tooltip-warning {
	color: var(--tooltip-warning);
	background-color: var(--tooltip-warning-bg);
	border: dashed 2px var(--tooltip-warning);
	border-radius: 30px;
	padding: 20px;
}
.tooltip-warning:before {
	content: "Warning: ";
}

.tooltip-info {
	color: var(--tooltip-info);
	background-color: var(--tooltip-info-bg);
	border: dashed 2px var(--tooltip-info);
	border-radius: 30px;
	padding: 20px;
}
.tooltip-info:before {
	content: "Info: ";
}

.tooltip-comment {
	color: var(--tooltip-comment);
	background-color: var(--tooltip-comment-bg);
	border: dashed 2px var(--tooltip-comment);
	border-radius: 30px;
	padding: 20px;
}
.tooltip-comment:before {
	content: "Comment: ";
}

.choreUILink a {
	border: none;
}

/* DEBUG CSS */

.error, .error-view > .error-toggle, .error-source {
	background-color: red;
	color: white;
}

@media only screen and (min-width: 600px) {
  img {
	max-height: 10em;
  	max-width: 40%;
  }
}</style><script role="script" id="twine-user-script" type="text/twine-javascript">/* twine-user-script #1: "character.js" */
window.ClothesSlots = ["wig", "shirt", "pants", "underwear", "bra", "hoisery", "shoe", "accessory-head", "accessory-neck", "toy-front", "toy-back"];

window.npc = {
	baseNPC : {
		gender: "male",
		title: "Mr",
		name: "James",
		lastName: "Walls",
		age: 50,
		like: {tag: "count", data: [], expected: true},
		color: {light: "#FFFFFF", dark: "#FFFFFF"}
	},
	generateNPC: function(gender) {
		var npc = this.baseNPC;
		npc.gender = gender ? "male" : "female";
		npc.title = gender ? "Mr" : "Mrs";
		npc.name = (gender ? ["James", "Joseff", "Jack", "John", "Hugo", "Leo", "Vincent"] : ["Lea", "Marie", "Aurora", "Fiona", "Maeve", "Jade", "Amber", "Liya", "Velma", "Nana"]).random()
		npc.lastName = ["Walls", "Barker", "O'Connor", "Thomas", "Short", "Beard", "Simon", "Knott", "Robins", "Moody", "Cullen", "Morris", "Dilon"].random();
		npc.age = Math.floor(State.random() * 30) + 20;

		npc.like.data = null // DOD

		npc.color.light = this.npc.getColor();
		npc.color.dark = npc.color.light;
		return npc
	}
}

class Character {
	// Base class for npc
	constructor(config) {
		this.name = '';
		this.title = '';
		this.color = {};

		Object.keys(config).forEach((pn) => this[pn] = clone(config[pn]), this);
	}

	// Displays the speach buble for the npc
	speak(text) {
		return Character.speakAnonymous(text, this.colorTheme)
	}

	// Gets the color for the selected theme
	get colorTheme() {
		return settings.theme === "theme-dark" ? this.color["dark"] : this.color["light"]
	}

	// Speach function. Color is optionnal and allows to display in a specific color if given
	static speakAnonymous(text, color) {
		return `<span class="speak" style="color:${color};">"${text}"</span>`
	}

	// Used by twine
	clone() {
		return new Character(this);
	}

	// Used by twine
	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Character($ReviveData$)', ownData);
	}
}
// Add Character class to the window
Object.defineProperty(window, 'Character', {
	value: Character
});

class NPC extends Character {
	// Class for the major npc
	constructor(config) {
		super(Object.assign({
			schedule: new Schedule(),
			path: [],
			appreciation: 0,
			displayPos: false
		}, config));
	}

	addAppreciation(val) {
		// changes how much a npc likes you. Values beteween -100 and 100
		this.appreciation = Math.clamp(this.appreciation + val, -100, 100);
	}

	getAppreciation() {
		// Returns string for displaying how much an npc likes you
		return `<<scale ${this.appreciation} ${-100} ${100}>><</scale>>`;
	}

	// Used by twine
	clone() {
		return new NPC(this);
	}

	// Used by twine
	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new NPC($ReviveData$)', ownData);
	}
}
// Adds NPC to the window
Object.defineProperty(window, 'NPC', {
	value: NPC
});


class Player extends Character {
	// Player's class
	constructor(config) {
		super(Object.assign({
			name: "Alex",
			title: "servant",
			femName: "Alice",
			femininity: 0,
			appearance: 0,
			submission: 0,
			boldness: 0,
			voice: {
				current: 0,
				absolute: 0
			},
			stamina: {
				current: 100,
				max: 100
			},
			arousal: {
				current: 0,
				max: 100
			},
			currRoom: "PlayerBdRm",
			choresLate: 0,
			debt: 23456,
			money: 0,
			bodyPart: {
				"hairColor": 0,
				"hairLength": 0,
				"eyeColor": 0
			},
			bodyHair: 0,
			inv: new Inventory({
				name: "Player Inventory"
			}),
			stats: {
				serving: {level:1, xp: 0},
				cleaning: {level:1, xp: 0},
				fitness: {level:1, xp: 0}
			},
			weeksFailed: 0
		}, config));
	}

	// Equips item of name 'itemName'. If bypassFemininty is true, skips the check for femininity (usefull for events)
	equip(itemName, bypassFeminity) {
		var index = this.inv.items.findIndex((el) => el.item.name === itemName);
		// Makes sure that the femininity is not too low
		if (bypassFeminity || this.inv.items[index].item.femininity <= this.femininity) {
			this.inv.items[index].item.removeTag("equippable");
			var tags = this.inv.items[index].item.tags;
			// Might have to prefiler the tags (ie remove any tags that are special)
			this.inv.items.filter((el) =>
				el.item.tags.some((tag) => tags.includes(tag) && ClothesSlots.includes(tag)))
					.filter((el) => el.item.tags.includes("equipped"))
					.forEach((el) => {
						el.item.addTag("equippable");
						el.item.removeTag("equipped");
					});
			this.inv.items[index].item.addTag("equipped");
		}
	}

	levelUp(stat, amnt) {
		this.stats[stat].xp += amnt;
		while (this.stats[stat].xp > 25 * this.stats[stat].level) {
			this.stats[stat].xp -= 25 * this.stats[stat].level;
			this.stats[stat].level++;
		}
	}

	getStat(stat) {
		return this.stats[stat].level;
	}

	getStatBar(stat) {
		return `<<scale ${this.stats[stat].xp} ${0} ${25 * this.stats[stat].level}>><</scale>>`
	}

	// Unequips items. ItemName can be either specific item or All. If all, unequips all of the items but the ones with a tag in bl.
	unequip(itemName, bl) {
		if (itemName === "All") {
			// Unequips all of the items
			this.inv.items.forEach((el) => {
				if (el.item.tags.includes("equipped") && !el.item.tags.some((tag) => (bl || []).includes(tag))) 
					this.unequip(el.item.name);
			}, this);
		} else {
			var index = this.inv.items.findIndex(
				(el) => el.item.name === itemName || (el.item.tags.includes(itemName) && el.item.tags.includes("equipped")));
			if (index === -1) return undefined;
			this.inv.items[index].item.removeTag("equipped");
			this.inv.items[index].item.addTag("equippable");
		}
	}

	// Shaves the player using the item 'item'
	shave(item) {
		if (item.tags.includes("razor")) {
			this.bodyHair += item.efficiency;
			if (this.bodyHair > 1) 
				this.bodyHair--;
		}
	}

	// Grows the player's body hairs
	growHair() {
		this.bodyHair.current -= this.bodyHair.growthSpeed.current;
		this.bodyHair.growthSpeed.current = this.bodyHair.growthSpeed.absolute;
	}

	// Returns the stamina bar for the player
	getStaminaBar() {
		return `<<scale ${this.stamina.current} ${0} ${this.stamina.max}>><</scale>>`
	}

	// Checks if the player has enough stamina
	hasEnoughStamina(cost) {
		return this.stamina.current >= cost;
	}

	// Adds some of the stamina to the player
	rest(amnt) {
		this.stamina.current = Math.min(this.stamina.current + (amnt || this.stamina.max), this.stamina.max);
	}

	// Uses some of the stamina
	useStamina(amnt) {
		this.stamina.current = Math.max(this.stamina.current - amnt, 0);
	}

	// Returns the arousal bar for the player
	getArousalBar() {
		return `<<scale ${this.arousal.current} ${0} ${this.arousal.max}>><</scale>>`
	}

	// Adds some of the arousal to the player
	increaseArousal(amnt) {
		this.arousal.current = Math.min(this.arousal.current + (amnt || this.arousal.max), this.arousal.max);
	}

	// Uses some of the arousal
	decreaseArousal(amnt) {
		this.arousal.current = Math.max(this.arousal.current - amnt, 0);
	}

	// Returns the description of the bodypart
	getDesc(bodyPart) {
		return State.variables.bodyPart.desc[bodyPart][this.bodyPart[bodyPart] || 0];
	}

	// Returns false if no equipped item fit the tags, the first found item if found
	hasEquipped(tags) {
		if (typeof(tags) !== Array)
			tags = [tags, "equipped"];
		else if (!tags.includes["equipped"]) tags.push("equipped");
		var item = this.inv.items.filter((el) => tags.every((tag) => el.item.tags.includes(tag)))
		return item.length > 0 ? item[0].item.name : false;
	}

	// Returns which body part hides said bodypart
	hiddenBy(bodyPart) {
		switch (bodyPart) {
			case "hair":
				return ["wig"];
			case "chest":
				return ["shirt", "bra"];
			case "crotch":
				return ["pants", "underwear"];
			case "legs":
				return ["pants", "hoisery"];
			default:
				return [];
		}
	}

	// returns this items hiding said bodyPart
	isHidden(bodyPart) {
		var bodyPart = this.hiddenBy(bodyPart).filter((el) => this.hasEquipped(el), this)
		if (bodyPart.length > 0)
			return this.hasEquipped(bodyPart[0]);
		return undefined;
	}

	// Returns the gender of the npc
	get gender() {
		if (this.femininity > 50)
			return "female";
		return "male";
	}

	// Raises the voice by amount
	raiseVoice(amnt) {
		this.voice.current = amnt.tmp;
		this.voice.absolute += amnt.abs;
	}

	// Returns the hair color
	get getHairColor() {
		return this.isHidden("hair") ? this.inv.filter(["wig", "equipped"]).color : this.getDesc("hairColor");
	}

	// Returns the hair length
	get getHairLength() {
		return this.isHidden("hair") ? this.inv.filter(["wig", "equipped"]).length : this.getDesc("hairLength");
	}

	// Returns the voice color (TO BE CHANGED)
	get getColor() {
		return State.variables.bluePinkGradient[Math.min(this.voice.current, State.variables.bluePinkGradient.length - 1)];
	}

	// Makes the character speak
	speak(text) {
		return Character.speakAnonymous(text, this.getColor);
	}

	// For twine
	clone() {
		return new Player(this);
	}

	// For twine
	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Player($ReviveData$)', ownData);
	}
}
// adds player to window
Object.defineProperty(window, 'Player', {
	value: Player
});

class MinorNPC extends Character {
	// Minor npc generated for events
	constructor(values) {
		super(values);
	}

	// Gets how many points this npc gives
	getBonusPoint() {
		// TODO
		return 0;
		return tageval(this.like, el.data, el.expected) * 5;
	}

	// For twine
	clone() {
		return new MinorNPC(this);
	}

	// For twine
	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new MinorNPC($ReviveData$)', ownData);
	}
}
// Addst MinorNPC to window
Object.defineProperty(window, 'MinorNPC', {
	value: MinorNPC
});

window.npc = {
	baseNPC : {
		gender: "male",
		title: "Mr",
		name: "James",
		lastName: "Walls",
		age: 50,
		like: {tag: "count", data: [], expected: true},
		color: {light: "#FFFFFF", dark: "#FFFFFF"}
	},
	generateNPC: function(gender) {
		var npc = this.baseNPC;
		npc.gender = gender ? "male" : "female";
		npc.title = gender ? "Mr" : "Mrs";
		npc.name = (gender ? ["James", "Joseff", "Jack", "John", "Hugo", "Leo", "Vincent"] : ["Lea", "Marie", "Aurora", "Fiona", "Maeve", "Jade", "Amber", "Liya", "Velma", "Nana"]).random()
		npc.lastName = ["Walls", "Barker", "O'Connor", "Thomas", "Short", "Beard", "Simon", "Knott", "Robins", "Moody", "Cullen", "Morris", "Dilon"].random();
		npc.age = Math.floor(State.random() * 30) + 20;

		var tags = [
			{tag: "bodyPart", data: {bodyPart: "hairLength", value: 0}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairLength", value: 1}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairLength", value: 2}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairColor", value: 0}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairColor", value: 1}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairColor", value: 2}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "hairColor", value: 3}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "eyeColor", value: 0}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "eyeColor", value: 1}, expected: true},
			{tag: "bodyPart", data: {bodyPart: "eyeColor", value: 2}, expected: true},
		];

		npc.like.data = tags.filter((tag) => State.random() < 0.3); // TODO

		npc.color.light = this.getColor();
		npc.color.dark = npc.color.light;
		return npc
	},
	getColor: function() {
		var letters = '0123456789ABCDEF'.split('');
    	var color = '#';
    	for (var i = 0; i < 6; i++ ) {
    	    color += letters[Math.round(Math.random() * letters.length - 1)];
    	}
    	return color;
	},
	createNPC: function(list, activeNPC, nb) {
		if (settings.maxNPC <= list.length || (list.length > 1 && State.random() > 0.5)) {
			var index = Math.floor(State.random() * list.length);
			if (!activeNPC.includes(index)) {
				activeNPC.push(index);
			} else {
				this.createNPC(list, activeNPC, nb / settings.npcPerEvent < 0.5);
			}
		} else {
			do {
				var values = this.generateNPC(State.random() > 0.5);
			} while (State.variables.minorNPC.find((el) => el.title === values.title))
			list.push(new MinorNPC(values));
			activeNPC.push(list.length - 1);
		}
	}
}
/* twine-user-script #2: "chore.js" */
function skipChores() {
	// Checks if the chores are counted during the reset
	return State.variables.time.day === 0 || State.variables.mansion.currentEvent !== "";
}

class Chore {
	constructor (config) {
		this.name = '';
		this.duration = {day: 0, hour: 0, minute: 0};
		this.passages = [
			{name: '', weight: 1}
		];
		this.time = {};
		this.img = [];
		this.staminaCost  = 0;
		this.done = true;
		this.todo = false;
		this.days = [0, 1, 2, 3, 4, 5, 6];
		this.room = '';
		this.id = '';
		this.xp = 1;

		Object.keys(config).forEach((pn) => {
            this[pn] = clone(config[pn]);
        }, this);

		this.time = {...this.time, ...{start:{hour: 6, minute: 0}, end:{hour:22, minute:0}}};
	}

	do(canDoChores, filterDone, short) {
		// Chore is waiting to be reset
		if (skipChores() || (this.done && filterDone) || !this.todo)
			return "";

		var htmlClass = "chore";
		if (this.done)
			htmlClass = 'chore-done';
		else if (!State.variables.player.hasEnoughStamina(this.staminaCost))
			htmlClass = 'chore-exhaused';
		else if (State.variables.time.endsAfter(this.time.end, this.duration) || State.variables.time.compareTime(this.time.start) > 0)
			htmlClass = 'chore-not-time';
		else if (!canDoChores)
			htmlClass = 'chore-unavailable';

		if (short && !this.done && !Story.get(State.passage).tags.includes("chore") && State.variables.mansion.currentEvent == "") return `<span class="chore-short ${htmlClass}">${State.variables.mansion.findRoom(this.room).getPassage(this.name)}</span>`;
		if (short) return `<span class="${htmlClass}">${this.name}</span>`;

		return String.format(
			"<span class='{0}'>{1} {2} {3} {4}</span>",
			htmlClass,
			this.name,
			this.done ? "" : `(To do beween: ${Timer.getTime(this.time.start)} to ${Timer.getTime(this.time.end)}. Duration: ${Timer.getTime(this.duration)})`,
			{"chore-done" : "[DONE]", "chore-exhaused" : "[TOO TIRED]", "chore-not-time" : "[NOT THE RIGHT TIME]", "chore": "", "chore-unavailable": ""}[htmlClass],
			canDoChores && !this.done && htmlClass === "chore" ? String.format(
				"<span class='chore-button'><<link 'Start chore' \"{0}\">><<= $player.levelUp('cleaning', {5})>><<set $aPsgText to `{6}`>><<= $player.currentRoom=`{1}`>><<set $player.useStamina({2})>><<= $time.addTime({3})>><<= $mansion.findRoom('{1}').findChore(\"{4}\").done = true>><</link>></span>",
				this.passage,
				this.room,
				this.staminaCost,
				this.duration,
				this.name,
				this.xp,
				State.variables.mansion.findRoom(this.room).getPassage()
			) : ""
		);
	}

	reset() {
		if (!skipChores())
			State.variables.player.choresLate += !this.done && this.todo ? 1 : 0;
		this.done = false;
		this.todo = false;
	}

	get getDuration() {
		// Returns the duration of the Chore in string
		var timeOrder = ["day", "hour", "minute"];
		var str = "";
		for (var i = 0; i < timeOrder.length; i++) {
			if (this.duration[timeOrder[i]] > 1)
				str += `${this.duration[timeOrder[i]]} ${timeOrder[i]}s `
			else if (this.duration[timeOrder[i]] == 1)
				str += `1 ${timeOrder[i]}`
		}
		return str;
	}

	addPassage(passage) {
		this.passages.push();
	}

	removePassage(passageName) {
		this.passages.filter((pass) => pass.name != passageName);
	}

	get passage() {
		var sum = this.passages.reduce((sum, p) => sum + p.weight, 0);
		var val = State.random(0, sum - 1);
		return this.passages.find((p) => {val -= p.weight; return val < 0}).name
	}

	clone() {
        return new Chore(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach((pn) => ownData[pn] = clone(this[pn]), this);
        return JSON.reviveWrapper('new Chore($ReviveData$)', ownData);
	}

	display(imgIndex) {
		var imgIndex = imgIndex || 0;
		var str = `<span class='estateChore'>${this.name}</span><br>`;

		return str + (imgIndex < this.img.length ? `[img[${this.getImgPath(imgIndex)}]]` : "");
	}

	getImgPath(imgIndex) {
		return `${setup.ImagePath}events/chores/${this.id}/${this.img[imgIndex]}`; 
	}

}
Object.defineProperty(window, 'Chore', {
    value : Chore
});
/* twine-user-script #3: "documentation.js" */
Macro.add("tooltips", {
	tags: [],
	handler: function() {
		if (!settings.tips) return $(this.output).wiki("");
		var tipType = this.args[0]; // One of: "warning", "info", "comment"
		var content;
		if (this.args.length > 1)
			content = State.variables.tooltips[this.args[1]]; // Selects the right tooltip
		else
			content = this.payload[0].contents;
		return $(this.output).wiki(`<div class='tooltip-${tipType}'>${content}</div>`);
	}
});
/* twine-user-script #4: "event.js" */
class Event {
	constructor(config) {
		this.name = ''; // Not used, just for us to remeber it
		this.passage = ''; // Passage in which it starts
		this.inline = false; // If true, will be included in the current passage
		this.repeats = false;
		this.room = "";
		this.tags; // add Tags here
		this.priority = 0;

		Object.keys(config).forEach((pn) => this[pn] = clone(config[pn]), this);
	}

	playEvent(debug) {
		if (this.inline) {
			if (!this.repeats) {
				State.variables.mansion.removeEvent(this.room, this.name);
			}
			return `<<include "${this.passage}">>`;
		} else {
			if (!this.repeats)
				return `<<link "${this.name}" "${this.passage}">><<= $mansion.removeEvent("${this.room}","${this.name}")>><</link>>`;
			return `<<link "${this.name}" "${this.passage}">><</link>>`;
		}
	}

	active() {
		return window.tags.eval(this.tags.tag, this.tags.data, this.tags.expected)
	}

	clone() {
        return new Event(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Event($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Event', {
    value : Event
});
/* twine-user-script #5: "inventory.js" */
function ItemSorter(a, b) {
	// Prefer equipped, low femininity, lowest clothes

	if(a.item.tags.includes("equipped") || b.item.tags.includes("equipped"))
		return a.item.tags.includes("equipped") ? -1 : 1;

	var tagIndexA = ClothesSlots.length;
	a.item.tags.forEach((tag) => {
		var i = ClothesSlots.findIndex(t => t == tag);
		if (i != -1 && tagIndexA > i)
			tagIndexA = i;
	});

	var tagIndexB = ClothesSlots.length;
	b.item.tags.forEach((tag) => {
		var i = ClothesSlots.findIndex(t => t == tag);
		if (i != -1 && tagIndexB > i)
			tagIndexB = i;
	});
	if (tagIndexA == tagIndexB)
		return a.item.femininity - b.item.femininity;
	return tagIndexA - tagIndexB;
}

class Inventory {
	constructor(config) {
		this.items = [];
		this.name = "Default";
		this.isShop = false; 

		Object.keys(config || {}).forEach(function (pn) {
            this[pn] = clone(config[pn]);
        }, this);
	}

	addItem(item, count, autoEquip)
	{
		if (item.constructor == Object)
			item = new Item(item);
		if (this.isShop) 
			item.addTag("shopItem");
		if (this.items.find(function(el){return el.item.name == item.name}))
			this.items.find(function(el){return el.item.name == item.name}).count += count || 1;
		else
			this.items.push({"item" : item, "count" : count || Infinity});
		if (autoEquip || false)
			State.variables.player.equip(item.name, true);
	}

	removeItem(item, count) {
		var i = this.items.findIndex((el) => el.item.name == item);
		this.items[i].count -= amount || 1;
		var item = this.items[i].item.clone();
		this.items = this.items.filter((el) => el.count > 0);
	}

	getAsTemp(itemName) {
		var index = this.findItemIndex(itemName);
		if (index != -1) {
			var item = this.items[index].item.clone();
			item.addTag("tmp");
			return item;
		} 
		return undefined;
	}

	removeTmp(keepEquipped) {
		this.items.filter((el) => !el.item.tags.includes("tmp") || (keepEquipped && el.item.tags.includes("equipped")));
	}

	findItemIndex(item) {
		return this.items.findIndex((el) => el.item.name == item);
	}

	filter(wl, bl)
	{
		var items = this.items;
		if (wl !== undefined)
			items = items.filter((el) => wl.find((tag) => el.item.tags.includes(tag)));
		if (bl !== undefined)
			items = items.filter((el) => !el.item.tags.some((tag) => bl.includes(tag)));
		return items;
	}

	listItem(parent, wl, bl, displayName, canEquip) {
		var items = this.filter(wl, bl);
		items.sort(ItemSorter);

		var str = items.reduce(
		    (str, item) => str + item.item.description(item.count, parent || (`State.variables.${this.name}`), canEquip), 
		    `<div class="inventory-display"><div class="inventory-name">${displayName || this.name}</div>`);

		var i = 0;
		while ((i + items.length) % settings.inventoryRows !== 0) {
			str += `<div class="inventory-display-empty"></div>`
			i++;
		}

		return str + "</div>";
	}

	buyItem(item, price, amount)
	{
		amount = amount || 1;
		price = price || 0;
		// TODO: Add price
		var i = this.items.findIndex((el) => el.item.name == item);
		if (i !== undefined && State.variables.player.money >= price)
		{
			var item = this.removeItem(el.item.name);
			item.removeTag("shopItem");
			State.variables.player.money -= price;
			State.variables.player.inv.addItem(
				item, 
				this.items[i].count <= 0 ? this.items[i].count + amount : amount
			);
		}
	}

	clone() {
        return new Inventory(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Inventory($ReviveData$)', ownData);
    }
}
Object.defineProperty(window, 'Inventory', {
    value : Inventory
});
/* twine-user-script #6: "items.js" */
class Item {
	constructor (config) {
		this.name = "Unnamed item";
		this.tags = [];
		this.price = 0;
		this.femininity = 0;
		this.img = null;

		Object.keys(config || {}).forEach(function (pn) {
			this[pn] = clone(config[pn]);
		}, this);
	}

	description(count, parent, canEquip) {
		var str = "<div class='item-display'>";

		// Adds name and image if any
		str += `<div class='item-display-name'>${this.name}</div>`;
		if (this.img !== null) {
			str += `<div class='item-display-img'>[img["${setup.ImagePath + this.img}"]]</div>`;
		} else {
			str += `<div class='item-display-img'></div>`;
		}

		var info = "";
		var button = "";

		// Creates base info for the item
		info += (this.tags.includes("shopItem") ? "$ " + this.price + " " : "") + 
				(count !== Infinity ? (`[Amnt: ${count}]`) : "") + " " + 
				((`[Fem: ${this.femininity}]`) || "");

		if (canEquip === false) {
			return `${str}<div class='item-display-info'>${info}</div><div class='item-display-button'></div></div>`;
		}

		var actionTags = ["shopItem", "gettable", "equippable", "equipped"].find((tag) => this.tags.includes(tag), this);

		button += String.format([actionTags].map((tag) => {
				switch (tag) {
					case "shopItem": return "<span id='{5}-{6}-buy'><<button 'buy'>><<if $player.femininity >= {4}>><<= {0}.buyItem('{2}',{3})>><<goto {1}>><<else>><<replace '#{5}-{6}-buy'>><<= $player.speak('<i>I would never buy that</i>')>><</replace>><</if>><</button>></span>";
					case "gettable": return "<span id='{5}-{6}-get'><<button 'get'>><<if $player.femininity >= {4}>><<= {0}.buyItem('{2}', 0 )>><<goto {1}>><<else>><<replace '#{5}-{6}-get'>><<= $player.speak('<i>I would never get that</i>')>><</replace>><</if>><</button>></span>";
					case "equippable": return "<span id='{5}-{6}-wear'><<button 'wear'>><<if $player.femininity >= {4}>><<= $player.equip('{2}')>><<goto {1}>><<else>><<replace '#{5}-{6}-wear'>><<= $player.speak('<i>I would never wear that</i>')>><</replace>><</if>><</button>></span>";
					case "equipped": return "<span id='{5}-{6}-remove'><<button 'remove' '{1}'>><<= $player.unequip('{2}')>><</button>></span>";
				}
			}).reduce((str, action) => str + action, button),
			parent, 
			State.passage, 
			this.name,
			this.price,
			this.femininity,
			Date.now(),
			this.name.replace(/ /g, "-")
		);

		return `${str}<div class='item-display-info'>${info}</div><div class='item-display-button'>${button}</div></div>`
	}

	addTag(tag) {
		if (!this.tags.includes(tag))
			this.tags.push(tag)
	}

	removeTag(tagName) {
		this.tags = this.tags.filter((tag) => tag !== tagName);
	}
	
	clone() {
		return new Item(this);
	}

	toJSON() {
		var ownData = {};
		Object.keys(this).forEach(function (pn) {
			ownData[pn] = clone(this[pn]);
		}, this);
		return JSON.reviveWrapper('new Item($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Item', {
	value : Item
});
/* twine-user-script #7: "keyboardLinks.js" */
/* Keyboard links - Start */
var KBIntervalID = 0;
$(document).on(":passagerender", function (ev) {
	clearInterval(KBIntervalID);
	UpdateLinks(ev.content);
	// Search passages for links every 300ms, just in case they get updated, and marks them for key clicks
	KBIntervalID = setInterval(UpdateLinks, 300);
});
// Adds key shortcut indicators to links in passage if there are less than 11 links in the passsage.
function UpdateLinks(Container) {
	// Enables keyboard shortcuts on passages that do not have the "DisableKeyLinks" tag
	if (!tags().includes("DisableKeyLinks")) {
		var Links, i;
		if (typeof Container === "undefined") {
			Container = document;
			Links = $("#passages a").toArray();
		} else {
			Links = $(Container).find("a").toArray();
		}
		if (Links.length > 0) {
			for (i = 0; i < Links.length; i++) {
				if ((Links[i].getAttribute("data-nokey") == "true") || (Links[i].parentElement.getAttribute("data-nokey") == "true")) {
					Links.deleteAt(i);
					i--;
				}
			}
		}
		if (Links.length === 1) {
			if (!Links[0].id.includes("Link")) {
				Links[0].id = "NextLink";
			}
		} else if (Links.length >= 1 && Links.length <= 10) {
			var n = 1;
			for (i = 0; i < Links.length; i++) {
				if (!Links[i].id.includes("Link")) {
					while ($(Container).find("#Link" + n).length) {
						++n;
						if (n > 10) {
							break;
						}
					}
					if (n < 10) {
						$("<sup>[" + n + "]</sup>").appendTo(Links[i]);
						Links[i].id = "Link" + n;
					} else if (n === 10) {
						$("<sup>[0]</sup>").appendTo(Links[i]);
						Links[i].id = "Link0";
						break;
					} else {
						break;
					}
				}
			}
		}
	}
}
$(document).on("keyup", function (e) {
	// Enables keyboard shortcuts on passages that do not have the "DisableKeyLinks" tag
	if (!tags().includes("DisableKeyLinks")) {
		// Trigger next link click on right arrow key or "1" (normal and numpad)
		if (((e.key == "ArrowRight") || (e.key == "1") || (e.keyCode == 97)) && ($("#NextLink").length > 0)) {
			if (!(tags().includes("IgnoreArrowKeys") && (e.key == "ArrowRight"))) {
				e.preventDefault();
				$("#NextLink").click();
				return false;
			}
		} else {
			// Trigger link click on keys "0" through "9"
			if ((e.keyCode > 47) && (e.keyCode < 58)) {
				if ($("#Link" + (e.keyCode - 48)).length) {
					e.preventDefault();
					$("#Link" + (e.keyCode - 48)).click();
					return false;
				}
			}
			// Trigger link click on numpad keys "0" through "9"
			if ((e.keyCode > 95) && (e.keyCode < 106)) {
				if ($("#Link" + (e.keyCode - 96)).length) {
					e.preventDefault();
					$("#Link" + (e.keyCode - 96)).click();
					return false;
				}
			}
		}
	}
});
/* Keyboard links - End */
/* twine-user-script #8: "macro.js" */
Macro.add("scale", {
	tags: undefined,
	handler: function() {
		var value = this.args[0];
		var min = this.args.length > 1 ? this.args[1] : 0;
		var max = this.args.length > 2 ? this.args[2] : 0;
		var charOn = this.args.length > 3 ? this.args[3] : '█';
		var charOff = this.args.length > 4 ? this.args[4] : '░';
		var nb = this.args.length > 5 ? this.args[5] : 10;
		var str = "";
		if (value < min || value > max)
			return this.error("value must be in the min max range")
		const scale = (max - min) / nb;
		for (var i = min; i < max; i += scale)
			str += (i < value) ? charOn : charOff;
		return jQuery(this.output).wiki(str);
	}
});

Macro.add("debug", {
	tags: [],
	handler: function() {
		return jQuery(this.output).wiki(
		    `<<debug-internal>>${process(this.args[0])}<</debug-internal>>`)
	}
});

Macro.add("debug-internal", {
	tags: [],
	handler: function() {
		var obj = this.payload[0].contents;
		try {
			obj = JSON.parse(obj);
		} catch {}
		var str = "";
		if (obj instanceof Object && !Array.isArray(obj)) {
			str += "<ul>";
			Object.keys(obj).forEach(function(tag) {
				if (obj[tag] instanceof Object)
					str += `<li>${tag}: <<debug-internal>>${obj[tag]}<</debug-internal>></li>`
				else if (obj[tag] != "")
					str += `<li>${tag} : ${obj[tag]}</li>`
			});
			str += "</ul>";
		} else if (Array.isArray(obj)) {
			obj.reduce((str, val) => str + `<li><<debug-internal>>${val}<</debug-internal>></li>`, `${str}<li><ol>`);
			str += "</ol></li>"
		} else {
			str += JSON.stringify(obj);
		}
		return jQuery(this.output).wiki(str);
	}
});

Macro.add("chooseOption", {
	tags: ["option", "end", "default"],
	handler: function() {
		if (this.payload.length === 0)
			return this.error("bad expression: this macro require at least one argument")
		var end = "";
		var def = "";
		var id = Date.now();
		if (this.payload[this.payload.length - 1].name == "default")
			def = "<br>" + this.payload.pop().contents;
		if (this.payload[this.payload.length - 1].name == "end")
			end = this.payload.pop().contents;
		var str = this.payload.reduce(function(str, p, i) {
			if (i != 0 && p.name != "option")
				return ""
			return str + `<<link \"${p.args[0]}\">><<replace '#${id}'>>${p.contents}${end}<</replace>><</link>><br>`
		}, "");
		if (str === "") 
			return this.error("One of the tags is invalid")
		return $(this.output).wiki(`<span id='${id}'>${str}${def}</span>`)
	}
});
/* twine-user-script #9: "mansion.js" */
class Mansion {
	constructor(config) {
		this.rooms = [];
		this.events = []; // Special Events
		this.currentEvent = "";
		this.choresGroup = {};

		if (config != {}) {
			Object.keys(config).forEach(function (pn) {
        	    this[pn] = clone(config[pn]);
        	}, this);
		}
	}

	endEvent() {
		this.currentEvent = "";
	}

	findRoom(roomID) {
		return this.rooms.find((element) => element.id === roomID);
	}

	display(roomID, imgIndex) {
		return this.findRoom(roomID).display(imgIndex);
	}

	describeRoom(roomID) {
		return this.findRoom(roomID).generatePassage();
	}

	displayChores(canDoChores, filterDone, short) {
		var str = "<ol>";
		var hasChores = false;
		for (var i = 0; i < this.rooms.length; i++) {
			var roomChores = this.rooms[i].displayChores(undefined, canDoChores && this.currentEvent == "", filterDone, short || false);
			if (roomChores != undefined && roomChores !== "") {
				str += roomChores;
				hasChores = true;
			}
		}
		return hasChores ? (`${str}</ol>`) : "No chores right now !!";
	}

	addRoom(room) {
		this.rooms.push(room);
	}

	addChore(roomID, chore, groups) {
		var groups = groups || ["default"]; 
		groups.forEach(function(group) {
			if (this.choresGroup[group] !== undefined)
				this.choresGroup[group].push({name: chore.name, room: roomID});
			else
				this.choresGroup[group] = [{name: chore.name, room: roomID}];
		}, this);
		this.findRoom(roomID).addChore(chore.clone());
	}

	resetChores() {
		if (this.currentEvent != "") return;
		this.rooms.forEach(
		    function(room) {room.resetChores()}
		);
		var i = Object.keys(this.choresGroup)[Math.floor(State.random() * Object.keys(this.choresGroup).length)];
		this.choresGroup[i].forEach(function(chore) {
			this.findRoom(chore.room).chores.find(function(c) {return c.name === chore.name}).todo |= true;
		}, this);
		var j = i; 
		while (j === i) 
			j = Object.keys(this.choresGroup)[Math.floor(State.random() * Object.keys(this.choresGroup).length)];
		this.choresGroup[j].forEach(function(chore) {
			this.findRoom(chore.room).chores.find(function(c) {return c.name === chore.name}).todo |= State.random() > 0.5;
		}, this);
	}

	addEvent(roomID, event) {
		if (roomID === "specialEvent") {
			event.room = roomID;
			this.events.push(event);
		} else {
			this.findRoom(roomID).addEvent(event.clone());
		}
	}

	removeEvent(roomID, eventName) {
		if (roomID === "specialEvent")
			this.events = this.events.filter((em) => em.name !== eventName);
		else
			this.findRoom(roomID).events.filter((em) => em.name !== eventName);
	}

	checkSpecialEvents() {
		return this.events.reduce((str, ev) => ev.active(false) ? str += ev.playEvent() : str, "");
	}

	clone() {
        return new Mansion(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Mansion($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Mansion', {
    value : Mansion
});
/* twine-user-script #10: "pathfinding.js" */
window.pathfind = {};
pathfind.cost = (startName, endName, c, roomCost) => {
	c = c || 0;
	roomCost = roomCost || {};

	if (Object.keys(roomCost).includes(startName) && c > roomCost[startName]) {
		return roomCost
	}

	roomCost[startName] = c;

	if (startName === endName) {
		return roomCost
	}
	return State.variables.mansion.findRoom(startName).adjacentRooms.reduce((roomCost, room) => {
		return pathfind.cost(room, endName, c + 1, roomCost);
	}, roomCost);
};

pathfind.nextRoom = (start, end, cost) => {
	var cost = cost || pathfind.cost(start, end);
	var rooms = State.variables.mansion.findRoom(end).adjacentRooms.filter((newRoom) => cost[newRoom] === cost[end] - 1);
	return rooms[Math.floor(State.random() * rooms.length)] || start;
};

pathfind.path = (start, room) => {
	if (room === "FreeRoam") {
		return [State.random() > 0.5 ? State.variables.mansion.findRoom(start).adjacentRooms.random() : start];
	}
	var path = [];
	var cost = pathfind.cost(start, room);
	while (room != start) {
		path.unshift(room);
		if (room !== start) {
			cost = pathfind.cost(start, room);
			room = pathfind.nextRoom(start, room, cost);
		}
	}
	path.unshift(room);
	return path;
};

class Schedule {
	constructor(config) {
		this.waypoints = Array(7).fill([]);
		this.path = [];
		this.currRoom = undefined;

		Object.keys(config || {}).forEach((pn) => this[pn] = clone(config[pn]), this);
	}

	addPoint(room, start, end, week) {
		(week || [0, 1, 2, 3, 4, 5, 6]).forEach((day) => {
			if (start.hour * 60 + start.minute <= end.hour * 60 + end.minute) {
				this.waypoints[day].push({
					room: room, start: start, end: end
				})
			}
			else {
				this.waypoints[day].push({
					room: room, start: start, end: {hour: 24, minute: 0}
				});
				this.waypoints[(day + 1) % 7].push({
					room: room, start: {hour: 0, minute: 0}, end: end
				});
			}
		})
		this.waypoints = this.waypoints.map((arr) => arr.sort((a, b) => (a.start.hour * 60 + a.start.minute) - (b.start.hour * 60 + b.start.minute)))
	}

	curPoint() {
		return this.waypoints[State.variables.time.weekDay].find((wp) => State.variables.time.inInterval(wp.start, wp.end));
	}

	nextPoint() {
		return this.waypoints[State.variables.time.weekDay].find((wp) => State.variables.time.compareTime(wp.start) === -1) ||
		this.waypoints[(State.variables.time.weekDay + 1) % 7][0];
	}
	
	updatePath() {
		var nextPoint = this.curPoint() || this.nextPoint() || {room: "Void"};
		var path;
		if (this.currRoom === "Void" && nextPoint.room !== "Void") {
			this.currRoom = "LowerHall";
		}
		if (nextPoint.room === "Void") {
			// Special case where npc is away
			if (this.currRoom === "Void" || this.currRoom === "LowerHall")
				path = ["Void"]
			else {
				path = pathfind.path(this.currRoom, "LowerHall")
			}
		} else 
			path = pathfind.path(this.currRoom, nextPoint.room);
		if (Timer.toMinute(State.variables.time.time) > State.variables.lastTime.tp + 30 && nextPoint.room === "FreeRoam" && State.random() > 0.5) {
			State.variables.lastTime.tp = Timer.toMinute(State.variables.time.time);
			path = [State.variables.player.currRoom];
		}
		this.currRoom = path.length > 1 ? path[1] : path[0];
	}
	
	estimateLoc() {
		var loc = this.curPoint() || {room: "Void"};
		if (loc.room === "Void") return "Away";
		if (loc.room === "FreeRoam") return "Traveling"
		else return State.variables.mansion.findRoom(loc.room).name;
	}

	clone() {
		return new Schedule(this);
	}

	// For twine
	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Schedule($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Schedule', {
	value: Schedule
});

window.schedule = function(tick) {
	while(tick > 0) {
		tick--; 
		npcList.forEach((npc) => State.variables[npc].schedule.updatePath())
	}
};
/* twine-user-script #11: "pronouns.js" */
// Chapel's pronouns template

(function () {
    'use strict';
    // v1.0.0; by Chapel, for SugarCube 2 (>= v2.29.0)

    if (!Template || !Template.add || typeof Template.add !== 'function') {
        alert('Warning, this version of SugarCube does not include the Template API. Please upgrade to v2.29.0 or higher.');
        return;
    }

    // CONFIGURATION

    var config = {
        name : 'gender',
        showSetting : false,
        label : 'Gender',
        desc : '',
        storyVar : '$player.gender',
        default : 'male' // female, male, or other
    };

    // DATA

    // the point-replace id
    var settingID = '#setting-control-' + config.name;

    // preset pornoun map
    var genderMap = {
        subjective : ['she', 'he', 'they'],
        objective : ['her', 'him', 'them'],
        possessive : ['hers', 'his', 'theirs'],
        determiner : ['her', 'his', 'their'],
        reflexive : ['herself', 'himself', 'themself'],
        noun : ['woman', 'man', 'person']
    };

    // INTERNAL FUNCTIONS

    // custom dialog function
    function createDialog (name, element, classes) {
        var reopen = false;
        if (Dialog.isOpen() && $('#ui-dialog-body').hasClass('settings')) {
            reopen = true;
        }
        Dialog.close();
        Dialog.setup(name, (reopen) ? classes + ' reopen' : classes);
        Dialog.append(element);
        Dialog.open();
    }

    function genderForm () { // create a form for users to configure their pronouns
        var $wrapper = $(document.createElement('div'));

        function createInput (label, name, def) { // create text inputs
            return $(document.createElement('label'))
                .append(label)
                .css('display', 'block')
                .append($(document.createElement('input'))
                    .attr({
                        type : 'text',
                        name : name
                    })
                    .css({
                        float : 'right',
                        'margin-left' : '0.2em'
                    })
                    .val(def)
                );
        }

        function createDropdown (label, name, list) { // create dropdowns
            var $select = $(document.createElement('select'))
                .attr('name', name)
                .css('float', 'right');
            list.forEach( function (opt, idx) {
                $(document.createElement('option'))
                    .attr('value', String(idx))
                    .append(opt)
                    .appendTo($select);
            });
            return $(document.createElement('label')).css('display', 'block').append(label, $select);
        }

        var $inputs = Object.keys(genderMap).map( function (key) {
            // create an input for each type of pronoun
            var idx = 2;
            if (config.default === 'male') {
                idx = 1;
            } else if (config.default === 'female') {
                idx = 0;
            }
            var sv = State.variables;
            var def = genderMap[key][idx];
            if (sv[config.storyVar] && sv[config.storyVar][key]) {
                def = sv[config.storyVar][key];
            }
            return createInput(key.toUpperFirst() + ': ', 'gender-' + key, def);
        });

        var $presets = createDropdown('Presets: ', 'gender-preset', ['She/Her', 'He/Him', 'They/Them'])
            .on('change', function () {
                // auto-fill text inputs when the preset is changed
                var value = Number($(this).find('select').val());
                if (!Number.isNaN(value)) {
                    $inputs.forEach( function ($input) {
                        var $text = $input.find('input');
                        var type = $text.attr('name').split('-')[1];
                        $text.val(genderMap[type][value]);
                    });
                }
            });

        var $select = $presets.find('select');
        if (!State.variables[config.storyVar]) {
            // set defaults
            if (config.default === 'male') {
                $select.val('1');
            } else if (config.default === 'female') {
                $select.val('0');
            } else {
                $select.val('2');
            }
        } else {
            $select.val(''); // custom config, no preset
        }
        
        var $confirm = $(document.createElement('button'))
            .wiki('Confirm')
            .addClass('gender-confirm')
            .ariaClick({ label : 'Confirm pronoun selection.' }, function () {
                // this button saves the pronoun config settings
                var sv = State.variables;
                sv[config.storyVar] = {};
                $inputs.forEach( function ($input) {
                    var $text = $input.find('input');
                    var type = $text.attr('name').split('-')[1];
                    sv[config.storyVar][type] = $text.val().trim().toLowerCase();
                });
                // reopen the settings modal or close the modal
                if ($('#ui-dialog-body').hasClass('reopen')) {
                    UI.settings();
                }
                Dialog.close();
            });

        var $form = (function () {
            // add some line breaks to the generated form
            var $els = [$presets, '<br>'];
            $inputs.forEach( function ($input) {
                $els.push($input);
                $els.push('<br>');
            });
            $els.push($confirm);
            return $els;
        }());

        return $wrapper.append($form);

    }

    // CORE FUNCTIONS

    function handleGender () {
        // this function opens the custom modal
        createDialog('Customize Gender', genderForm(), 'custom-gender');
    }

    function getGender () {
        // get the player's gender (custom or grab the default)
        // custom
        if (State.variables[config.storyVar] && State.variables[config.storyVar].subjective) {
            return State.variables[config.storyVar];
        }
        // default
        var idx = 2;
        if (config.default === 'male') {
            idx = 1;
        } else if (config.default === 'female') {
            idx = 0;
        }
        var ret = {};
        Object.keys(genderMap).forEach( function (key) {
            ret[key] = genderMap[key][idx];
        });
        return ret;
    }

    // SETTINGS API

    if (config.showSetting) {
        Setting.addToggle(config.name, {
            label : config.label,
            desc : (config.desc && typeof config.desc === 'string' && config.desc.trim()) ? 
                config.desc.trim() : undefined
        });

        $(document).on(':dialogopen :dialogopened', function () {
            if ($('#ui-dialog-body').hasClass('settings')) {
                $(settingID).parent('div').empty().append( $(document.createElement('button'))
                    .append('Configure...')
                    .ariaClick( function () {
                        handleGender();
                    })
                );
            }
        });
    }

    // TEMPLATES

    function isUpper (name, string) {
        // is name is uppercase, return uppercased string
        if (name.first() === name.first().toUpperCase()) {
            return string.toUpperFirst();
        }
        return string;
    }
    
    Template.add(['he', 'she', 'they', 'He', 'She', 'They'], function () {
        return isUpper(this.name, getGender().subjective);
    });
    Template.add(['him', 'her', 'them', 'Him', 'Her', 'Them'], function () {
        return isUpper(this.name, getGender().objective);
    });
    Template.add(['his', 'hers', 'theirs', 'His', 'Hers', 'Theirs'], function () {
        return isUpper(this.name, getGender().possessive);
    });
    Template.add(['his_', 'her_', 'their', 'His_', 'Her_', 'Their'], function () {
        return isUpper(this.name, getGender().determiner);
    });
    Template.add(['himself', 'herself', 'themself', 'Himself', 'Herself', 'Themself'], function () {
        return isUpper(this.name, getGender().reflexive);
    });
    Template.add(['man', 'woman', 'person', 'Man', 'Woman', 'Person'], function () {
        return isUpper(this.name, getGender().noun);
    });

    // singular endings
    var replaceWith_are = /^is$/i; // is
    var replaceWith_were = /^was$/i; // was
    var replaceWith_o = /oes$/i; // does, goes
    var replaceWith_ie = /^[dl]ies$/i; // dies
    var replaceWith_y = /ies$/i; // dries
    var remove_es = /sses$/i; // posesses
    var remove_es2 = /hes$/i; // catches
    var remove_s = /s$/i; // surpises, plays
    // the above are tested in order; if none apply, return singular form (e.g: ran -> ran)

    // test for 'they' pronoun
    var hasThey = /they/i;

    function makePlural (singular) {
        if (!singular || typeof singular !== 'string') {
            return singular;
        }
        singular = singular.trim();
        if (replaceWith_are.test(singular)) {
            return singular.replace(replaceWith_are, 'are');
        }
        if (replaceWith_were.test(singular)) {
            return singular.replace(replaceWith_were, 'were');
        }
        if (replaceWith_o.test(singular)) {
            return singular.replace(replaceWith_o, 'o');
        }
        if (replaceWith_ie.test(singular)) {
            // need to use replaceWith_y regex here.
            return singular.replace(replaceWith_y, 'ie');
        }
        if (replaceWith_y.test(singular)) {
            return singular.replace(replaceWith_y, 'y');
        }
        if (remove_es.test(singular)) {
            return singular.replace(remove_es, 'ss');
        }
        if (remove_es2.test(singular)) {
            return singular.replace(remove_es2, 'h');
        }
        if (remove_s.test(singular)) {
            return singular.replace(remove_s, '');
        }
        return singular;
    }

    function _getPronounsArePlural () {
        return hasThey.test(getGender().subjective.trim());
    }

    // usage: pluralize('dries', null, true) -> dry; pluralize('supresses', 'supress') -> supresses
    function pluralize (singular, plural, forcePlural) {
        if (!forcePlural) {
            return singular;
        }
        if (plural && typeof plural === 'string') {
            return plural;
        }
        return makePlural(singular);
    }

    // MACRO

    // `<<pronouns>>` -> opens the modal for pronoun configuration, probably best paired with a link
    Macro.add('pronouns', {
        skipArgs : true,
        handler : function () {
            handleGender();
        }
    });

    // <<verb singular [plural] [makePlural]>>
    Macro.add('verb', {
        handler: function () {
            var pl = _getPronounsArePlural();

            if (this.args.length < 1) {
                return this.error('Please pass at least a singular third person pronoun to this macro.');
            }

            if (this.args.includes('plural')) {
                pl = true;
            }

            this.output.append(pluralize(String(this.args[0]), (this.args[1]) ? String(this.args[1]) : null, !!pl));
        }
    });

    // JAVASCRIPT API

    setup.gender = {
        // get the pronoun object; `setup.gender.pronouns().subjective` -> get `he`, `she`, etc
        pronouns : getGender,
        // open the pronoun config modal from JS; `setup.gender.dialog()`
        dialog : handleGender,
        // pluralizer function
        pluralize : makePlural
    };

    window.gender = window.gender || setup.gender;

}());
/* twine-user-script #12: "rooms.js" */
class Room {
	constructor(config) {
		this.name = '';
		this.chores = [];
		this.events = [];
		this.img = [];
		this.id = '';
		this.adjacentRooms = [];

		Object.keys(config).forEach(function (pn) {
            this[pn] = clone(config[pn]);
        }, this);
	}

	resetChores() {
		this.chores.forEach((chore) => chore.reset())
	}

	addChore(chore) {
		chore.room = this.id;
		this.chores.push(chore);
	}

	addEvent(event) {
		event.room = this.name;
		this.events.push(event);
		this.events.sort((a, b) => {
			if (a.priority > b.priority) return -1;
			else if (a.priority === b.priority) return 0;
			else return 1;
		});
	}

	removeEvent(eventName) {
		this.events = this.events.filter((em) => em.name != eventName);
	}

	getEvent() {
		var activeEvents = Array.from(this.events);
		activeEvents = activeEvents.filter((el) => el.active(true));
		if (activeEvents.length > 0) {
			var totalWeight = activeEvents.reduce((totalWeight, el) => totalWeight + 1 << el.priority, 0);

			var i = 0;
			for (var eventPicked = Math.floor(State.random() * totalWeight); eventPicked > 0; eventPicked -= 1 << activeEvents[i].priority)
				i++;
			return activeEvents[i].playEvent(true);
		} 
		else
			return "";
	}

	addEventCondition(event, fun) {
		this.events.find((em) => em.name == event).setCondition(fun)
	}

	findChore(choreName) {
		return this.chores.find((el) => el.name === choreName);
	}

	resetChores() {
		for (var i = 0; i < this.chores.length; i++)
			this.chores[i].reset()
	}

	getImgPath(imgIndex) {
		return `${setup.ImagePath}estate/${this.id}/${this.img[imgIndex]}`; 
	}

	display(imgIndex) {
		var imgIndex = imgIndex || 0;
		var str = `<span class='estateRoom'>${this.name}`;
		return str + (imgIndex < this.img.length ? `[>img[${this.getImgPath(imgIndex)}]]</span>` : "</span>");
	}

	getAdjacentRooms() {
		return this.adjacentRooms.reduce((str, room, i) => `${str}<li>${State.variables.mansion.findRoom(room).getPassage()}</li>`, `<ol>`) + "</ol>";
	}

	getPassage(display) {
		return `<<link "${display || this.name}" "${Story.has(this.id) ? this.id : "RoomDescription"}">><<set $player.currRoom to "${this.id}">><<= $time.addTravelTime("${State.variables.player.currRoom}", $player.currRoom)>><</link>>`
	}

	getNPC() {
		var present = [...npcList].filter((npc) => State.variables[npc].schedule.currRoom === this.id);
		if (present.length > 0)
			return present.reduce((str, npc) => str + `<li>${State.variables[npc].name}</li>`, "In the room, you see: <ul>") + "</ul>";
		else return "";
	}

	displayChores(displayTitle, canDoChores, filterDone, short) {
		return this.chores.reduce((str, chore) => {
			var choreDo = chore.do(canDoChores, filterDone||false, short||false);
			if (choreDo === "") return str;
			return `${str}<li class="choreUILink">${canDoChores ? choreDo : this.getPassage(chore.name)}</li>`;
		}, "");

		if (this.chores.length > 0) {
			var title = `${((displayTitle || true) ? this.name : "")}<ol>`;
			var str = "";
			for (var i = 0; i < this.chores.length; i++) {
				var chore = this.chores[i].do(canDoChores, filterDone || false);
				if (chore != "")
					str += `<li>${chore}</li>`;
			}
			if (str === "")
				return str
			return `${title}${str}</ol>`
		} else
			return ""
	}

	clone() {
        return new Room(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Room($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Room', {
    value : Room
});
/* twine-user-script #13: "save.js" */
Config.saves.version = 1;

Config.saves.isAllowed = () => !Story.get(State.passage).tags.includes("noSave");
Config.saves.autosave = () => Story.get(State.passage).tags.includes("Save");
/* twine-user-script #14: "script.js" */
// Adds Icons
//importScripts("https://kit.fontawesome.com/7a29cd6e9e.js");
importScripts("https://leaverou.github.io/stretchy/stretchy.min.js");

$(document).on(':passageinit', (ev) => (settings.nsfw) ? $("html").removeClass("hidden") : $("html").addClass("hidden"));

$(document).on(':passagestart', (ev) => {
	if (!ev.passage.tags.includes('noreturn')) {
		State.variables.return = ev.passage.title;
		if (!ev.passage.tags.includes('mainMenu'))
			State.variables.exitMenu = ev.passage.title;
	}
	if (ev.passage.tags.includes('eventStart')) // Stores the last event
		State.variables.mansion.currentEvent = ev.passage.title;
});

Config.passages.onProcess = (p) => {
	var text = `${State.variables.pPsgText}${p.text}<br>${State.variables.aPsgText}`;
	State.variables.pPsgText = "";
	State.variables.aPsgText = "";
	return text;
};

window.rememberScore = (score, event) => {
	// Stores the new events and forgets an event if it needs to
	while (State.variables.lastEvents[event].length >= settings.rememberLastEvents)
		State.variables.lastEvents[event].shift();
	State.variables.lastEvents[event].push(score);
}

window.process = (str) => Scripting.evalTwineScript(str);
/* twine-user-script #15: "settings.js" */
Setting.addHeader("NPC", "Anything that influence the generation of NPCs.");
Setting.addList("maxNPC", {
	label: "Maximum of npc to generate.",
	list: [10, 20, 50, 100],
	default: 20,
	onChange: () => {
		if (State.variables.minorNPC.length > settings.maxNPC)
			State.variables.minorNPC.splice(settings.maxNPC, State.variables.minorNPC.length)
	}
});
Setting.addList("npcPerEvent", {
	label: "Number of npc per events.",
	list: [5, 6, 7, 8, 9, 10],
	default: 5
});
Setting.addList("remeberLastEvents", {
	label: "How many events to store (More means the game is more forgiving).",
	desc: "Avoid changing during the game as it may cause some inbalance",
	list: [1, 2, 3, 4, 5, 6],
	default: 1,
	onInit: () => {
		State.variables.lastEvents = {
			CParty : [100],
			mean : (event) => State.variables.lastEvents[event].reduce((total, curr) => total + curr, 0) / State.variables.lastEvents[event].length
		};
	}
});


Setting.addHeader("Display");
Setting.addList("inventoryRows", {
	label    : "Number of rows in the inventory",
	list: [1, 2, 3, 4, 5],
	default  : 4,
	onInit: () => document.documentElement.style.setProperty("--inventoryRow", settings.inventoryRows),
	onChange: () =>	document.documentElement.style.setProperty("--inventoryRow", settings.inventoryRows)
});

// Setting up a list control for the settings property 'theme' w/ callbacks
var settingThemeHandler = () => {	// cache the jQuery-wrapped <html> element
	var $html = $("html");

	// remove any existing theme class
	$html.removeClass("theme-dark theme-light theme-green");

	// switch on the theme name to add the requested theme class
	switch (settings.theme) {
	case "theme-dark":
		$html.addClass("theme-dark");
		break;
	case "theme-light":
		$html.addClass("theme-light");
		break;
	case "theme-green":
		$html.addClass("theme-green");
	default:
		$html.addClass("theme-dark");
		break;
	}
};
Setting.addList("theme", {
	label    : "Choose a theme.",
	list     : ["theme-dark", "theme-light", "theme-green"], // TODO - add auto switching as an option
	default  : "theme-light",
	onInit   : settingThemeHandler,
	onChange : settingThemeHandler
});


Setting.addHeader("Misc", "For all the settings that don't have their place in other parts");
Setting.addToggle("nsfw", {
	label    : "Displays NSFW images",
	default  : true
});
Setting.addToggle("tips", {
	label    : "Displays the tips",
	default  : true
});
/*
Setting.addToggle("debug", {
	label    : "Displays the debugger",
	default  : false,
	onChange : () => State.variables.debug = settings.debug
});
*/


Config.history.maxStates = 20;
Config.passages.transitionOut = 10;
/* twine-user-script #16: "shop.js" */
class Shop {
	constructor (config) {
		this.categories = [];
		this.name = "Unnamed shop";
		this.id = "shop"; // Id must be same as the variable name

		Object.keys(config || {}).forEach(function (pn) {
            this[pn] = clone(config[pn]);
        }, this);
	}

	addCategory(categoryName)
	{
		this.categories.push(new Inventory({"name": categoryName, "isShop": true}));
	}

	addItem(category, item, count)
	{
		this.getCategory(category).addItem(item, count);
	}

	getAsTemp(itemName){
		for (var i = 0; i < this.categories.length; i++) {
			var item = this.categories[i].getAsTemp(itemName);
			if (item !== undefined) {
				item.removeTag("shopItem")
				return item;
			}
		}
	}

	getCategory(category)
	{
		return this.categories.find((el) => el.name == category);
	}

	listItem()
	{
		var str = "<div class='shop-display'>";
		var name = this.name;
		var id = this.id;
		this.categories.reduce((str, el) => {
			str + el.listItem(`State.variables['${id}']`);
		}, str);
		return str + "</div>";
	}
	
	clone() {
        return new Shop(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Shop($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Shop', {
    value : Shop
});
/* twine-user-script #17: "tags.js" */
window.tags = {
	base: {
		isPresent: (data) => State.variables.player.currRoom === State.variables[data.npc].schedule.currRoom,
		appreciation: (data) => (State.variables[data.npc].appreciation > data.value),
		day: (data) => (State.variables.time.weekDayFormat === data.day),
		bodyPart: (data) => (State.player.bodyPart[data.bodyPart] === data.value),
		weekEven: (data) => (State.variables.time.day % 14 >= 7),
		time: (data) => {
			if (data.time === "Morning")
				return State.variables.time.inInterval("wakeup", {hour: 12, minutes: 0});
			if (data.time === "Evening")
				return State.variables.time.inInterval("sleep", "wakeup");
		},
		flag: (data) => (State.variables.flags[data.flag] === data.state),
		random: (data) => (State.random() > data.threshold)

	},
	eval: function(tag, data, expected) {
		if (tag === "some")
			return data.some((val) => window.tags.eval(val.tag, val.data, val.expected) === expected)
		if (tag === "every") 
			return data.every((val) => window.tags.eval(val.tag, val.data, val.expected) === expected)
		if (tag === "count")
			return data.reduce((total, val) => total + window.tags.eval(val.tag, val.data, val.expected) === expected ? 1 : 0, 0)
		return this.base[tag](data) === expected;
	}
};
/* twine-user-script #18: "time.js" */
setup.ImagePath = "img/";
setup.SoundPath = "sound/";

class Timer {
	constructor (config) {
		this.time = {hour : 0, minute : 0};
		this.day = 0;
		this.days = ["monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday"];

		this.wakeup = {hour: 6, minute: 0};
		this.sleep = {hour: 22, minute: 0};

		Object.keys(config).forEach(function (pn) {
			this[pn] = clone(config[pn]);
		}, this);
	}

	setDate(time) {
		if (typeof time === "string")
			time = this[time]
		time = Object.assign({day:0, hour:0, minute:0}, time);
		if (this.compareTime(time) <= 0)
			this.day = time.day != 0 ? time.day + 1 : this.day + 1
		else {
			this.day = time.day != 0 ? time.day : this.day;
		}
		this.time.hour = time.hour;
		this.time.minute = time.minute;
	}

	addTime(time) {
		if (typeof time === "string")
			time = this[time];
		this.time.minute += (time.minute || 0);
		this.time.hour += (time.hour || 0) + Math.floor(this.time.minute / 60);
		this.time.minute %= 60;
		this.day += (time.day || 0) + Math.floor(this.time.hour / 24);
		this.time.hour %= 24;
	}

	static toMinute(time) {
		return ((time.day || 0) * 24 + (time.hour || 0)) * 60 + (time.minute || 0);
	}

	addTravelTime(start, end){
		this.addTime({minute: 5 * (pathfind.path(start, end).length - 1)})
	}

	compareTime(time, time2) {
		if (typeof time === "string")
			time = this[time];
		time2 = time2 || this.time;
		return Timer.toMinute(time) - Timer.toMinute(time2);
	}

	endsAfter(endTime, duration) {
		if (typeof endTime === "string")
			endTime = this[endTime];
		return Timer.toMinute(endTime) - Timer.toMinute(duration) < Timer.toMinute(this.time);
	}

	inInterval(timeStart, timeEnd) {
		if (typeof timeStart === "string")
			timeStart = this[timeStart];

		if (typeof timeEnd === "string")
			timeEnd = this[timeEnd];

		timeStart = timeStart || {hour: 0, minute: 0};
		timeEnd = timeEnd || {hour : 24, minute : 0};

		var time = Timer.toMinute(this.time);
		var t1 = Timer.toMinute(timeStart);
		var t2 = Timer.toMinute(timeEnd);

		return t1 > t2 ? time >= t1 || time < t2 : time >= t1 && time < t2;
	}

	get weekDay() {
		return this.day % 7;
	}

	get weekDayFormat() {
		return this.days[this.weekDay].charAt(0).toUpperCase() + this.days[this.weekDay].slice(1);
	}

	get clock() {
		return Timer.getTime(this.time);
	}

	static getTime(time) {
		return `${time.hour !== undefined ? ("0" + time.hour).slice(-2) : "00"}:${time.minute !== undefined ? ("0" + time.minute).slice(-2) : "00"}`
	}

	clone() {
        return new Timer(this);
    }

	toJSON() {
        var ownData = {};
        Object.keys(this).forEach(function (pn) {
            ownData[pn] = clone(this[pn]);
        }, this);
        return JSON.reviveWrapper('new Timer($ReviveData$)', ownData);
	}
}
Object.defineProperty(window, 'Timer', {
    value : Timer
});</script><tw-passagedata pid="1" name="changelog" tags="" position="100,100" size="100,100">! Community service

&lt;!-- Versioning system: MAJOR.MINOR.FIX --&gt;
!V0.X.X
!!V0.2.X - They have personalities now!
&lt;&lt;include &quot;changelog-V0.2.0&quot;&gt;&gt;
!!V0.1.X - Getting to know each other
&lt;&lt;include &quot;changelog-V0.1.3&quot;&gt;&gt;
&lt;&lt;include &quot;changelog-V0.1.2&quot;&gt;&gt;
&lt;&lt;include &quot;changelog-V0.1.1&quot;&gt;&gt;
&lt;&lt;include &quot;changelog-V0.1.0&quot;&gt;&gt;

&lt;&lt;return&gt;&gt;</tw-passagedata><tw-passagedata pid="2" name="changelog-V0.2.0" tags="changelog" position="225,100" size="100,100">!! V0.2.0
!!! Main content
- NPC&#39;s now move around much better.
- Repeated failure to complete your chores gets the first real bad end.

!!! Other content
- You can now see your debt.
- Variable breakfast events.
- More random events.
- More player stats added in the CUFF.
- Some choices now affect the player and NPC stats.
	Changes are still superficial for now but give you an idea of how different actions affect the game.

!!! Bug fixes:
- Fixed display for images on mobile.</tw-passagedata><tw-passagedata pid="3" name="changelog-V0.1.3" tags="changelog" position="350,100" size="100,100">!! V0.1.3
!!! Main content
- Added a computer to your room. Now, have fun playing and reading.

!!! Other content
- More balancing of the chores
- Added random events in the rooms, feel free to explore!

!!! Bug fixes:
- Fixed bug for internet explorer
- Fixed typo</tw-passagedata><tw-passagedata pid="4" name="changelog-V0.1.2" tags="changelog" position="475,100" size="100,100">!! V0.1.2
!!! Main conent
- Reworked the chores to make use of less chores

!!! Other content
- Reduced animation time from passage to passage
- Moved to the right the images for the rooms
- Changed the max time to do chores from 6pm to 10pm

!!! Bug fixes:
- Added the changelog from V0.1.1
- Mrs Sono unlearned how to teleport</tw-passagedata><tw-passagedata pid="5" name="changelog-V0.1.1" tags="changelog" position="600,100" size="100,100">!! V0.1.1
!!! Main content
- Moved the first minigame to be on the first week
- Made the player start mid-week

!!!Other content:
- Made more explicit how many chores need to be done weekly
- You now skip the time between 18:00 and 22:00 where there is nothing to do

!!!Bug fixes:
- Saves were not working
- At the end of the week, the player wasn&#39;t autoevaluated
- Some NPC in the first event were not well generated
- Fixed typo</tw-passagedata><tw-passagedata pid="6" name="changelog-V0.1.0" tags="changelog" position="725,100" size="100,100">!! V0.1.0
!!! Main content:
- Intro story
- Start of the housekeeper role
- First end of week assessment
- First mini-game
!!! Minor content: 
- Minor NPC encounters
- Inventory
- Bugs for your entertainement
!!! Bug fixes:
- None, it&#39;s the first release</tw-passagedata><tw-passagedata pid="7" name="foyerCleaning" tags="noreturn chore" position="850,100" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;wifeCleaningBossy01A&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;foyerDusting&quot;&gt;&gt;
		&lt;&lt;include &quot;foyerSweepMop&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="8" name="foyerDusting" tags="noreturn chore" position="975,100" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room. There are a lot of delicate items so it takes a fair amount of time. Some of the higher areas are a bit hard to get to so you have to get up on your tips toes.</tw-passagedata><tw-passagedata pid="9" name="foyerSweepMop" tags="noreturn chore" position="1100,100" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sweeping/sweeping_1.jpg&quot;]]

You sweep the floor carefully, making sure to get into all the nooks and crannies while being careful not to knock any of the displays over. Once that is done you fill the mop bucket up with water and some cleaning solution. You go over the surface with some floor wax, to create a shiny finish and it fills the room with a pleasant aroma.</tw-passagedata><tw-passagedata pid="10" name="hallCleaning" tags="noreturn chore" position="1225,100" size="100,100">&lt;&lt;include &quot;hallDusting&quot;&gt;&gt;

&lt;&lt;include &quot;hallSweepMop&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="11" name="hallDusting" tags="noreturn chore" position="100,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the hall. Once the tables and other surface are done you carefully run the duster over the paintings lining the walls. You use a cloth to clean the gaps in the moulded frames as well.</tw-passagedata><tw-passagedata pid="12" name="hallSweepMop" tags="noreturn chore" position="225,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_mopping/mopping_2.jpg&quot;]]

You sweep the floor carefully, making sure to get into all the nooks and crannies. Once that is done you fill the mop bucket up with water and some cleaning solution. You go over the surface with some floor wax, to create a shiny finish and it fills the hall with a pleasant aroma.</tw-passagedata><tw-passagedata pid="13" name="gardenCleaning" tags="noreturn chore" position="350,225" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;gardnerGardenBossy01&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;gardenSweep&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="14" name="gardenSweep" tags="noreturn chore" position="475,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sweeping/sweeping_2.jpg&quot;]]

$gardner.name doesn&#39;t like you messing with the plants so all you can do here is sweep any debris off the paths and sitting areas.</tw-passagedata><tw-passagedata pid="15" name="kitchenDishes" tags="noreturn chore" position="600,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dishes/dishes_1.jpg&quot;]]

You run the water until it&#39;s piping hot and then add dish soap to get a good amount of suds. After you rinse each dish you then scrub with a rough sponge until there is no residue. You rinse both sides again with more hot water then put each item on the dish rack. A little while later the rack is full of sparkling clean tableware, cookware and utensils. When you&#39;re done washing, you dry everything with a fresh dish towel and then put it all away in its proper place.</tw-passagedata><tw-passagedata pid="16" name="kitchenClean" tags="noreturn chore" position="725,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sink/sink_1.jpg&quot;]]

You get some heavy duty cleaner and give the whole sink area a good scrub down, then polish the petal parts so they really shine. The stove top and oven need the most attention and you have to a hard bristle brush to clean it off. You finish up by neatly arranging the sink area and kitchen utensils. You&#39;re quite tired by the time it&#39;s all done, but everything is left gleaming. You also empty the trash into the garbage chute.</tw-passagedata><tw-passagedata pid="17" name="kitchenSweepMop" tags="noreturn chore" position="850,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_mopping/mopping_1.jpg&quot;]]

You sweep the floor carefully, making sure to get into the counter corners and into the gap beside the fridge. You’re also careful that no food debris gets left behind. Once that is done you fill the mop bucket up with water and some cleaning solution. You use a rag to take care of any tough stains, it’s hard work but you’re confident it gets the job done. You go over the surface with some floor wax, leaving the floor shiny and filling the room with a pleasant smell.</tw-passagedata><tw-passagedata pid="18" name="laundryLinen" tags="noreturn chore" position="975,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_laundry/laundry_linen_2.jpg&quot;]]

You go through each room, stripping the beds, pillows and quilts and take it all to the laundry. You throw it all into one of the machines along with detergent and heavy duty stain remover before starting the cycle. While it is all washing you take fresh linen and remake all the beds. Once each load is clean and dried you fold and store it all in the nearby cupboards.</tw-passagedata><tw-passagedata pid="19" name="laundryClothes" tags="noreturn chore" position="1100,225" size="100,100">&lt;&lt;switch random(3)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;daughterLaundryPlayerNude01&quot;&gt;&gt;
	&lt;&lt;case 2&gt;&gt;
		&lt;&lt;include &quot;wifeLaundryPlayerNude01A&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;laundryClothesDefault&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="20" name="laundryClothesDefault" tags="" position="1225,225" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_laundry/laundry_clothes_1.jpg&quot;]]

With a heavy sigh, you spend time going through each room, taking the clothes discarded to hampers. Once you have everything you take it all back to the large laundry. You separate the items so you are washing the correct things together. Fortunately dry cleaning gets taken off site so you don’t have to learn that skill. Once it’s all ready you put each load into one of the machines with some laundry detergent, and then start the washing cycle. Once each cycle is done you put everything in the dryer before repeating the process. Once each load is done you have to fold everything neatly and sort it all into piles before putting it away.</tw-passagedata><tw-passagedata pid="21" name="loungeCleaning" tags="noreturn chore" position="100,350" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;wifeCleaningBossy02A&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;loungeDusting&quot;&gt;&gt;
		&lt;&lt;include &quot;loungeSweepMop&quot;&gt;&gt;
		&lt;&lt;include &quot;loungeWindows&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="22" name="loungeDusting" tags="noreturn chore" position="225,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure to get ever chair frames and table. The lamp shades and curtains require a softer touch. You have to spend a little extra time going around the fire place to clean out any soot as well.</tw-passagedata><tw-passagedata pid="23" name="loungeSweepMop" tags="noreturn chore" position="350,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sweeping/sweeping_1.jpg&quot;]]

Before you can start you move the furniture out of the way and then sweep the floor in sections, making sure to go around the legs of the furnitre to pick up any gathered debris. You have to move funiture several times so it is a slow process. Once that is done you fill the mop bucket up with water and some cleaning solution and repeat the process again. You use a rag to take care of any tough stains, it’s hard work but you’re confident it gets the job done.</tw-passagedata><tw-passagedata pid="24" name="loungeWindows" tags="noreturn chore" position="475,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="25" name="diningCleaning" tags="noreturn chore" position="600,350" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;wifeCleaningBossy01A&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;diningDusting&quot;&gt;&gt;

		&lt;&lt;include &quot;diningSweepMop&quot;&gt;&gt;

		&lt;&lt;include &quot;diningWindows&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="26" name="diningDusting" tags="noreturn chore" position="725,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure to get ever chair frames and table. The lamp shades and curtains require a softer touch. You have to spend a little extra time going around the fire place to clean out any soot as well.</tw-passagedata><tw-passagedata pid="27" name="diningSweepMop" tags="noreturn chore" position="850,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_mopping/mopping_1.jpg&quot;]]

Before you can start you move the furniture out of the way and then sweep the floor in sections. The table to too big to move on your own so you have to lift the edge of the rug underneath and clean where you can reach. It&#39;s diffuclt to manage the rug and your broom at the same time but you get the job done. Once the floors are swept you fill the mop bucket up with water and some cleaning solution and repeat the process again. You use a rag to take care of any tough stains, it’s hard work but you’re confident it gets the job done.</tw-passagedata><tw-passagedata pid="28" name="diningWindows" tags="noreturn chore" position="975,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="29" name="masterBdRmCleaning" tags="noreturn chore" position="1100,350" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;wifeBedroomCleaning01&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;masterBdRmDusting&quot;&gt;&gt;

		&lt;&lt;include &quot;masterBdRmVacuum&quot;&gt;&gt;

		&lt;&lt;include &quot;masterBdRmWindows&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="30" name="masterBdRmDusting" tags="noreturn chore" position="1225,350" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure to get ever chair frames and table. The lamp shades and curtains require a softer touch.</tw-passagedata><tw-passagedata pid="31" name="masterBdRmVacuum" tags="noreturn chore" position="100,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_vacuum/vacuum_1.jpg&quot;]]

You take out your vacuum and go over the entire room. You make sure to fluff and clean chaise cushions and then go over the curtains.</tw-passagedata><tw-passagedata pid="32" name="masterBdRmWindows" tags="noreturn chore" position="225,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="33" name="masterBathRmCleaning" tags="noreturn chore" position="350,475" size="100,100">&lt;&lt;include &quot;masterBathRmSweepMop&quot;&gt;&gt;

&lt;&lt;include &quot;masterBathRmSink&quot;&gt;&gt;

&lt;&lt;include &quot;masterBathRmToilet&quot;&gt;&gt;

&lt;&lt;include &quot;masterBathRmShower&quot;&gt;&gt;

&lt;&lt;include &quot;masterBathRmBath&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="34" name="masterBathRmSweepMop" tags="noreturn chore" position="475,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_mopping/mopping_1.jpg&quot;]]

You sweep the floor carefully, making sure to get into all the nooks and crannies. Then with some floor cleaner you start washing the tiles. The harsher stains are more difficult to remove and need some hard scrubbing to get them out of the seams. By the time you are finished the chemicals have dried out your fingers but you&#39;ve cleaned every tile and line of grout in the flooring.</tw-passagedata><tw-passagedata pid="35" name="masterBathRmSink" tags="noreturn chore" position="600,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sink/sink_2.jpg&quot;]]

You put some extra attention into the sink. It gets used more than anything else so you have to scrub away dried toothpaste and leftover cosmetics, collect strands of hair. Goodness knows what else was there but the ceramic is left perfectly white. You polish the metal trim on the mirror and sink, until it practically sparkles.
	
You spray down the mirror with some glass cleaner and start polishing the surface. There is a satisfying squeak as you work away until the glass looks flawless. You empty the cabinets, cleaning every object you take out of it, then clean every shelf while they have nothing on them before putting it all back where you found it.</tw-passagedata><tw-passagedata pid="36" name="masterBathRmToilet" tags="noreturn chore" position="725,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_toilet/toilet_1.jpg&quot;]]

You&#39;re on your hands and knees scrubbing around the toilet for longer than any person should ever be. You don&#39;t even want to think about where some of the stains came from. You pour medical grade cleaner around the bowl and use your toilet brush to remove whatever clings to the inside before flushing it clean again.</tw-passagedata><tw-passagedata pid="37" name="masterBathRmShower" tags="noreturn chore" position="850,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_shower/shower_1.jpg&quot;]]

You wash the entire inside of the shower with some nasty-smelling mildew remover that makes you feel dizzy, then run the shower before drying everything again with a towel. You spend a considerable amount of time clearing the cobwebs and dust for the corners of the room.</tw-passagedata><tw-passagedata pid="38" name="masterBathRmBath" tags="noreturn chore" position="975,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_bath/bath_1.jpg&quot;]]

You get into the bathtub and scrub down the rings staining the inside. It takes a good deal more time to remove the grime across the divide between the floor, walls and tub.</tw-passagedata><tw-passagedata pid="39" name="officeCleaning" tags="noreturn chore" position="1100,475" size="100,100">&lt;&lt;include &quot;officeDusting&quot;&gt;&gt;

&lt;&lt;include &quot;officeVacuum&quot;&gt;&gt;

&lt;&lt;include &quot;officeWindows&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="40" name="officeDusting" tags="noreturn chore" position="1225,475" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure to get ever chair frames and table. The lamp shades and curtains require a softer touch.</tw-passagedata><tw-passagedata pid="41" name="officeVacuum" tags="noreturn chore" position="100,600" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_vacuum/vacuum_1.jpg&quot;]]

You take out your vacuum and go over the entire room. You make sure to fluff and clean lounge cushions and are careful not to disturb anything on the desk.</tw-passagedata><tw-passagedata pid="42" name="officeWindows" tags="noreturn chore" position="225,600" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="43" name="gymCleaning" tags="noreturn chore" position="350,600" size="100,100">&lt;&lt;include &quot;gymDusting&quot;&gt;&gt;

&lt;&lt;include &quot;gymSweepMop&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="44" name="gymDusting" tags="noreturn chore" position="475,600" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure to go obver the skirting boards and windows frames. Each piece of equipment gets wiped down with disinfectant after you finish dusting it.</tw-passagedata><tw-passagedata pid="45" name="gymSweepMop" tags="noreturn chore" position="600,600" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sweeping/sweeping_1.jpg&quot;]]

You pick the rubber mats and other loose gear. Embarassingly, some of the equipment is too heavy for you to move so you have to go around it instead, still making sure to pick up any gathered debris. Once that is done you fill the mop bucket up with water and some cleaning solution and repeat the process again. You use a rag to take care of any tough stains, it’s hard work but you’re confident it gets the job done.</tw-passagedata><tw-passagedata pid="46" name="gymWindows" tags="noreturn chore" position="725,600" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="47" name="sonBdRmCleaning" tags="noreturn chore" position="850,600" size="100,100">&lt;&lt;include &quot;sonBdRmLocked&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="48" name="sonBdRmLocked" tags="noreturn chore" position="975,600" size="100,100">[img[setup.ImagePath + &quot;estate/SonBdRm/Locked.jpg&quot;]]

The door to this room is locked. Someone did mention something about not going into this room. Better leave it alone for now.</tw-passagedata><tw-passagedata pid="49" name="playerBdRmCleaning" tags="noreturn chore" position="1100,600" size="100,100">&lt;&lt;include &quot;playerBdRmClean&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="50" name="playerBdRmClean" tags="noreturn chore" position="1225,600" size="100,100">Thers isn&#39;t a lot of room to work with so cleaning up is as simple as putting everything where it&#39;s supposed to be and giving everything and quick dust and wipe.</tw-passagedata><tw-passagedata pid="51" name="poolCleaning" tags="noreturn chore" position="100,725" size="100,100">&lt;&lt;switch random(2)&gt;&gt;
	&lt;&lt;case 1&gt;&gt;
		&lt;&lt;include &quot;gardnerPoolBossy01&quot;&gt;&gt;
	&lt;&lt;default&gt;&gt;
		&lt;&lt;include &quot;poolSweep&quot;&gt;&gt;
&lt;&lt;/switch&gt;&gt;</tw-passagedata><tw-passagedata pid="52" name="poolSweep" tags="noreturn chore" position="225,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_sweeping/sweeping_2.jpg&quot;]]

$gardner.name takes care of most of the pool maintenance so you just sweep the sitting area and make sure it is tidy.</tw-passagedata><tw-passagedata pid="53" name="daughterBdRmcleaning" tags="noreturn chore" position="350,725" size="100,100">&lt;&lt;include &quot;daughterBdRmDusting&quot;&gt;&gt;

&lt;&lt;include &quot;daughterBdRmVacuum&quot;&gt;&gt;

&lt;&lt;include &quot;daughterBdRmWindows&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="54" name="daughterBdRmDusting" tags="noreturn chore" position="475,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure do all the surfaces you can get to. The lamp shades and curtains require a softer touch, even more so around the computer desk.</tw-passagedata><tw-passagedata pid="55" name="daughterBdRmVacuum" tags="noreturn chore" position="600,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_vacuum/vacuum_1.jpg&quot;]]

You take out your vacuum and go over the entire room. You make sure to get into every nook and canny and are careful not to disturb anything on the desk.</tw-passagedata><tw-passagedata pid="56" name="daughterBdRmWindows" tags="noreturn chore" position="725,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="57" name="guestRmCleaning" tags="noreturn chore" position="850,725" size="100,100">&lt;&lt;include &quot;guestRmDusting&quot;&gt;&gt;

&lt;&lt;include &quot;guestRmVacuum&quot;&gt;&gt;

&lt;&lt;include &quot;guestRmWindows&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="58" name="guestRmDusting" tags="noreturn chore" position="975,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_dusting/dusting_1.jpg&quot;]]

You take the duster from your collection of cleaning supplies and start going over the room making sure do all the surfaces you can get to. The lamp shades and curtains require a softer touch. You also go through all the drawers and clear out anything in there so they are clean in case a guest needs to stay here at the last minute.</tw-passagedata><tw-passagedata pid="59" name="guestRmVacuum" tags="noreturn chore" position="1100,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_vacuum/vacuum_1.jpg&quot;]]

You take out your vacuum and go over the entire room. You make sure to get into every nook and canny and are careful not to disturb anything on the desk.</tw-passagedata><tw-passagedata pid="60" name="guestRmWindows" tags="noreturn chore" position="1225,725" size="100,100">[img[setup.ImagePath + &quot;events/chores/general_windows/windows_1.jpg&quot;]]

Taking some windows cleaner you go over the large window with a clean cloth, making sure to polish it until they are crystal clear.</tw-passagedata><tw-passagedata pid="61" name="debug-passage" tags="debug DisableKeyLinks" position="100,850" size="100,100">&lt;hr&gt;
DEBUG

&lt;&lt;link &quot;Debug Skip Day&quot;&gt;&gt;
	&lt;&lt;= $time.setDate(&quot;wakeup&quot;)&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;Skip to end of day&quot;&gt;&gt;
	&lt;&lt;= $time.setDate({day:0, hour:22, minute:0})&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;Increase Arousal by 10&quot;&gt;&gt;
	&lt;&lt;= $player.increaseArousal(10)&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;Reset Arousal&quot;&gt;&gt;
	&lt;&lt;= $player.decreaseArousal()&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;Increase Serving&quot;&gt;&gt;
	&lt;&lt;= $player.levelUp(&#39;serving&#39;, 1)&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;Increase Daughter Appreciation&quot;&gt;&gt;
	&lt;&lt;set $daughter.addAppreciation(1)&gt;&gt;
	&lt;&lt;goto `passage()`&gt;&gt;
&lt;&lt;/link&gt;&gt; Current: $daughter.appreciation

Search variable: &lt;&lt;textbox &#39;_value&#39; &#39;&#39;&gt;&gt;&lt;&lt;button &quot;get&quot;&gt;&gt;
&lt;&lt;replace &#39;#story-variable&#39;&gt;&gt;&lt;&lt;debug _value&gt;&gt;&lt;&lt;/debug&gt;&gt;
&lt;&lt;/replace&gt;&gt;
&lt;&lt;/button&gt;&gt;

&lt;span id=&quot;story-variable&quot;&gt;&lt;/span&gt;

Current event: &lt;&lt;= $mansion.currentEvent&gt;&gt;

&lt;hr&gt;
Quick access to events:
[[mansionCPartyIntro01]]
[[mansionCPartySetup01]]
[[daughterPath04IntroDate01]]

&lt;hr&gt;
&lt;&lt;include playerDescription&gt;&gt;

&lt;&lt;for _npc_name range $npcList&gt;&gt; &lt;&lt;set _npc to State.variables[_npc_name]&gt;&gt;
&lt;&lt;capture [_npc_name, _npc]&gt;&gt;&lt;&lt;= _npc.speak(&quot;_npc.name (_npc.title): &lt;&lt;= _npc.getAppreciation()&gt;&gt; (_npc.appreciation), current room: &lt;&lt;= _npc.getLocation&gt;&gt;&quot;)&gt;&gt;&lt;&lt;/capture&gt;&gt;
&lt;&lt;/for&gt;&gt;</tw-passagedata><tw-passagedata pid="62" name="EndHomeSweetHome" tags="ending" position="225,850" size="100,100">&lt;&lt;= $player.speak(&quot;Sorry, not interested.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Oh come on just hear me out...&quot;, &quot;Peru&quot;)&gt;&gt;

He tries to convince you but you just walk away and get back on the bus.

A few days later you&#39;re back home in your room thinking about the great trip you had and what the future holds.

Your mind wanders back to that shady guy you met before leaving. It was definitely a bad idea given the airport security but you can&#39;t help but wonder what would&#39;ve happened if you wanted to [[Take that package.|Intro2]]</tw-passagedata><tw-passagedata pid="63" name="EndHardLabour" tags="ending" position="350,850" size="100,100">The Sentencing Officer goes through the formal paper work with you and hands you over to the state.

It deosn&#39;t take long for you to be stripped of all your belongs and sent to the camp. The conditions are hard and the only news from home is from your academy. You have forfeited your scholarship and been expelled.

The next few years are spent working off your debt. The work is back breaking and none of the other workers are particularly friendly given that they are all criminals. All alone you&#39;re easy pickings for the gangs and other low lifes of the camp. You eventually get taken in by one group but you just end up being their play thing and are passed around like a toy.

Years later your sentence ends and you are shipped back to your home country without much fuss but you have no one to meet and nowehere to stay. With no money and no prospects the future doesn&#39;t look great.

Maybe I should&#39;ve chosen [[Indentured Servitude|Intro5]] instead?</tw-passagedata><tw-passagedata pid="64" name="endChoresFailed01" tags="gameover" position="475,850" size="100,100">&lt;&lt;= $owner.speak(&quot;Your continued failure to meet my generous expectations has gone on long enough. I have chosen to forfeit your debt back to the state.&quot;)&gt;&gt; It seems everything else was just him crossing off his checklist until he got to this. &lt;&lt;= $owner.speak(&quot;You can come in now.&quot;)&gt;&gt;

$owner.name calls out behind you and two of the security personelle come in and take you by your arms.

&lt;&lt;= $owner.speak(&quot;Dismissed.&quot;)&gt;&gt;

$owner.name waves you away. You shout at to him to let you go and then beg to be given another chance as you&#39;re dragged out to the foyer and through the main door but it&#39;s too late. One bad decision after another has led you here and you aren&#39;t sure what will happen to you now. Whatever it is it won&#39;t be good.

!GAME OVER</tw-passagedata><tw-passagedata pid="65" name="mansionCPartyIntro01" tags="event eventStart" position="600,850" size="100,100">As you roll out of bed, you can&#39;t help but have a good feeling about the day. The feeling puts a hop in your step as you shower and prepare to serve breakfast. Afterwards, you decide to ride the wave and end up relaxing in your room for the rest of the morning instread of getting your chores done.

It&#39;s nice to spend the morning chilling out for once, but you eventually remember you need to at least get the daily jobs done.

[[Get started.|mansionCPartyIntro02]]
&lt;&lt;= $time.setDate({hour: 12, minute:0})&gt;&gt;</tw-passagedata><tw-passagedata pid="66" name="mansionCPartyIntro02" tags="event" position="725,850" size="100,100">The main foyer is busy with people setting up for the party this evening. No expense was spared, there are lavish decorations, flower arrangements. The smell coming from the kitchen is amazing. The rooms were already impressive before, but now you can really see the money on display.

You dodge a few of the workers as they move through with another bouquet. One of the women moving through the room catches your eyes. She is wearing a gorgeous maid&#39;s outfit that looks like something out of a boutique magazine.

You are busy taking in the sight of the cute maid when you get a shoved from behind from two people moving a table. The world teeters for a moment before you stumble down the stairs and run straight into a woman holding a stack of plates. You try to steady yourself but all you manage to do is tangle your feet in hers. Both you and the server crash to the ground and the plates shatter on impact.

[img[setup.ImagePath + &quot;events/cocktailparty/broken_plates.jpg&quot;]]

[[This won&#39;t be good.|mansionCPartyIntro03]]</tw-passagedata><tw-passagedata pid="67" name="mansionCPartyIntro03" tags="event" position="850,850" size="100,100">Everyone in the room turns to you both, lying on the ground and the caterer comes storming out of the kitchen.

&lt;&lt;= $caterer.speak(&quot;What the hell is this!?&quot;)&gt;&gt;

The woman tries to pick herself up but stumbles back to the ground in pain with a twisted ankle.

The caterer grabs some ice in a towel and rushes over to her shouting at you. &lt;&lt;= $caterer.speak(&quot;You idiot!&quot;)&gt;&gt; The man immediately starts icing her ankle.

Everyone else is just watching and enjoying the drama undolds when $wife.name walks into the room.

&lt;&lt;= $wife.speak(&quot;Well, well. What&#39;s going on here?&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;Your clumsy little fool of a servant injured my best server. That&#39;s what&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Oh please $caterer.name. Stop shouting.&quot;)&gt;&gt;

Some of the other people come and help the woman onto a seat. The sprain is already swelling up and the woman is clearly in pain. $caterer.name stands over you and confronts $wife.name.

&lt;&lt;= $caterer.speak(&quot;This is a problem. It&#39;s short notice and I&#39;m without my server.&quot;)&gt;&gt; He starts pacing back and forth. &lt;&lt;= $caterer.speak(&quot;You don&#39;t hire me to work in conditions like this. That&#39;s it! I&#39;m leaving.&quot;)&gt;&gt;

$caterer.name starts to walk away but $wife.name runs over and stops him.

&lt;&lt;= $wife.speak(&quot;Now $caterer.name just calm down. Do you have any idea how hard it will be to get someone to cover this evening? You&#39;re the best caterer in the city.&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;Well, do you expect me to serve myself? I need someone who knows what they are doing.&quot;)&gt;&gt;

$wife.name looks down at you and then back to $caterer.name. &lt;&lt;= $wife.speak(&quot;I&#39;ll get you a replacement alright? Just keep doing your usual, brilliant work and I&#39;ll be back.&quot;)&gt;&gt;

$wife.name grabs your arm and pulls you to your feet with startling ease and shoves you out of the room.

&lt;&lt;= $caterer.speak(&quot;It&#39;d better be fat and they&#39;d better know what they are doing!&quot;)&gt;&gt;

$wife.name drags you towards the [[Master Bedroom|mansionCPartyIntro04]]</tw-passagedata><tw-passagedata pid="68" name="mansionCPartyIntro04" tags="event" position="975,850" size="100,100">&lt;&lt;= $wife.speak(&quot;I swear $caterer.name is such a handful sometimes.&quot;)&gt;&gt; $wife.name pushes you down onto the bed so you&#39;re sitting on the end with her towering over you. &lt;&lt;= $wife.speak(&quot;This is a disaster. Do you know how much trouble you&#39;ve caused with your little stunt?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But the workers...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Nevermind that. $caterer.name is the best caterer in the city and I will not have sub-standard serving at my party tonight. It&#39;s too late to hire someone else who has any real skill and since you caused this mess, I&#39;m held responsible. You&#39;re still under probation so do you know what that means? You forfeited the terms of your service and you&#39;ll be shipped off to a labour camp.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But it wasn&#39;t me! I got shoved...&quot;)&gt;&gt; Your heat is thrumming in your chest at the mention of the camps. From the few stories you&#39;ve head about them over the last week, they&#39;re pretty severe with gangs and cruel guards that treat their charges like cattle.

&lt;&lt;= $wife.speak(&quot;I don&#39;t want to hear your weak exuses.&quot;)&gt;&gt; You&#39;ve never realised you could feel this small, but $wife.name was holding all the cards. &lt;&lt;= $wife.speak(&quot;The only solution is that you take over serving duties at the party tonight. I was originally going to hide you away, but this will have to do. I couldn&#39;t have someone in your state around the guests. If you agree and do a good job, I&#39;ll pretend this whole mess never happened. What do you say? It&#39;s either this or I hand you over to the state.&quot;)&gt;&gt;

[[Agree to serve a the party. It&#39;s the only real option you have.|mansionCPartyIntro05]]</tw-passagedata><tw-passagedata pid="69" name="mansionCPartyIntro05" tags="event" position="1100,850" size="100,100">&lt;&lt;= $wife.speak(&quot;Exellent. Not that you have a choice though. Who knows, if you like it, we might make this part of your normal duties. Now we can&#39;t have you dressed like this so stay there while I get you something to wear.&quot;)&gt;&gt;

$wife.name goes into the closet and you sit wringing your hands nervously. Hopefully you can do well enough that they&#39;ll let you stay on at the estate.

She comes back out with a bundle of items and starts laying them out on the large master bed. There&#39;s some simple silk bra and panties, a nice black and white silk dress...

[img[setup.ImagePath + &quot;events/cocktailparty/clothes01.jpg&quot;]]

&lt;&lt;= $player.speak(&quot;&lt;i&gt;What the fuck?&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;What the hell? Why are you getting out women&#39;s clothes?&quot;)&gt;&gt;

$wife.name snaps around and stares right at you. &lt;&lt;= $wife.speak(&quot;Watch your tone.&quot;)&gt;&gt;

You immediately shrink back realising how that sounded and she [[continues|mansionCPartyIntro06]]</tw-passagedata><tw-passagedata pid="70" name="mansionCPartyIntro06" tags="event" position="1225,850" size="100,100">$wife.name continues putting out the clothes she had gathered. &lt;&lt;= $wife.speak(&quot;There is a guest coming tonight who is a valued business partner and friend of the family. He is quite vocal in his distaste of keeping male indured servants. That means if this is going to work, you will need to be a girl for the night. I will &#39;&#39;NOT&#39;&#39; tolerate him finding out your are a boy. It shouldn&#39;t be too hard for you to pass as a girl anyway.&quot;)&gt;&gt;

Then under her breath you hear her say: &lt;&lt;= $wife.speak(&quot;Who knows, you might enjoy playing the part.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Now you&#39;re a more slight than I would like. Strip down and put the underwear on so I can see if they fit.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Can&#39;t I at least wear my own underwear?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Oh for godness sake. If you&#39;re going to convince anyone you need to wear everything. If you&#39;re embarassed by your manhood, you can go to the bathroom.&quot;)&gt;&gt;

[[Go to the bathroom|mansionCPartyIntro07]]</tw-passagedata><tw-passagedata pid="71" name="mansionCPartyIntro07" tags="event" position="100,975" size="100,100">You reach out to take the black silk panties, half worried they might jump up and bite you. $wife.name bustles you into the large bathroom that ajoins the closet.

Once the door is safely closed, you drop your shirt, pants and boxers onto a nearby counter and hold out the girly panties.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Geez, my heart is pounding.&lt;/i&gt;&quot;)&gt;&gt;

You hold the black silk down and step one foot in and then the other before pulling them up your legs.

[img[setup.ImagePath + &quot;events/cocktailparty/pantiesup.jpg&quot;]]

The feel of the material against your skin is nice and almost tingles. It&#39;s a way different feeling from your boring cotton boxers. You snap the waist band over your hips and adjust the edges so they aren&#39;t pulling or riding up everywhere and examine the fit.

The black silk cups and conceals your manhood but it&#39;s a bit tight since they are clearly made for someone with less down there. They&#39;re not really unconfortable though and the feeling of the silk against your sensitive member is much more acute. You twist sightly and your penis almost pokes out one side of the crotch before slipping back in.

As you are twisting and turning the bathroom door suddently opens and $wife.name comes in with the rest of the lingerie.

You rush to cover yourself. &lt;&lt;= $player.speak(&quot;I thought you where waiting outside!?&quot;)&gt;&gt;

$wife.name puts the items on top of your normal clothes. &lt;&lt;= $wife.speak(&quot;We need those legs smooth as silk. Sit down.&quot;)&gt;&gt; She grabs you by the shoulders again and sits you down the ornate chaise lounge near the vanity.

&lt;&lt;= $player.speak(&quot;But the stockings aren&#39;t even see through.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Shush now.&quot;)&gt;&gt;

&lt;&lt;link &quot;She&#39;s setting the terms so you have no choice.&quot; &quot;mansionCPartyIntro08&quot;&gt;&gt;
&lt;&lt;= $player.unequip(&quot;All&quot;)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Lacey black silk panties&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="72" name="mansionCPartyIntro08" tags="event" position="225,975" size="100,100">$wife.name pulls out a razor and some shaving butter. She start rubbing the oil all over your legs.

&lt;&lt;= $wife.speak(&quot;Hmm. It&#39;s nice a sparse already. Convenient.&quot;)&gt;&gt;

She then begins softly running the razor in lines down your thigh. The feel of her hands rubbing oil over your legs and now the razor is definetly having an effect on other parts of your body. You try to shift your seat and make room for your growing arousal.

$wife.name stops and then - &#39;&#39;WHACK&#39;&#39; - She gives you a hard slap on your butt.

&lt;&lt;= $player.speak(&quot;Ouch!&quot;)&gt;&gt; You shout was far less deep than you&#39;d have liked.

&lt;&lt;= $wife.speak(&quot;Don&#39;t move. I don&#39;t want to nick you.&quot;)&gt;&gt;

You stop shifting as she removes all the hairs from one leg, then the other. she gets you to roll over so the can do the backs and your growling erection is unconfortably squished against the chaise.

&lt;&lt;= $wife.speak(&quot;All done for the legs.&quot;)&gt;&gt;

[img[setup.ImagePath + &quot;player/legs/legs_smooth_02.jpg&quot;]]

&lt;&lt;= $wife.speak(&quot;Now roll over and lay down.&quot;)&gt;&gt;

&lt;&lt;link &quot;Roll over.&quot; &quot;mansionCPartyIntro09&quot;&gt;&gt;
&lt;&lt;= $player.shave($shop.getAsTemp(&quot;Basic razor&quot;))&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="73" name="mansionCPartyIntro09" tags="event" position="350,975" size="100,100">You roll over and she repeats the process on the thin patch of hair on your chest.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Who will even see my chest?&lt;/i&gt;&quot;)&gt;&gt;

[img[setup.ImagePath + &quot;player/chest/chest_flat_02.jpg&quot;]]

&lt;&lt;= $wife.speak(&quot;At least there&#39;s not much on your face. I think we&#39;ll leave that for now. Up you get.&quot;)&gt;&gt; She gives you another hard slap on the side of your butt and gets you to stand up.

&lt;&lt;= $wife.speak(&quot;Well then, on with the rest.&quot;)&gt;&gt; She gestures to the rest of the lingerie.

You look at the intimidating pile of silk before reaching out to take...

&lt;&lt;chooseOption &quot;The bra&quot;&gt;&gt;
You reach out and take the bra from the pile. It&#39;s a bit difficult to manage and you fumble a bit as you try to hook your arms through the loops. $wife.name is already tapping her foot impatiently. By the time you manage to get it over your shoulder, they are already a bit tangled.
&lt;&lt;option &quot;The stockings&quot;&gt;&gt;
You take one of the long stockings and sit down. Aside from being made of nylon it feels like any other sock, so you poke your toes in the opening and yank it over your heel. You immediately hear a ripping sound and can see your toes poking through the tear.
&lt;&lt;option &quot;The chincher&quot;&gt;&gt;
You take the bundle of fabric and it unrolls into a long tube of silk. Assuming it&#39;s a top of some kind, you try to pull it on like a shirt. It&#39;s extremely tight and within seconds, you manage to pin your arms in an awkward position and cant budge it.
&lt;&lt;end&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Oh for goodness sake. You are hopeless.&quot;)&gt;&gt;

[[She snatches the item from you|mansionCPartyIntro10]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="74" name="mansionCPartyIntro10" tags="event" position="475,975" size="100,100">$wife.name takes one of the bigger items.

&lt;&lt;= $wife.speak(&quot;First the body shaper. Lift your arms up.&quot;)&gt;&gt;

You hold your arms above your head as she warps the black lave arround your waist and hips. You feel her tugging it tight as she holds it together. It&#39;s very tight and you can already feel it compress your midsection.

&lt;&lt;= $wife.speak(&quot;Take a deep breath now.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Why&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Isn&#39;t it already tight enougth?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;The more you complain the less happy I am with your performance. Now take a deep breath.&quot;)&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

[[Just do as she says.|mansionCPartyIntro11]]</tw-passagedata><tw-passagedata pid="75" name="mansionCPartyIntro11" tags="event" position="600,975" size="100,100">You take a deep breath and $wife.name pulls the shaper even tighter and manages to get the hooks into the last holes.

&lt;&lt;= $wife.speak(&quot;You can put your arms down now.&quot;)&gt;&gt;

You do so and can feel the shaper holding your thin waist in tightly. You twist and bend a bit. It doesn&#39;t restrict your movement too much, it anything, it&#39; making you slouch less and hold yourself straighter. It&#39;s just really tight.

&lt;&lt;= $wife.speak(&quot;Bra next.&quot;)&gt;&gt;

[[Continue dressing|mansionCPartyIntro12]]</tw-passagedata><tw-passagedata pid="76" name="mansionCPartyIntro12" tags="event" position="725,975" size="100,100">$wife.name holds the shoulder straps for the bra open and you slip your hands through. She pulls it up over your shoulder before adjusting the fit on your chest. Once it&#39;s at the right place, she hooks it together and walks back in front of you.

The cups of the bra sit flat and empty against your chest.

&lt;&lt;= $player.speak(&quot;I don&#39;t really need this do I?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Yes.&quot;)&gt;&gt; She taps her chin and thnks for a moment. &lt;&lt;= $wife.speak(&quot;But your curves do need some work. Wait here.&quot;)&gt;&gt;

It doesn&#39;t take long for $wife.name to return holding two fleshy coloured bags. Without pausing, she holds open one cup of the bra and pushes the squishy sack in and then does the same with the other cup. They&#39;re both cold against your chest and rub against your nipples. You can feel them already stating to perk up and making the rubbing even more noticeable.

$wife.name pulls your attention away from the breast forms as she grabs your chin and turns your face to the side.

&lt;&lt;= $wife.speak(&quot;Hmm, not a bad start, but we&#39;ll need to work on your looks.&quot;)&gt;&gt;

&lt;&lt;link &quot;She sits you down on the vanity chair.&quot; &quot;mansionCPartyIntro13&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Lacey black silk bra&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="77" name="mansionCPartyIntro13" tags="event" position="850,975" size="100,100">&lt;&lt;= $wife.speak(&quot;Close your eyes.&quot;)&gt;&gt;

You do so and feel her brushing against your eyes, cheeks and mouth. It doesn&#39;t take a genious to guess that she is applying makeup.

[img[setup.ImagePath + &quot;events/bath_routine/makeup_eyes01.gif&quot;]]

It takes a few minutes and $wife.name chides you a few times for moving and spoiling her work. You can&#39;t help but feel like a child getting dressed up by their mother. In any other situation, there is no way you would be letting this situation happen.

[img[setup.ImagePath + &quot;events/bath_routine/makeup_lips01.gif&quot;]]

She stops for a moment and you&#39;re tempted to open your eyes and risk getting a talking to.

&lt;&lt;= $wife.speak(&quot;Do you prefer blondes, brunettes, or red heads?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Um...&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Um...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Brunette then.&quot;)&gt;&gt;

You feel $wife.name putting something on your head.

&lt;&lt;= $player.speak(&quot;What&#39;s that?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Your hair is too scruffy to work with, so you&#39;ll have to wear a wig instead.&quot;)&gt;&gt;

$wife.name adjusts the fit as best she can and tucks your short hair under the wig until she has it in the right spot. You feel the long tresses of the wig fall arount your shoulders. she spends some time adjusting the front so it frames your face and then ties your hairs back into a ponytail.

&lt;&lt;= $wife.speak(&quot;Put your legs out so we can get your stockings on.&quot;)&gt;&gt;&lt;&lt;set _wig to &quot;Long Brown Wig&quot;&gt;&gt;
&lt;&lt;option &quot;Blonde&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Blonde, I think...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Blonde it is. Looks like you&#39;re in for some fun&quot;)&gt;&gt;

You feel $wife.name putting something on your head.

&lt;&lt;= $player.speak(&quot;What&#39;s that?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Your hair is too scruffy to work with, so you&#39;ll have to wear a wig instead.&quot;)&gt;&gt;

$wife.name adjusts the fit as best she can and tucks your short hair under the wig until she has it in the right spot. You feel the long tresses of the wig fall arount your shoulders. she spends some time adjusting the front so it frames your face and then ties your hairs back into a ponytail.

&lt;&lt;= $wife.speak(&quot;Put your legs out so we can get your stockings on.&quot;)&gt;&gt;&lt;&lt;set _wig to &quot;Long Blonde Wig&quot;&gt;&gt;
&lt;&lt;option &quot;Brunettes&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Ah, Brunettes?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Brunette then. Looking to play the friend card, eh?&quot;)&gt;&gt;

You feel $wife.name putting something on your head.

&lt;&lt;= $player.speak(&quot;What&#39;s that?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Your hair is too scruffy to work with, so you&#39;ll have to wear a wig instead.&quot;)&gt;&gt;

$wife.name adjusts the fit as best she can and tucks your short hair under the wig until she has it in the right spot. You feel the long tresses of the wig fall arount your shoulders. she spends some time adjusting the front so it frames your face and then ties your hairs back into a ponytail.

&lt;&lt;= $wife.speak(&quot;Put your legs out so we can get your stockings on.&quot;)&gt;&gt;&lt;&lt;set _wig to &quot;Long Brown Wig&quot;&gt;&gt;
&lt;&lt;option &quot;Jet Black&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;I suppose black hair?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Hmm, I&#39;m not sure you have the confidence to pull off raven hair but so be it.&quot;)&gt;&gt;

You feel $wife.name putting something on your head.

&lt;&lt;= $player.speak(&quot;What&#39;s that?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Your hair is too scruffy to work with, so you&#39;ll have to wear a wig instead.&quot;)&gt;&gt;

$wife.name adjusts the fit as best she can and tucks your short hair under the wig until she has it in the right spot. You feel the long tresses of the wig fall arount your shoulders. she spends some time adjusting the front so it frames your face and then ties your hairs back into a ponytail.

&lt;&lt;= $wife.speak(&quot;Put your legs out so we can get your stockings on.&quot;)&gt;&gt;&lt;&lt;set _wig to &quot;Long Black Wig&quot;&gt;&gt;
&lt;&lt;option &quot;Red heads&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;I kind of like red heads, I guess...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Hmm, you&#39;re not really firey, but Aubrun may suit you.&quot;)&gt;&gt;

You feel $wife.name putting something on your head.

&lt;&lt;= $player.speak(&quot;What&#39;s that?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Your hair is too scruffy to work with, so you&#39;ll have to wear a wig instead.&quot;)&gt;&gt;

$wife.name adjusts the fit as best as she can and tucks your short hair under the wig until she has it in the right spot. You feel the long tresses of the wig fall arount your shoulders. she spends some time adjusting the front so it frames your face and then ties your hairs back into a ponytail.

&lt;&lt;= $wife.speak(&quot;Put your legs out so we can get your stockings on.&quot;)&gt;&gt;&lt;&lt;set _wig to &quot;Long Aubrun Wig&quot;&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;link &quot;Continue dressing&quot; &quot;mansionCPartyIntro14&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(_wig), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="78" name="mansionCPartyIntro14" tags="event" position="975,975" size="100,100">You open your eyes to the weird feeling of &lt;&lt;= $player.inv.filter([&quot;wig&quot;, &quot;equipped&quot;])[0].item.color&gt;&gt; bangs framing your view. $wife.name gives you a quick slap on the bottom of your foot when you hold your legs out.

&lt;&lt;= $wife.speak(&quot;Point your toes.&quot;)&gt;&gt;

You do so and she rolls each stockings up your legs one at a time.

[img[setup.ImagePath + &quot;events/cocktailparty/stockings1.gif&quot;]]

The feeling of the silk against your smooth skin sends a tingle up your thighs and you feel your hard on twitching.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;It&#39;s just because a woman is dressing me, that&#39;s all&lt;/i&gt;&quot;)&gt;&gt;

She finishes by clipping them to the stays on the body shaper.

&lt;&lt;= $wife.speak(&quot;Alright. Up you get, so we can have a look.&quot;)&gt;&gt;

Before you move, $wife.name pulls you up and turns you arround.

&lt;&lt;= $wife.speak(&quot;I havent got all day.&quot;)&gt;&gt;

&lt;&lt;link &quot;When you face the mirror your jaw almost hits the floor.&quot; &quot;mansionCPartyIntro15&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black Stockings with garter belt&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="79" name="mansionCPartyIntro15" tags="event" position="1100,975" size="100,100">[img[setup.ImagePath + &quot;events/cocktailparty/cocktailparty_firstlook.jpg&quot;]]

Standing in front of you, wearing demure black lingerie is one of the prettiest girls you&#39;ve ever seen. Her slim legs look amazing with the black stocking hugging them and the body shaper is squeezing her waist just tight enough to give a hint of curves to her narrow hips. The lacey bra hides away her small breasts as if encouraging someone to unwrap them. Her face has subtle make up done, with smoky eye shadow, glossy lips and a hint of blush contrasting her cheeks with soft pink against her pale skin. The &lt;&lt;= $player.inv.filter([&quot;wig&quot;, &quot;equipped&quot;])[0].item.color&gt;&gt; chin length bangs makes her face pop even more and the ponytail begs someone to caress her thin neck.

The only problem is, that girl is you.

&lt;&lt;= $player.speak(&quot;Holy shit.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Language.&quot;)&gt;&gt; $wife.name says sternly &lt;&lt;= $wife.speak(&quot;But yes, I think I&#39;ve outdone myself this time.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;This time..?&quot;)&gt;&gt;

You can&#39;t finish as staring at your cute reflection has had the exact reaction you&#39;d expect and your hard on pops out of the top of the elastic of the panties.

&lt;&lt;chooseOption &quot;Panic!&quot;&gt;&gt;
You stand like a deer in headlight staring at $wife.name and your cheeks get even redder.
&lt;&lt;option &quot;Cover yourself.&quot;&gt;&gt;
You cover yourself but all it did was draw $wife.name&#39;s attention.
&lt;&lt;end&gt;&gt;
&lt;&lt;= $wife.speak(&quot;Oh, that will not do.&quot;)&gt;&gt;

[[Hide your hard on|mansionCPartyIntro16]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="80" name="mansionCPartyIntro16" tags="event" position="1225,975" size="100,100">$wife.name leaves again and you hastily tuck your penis back into the silk panties. You&#39;re alone and staring at your cute reflection. If that girl wasn&#39;t you, you might stomach up the courage to go talk to her.

&lt;&lt;= $player.speak(&quot;Might as well...&quot;)&gt;&gt;

&lt;span id=&quot;maiddressing5_action&quot;&gt;&lt;/span&gt;\
&lt;&lt;set _i = 0&gt;&gt;\
&lt;span id=&quot;maiddressing5_breasts&quot;&gt;\
&lt;&lt;link &quot;Touch your breasts&quot;&gt;&gt;
&lt;&lt;= _i++&gt;&gt;
&lt;&lt;replace &quot;#maiddressing5_breasts&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;
&lt;&lt;append &quot;#maiddressing5_action&quot;&gt;&gt;
[img[setup.ImagePath + &quot;events/cocktailparty/cocktailparty_boobs.jpg&quot;]]

You reach up and cup your &quot;breasts&quot; through the silk bra. The breast forms give a little bit of weight to them but any sort of closer inspection would quickly reveal the truth. You suspect that&#39;s why $wife.name chose this bra, to make them feel real but have them hidden. As you knead the faux breasts, your nipples tingle as the texture gently pulls and twists them around. You pull your hand away and...


&lt;&lt;/append&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;/span&gt;\
&lt;span id=&quot;maiddressing5_pose&quot;&gt;\
&lt;&lt;link &quot;Strike a pose&quot;&gt;&gt;
&lt;&lt;= _i++&gt;&gt;
&lt;&lt;replace &quot;#maiddressing5_pose&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;
&lt;&lt;append &quot;#maiddressing5_action&quot;&gt;&gt;
[img[setup.ImagePath + &quot;events/cocktailparty/cocktailparty_pose.jpg&quot;]]

With one hand behind your head, you put the other on your hips before cocking them to the side. The girl looking back at you in the mirror could almost be a lingerie model. The slight tilt gives her hips even more definition as she smiles cutely at you. You quickly shake your head and drop the pose before...


&lt;&lt;/append&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;/span&gt;\
&lt;span id=&quot;maiddressing5_turn&quot;&gt;\
&lt;&lt;link &quot;Turn around&quot;&gt;&gt;
&lt;&lt;= _i++&gt;&gt;
&lt;&lt;replace &quot;#maiddressing5_turn&quot;&gt;&gt;&lt;&lt;/replace&gt;&gt;
&lt;&lt;append &quot;#maiddressing5_action&quot;&gt;&gt;
[img[setup.ImagePath + &quot;events/cocktailparty/cocktailparty_turn.jpg&quot;]]

Looking back over your shoulder, the ponytail flicks out of the way. The pale skin of your back is complemented by the dark lingerie. The modest silk panties cover your butt just enough but still show the hint of your cheeks underneath. The shaper and stockings create a sexy little squeeze at their edges to show you at least have a little muscle.


&lt;&lt;/append&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;/span&gt;\
&lt;&lt;link &quot;Wait&quot; &quot;mansionCPartyIntro17&quot;&gt;&gt;
&lt;&lt;set $pPsgText to &quot;&lt;&lt;set _i to &quot; + _i + &quot;&gt;&gt;&quot;&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="81" name="mansionCPartyIntro17" tags="event" position="100,1100" size="100,100">&lt;&lt;if _i &gt; 1&gt;&gt;\
&lt;&lt;= $wife.speak(&quot;Enjoying the view?&quot;)&gt;&gt;

You turn around with a little squeak to find $wife.name watching you. You feel like you shrink dow to about half your size at the way she is smiling at you.

&lt;&lt;= $wife.speak(&quot;Don&#39;t be embarassed. You look adorable.&quot;)&gt;&gt;

&lt;&lt;/if&gt;&gt;\
$wife.name joins you and drops something on the chaise before she kneels down in front of you. Before you can react, she pulls the panties down to the top of your stockings and pinches you right in the middle of your balls.

&lt;&lt;= $player.speak(&quot;Ow! What the hell!&quot;)&gt;&gt;

$wife.name stands up angrily. &lt;&lt;= $wife.speak(&quot;Excuse me?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Keep going.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;That hurts. Are you crazy?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;No, servant, I&#39;m not crazy and you&#39;d better watch your tone. You&#39;re already walking on thin ice and don&#39;t think I haven&#39;t noticed you not addressing me as $wife.title this entire time.&quot;)&gt;&gt;

&lt;&lt;link &quot;Back off&quot; &quot;mansionCPartyIntro18&quot;&gt;&gt;
&lt;&lt;= $player.boldness += 5&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;default&gt;&gt; or [[Back off|mansionCPartyIntro18]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="82" name="mansionCPartyIntro18" tags="event" position="225,1100" size="100,100">&lt;&lt;= $player.speak(&quot;Sorry. It&#39;s just that it realy hurts.&quot;)&gt;&gt; You shrink back a little and look away from her.

&lt;&lt;= $wife.speak(&quot;That&#39;s better. You need to watch yourself. Any more outburst like that and we&#39;ll have a problem. I&#39;ll let go of the fact that you haven&#39;t said $wife.title once today, but you&#39;d better make sure your performance tonight works. Now eyes forward. I don&#39;t want you getting any ideas.&quot;)&gt;&gt;

$wife.name kneels back down and takes the item from the chaise.

&lt;&lt;= $player.speak(&quot;Why did you do that $wife.title and why are you, um, down there?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I can&#39;t have you tenting your skirt at the party tonight or someone might figure out you&#39;re not a pretty little maid.&quot;)&gt;&gt;

You feel her grab your penis which softened moments after the pinch. She wraps something cold and hard over its than wraps it behind your balls.

&lt;&lt;= $wife.speak(&quot;Fortunately one of my smaller chastity cages is just the right size.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Excuse me $wife.title. A chastity what?&quot;)&gt;&gt;

You hear a little click as the cage locks in place and the she pulls your panties back up.

&lt;&lt;= $wife.speak(&quot;It will stop you from getting hard and making me look bad. You&#39;ll keep it on for the remainer of the night. You can come see me tomorrow to get it removed if you want to.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;All night? It&#39;s still morning though.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;The only way anyone will find out is if they get handsy. Now, knowing some of my guests, that&#39;s possible but at least we&#39;re reducing the risk so don&#39;t let that stop you from leaning into any stray hands if you want to.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Why would I do that $wife.title&quot;)&gt;&gt;

$wife.name was already walking back to the dressing room.

&lt;&lt;= $wife.speak(&quot;Come on. Let&#39;s wrap this up.&quot;)&gt;&gt;

&lt;&lt;link &quot;Follow&quot; &quot;mansionCPartyIntro19&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Pink chastity cage&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="83" name="mansionCPartyIntro19" tags="event" position="350,1100" size="100,100">You quickly head back into the main bedroom where $wife.name is already waiting with the maid&#39;s dress unzipped.

You step into the dress and she pulls it up over your hips. She helps you thread your arms through the sleeves and pulls it over your shoulders. $wife.name zips up the back before tying the laces on the back to pull the whole outfit tight in against your new curves. The black skirt ends just above your knees and has a ruffled white petit coat underneath it to give a bit of bounce. The dress stops just below your bra but it includes a thin white blouse that covers the high enough to hide your assets. The effect enhances your new bust while still mostly hiding it from view. $wife.name has already tied a white apron over your shoulders and end in white lace.

There is a pair of black mary janes wating and $wife.name buckles the up after helping you into them. Lastly, she places a white lave bonnet on your head.

You turn and look in one of the full length mirror. The cute gir you saw earlier is still watching you, only now in a little maids outfit. Overall, the look it quite modest but just sexy enough to turn some heads. The appeal is there though and you wouldn&#39;t be surprised to see the outfit in a high class porno.

[img[setup.ImagePath + &quot;events/cocktailparty/maid_firstlook.jpg&quot;]]

&lt;&lt;chooseOption &quot;Do a spin&quot;&gt;&gt;
[img[setup.ImagePath + &quot;items/wearables/dress/maid_twirl_01.gif&quot;]]

As you spin around, the skirt and apron do a cute little twirl with you. $wife.name smiles devilishly. She seems to appreciate how into the role you are getting.
&lt;&lt;= $player.femininity += 1&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Well? Thoughts? I won&#39;t ask for your opinion much so make the most of it.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;It could be worse&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;It&#39;s fine, I guess... $wife.title.&quot;)&gt;&gt;

She seems happy with that response.
&lt;&lt;= $player.femininity += 1&gt;&gt;
&lt;&lt;option &quot;Get me out of this stuff.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;If I didn&#39;t have to be doing this, I wouldn&#39;t.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Wouldn&#39;t what?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Wouldn&#39;t, $wife.title&quot;)&gt;&gt;
&lt;&lt;= $player.femininity -= 1&gt;&gt;
&lt;&lt;end&gt;&gt;&lt;&lt;link &quot;&lt;&lt;= $wife.speak(&#39;Better. Oh, one more thing.&#39;)&gt;&gt;&quot; &quot;mansionCPartyIntro20&quot;&gt;&gt;
&lt;&lt;= $player.raiseVoice({tmp:100, abs:1})&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Stylised maid outfit&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black leather mary jane heels&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="84" name="mansionCPartyIntro20" tags="event" position="475,1100" size="100,100">$wife.name wraps a choker around your neck. It&#39;s not too tight, but it does the job of hiding your small Adam apple.

&lt;&lt;= $wife.speak(&quot;Here. Drink this.&quot;)&gt;&gt; She hands you a small glass bottle. &lt;&lt;= $wife.speak(&quot;The whole thing.&quot;)&gt;&gt;

It smells like sour oranges, and, knowing there is no way around it, you down the entire bottle. It burns going down, like a shot of pure alcohol.

&lt;&lt;= $player.speak(&quot;What was that?&quot;)&gt;&gt; Your voice is softer and more feminine.

&lt;&lt;chooseOption &quot;Not good&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;What did you do to me?&quot;)&gt;&gt; You shout, grabbing your throat.

&lt;&lt;= $wife.speak(&quot;We can&#39;t have you sounding like a boy, otherwise what&#39;s the point in dressing you up.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Oh stop worrying. The effects are usually temporary.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Usually...&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;option &quot;Submissively.&quot;&gt;&gt;
You grab your mouth and throat in shock.
&lt;&lt;= $player.submission += 1&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;link &quot;&lt;&lt;= $wife.speak(&#39;Now, about your name...&#39;)&gt;&gt;&quot; &quot;mansionCPartyIntro21&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black choker&quot;), 1, true)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="85" name="mansionCPartyIntro21" tags="event" position="600,1100" size="100,100">&lt;&lt;= $wife.speak(&quot;You&#39;ll need a different name to keep up appearance.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Why can&#39;t I just use my name?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I want to avoid confusion. What if someone comes by after the party and meets you when you aren&#39;t a girl? So, how do you want to be named?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;&lt;textbox &#39;$player.femName&#39; &#39;Alice&#39; &#39;mansionCPartyIntro22&#39;&gt;&gt;&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="86" name="mansionCPartyIntro22" tags="event" position="725,1100" size="100,100">&lt;&lt;= $wife.speak(&quot;Yes, $player.femName suits you.&quot;)&gt;&gt;

$wife.name gives you a spritz of some nice smelling perfume.

[img[setup.ImagePath + &quot;events/bath_routine/perfume01.gif&quot;]]

&lt;&lt;= $wife.speak(&quot;Now make sure you look after your outfit. I expect everything to be cleaned and returned. If you don&#39;t I&#39;ll just add the items to your debt, and they aren&#39;t cheap, trust me.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $wife.title&quot;)&gt;&gt;

There is a knock on the door and $butler.name comes in and gives a guick bow.

&lt;&lt;= $butler.speak(&quot;$wife.title. $owner.title sent me ahead to make sure everything was prepared for this evening.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Right then. This is $player.femName. She will be assisting $caterer.name this evening. Please update AL with some new rules accordingly.&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;Of course $wife.title.&quot;)&gt;&gt;

$wife.name walks past $butler.name back to the main event.

$butler.name pauses for a moment and looks you up and down. There is little to no chance he hasn&#39;t already seen through the outfit and make-up.

&lt;&lt;= $butler.speak(&quot;AL, please update $player.femName&#39;s CUFF with hostess protocols.&quot;)&gt;&gt; He looks you in the eyes and you want to shrink back into yourself. &lt;&lt;= $butler.speak(&quot;Come with me $player.femName.&quot;)&gt;&gt;

[[Introduce everyone to the new maid.|mansionCPartyIntro23]]</tw-passagedata><tw-passagedata pid="87" name="mansionCPartyIntro23" tags="event" position="850,1100" size="100,100">[img[setup.ImagePath + &quot;events/cocktailparty/maid_debut.gif&quot;]]

You follow after $butler.name and try to get used to the changes in you wardrobe. The shaper isn&#39;t uncomfortable but both it and the short heels are forcing you to walk in a feminine sway. Feeling the air against your thighs makes you all to aware of the skirt you have on. You fidget with your hands as the long ponytail tickles behind your shoulder. Before you come into view of anyone else, you reach down and shift unconfortably a few times. After checking yourself out in the mirror your tapped member is already straining against its restricting plastic prison.

$wife.name is already back in the kitchen with $caterer.name.

&lt;&lt;= $wife.speak(&quot;Well $caterer.name. This is $player.femName.&quot;)&gt;&gt;

$caterer.name walks over to you and walks around you thoughtfully. You&#39;re reminded of when you met $wife.name for the first time as she examines you.

&lt;&lt;= $caterer.speak(&quot;What sort of experience do you have?&quot;)&gt;&gt;

Your eyes dart to $wife.name who is looking at you sternly. &lt;&lt;= $player.speak(&quot;Some. I have experience with house work and general cleaning.&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;Well, I&#39;m not looking for a kitchen hand.&quot;)&gt;&gt; He turns back to $wife.name who rases an eyebrow at him. &lt;&lt;= $caterer.speak(&quot;She&#39;ll do. I&#39;m going to have to switch things up and do standing service instead. That way she won&#39;t have to do any formal serving until after I&#39;ve trained her properly.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Whatever you say $caterer.name. As long as you&#39;re happy.&quot;)&gt;&gt;

$caterer.name goes back to the kitchen to continue his prep work.

&lt;&lt;= $wife.speak(&quot;I&#39;ll be basing my decision on how $caterer.name feels you performed.&quot;)&gt;&gt; $wife.name shakes her finger at you. &lt;&lt;= $wife.speak(&quot;Make sure you follow his instruction as if they were coming from me. Is that understood?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

$wife.title leaves and starts giving the worker instructions to clear the dining room as $caterer.name says to you:

&lt;&lt;= $caterer.speak(&quot;Come on girl. We need to get you started.&quot;)&gt;&gt;

&lt;&lt;link &quot;$caterer.name walks you through your duties.&quot; &quot;mansionCPartyIntro24&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="88" name="mansionCPartyIntro24" tags="event" position="975,1100" size="100,100">&lt;&lt;= $caterer.speak(&quot;Alright. I expect that you have no idea of what you&#39;re doing when it comes to the food prep so you just leave all that to me. I&#39;ll have you do laps to the guests with the serving trays. Have you ever held a serving tray before?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Only when I bring out breakfast.&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;So that&#39;s a no then. Here.&quot;)&gt;&gt; $caterer.name hands you a round serving tray.

&lt;&lt;chooseOption &quot;You don&#39;t want to risk dropping it, hold it with two hands.&quot;&gt;&gt;
&lt;&lt;= $caterer.speak(&quot;No, no, no.&quot;)&gt;&gt; He snatches the tray from you. &lt;&lt;= $caterer.speak(&quot;You hold the tray with one hand and put the other hand behind your back. Like this.&quot;)&gt;&gt;

He demonstrates for you and then hands you the tray back. You hold it with one hand this time.

&lt;&lt;= $caterer.speak(&quot;Better, but you still need some work.&quot;)&gt;&gt;

&lt;&lt;option &quot;Take the tray with one hand.&quot;&gt;&gt;
&lt;&lt;= $caterer.speak(&quot;Alright. At least you know that much. More than I was expecting to be honnest.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;What a jerk&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;You still need the other hand behind your back though.&quot;)&gt;&gt;
&lt;&lt;= $player.levelUp(&#39;serving&#39;, 1)&gt;&gt;
&lt;&lt;end&gt;&gt;
[[Continue practicing|mansionCPartyIntro25]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="89" name="mansionCPartyIntro25" tags="event" position="1100,1100" size="100,100">&lt;&lt;= $caterer.speak(&quot;I&#39;ll load you up with something that won&#39;t break and you can practice for a while.&quot;)&gt;&gt;

[img[setup.ImagePath + &quot;events/cocktailparty/serving_tray01.jpg&quot;]]

He loads the tray with some plastic and metal usensils he&#39;s not using and then set about walking back and forth around the open space in the kitchen sitting room. It&#39;s a little hard at first and you drop everything a few times. The first time you dropped something, you tried to bend down normally but the skirt started to ride up as you spread your knees. Instead you have to keep your legs together and kneel to the side to stop anyone from seeing the silk panties hiding your caged member. You catch a few of the workers stopping to stare when you do this and realise it&#39;s a very delicate and ladylike pose. When you stand back up, you feel your crotch twich unconfortably against its restaints.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;It&#39;s just my blood pumping from being nervous&lt;/i&gt;&quot;)&gt;&gt;

After a while, you seem to be getting the hung of it and $caterer.name calls you back over.

&lt;&lt;= $caterer.speak(&quot;Alright girl, one of the most important things to know about standing service is to catch the body language of your betters.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;My name is $player.femName.&quot;)&gt;&gt;

&lt;&lt;= $caterer.speak(&quot;The position of the hands can tell you...&quot;)&gt;&gt; $caterer.name continues his in-depth explanation.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Great, he&#39;s not even listening to me.&lt;/i&gt;&quot;)&gt;&gt;

As you&#39;re watching him explain the ins and outs of body language in relation to food service, it clicks that even the voice in your head sounds a bit feminine. You wonder what was in that drink $wife.name gave you.

After the lesson, he has you do some basic tidy work while he fininshes his prep. It&#39;s already starting to get to mid-afternoon. The workers have finished their setup and cleared out.

[[Your work continues into the afternoon.|mansionCPartyIntro26]]</tw-passagedata><tw-passagedata pid="90" name="mansionCPartyIntro26" tags="event" position="1225,1100" size="100,100">You&#39;re busy polishing the silver wear when $daughter.name comes into the kitchen already dressed for the party. She&#39;s wearing sexy black cocktail dress with black heels.

&lt;&lt;= $daughter.speak(&quot;Wow. Mum wasn&#39;t joking. You&#39;re giving some of my friends a run for their money. The cute but sexy maid thing really works for you.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Thank her.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Um, thank you $daughter.title.&quot;)&gt;&gt;

$daughter.name walks up to you and grabs you by the waist to check you out. She leans in to wisper in your ears.
&lt;&lt;= $player.submission += 1&gt;&gt;
&lt;&lt;option &quot;Get snarky.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Oh please, if I didn&#39;t have to do this, I wouldn&#39;t be.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Oh. You&#39;ve dropped the formalities already? You&#39;ve got some guts for a skinny little servant girl.&quot;)&gt;&gt;

You start to bristle a bit but it reminds you of your place. $daughter.name starts laughting.

&lt;&lt;= $daughter.speak(&quot;It&#39;s ok. I kind of like it.&quot;)&gt;&gt;

$daughter.name walks up to you leans in to whisper in your ears.
&lt;&lt;= $player.boldness += 1&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;= $daughter.speak(&quot;You can call me $daughter.name. Just when it&#39;s us girls though. Ok $player.femName?&quot;)&gt;&gt;

You nod meekly.

&lt;&lt;= $player.speak(&quot;If you say so.&quot;)&gt;&gt;

[[Continue|mansionCPartyIntro27]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="91" name="mansionCPartyIntro27" tags="event" position="100,1225" size="100,100">She pulls away and gives you a wink. You feel your cheeks burning and your penis quickly start straining against its plastic prison.

$daughter.name gives you a quick pat on the cheek before turing around to $caterer.name. She walks over and they hug before a quick peck on each cheeks.

&lt;&lt;= $caterer.speak(&quot;Good to have you back $daughter.name. These gatherings have been getting a bit stale.&quot;)&gt;&gt; $caterer.name&#39;s attitude is polar shift from when he&#39;s been talking to you or $wife.name.

&lt;&lt;= $daughter.speak(&quot;I have a feeling things might liven up over the next few week.&quot;)&gt;&gt;

$daughter.name gives him another quick hug and moves to leave as guests start arriving.

&lt;&lt;= $caterer.speak(&quot;Come on girl. You&#39;re up.&quot;)&gt;&gt; $caterer.name pushes a tray forward and you quickly take it and leave to start serving the new arrivals.

[[Begin serving|mansionCPartyInit]]</tw-passagedata><tw-passagedata pid="92" name="mansionCPartyIntro28" tags="event" position="225,1225" size="100,100">Exhausted from the busy night, your only thought are bathroom then bed. &lt;&lt;if $flags.kissedSuitor is true&gt;&gt;Although the kiss still lingers on your mind.&lt;&lt;/if&gt;&gt;

You head to the bathroom and quickly do a double take at the attractive maid looking at you before once again realising that you are the maid.

&lt;&lt;= $player.speak(&quot;What have I gotten myself into?&quot;)&gt;&gt; The cute girl says to you.

[[Undress|mansionCPartyIntro29]]</tw-passagedata><tw-passagedata pid="93" name="mansionCPartyIntro29" tags="event" position="350,1225" size="100,100">You reach around to unzip the dress. It&#39;s a bit difficult since the zipper is fairly high but eventually, and after a lot of streching and curses, you manage to grab a hold of it and pull the dress down off your shoulders and let it fall to your ankles.

Following the reverse of what $wife.name did, you remove the rest of the items, making sure to pile them neatly after her warning when you were getting dressed.

As you do you realise you havent&#39;t been to the bathroom all night and starting to feel the pressure on your bladder. You hirriedly pull down the panties and for the first time see your penis trapped in the pink chastity cage.

[img[setup.ImagePath + &quot;items/wearables/toys/cage_01.jpg&quot;]]

&lt;&lt;= $player.speak(&quot;Pink. Really?&quot;)&gt;&gt;

You try to release the device but quickly find a small padlock holding the clasp shut.

&lt;&lt;= $player.speak(&quot;What the fuck!?&quot;)&gt;&gt;

You tug and pull but only manage to make your urgent need to pee even worse.

&lt;&lt;link &quot;Go ask for it to be unlocked.&quot; &quot;mansionCPartyIntro30&quot;&gt;&gt;&lt;&lt;= $player.unequip(&quot;All&quot;, [&quot;toy-front&quot;, &quot;wig&quot;, &quot;underwear&quot;])&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;link &quot;It&#39;s late so you should wait until tomorrow.&quot; &quot;mansionCPartyIntro31&quot;&gt;&gt;&lt;&lt;= $player.unequip(&quot;All&quot;, [&quot;toy-front&quot;, &quot;wig&quot;, &quot;underwear&quot;])&gt;&gt;&lt;&lt;= $player.inv.removeTmp(true)&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="94" name="mansionCPartyIntro30" tags="event" position="475,1225" size="100,100">You head back though the halls of the estate. Compared to a few hours ago, it&#39;s practically dead. You reach the master bedroom, but before you knock, you hear noise from inside. You listen for a moment and it&#39;s clear $wife.name is preocupied with her pending orgasm. You think better of it and head back to your room, resigned to spend the night in chastity.

[[Head back to your bathroom|mansionCPartyIntro31]]</tw-passagedata><tw-passagedata pid="95" name="mansionCPartyIntro31" tags="event" position="600,1225" size="100,100">Resigning yourself to the situation, you try to position yourself over the toilet to relieve yourself. It&#39;s a tight squeeze in the small room and you can&#39;t quite get your trapped member in the right spot. With a grumble, you put the toilet seat down and turn arround before planting your butt. You let go with a sigh of relief.

[img[setup.ImagePath + &quot;events/cocktailparty/sittingonthetoilet.jpg&quot;]]

After a moment, you catch a sight of the cute &lt;&lt;= $player.inv.filter([&quot;wig&quot;, &quot;equipped&quot;])[0].item.color&gt;&gt; hairs sitting on the loo in front of you. Your cheeks flush with embarrasement as you realise that if anyone saw this, they would just think it was a flat chested girl peeing right now.

You wipe the cage clean with some tissues and then remove the wig and make-up. You put the maid&#39;s clothes in the laundry to clean overnight before rolling into bed to try and get some sleep.

&lt;&lt;link &quot;Sleep&quot; &quot;sleep&quot;&gt;&gt;
&lt;&lt;= $player.unequip(&quot;All&quot;, [&quot;toy-front&quot;])&gt;&gt;&lt;&lt;= $player.inv.removeTmp(true)&gt;&gt;
&lt;&lt;= $player.femininity += 1&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="96" name="mansionCPartyIntro32" tags="event" position="725,1225" size="100,100">You wake up with a jolt. The early morning light is only barely visible through your window so you only have the dim light of your lamp but with thankfully there is no one looming over the top of you. You pull off your sheets and see your member is still there, still locked in the pink cage.

&lt;&lt;= $player.speak(&quot;Just a dream.&quot;)&gt;&gt;

The sound of your normal voice is a relief. You pull the sheet bakc up and lie down can&#39;t get comfortable. Something feels wet around you waist. You reach down and touch and wet sticky spot on the sheets before turning the light on. Now you can see the pink cage has fresh pre-cum on it.

You quickly go to the bathroom and dry your self off with some tissue before getting back in bed, all the while doing your best to pretend none of that happened. Your sleep is ruined so all your really do is toss and turn for a while.

&lt;&lt;link &quot;Get up&quot; &quot;mansionCPartyIntro33&quot;&gt;&gt;
&lt;&lt;= $time.setDate(&quot;wakeup&quot;)&gt;&gt;
&lt;&lt;set $player.rest()&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="97" name="mansionCPartyIntro33" tags="event" position="850,1225" size="100,100">You look at the time and hope $wife.name is awake. You put your normal clothes, grab the maid&#39;s uniform and head to the master bedroom. After listening for the sound of any... morning activities, you think it&#39;s clear so you knock and wait for a moment before $wife.name eventually opens the door.

&lt;&lt;= $wife.speak(&quot;What is it?&quot;)&gt;&gt; She seems awake enough so you think you timed it right.

&lt;&lt;= $player.speak(&quot;The uniform $wife.title.&quot;)&gt;&gt; You hold out the black and white bundle.

&lt;&lt;= $wife.speak(&quot;Of course.&quot;)&gt;&gt; She takes and starts closing the door.

&lt;&lt;= $player.speak(&quot;Um, $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;What?&quot;)&gt;&gt; She stops and is now a little frustrated.

&lt;&lt;= $player.speak(&quot;Would you mind you mind unlocking me?&quot;)&gt;&gt; Your eyes dart down to your crotch.

&lt;&lt;= $wife.speak(&quot;Oh, I suppose. We&#39;ll need to discuss your performance last night first.&quot;)&gt;&gt; She opens the door all the way and lets you into her room.

You can see $owner.name lying asleep face down, clearly naked, and quicly follow $wife.name into the wardrobe.

&lt;&lt;link &quot;Performance review&quot; &quot;mansionCPartyReview01&quot;&gt;&gt;
&lt;&lt;= $mansion.addEvent(&quot;specialEvent&quot;, new Event({
	name: &quot;mansionCPartySetup01&quot;,
	passage: &quot;mansionCPartySetup01&quot;,
	inline: true,
	repeats: true,
	tags: {tag: &quot;every&quot;, data: [
		{tag : &quot;weekEven&quot;, data: {}, expected: false},
		{tag : &quot;day&quot;, data: {day: &quot;Saturday&quot;}, expected: true},
		{tag : &quot;time&quot;, data: {time: &quot;Morning&quot;}, expected: true},
	], expected: true}
}))&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="98" name="mansionCPartySetup01" tags="event eventStart" position="975,1225" size="100,100">It’s Saturday and today is $wife.name’s bi-weekly party so it’s time for you to take your role as $player.femName.

There are already several workers setting up for the event and you do your best to avoid them and head to the master bedroom. $wife.name is waiting with everything you need to get ready laid out in front of her save the pink chastity cage which has dangling from her finger.

&lt;&lt;= $wife.speak(&quot;Time to get dressed $player.femName.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

[[Start getting ready|mansionCPartySetup02]]</tw-passagedata><tw-passagedata pid="99" name="mansionCPartySetup02" tags="" position="1100,1225" size="100,100">Knowing waiting for $wife.name to leave is pointless you undress in front of her. She walks over, never breaking eye contact. You feel her slip the pink cage over your member and with a click the padlock is in place. It already feels uncomfortably tight.

&lt;&lt;= $wife.speak(&quot;Good girl.&quot;)&gt;&gt;

Next she hands you your black lace panties. You slide them up over your legs so they rest on your hips. The thin lace hardly does anything to conceal the cage underneath. Thank goodness you’ll be wearing a dress.

$wife.name helps you with the rest of your outfit. The cincher, stockings and bra all go on first. She then provides a wig and does your make up. Finally you step into the dress and pull it up over your slim figure and put on shoes, bonnett and the choker.

&lt;&lt;= $wife.speak(&quot;Now to restore that sweet sounding voice.&quot;)&gt;&gt;

She hands you a bottle of tonic.

&lt;&lt;link &quot;Complete the transformation&quot; &quot;mansionCPartySetup03&quot;&gt;&gt;
&lt;&lt;= $player.unequip(&quot;All&quot;)&gt;&gt;
/* Will change this to symply equip a set of clothes, like this it will be customisable */
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Lacey black silk panties&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Lacey black silk bra&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Long Brown Wig&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black Stockings with garter belt&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Pink chastity cage&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Stylised maid outfit&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black leather mary jane heels&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black choker&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Pink chastity cage&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.raiseVoice({tmp: 100, abs:1})&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="100" name="mansionCPartySetup03" tags="" position="1225,1225" size="100,100">You down the sour smelling liquid and wince as it burns your throat.

&lt;&lt;= $player.speak(&quot;Eh hem.&quot;)&gt;&gt; You clear your throat and the noise is decidely more feminine. Looks like you&#39;re $player.femName again.

&lt;&lt;= $wife.speak(&quot;Well $player.femName. Off you go.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

You turn and head towards the kitchen where $caterer.name has just arrived and is getting ready.

[[Start serving at the party|mansionCPartyInit]]</tw-passagedata><tw-passagedata pid="101" name="mansionCPartyInit" tags="event nobr" position="100,1350" size="100,100">&lt;&lt;silently&gt;&gt;
/* Used to generate npcs and other stuff needed for the party */
&lt;&lt;if $eventInfo === undefined&gt;&gt;
&lt;&lt;= console.log(&quot;UNDEFINED EVENT INFO&quot;)&gt;&gt;
&lt;&lt;set $eventInfo to {
	npc: [],
	score: 0,
	stage: 5,
	microEventCount: 2,
	events: [
		{name: &quot;Circulate some hors d&#39;oeuvres&quot;, passage: &quot;mansionCPartyStaring01&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Serve the lady on the lounge&quot;, passage: &quot;mansionCPartyStaring02&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Serve the man in the back&quot;, passage: &quot;mansionCPartyGroping01a&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Get another tray of food&quot;, passage: &quot;mansionCPartyCage01&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Go refill your tray&quot;, passage: &quot;mansionCPartyCage02&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Approach the people eyeing your tray&quot;, passage: &quot;mansionCPartySocialListen01&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Serve the the nearby couple&quot;, passage: &quot;mansionCPartySocialListen02&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Clear some of the tables&quot;, passage: &quot;mansionCPartySocialListen03&quot;, npc: [&quot;any&quot;]},
		{name: &quot;Tidy the side rooms&quot;, passage: &quot;mansionCPartySocialListen04&quot;, npc: [&quot;any&quot;]}
	],
	active : [],
	getNpc: function(npcType) {
		var NPC = [];
		npcType.forEach((type) =&gt; {
			var npc = this.npc.random();
			while (NPC.includes(npc) || (type !== &quot;any&quot; &amp;&amp; (State.variables.minorNPC[npc].gender !== type))) {
				npc = this.npc.random();
			}
			NPC.push(State.variables.minorNPC[npc]);
		});
		return this.active = NPC.length === 1 ? NPC[0] : NPC;
	},
	addPoint: function(nb) {
		var arr;
		console.log(this.active);
		if (this.active === undefined) {
			arr = [];
		} else if (typeof this.active === String) {
			arr = [this.active];
		} else {
			arr = this.active;
		}
		var nb = arr.reduce((nb, n) =&gt; nb + n.getBonusPoint(), nb);
		this.score += nb;
		return `Score + ${nb} (Total: ${this.score})`;
	}
}&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;= $eventInfo.npc = []&gt;&gt;
&lt;&lt;for _i = 0; _i &lt; settings.npcPerEvent; _i++&gt;&gt;
&lt;&lt;= generateNPC($minorNPC, $eventInfo.npc, _i)&gt;&gt;
&lt;&lt;/for&gt;&gt;
&lt;&lt;= console.log($eventInfo)&gt;&gt;
&lt;&lt;goto &quot;mansionCPartyServing01&quot;&gt;&gt;
&lt;&lt;/silently&gt;&gt;</tw-passagedata><tw-passagedata pid="102" name="mansionCPartyServing01" tags="event" position="225,1350" size="100,100">&lt;h1&gt;At the party&lt;/h1&gt;
&lt;span id=&quot;party-description&quot;&gt;
The people attending the party dressed in casual formal wear. You can tell by the designs that most people are probably just as well off as the hosts. There are quite a few people in attendence and with a mix of all kinds of people.

The party goers are mostly gathering in the lounge which has been setup as the main focus of the event. Furniture has been shifted and another server is at the bar is mixing drinks. A small band is playing music in one corner and space has been cleared in center of the room for people to dance. Most of the guests here are seated in lounges or standing around the bar. It’s not packed but moving through here is definitely a test of your tray management skills. Laughter and loud discussion hums along with the music being played.

The dining room furniture, including the large central table has all been moved and it is now setup to be a sitting area. The lighting is subdued and the music is still audible but much softer so guest can have quite conversations. The mood and conversations are much more subdued than in the rest of the estate. You overhear talk of social scandals, business deals and other upper class chat. The occasional salacious comment between some couples has you blushing in no time.

The expansive garden has been set up with strings of soft glowing lanterns hanging between most of the trees providing a very romantic mood to those moving between the flowers. People are more spread out here but no less boisterous than those inside. The music from inside is quieter but can still be heard through various speakers that have been setup. 

Several people are gathered around the pool and enjoying the party atmosphere from deck chairs and recliners. The pool lights are on giving everything an ethereal glow while the music suffuses the whole area with fun energy. A few people are in their swimsuits and enjoying the warm water.
&lt;/span&gt;

&lt;&lt;if $eventInfo.stage === 0&gt;&gt;
[[Finish the party|mansionCPartyFinish01]]
&lt;&lt;else&gt;&gt;
&lt;&lt;for _event range $eventInfo.events.randomMany($eventInfo.microEventCount)&gt;&gt;
&lt;&lt;capture _event&gt;&gt;\
&lt;&lt;link _event.name _event.passage&gt;&gt;
	&lt;&lt;= $eventInfo.stage--&gt;&gt;
	&lt;&lt;= $eventInfo.getNpc(_event.npc)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/capture&gt;&gt;
&lt;&lt;/for&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="103" name="mansionCPartyStaring01" tags="event" position="350,1350" size="100,100">While moving about you get stopped by one of the groups who happily clear the rest of the finger food from your tray. You catch one of them looking strait at your chest. You&#39;re a little flushed from all the walking so it has a nice pink hue just above the blouse. His eyes meet yours and he smiles warmly and tips his glass to you.

You quickly move away to escape his gaze.

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="104" name="mansionCPartyStaring02" tags="event" position="475,1350" size="100,100">You lean down to offer the drink to the lady on the lounge. She takes it and gives you a gentle rub on your arm.
&lt;&lt;= Character.speakAnonymous(&quot;Thank you so much. You must tell me how you keep your skin so soft.&quot;, &quot;Maroon&quot;)&gt;&gt; She caresses your arm for a few seconds longer. &lt;&lt;= Character.speakAnonymous(&quot;It&#39;s like touching silk.&quot;, &quot;Maroon&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Um, thank you.&quot;)&gt;&gt;

You politely pull away and hurry back to the bar to pick up some more drinks.

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="105" name="mansionCPartyGroping01a" tags="event" position="600,1350" size="100,100">&lt;&lt;= $player.speak(&quot;Can I get you something?&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;One scotch on the rock&#39;s and make it snappy.&quot;, &quot;MediumSlateBlue&quot;)&gt;&gt;

You turn away to retrieve the guest&#39;s drink and then feel a hard pinch on your rear end. Even through the skirt was in the way it still hurt like hell.

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Defend yourself|mansionCPartyGroping01b]]</tw-passagedata><tw-passagedata pid="106" name="mansionCPartyGroping01b" tags="" position="725,1350" size="100,100">&lt;&lt;= $player.speak(&quot;Ow! Hands to yourself.&quot;)&gt;&gt;

The person looks surpised at your reaction as you slap their hand away. Some of the other guests turn to look at the commotion and you spot $wife.name giving you a withering stare. You can almost hear her voice in your head telling you to suck it up and apologise or else...

The guest is staring at you with the barest hint of alarm.

&lt;&lt;chooseOption &quot;Appologise.&quot;&gt;&gt;
You swallow and say. &lt;&lt;= $player.speak(&quot;Sorry sir. You startled me is all.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Not a problem.&quot;, &quot;OrangeRed&quot;)&gt;&gt; The person smiles smugly. &lt;&lt;= Character.speakAnonymous(&quot;Now fetch my drink like a good girl.&quot;, &quot;OrangeRed&quot;)&gt;&gt;

You receive another quick slap on the butt to send you on your way.

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

&lt;&lt;option &quot;No way you&#39;re appologising&quot;&gt;&gt;
You stare at $wife.name for a moment and simply turn around and walk away. You still retrieve the guest&#39;s drink but you&#39;ll be damned if you&#39;re apologising to the groper.

&lt;&lt;= $eventInfo.addPoint(0)&gt;&gt;

&lt;&lt;end&gt;&gt;

[[Back to serving|mansionCPartyServing01]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="107" name="mansionCPartyCage01" tags="event" position="850,1350" size="100,100">$caterer.name pushes forward a fresh tray for you to collect.

&lt;&lt;= $caterer.speak(&quot;Come on girl.&quot;)&gt;&gt;

You lean forward to grab it and your hips bump against the counter. You gasp as the plastic cage is pushed into your crotch reminding you of your current situation down there. It gets shifted into an uncomfortable position.

&lt;&lt;chooseOption &quot;Reach down to adjust yourself.&quot;&gt;&gt;
&lt;&lt;= $caterer.speak(&quot;What the hell are you doing?&quot;)&gt;&gt; Caterer flicks out his arm and slaps your hand with a utensil and then hisses in a low voice. &lt;&lt;= $caterer.speak(&quot;Guests don&#39;t want to see you playing with yourself before taking out their food.&quot;)&gt;&gt;

You take the tray and walk out of the kitchen. Your restrained member twitches in the cage as it twist and pokes in an uncomfortable position. You&#39;ll just have to deal with it for now.

&lt;&lt;option &quot;Try and ignore it.&quot;&gt;&gt;
You take a moment to collect yourself, your twitching member straining against its plastic prison.

&lt;&lt;= $eventInfo.addPoint(10)&gt;&gt;

&lt;&lt;/chooseOption&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="108" name="mansionCPartyCage02" tags="event" position="975,1350" size="100,100">You&#39;re on your way back to the kitchen to refill your tray. As you pass between two guests one of them laughs loudly and tilts back forcing you to dodge them. Unfortunately you bump into the other guest. Worse still your hips press up against theirs and you feel the hard plastic of your chastity cage pressing against their thigh.

You pull back and fix you skirt before apologising. The person just looks down to your skirt and then back up before giving you a knowing wink.

You blush and feel an uncomfortable twitch in your loins, reminding you again of your tight cage. You hold the guests gaze for a moment before sheepishly looking down and then excusing yourself.

&lt;&lt;= $eventInfo.addPoint(10)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="109" name="mansionCPartySocialListen01" tags="event" position="1100,1350" size="100,100">Guests are taking items from your tray as you move through the crowd. They are pretty much ignoring the fact you are standing there as they carry on their conversations. One in particular gets your interest.

&lt;&lt;= Character.speakAnonymous(&quot;Have you seen the latest reports on PharmaTech&#39;s stock?&quot;, &quot;DarkMagenta&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Yes, it seems their stock keeps going up every since the borders were opened. It seems their body treatments are particularly popular amongst the wealthy of other countries.&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;The tailored effects are quite impressive. I volunteered one of my servants to test their skin softening treatments. Poor thing had some pock marks on her back and chest she hadn&#39;t even noticed before. She was reluctant to go but as soon as she returned I could see the improvements in her appearance. The mental side effects have also been beneficial to her overall attitude as a servant. She&#39;s much better at following instructions now.&quot;, &quot;DarkMagenta&quot;)&gt;&gt;

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="110" name="mansionCPartySocialListen02" tags="" position="1225,1350" size="100,100">A guest gestures for you to bring your tray over. You approach and they start examining the hors d&#39;oeuvres while continuing their conversation.

&lt;&lt;= Character.speakAnonymous(&quot;Did you hear the news about $suitor.name?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;No, what happened?&quot;, &quot;Tomato&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;It seems he&#39;s dismissed another servant.&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;How long did this one last? 2 weeks?&quot;, &quot;Tomato&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Not even that. At the rate he goes through stock the whole country will run out and will have to start pulling them from the labour camps.&quot;, &quot;GoldenRod&quot;)&gt;&gt;

Both of them start laughing, though you&#39;re not sure why it&#39;s funny.

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="111" name="mansionCPartySocialListen03" tags="" position="100,1475" size="100,100">You&#39;re picking up some empty glasses from an end table when you overhear some of the guests talking from around the corner.

&lt;&lt;= Character.speakAnonymous(&quot;I was talking to our host about their daughter earlier. Of course she only talked about her highs marks in her studies. There was no talk of her party habits though. It&#39;s amazing how such a bright mind can have such a wild side.&quot;, &quot;Tomato&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Yes, did you hear she&#39;s been brought back home by security several times since she got back into town.&quot;, &quot;Crimson&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;She definitely likes blowing off steam after being cooped up here all the time on her own. It&#39;s a bit sad really.&quot;, &quot;Tomato&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;The emergency response units would say that&#39;s putting it mildly.&quot;, &quot;Crimson&quot;)&gt;&gt;

&lt;&lt;= $eventInfo.addPoint(25)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="112" name="mansionCPartySocialListen04" tags="" position="225,1475" size="100,100">You go to one of the alcoves and are collecting some of the discarded food and rubbish. These don&#39;t really seem to care much about what they&#39;re eating and you find plenty of half eaten food. While you are busy you hear some voices from around a corner.

&lt;&lt;= Character.speakAnonymous(&quot;Have you seen $owner.name&#39;s latest acquisition?&quot;, &quot;OrangeRed&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Hm, I most certainly have. $wife.name has already been putting some work into her. She already created quite the beauty. Watching the way that maid&#39;s skirt bounces on that cute ass is definitely the highlight of my night so far&quot;, &quot;Maroon&quot;)&gt;&gt;

Your cheeks flush red as you realise, they are talking about you. Fortunately, they don&#39;t seem to know you are there so you do your best to keep it that way.

&lt;&lt;= Character.speakAnonymous(&quot;How long do you think it will take before she becomes the focal point of these parties?&quot;, &quot;OrangeRed&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Knowing how quickly $wife.name works not long at all.&quot;, &quot;Maroon&quot;)&gt;&gt;

//CLANG!//

You didn&#39;t realise you were leaning in to listen more and have knocked over one of your glasses. Quickly, you right the class and then move away.

A glance over your shoulder as you leave confirms the people heard and are watching you walk away with leering smiles.

&lt;&lt;= $eventInfo.addPoint(30)&gt;&gt;

[[Back to serving|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="113" name="mansionCPartyFinish01" tags="event" position="350,1475" size="100,100">Eventually the last guests leave and you help $caterer.name clean up. By the time you are finished with the last of the dishes $caterer.name is already gone. It&#39;s very late and after the nights work you are definitely ready for bed.

[[Head to your room|mansionCPartyIntro28][$time.setDate({hour:1, minute:30})]]</tw-passagedata><tw-passagedata pid="114" name="mansionCPartyReview01" tags="event" position="475,1475" size="100,100">&lt;&lt;nobr&gt;&gt;
&lt;&lt;set _final_score = Math.floor($eventInfo.score * (1 + $caterer.appreciation / 100))&gt;&gt;
&lt;&lt;set $flags.partyRule to true&gt;&gt;
&lt;&lt;/nobr&gt;&gt;\
Your score base: &lt;&lt;= $eventInfo.score&gt;&gt;
Your score final: &lt;&lt;= _final_score&gt;&gt; (expected at least &lt;&lt;= $lastEvents.mean(&quot;CParty&quot;)&gt;&gt;)

&lt;&lt;if _final_score &gt; $lastEvents.mean(&quot;CParty&quot;)&gt;&gt;
&lt;&lt;= $wife.speak(&quot;You worked so hard last night I&#39;m half tempted to leave it on just to keep you focused.&quot;)&gt;&gt;&lt;&lt;set $flags.cpartyBonus to true&gt;&gt;
&lt;&lt;elseif _final_score &gt; 0.9 * $lastEvents.mean(&quot;CParty&quot;)&gt;&gt;
&lt;&lt;= $wife.speak(&quot;Your performance was mediocre last night, I&#39;m half tempted to leave it on until you do better as a motivation.&quot;)&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;= $wife.speak(&quot;Given your poor performance last night I&#39;m half tempted to leave it on just to keep you focused.&quot;)&gt;&gt;&lt;&lt;set $wife.addAppreciation(1)&gt;&gt;&lt;&lt;set $flags.cpartyPenalty to true&gt;&gt;
&lt;&lt;/if&gt;&gt;

$wife.name pulls out a key and starts twirling it on her finger.

&lt;&lt;= $wife.speak(&quot;What do you think?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Please $wife.title. I would like it off.&quot;)&gt;&gt;

She waits for an uncomfortable minute just teasing you with the key to you’re your trapped penis spinning in front of you. You look at it longingly, if anything just to have the uncomfortable cage removed.
 
&lt;&lt;= $wife.speak(&quot;Oh fine.&quot;)&gt;&gt; She flicks you the key and gestures to one of the nearby cushions. You place the uniform there and wait for her to leave.

She doesn&#39;t, and time draws out as $wife.name stands there looking at you thoughtfully, her gaze wandering over your body, taking in every part of it before pausing on your crotch. As if reacting on it&#39;s own your trapped member throbs against it&#39;s confinement, forcing you to shift uncomfortably.

&lt;&lt;= $player.speak(&quot;Is there anything else you need $wife.title?&quot;)&gt;&gt;

Her eyes still linger on your hips for a moment before quickly shooting up to meet your gaze. $wife.name&#39;s piercing eyes seem to bore into you. You can&#39;t help but look away.

&lt;&lt;= $wife.speak(&quot;You know what. Given how everyone enjoyed having such a lovely and well presented young lady at their beck and call I think we might make some changes to the rules.&quot;)&gt;&gt;

Your eyes return to her face, smiling smugly and knowing you are at her mercy.

&lt;&lt;= $wife.speak(&quot;AL? Update the rules so $player.name here must assist $caterer.name for my bi-weekly gatherings. In full costume of course.&quot;)&gt;&gt;

Your [[CUFF]] beeps as the rules get updated.

$wife.name heads to the bathroom. &lt;&lt;= $wife.speak(&quot;A lot of people commented on having a beauty like you under our care. We can&#39;t disappoint your admirers now can we?&quot;)&gt;&gt;
 
&lt;&lt;= $player.speak(&quot;&lt;i&gt;As if I have a choice you f...&lt;/i&gt;&quot;)&gt;&gt;
 
&lt;&lt;= $wife.speak(&quot;Leave your little toy on the cushion. You never know when I might need it again.&quot;)&gt;&gt;
 
She closes the door and you quickly unlock the cage and remove it. The relief is instant but you can&#39;t help but think how pathetic your small member looks after being compressed by the cage for so long.
 
You leave the items on a cushion and then head &lt;&lt;link &quot;back to your room.&quot; &quot;PlayerBdRm&quot;&gt;&gt;&lt;&lt;= $mansion.endEvent()&gt;&gt;&lt;&lt;= rememberScore($eventInfo.score, &quot;CParty&quot;)&gt;&gt;&lt;&lt;set $eventInfo to undefined&gt;&gt;&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="115" name="daughterDateSetup01" tags="event eventStart" position="600,1475" size="100,100">&lt;&lt;set $daughterDateStart to true&gt;&gt;
&lt;&lt;set $daughterDateDrinking to 0&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;So what would you like to do? We can…&quot;)&gt;&gt;

&lt;&lt;link &#39;&lt;&lt;= $daughter.speak(&quot;Go to the movies.&quot;)&gt;&gt;&#39; &quot;daughterDateCinema01&quot;&gt;&gt;
&lt;&lt;set $flags.daughterDateEvent to 0&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;!--
&lt;&lt;link &#39;&lt;&lt;= $daughter.speak(&quot;Go dancing at a bar.&quot;)&gt;&gt;&#39; &quot;daughterDateDancing01&quot;&gt;&gt;
&lt;&lt;set $flags.daughterDateEvent to 1&gt;&gt;
&lt;&lt;/link&gt;&gt;
--&gt;</tw-passagedata><tw-passagedata pid="116" name="daughterDateCinema01" tags="" position="725,1475" size="100,100">&lt;&lt;= $daughter.speak(&quot;Sounds like fun. What movie do you want to see?&quot;)&gt;&gt;

You are pretty out of touch with anything going on outside of your role as a servant so you have no idea what there is available.

&lt;&lt;= $player.speak(&quot;I don’t really know what there is to see.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Ok. I’ll pick something for us then.&quot;)&gt;&gt;

[[Go to the movies|daughterDateActivity01]]</tw-passagedata><tw-passagedata pid="117" name="daughterDateDancing01" tags="" position="850,1475" size="100,100">&lt;&lt;= $daughter.speak(&quot;Sounds like fun. I know just the place.&quot;)&gt;&gt;

You have no idea where to go in the city so just end up following $daughter.name&#39;s lead.

&lt;&lt;= $player.speak(&quot;What sort of club is it?&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Don&#39;t worry, you&#39;ll see.&quot;)&gt;&gt;

[[Go to the club|daughterDateActivity01]]</tw-passagedata><tw-passagedata pid="118" name="daughterDateActivity01" tags="" position="975,1475" size="100,100">&lt;!-- todo: add interactions in the car --&gt;

A car is waiting downstairs and after getting in $daughter.name tells them where you are going. Both of you are int he back seat and a privacy screen keeps you separated from the driver. You look out of the corner of your eye and watch $daughter.name staring at the city as it passes by.

[[Arrive at you destination|daughterDateCinema02]]

&lt;!--
&lt;&lt;if $flags.daughterDateEvent is 0&gt;&gt;

&lt;&lt;elseif $flags.daughterDateEvent is 1&gt;&gt;
[[Arrive at you destination|daughterDateClub02]]
&lt;&lt;/if&gt;&gt;
--&gt;
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:30})&gt;&gt;</tw-passagedata><tw-passagedata pid="119" name="daughterDateCinema02" tags="" position="1100,1475" size="100,100">&lt;!-- todo: randomise between the movies --&gt;

The car drops you off on a back street and you follow $daughter.name down an alley. It&#39;s a pretty quiet area but you can see entrances to a few quirky cafe&#39;s and other establishments. The entrance to the cinema is just a simple unassuming door but once you&#39;re inside the room opens up into a Victorian style reception area.

[img[setup.ImagePath + &quot;events/daughterdate/theater_entrance_01.jpg&quot;]]

$daughter.name goes over and gets the tickets and comes back.

&lt;&lt;= $daughter.speak(&quot;They only do double features here but the seats are really comfy so it&#39;s like watching a movie at home.&quot;)&gt;&gt;

You start following her inside and spy the confection stand nearby.

&lt;&lt;chooseOption &quot;Ask to get some snacks.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Should we get something.&quot;)&gt;&gt; You point $daughter.name at the food stand.
&lt;&lt;if $player.fitness &lt;= 20&gt;&gt;
&lt;&lt;= $daughter.speak(&quot;We&#39;ll give it a miss this time.&quot;)&gt;&gt; $daughter.name pokes you in the stomach to emphasise the slight squish to your belly.

You blush and follow her [[into the theater.|daughterDateCinemaHorror01]]
&lt;&lt;else&gt;&gt;
&lt;&lt;= $daughter.speak(&quot;Sure, why not.&quot;)&gt;&gt;

You both step over to pick a few things and [[take them in with you.|daughterDateCinemaHorror01]]
&lt;&lt;/if&gt;&gt;
&lt;&lt;option &quot;Pass on getting snacks this time.&quot;&gt;&gt;
You decide against it and head [[inside the theater.|daughterDateCinemaHorror01]]
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="120" name="daughterDateCinemaHorror01" tags="" position="1225,1475" size="100,100">The cinema itself isn&#39;t huge and looks more like a re-puposed theater.

[img[setup.ImagePath + &quot;events/daughterdate/theater_room_01.jpg&quot;]]

You both take your seats and the movie starts. Ominous music starts playing and the opening scene is dark and gloomy. It quickly become obvious $daughter.name chose some sort of horror flick. A long figure comes in to fram running away from a shadow figure. You can&#39;t quite make out what is chasing her so you lean forward a little to see if it helps. After a minute or two of panicked running the person seems to get away.

You lean back as the film rolls on and the person meets up with one of their friends and tries to describe what is going on. The friend keeps telling them to calm down when out of nowehere something rips them both out of frame and they scream.

&lt;&lt;chooseOption &quot;Ah! So scary!&quot;&gt;&gt;
With a squeel of fright you grab the nearest person and bury your head in their shoulder.  Fortunately it was $daughter.name&#39;s arm and not some stranger. The smell of her purfume is comforting as you listen to the noises of the people being devoured. You peek at the screen as the scene changes to some more subdued before collecting yourself and pulling away. $daughter.name is smiling but still watching the movie.

For a while not much else happens since it&#39;s mostly boring setup but right in the middle of a quiet conversation the creature snatches another peron out of nowhere and you&#39;re right back at $daughter.name&#39;s side clinging to her in fright.

She reaches over your shoulder to hold you and pats you head with her other hand. &lt;&lt;= $daughter.speak(&quot;Don&#39;t worry, I&#39;ve got you.&quot;)&gt;&gt;

&lt;&lt;link &quot;Be held by her.&quot; &quot;daughterDateCinemaHorror02&quot;&gt;&gt;
&lt;&lt;= $player.femininity += 1&gt;&gt;
&lt;&lt;= $player.submission += 1&gt;&gt;
&lt;&lt;= $player.increaseArousal(20)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;That was awesome!&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Yeah! More of that.&quot;)&gt;&gt;

There are a few shooshes from the crowd so you pipe down a bit. $daughter.name chuckles from next to you. You sit back to enjoy the movie but a few minutes later you feel $daughter.name&#39;s shoulder brush up against yours. You can see her hand resting on the arm of the seat.

&lt;&lt;chooseOption &quot;Make a move.&quot;&gt;&gt;
With your heart thrumming in your chest sou slide you own hand over to brush against hers. Her fingers twitch against yours but she doesn&#39;t pull away. You gently hook one of her fingers with yours and she rubs against it before pulling away. $daughter.name then slides one of her slim digits between two of yours. This strange game of cat mouse plays out like this throughout the rest of movie. You both trying to ensare the other while still trying not to lose contact.

&lt;&lt;link &quot;Continue flirting awkwardly.&quot; &quot;daughterDateCinemaHorror02&quot;&gt;&gt;
&lt;&lt;= $player.boldness += 1&gt;&gt;
&lt;&lt;= $player.increaseArousal(30)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Chicken out.&quot;&gt;&gt;
Your mind struggles with what you want to do for the next hour or so as you try and decide what to do but you always stop just short of taking any action.

[[And so...|daughterDateCinemaHorror02]]
&lt;&lt;end&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="121" name="daughterDateCinemaHorror02" tags="" position="100,1600" size="100,100">It continues that way until the big finale and then the credits finally roll. You pull yourself away from $daughter.name, blushing slightly as she stands and smiles at you.

&lt;&lt;link &#39;&lt;&lt;= $daughter.speak(&quot;Well that was fun but we should probably head back.&quot;)&gt;&gt;&#39; &quot;daughterDateFinale01&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 5, minute: 0})&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="122" name="daughterDateDancing02" tags="" position="225,1600" size="100,100">[img[setup.ImagePath + &quot;events/daughterdate/bestdanceever.gif&quot;]]

This happens and everyone is impressed. (placeholders can be fun too)
&lt;&lt;set $time.addTime({day:0, hour: 2, minute: 0})&gt;&gt;
Some time later you both decide to [[call it a night.|daughterDateFinale01]]</tw-passagedata><tw-passagedata pid="123" name="daughterDateBar02" tags="" position="350,1600" size="100,100">&lt;!-- todo: add random events (friends, flirting, etc) --&gt;

You follow $daughter.name and eventually come to another hidden away venue. The small bar has a pretty good atmosphere with plenty of conversations going but not so loud you can&#39;t hear the person next to you. $daughter.name finds a booth to the side and once you sit down it could almost be a private bar with how it separates you both from the rest of the patrons. The dim but not dark lighting creates a very mellow atmosphere.

[img[setup.ImagePath + &quot;events/daughterdate/bar_01.jpg&quot;]]

&lt;&lt;= $daughter.speak(&quot;So what do you want to drink?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;No drinking for you both.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;I think we should take it easy don&#39;t you? If we end drinking it might get me into trouble with your mum right?&quot;)&gt;&gt;

$daughter.name pouts and gets an annoyed look on her face. &lt;&lt;= $daughter.speak(&quot;Stop being such a wuss. Is poor little baby scared of big bad $wife.name?&quot;)&gt;&gt;

You&#39;re never quite sure how to take $daughter.name when she talks to you like this.

[[Fumble for a response|daughterDateBarSober01]]
&lt;&lt;option &quot;Don&#39;t drink but don&#39;t stop her.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Just something non-alcoholic for me.&quot;)&gt;&gt;

$daughter.name pouts. &lt;&lt;= $daughter.speak(&quot;But I wanted you to have some fun with me.&quot;)&gt;&gt;

Her hand runs along the hem of her skirt of she says that as if to draw your attention to it. Your mind races. It would only take one wrong move for it to give you a view of what&#39;s hidden underneath. Your cage twitches and you shift in your seat uncomfortably.

&lt;&lt;link &quot;Before you can can change your mind.&quot; &quot;daughterDateBarDaughterDrunk01&quot;&gt;&gt;
&lt;&lt;set $daughterDateDrinking to 1&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Drinks all around.&quot;&gt;&gt;

&lt;&lt;link &quot;Party. Is. On.&quot; &quot;daughterDateBarBothDrunk01&quot;&gt;&gt;
&lt;&lt;set $daughterDateDrinking to 2&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="124" name="daughterDateBarBothDrunk01" tags="" position="475,1600" size="100,100">&lt;!-- todo: increase arousal high. debt goes up instead of down (random amount) --&gt;



[[Get krunk!|daughterDateBar03]]</tw-passagedata><tw-passagedata pid="125" name="daughterDateBarDaughterDrunk01" tags="" position="600,1600" size="100,100">&lt;!-- todo: increase arousal medium. you keep d under control. debt doesn&#39;t change --&gt;

One of the servers comes over and $daughter.name pulls her hand away. &lt;&lt;= $daughter.speak(&quot;Oh well. Your loss.&quot;)&gt;&gt;

She turns away and orders some drinks and food.

[[Enjoy the night |daughterDateBar03]]</tw-passagedata><tw-passagedata pid="126" name="daughterDateBarSober01" tags="" position="725,1600" size="100,100">&lt;!-- todo: increase arousal low. debt goes down (set amount)--&gt;&gt;

You aren&#39;t sure how to respond to that. You&#39;re here to stop $daughter.name from getting into trouble but you can&#39;t exactly tell her what to so.

&lt;&lt;= $player.speak(&quot;But ah. I thought you might...&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Hahahaha!&quot;)&gt;&gt; $daughter.name&#39;s facade cracks and she burst into laughter.

You blush at being the butt of another joke you don&#39;t get and look around as a few people stare. $daughter.name stops laughing and wipes away a tear.

&lt;&lt;= $daughter.speak(&quot;Ah, you should see your face.&quot;)&gt;&gt; She reaches out and pinch your cheek playfully until you bat it away. &lt;&lt;= $daughter.speak(&quot;I&#39;m just messing with you.&quot;)&gt;&gt;

A server comes over and asks for you orders.

&lt;&lt;= $daughter.speak(&quot;Two Blue Cow energy drinks please and can we get a share plate too?&quot;)&gt;&gt; $daughter.name scans her PDA to pay for everything and the server goes to get your order.

[[Enjoy the atmosphere.|daughterDateBar03]]</tw-passagedata><tw-passagedata pid="127" name="daughterDateBar03" tags="" position="850,1600" size="100,100">As the night goes on you both sit chatting and generally having a good time. It&#39;s nice to be out of the estate and eventually you relax enough to forget about your situation and just enjoy $daughter.name company. You both still don&#39;t have a lot in common but $daughter.name seems to be good at just engaging you.

&lt;&lt;= $daughter.speak(&quot;Oh! I love this song!&quot;)&gt;&gt;

$daughter.name stands up and grabs your arm.

&lt;&lt;chooseOption &quot;Go dancing.&quot;&gt;&gt;
You let $daughter.name pull you up onto the dancing floor. 

[[Get your groove on.|daughterDateBarDancing01]]
&lt;&lt;option &quot;Shake your head.&quot;&gt;&gt;
You shake you head awkwardly.

$daughter.name just rolls her eyes and heads over to the dance floor anyway leaving [[you alone at the table.|daughterDateBar04]]
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="128" name="daughterDateBar04" tags="" position="975,1600" size="100,100">&lt;!-- todo: add pictures/gifs of dancing. arousal ++ boldness -- --&gt;

$daughter.name spends the most of the rest of the night there and never seems to run out of energy.
&lt;&lt;if $daughterDateDrinking &gt;= 2&gt;&gt;
You sit alone drinking your drink and enjoying the buzz of the alcohol. Time runs away from you and you aren&#39;t sure how many you&#39;ve had. There are loud shout and noise at one point but you&#39;re too deep in your stupour to pay attention. 
&lt;&lt;elseif $daughterDateDrinking &gt;= 1&gt;&gt;
One of the server&#39;s keeps bringing her drinks but fortunately you manage to intercept and switch around a few of them without her noticing so she doesn&#39;t get anywhere near as crazy as she normally would.
&lt;&lt;else&gt;&gt;
You watch her she flows around the dance floor gracefully swaying and moving to the music. She still has artelaly good time and you&#39;re surprised she can get so wild when drinking so much if she has this much fun sober.
&lt;&lt;/if&gt;&gt;
Eventually $daughter.name has had enough so she joins you back in the booth.
&lt;&lt;if $daughterDateDrinking &gt;= 2&gt;&gt;
She slumps against you and gets very close your face almost as if she&#39;s about to say something. Your head lulls a little as you turn to face her. Before any words are said she just goes back to order another round and you happily join her.
&lt;&lt;elseif $daughterDateDrinking &gt;= 1&gt;&gt;
She slumps against you and gets very close your face almost as if she&#39;s about to say something. You heart starts beating faster. You can smell the alcohol on her breath but her moist lips aren&#39;t far from yours. If you just leaned forward a little.

$daughter.name abruptly turns and shouts out &lt;&lt;= $daughter.speak(&quot;Another round bar keep!&quot;)&gt;&gt;

She slump back against you, this time facing away. You subtley gesture to the server to make it half strength and they nod knowingly.
&lt;&lt;else&gt;&gt;
She scooches in close to you before putting and arm around your shoulders and resting her head against yours.

&lt;&lt;= $daughter.speak(&quot;I think I&#39;ll resting here a little bit.&quot;)&gt;&gt;
&lt;&lt;/if&gt;&gt;
Some time later you both decide to [[call it a night.|daughterDateFinale01]]</tw-passagedata><tw-passagedata pid="129" name="daughterDateBarDancing01" tags="" position="1100,1600" size="100,100">She immediately gets into a groove with you nearby and unsure what to do.

Some time later you both decide to [[call it a night.|daughterDateFinale01]]</tw-passagedata><tw-passagedata pid="130" name="daughterDateFinale01" tags="" position="1225,1600" size="100,100">You and $daughter.name find your way to a car and eventually get back to the estate.

&lt;&lt;if $daughterDateIntro is true&gt;&gt;
	[[daughterPath04IntroDate06]]
&lt;&lt;else&gt;&gt;
	[[sleep]]
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="131" name="daughterDateMorning01" tags="" position="100,1725" size="100,100"></tw-passagedata><tw-passagedata pid="132" name="therapySetup01" tags="event eventStart" position="225,1725" size="100,100">therapy variable setups</tw-passagedata><tw-passagedata pid="133" name="ownerBreakfastBossy01" tags="noreturn chore" position="350,1725" size="100,100">&lt;!-- Random % chance during [wakeUp] --&gt;

$owner.name is in the dining room already as you and $butler.name start layout out breakfast. He doesn&#39;t acknowledge either of you and continues reading his tablet and $butler.name hands hims a cup of coffee with milk and two sugars which $owner.name takes as if expecting it right then.

&lt;&lt;= $butler.speak(&quot;Your preferences today $owner.title?&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;Just the usual please $butler.name.&quot;)&gt;&gt;

You have a platter of fruit in your hands, not really paying attention to them, when you accidentllay put one of the trays&#39; down too hard. Some of the fruit spills off and both $butler.name and $owner.name look up.

&lt;&lt;= $butler.speak(&quot;Be sure that doesn&#39;t stain the upholstery and fetch a replace that fruit.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;It&#39;s ok $butler.name.&quot;)&gt;&gt; $butler.name looks to $owner.name and quickly stops berrating you. &lt;&lt;= $owner.speak(&quot;You know what. I&#39;ve changed my mind. I think I&#39;ll have some fruit instead. Come here with that tray $player.title.&quot;)&gt;&gt;

$owner.name crooks his finger and points to the space beside him. He doesn&#39;t give you orders very often but you know when he does disobeying has drastic consequences.

&lt;&lt;chooseOption &quot;Do as he says.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Yes $owner.title.&quot;)&gt;&gt;

You go to pick up the spilled fruit but $owner.name just gestures for you to leave it. Without a word $butler.name comes over and clears the mess instead. You approach with what&#39;s left on the tray and stand beside $owner.name.

Rather than filling the empty plate in front of him $owner.name just picks a piece from the platter and starts eating it. You go to put the tray down next to him.

&lt;&lt;= $owner.speak(&quot;Don&#39;t. Move.&quot;)&gt;&gt;

You stop halfway to putting the tray down, unsure of of what to do. $owner.name gestures for you to stand up with the platter still in your hand and takes another piece.

That&#39;s how you stay, standing there like a human side table while $owner.name slowly picks from the tray and skims through his tablet while $butler.name serves everyone else during the morning meal. The other residents don&#39;t really give you a second thought as they see what $owner.name has you doing. You never realised how demeaning such a simple task could be and your cheeks flush at the humiliation.

After three, long hours $butler.name comes back to the dining room. He finished clearing the rest of the table about fourty mintues ago but you&#39;ve had to stay here the whole time. Your arms started aching at around the one hour mark.

&lt;&lt;= $butler.speak(&quot;$owner.title.&quot;)&gt;&gt; He taps his wrist.

Without a word $owner.name gets up and leaves with $butler.name right behind him. Once they are both gone you drop the tray to the table and relax your sore muscles. You&#39;ll be doing your best not spill a tray again.

&lt;&lt;link &quot;Return to your room.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 1, minute: 0})&gt;&gt;
&lt;&lt;set $player.submission += 1&gt;&gt;
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;!-- Wife schedule events --&gt;</tw-passagedata><tw-passagedata pid="134" name="wifeOffice01" tags="noreturn chore" position="475,1725" size="100,100">&lt;!-- Requires wife in the Office --&gt;

$wife.name is sitting at the desk with her tablet. She’s most likely checking documents for a community outreach program she helps run. Her business clothes and posture make her every bit the confident and driven business woman.

[img[setup.ImagePath + &quot;character/wife/office_01.jpg&quot;]]</tw-passagedata><tw-passagedata pid="135" name="wifeGym01" tags="noreturn chore" position="600,1725" size="100,100">&lt;!-- Requires wife in the Gym --&gt;

$wife.name is in the gym going through her daily routine of cardio and light weight workout. She is on the bike at the moment and doesn’t even acknowledge you as you enter. The sheen of sweat glistening on her skin is very distracting.

[img[setup.ImagePath + &quot;character/wife/cardio01.jpg&quot;]]
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="136" name="wifeGym02" tags="noreturn chore" position="725,1725" size="100,100">&lt;!-- Requires wife in the Gym --&gt;

$wife.name is on the cable machine right now, working her shoulders and chest muscles. The defined lines of her body catch your eye and you can’t help but stare, and also feel a little jealous.

[img[setup.ImagePath + &quot;character/wife/cardio02.gif&quot;]]
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="137" name="wifeGym03" tags="noreturn chore" position="850,1725" size="100,100">&lt;!-- Requires wife in the Gym --&gt;

You hear the low hum of the treadmill as you enter the gym. $wife.name is jogging at a fast pace on the far side of the room. She breathing heavily but doesn&#39;t stop as you watch her. You doubt you could keep up that much effort with your current level of fitness.

[img[setup.ImagePath + &quot;character/wife/cardio03.gif&quot;]]
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="138" name="wifeOwnerLounge01" tags="noreturn chore" position="975,1725" size="100,100">&lt;!-- Requires wife in the Lounge with the Owner (they are both set to this location anyway so using either of them will work) --&gt;

You can see $wife.name reclining on one of the lounge chairs with her feet up resting on $owner.name’s lap while he gently rubs her feet. They are both reading something on their tablets and pause every so often to chat about something they just found. It’s a little strange seeing the two rich and domineering people just sitting like a regular married couple.

[img[setup.ImagePath + &quot;character/couples/wifeowner_lounge01.jpg&quot;]]

&lt;!-- Wife interactive events --&gt;</tw-passagedata><tw-passagedata pid="139" name="wifeCleaningBossy01A" tags="noreturn chore" position="1100,1725" size="100,100">&lt;!-- Randomly while the player is cleaning any room other than a bedroom and the wife is not in the Void --&gt;

You about to get started when $wife.name walks into the room. You pasue for a moment waiting for her to react.

&lt;&lt;= $wife.speak(&quot;Well? Come on. Get to it.&quot;)&gt;&gt;

You jolt to a start and begin going about your tasks.

&lt;&lt;= $wife.speak(&quot;That&#39;s it. Make sure you put your shoulder into this time.&quot;)&gt;&gt;

&lt;&lt;nobr&gt;&gt;
&lt;&lt;if $player.submission &gt;= 20&gt;&gt;
	&lt;&lt;= $player.speak(&quot;Yes $wife.title&quot;)&gt;&gt;&lt;br&gt;
	&lt;br&gt;
	You do as she says but after a few moments she speaks up again.&lt;br&gt;
&lt;&lt;else&gt;&gt;
	You roll your eyes and keep at your current task.&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;

&lt;&lt;= $wife.speak(&quot;No, no, no.&quot;)&gt;&gt;

$wife.name marches over and grabs you by the shoulders.

&lt;&lt;= $wife.speak(&quot;Like this.&quot;)&gt;&gt;

She manuevers you so that one shoulder is back while your other arms is doing the work.

&lt;&lt;= $wife.speak(&quot;And arch your back.&quot;)&gt;&gt;

You feel her press her elbow into your lower forcing you to push you chest.

&lt;&lt;= $wife.speak(&quot;Now hold that position while you work.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Maintain the pose.&quot;&gt;&gt;
You hold the postion as best you can. It&#39;s difficult hold you chest out in the awkward position and you&#39;re probably tiring out faster than you would normally. You don&#39;t really see how it&#39;s improving your work either but by the time you&#39;re finished it didn&#39;t take as long as it did last time.

When you finish $wife.name inspects your work.

She nods. &lt;&lt;= $wife.speak(&quot;This is satisfactory. See that you keep practicing. The longer you take the harder it will be for me to present a clean house to my guests.&quot;)&gt;&gt;

With that $wife.name turns around and leave you to your duties.
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:15})&gt;&gt;
&lt;&lt;= $player.levelUp(&#39;cleaning&#39;, 5)&gt;&gt;
&lt;&lt;= $player.useStamina(20)&gt;&gt;
&lt;&lt;option &quot;Just do it your way.&quot;&gt;&gt;
You go back to the way you were already doing it. $wife.name watches you the whole time with her arms crossed but doesn&#39;t seem to be reacting otherwise.

When you finish she inspects your work.

&lt;&lt;= $wife.speak(&quot;This is satisfactory. Unfortunately it took far too long. I told you how to do it and you failed to follow my instructions.&quot;)&gt;&gt;

She grabs you by the wrist and &lt;&lt;link &quot;drags you to the master wardrobe.&quot; &quot;wifeCleaningBossy01B&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:30})&gt;&gt;
&lt;&lt;set $player.boldness += 1&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="140" name="wifeCleaningBossy01B" tags="noreturn chore" position="1225,1725" size="100,100">&lt;!-- continues from previous passage --&gt;

The wife stands you in the middle of the wardrobe.

&lt;&lt;= $wife.speak(&quot;Top off now.&quot;)&gt;&gt; She says as she turn to grab something.

Knowing better than to talk back at this point you quickly take your top off. $wife.name comes back with a stiff black corset.

&lt;&lt;= $wife.speak(&quot;It seems you need more direct intervention to help you learn your role.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Quiet!&quot;)&gt;&gt;

She wraps the stiff fabric around your waist and begin tightening the clasps. You have to suck in your breath when she pulls it far tighter than your waist would normally allow. Once all the clasps are tightened she zips up the cover and locks it shut with a tiny pad lock.

&lt;&lt;= $wife.speak(&quot;Nice and secure. Now, if you behave and get your chores done you can come see before you turn in to have it unlocked.&quot;)&gt;&gt;

It only took minutes but she already has you on the ropes so you bow your head. &lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Good. Now back to work.&quot;)&gt;&gt;

She walks past you and out of the room but not before swatting your ass, leaving it tingling.

&lt;&lt;link &quot;Get back to your chores.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:10})&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black corset&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.increaseArousal(15)&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="141" name="wifeCleaningBossy02A" tags="noreturn chore" position="100,1850" size="100,100">&lt;!-- Randomly while the player is cleaning any room other than a bedroom and the wife is not in the Void --&gt;

Every now and then you have some diffuclty getting to get some of the high up areas. You&#39;re on you tip toes right now trying to get to one of these trouble spots when you hear a cough behind you.

$wife.name is standing at the entrance watching you thoughtfully.

&lt;&lt;= $wife.speak(&quot;If you&#39;re stuggling because of your small stature we could always find something to assist.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Wow, she&#39;s actually suggesting soemthing to help.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;A step stool would be nice $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Maybe. I don&#39;t see a need for something like that though. Shoes with a taller heel would suffice.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;&lt;&lt;= $player.speak(&#39;I think I can manage $wife.title.&#39;)&gt;&gt;&quot;&gt;&gt;

&lt;&lt;= $wife.speak(&quot;See that you do or the decision will be made for you.&quot;)&gt;&gt;

With that she turns and leaves you to your chores.
&lt;&lt;option &quot;&lt;&lt;= $player.speak(&#39;I guess that could help $wife.title.&#39;)&gt;&gt;&quot;&gt;&gt;
&lt;&lt;link &quot;&lt;&lt;= $wife.speak(&#39;Very well then. Follow me.&#39;)&gt;&gt;&quot; &quot;wifeCleaningBossy02B&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="142" name="wifeCleaningBossy02B" tags="noreturn chore" position="225,1850" size="100,100">&lt;!-- continues from previous passage --&gt;

You fall in behind $wife.name as she walks to the Master Bedroom.

&lt;&lt;= $wife.speak(&quot;Sit down and remove your shoes.&quot;)&gt;&gt;

She goes into the wardrobe while you remove your shoes and set them to the side. $wife.name comes back with the pair of Black leather mary janes that she makes you wear for the party.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Can I really say she&#39;s forcing me anymore?&lt;/i&gt;&quot;)&gt;&gt;

$wife.name slips the heels onto your feet and fastens the straps shut. You roll your toes enjoying the comfortable fit. The finishing touch is pair of small padlock on the straps.

&lt;&lt;= $player.speak(&quot;Ah, $wife.title?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Don&#39;t worry. You can return to me at the end of the day to have them removed.&quot;)&gt;&gt;

She stands up and you follow. Wearing heels still takes a little getting used to but you should be able to manage.

&lt;&lt;link &quot;Get back to your chores.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:10})&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Black leather mary jane heels&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.femininity += 1&gt;&gt;
&lt;&lt;= $player.submission += 1&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="143" name="wifeLaundryPlayerNude01A" tags="noreturn chore" position="350,1850" size="100,100">&lt;!-- When the player is doing the Laundry and the Wife enters the room --&gt;

Since you don&#39;t have any spare clothes that means you need to keep the one&#39;s you normally wear clean. You strip down and throw the few items you have in the wash and put it on a fast cycle.

It doesn&#39;t take too long so you busy yourself folding the washing that&#39;s already clean.

You bend down to put some of the linen away when the door to the laundry open.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;The lock you idiot!&lt;/i&gt;&quot;)&gt;&gt;

You spin around and see $wife.name standing there, arms crossed and a furious look on her face.

&lt;&lt;= $wife.speak(&quot;I come to check on you and find you like this?&quot;)&gt;&gt;

You snatch up one of the nearby towels and quickly cover yourself.

&lt;&lt;= $wife.speak(&quot;It&#39;s a bit late for that isn&#39;t it?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But, my clothes...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I don&#39;t want to hear excuses!&quot;)&gt;&gt;

$wife.name grabs you by the wrist. You lose a hold the towel, leaving you naked as she drags to [[your room.|wifeLaundryPlayerNude01B]]
&lt;&lt;= $player.unequip(&quot;All&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="144" name="wifeLaundryPlayerNude01B" tags="noreturn chore" position="475,1850" size="100,100">&lt;!-- continues from previous passage --&gt;

The small space feels even smaller with a second person here. $wife.name opens the wardrobe and pulls out the clothes that were left behind by the previous occupant and sets them on the bed.

&lt;&lt;= $wife.speak(&quot;You have a whole other outfit and yet you stand around my home naked! Get dressed.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;But those are...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;You can either wear these or go naked for the rest of the day. I can tell you my husband won&#39;t be impressed to find you in nothing but your birthday suit.&quot;)&gt;&gt;

Reluctantly you slip into the item provided. The panties and jeans rest a little low on your hips so the topof your butt is barely peeking out.

When you grab the shirt before the bra $wife.name speaks up again. &lt;&lt;= $wife.speak(&quot;Did I say you only had to wear some of it?&quot;)&gt;&gt;

You drop the shirt and slip into the bra first. It sits loose against your flat chest but when you put the shirt on it creates a very distracting illusion of small breasts underneath. Lastly you slide the pink sneakers on and stand up.

&lt;&lt;= $wife.speak(&quot;Much better. Be sure you keep that on for the rest of the day.&quot;)&gt;&gt;

Without another word she turns and leaves you alone in the small room

&lt;&lt;link &quot;Get back to your chores.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;!-- Currently broken.
/* Will change this to simply equip a set of clothes, like this it will be customisable */
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Female cut T-shirt&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Tight jeans&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Plain white panties&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Plain white bra&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Flat shoes&quot;), 1, true)&gt;&gt;
--&gt;
&lt;&lt;= $player.increaseArousal(15)&gt;&gt;
&lt;&lt;= $player.femininity += 5&gt;&gt;
&lt;&lt;= $player.submission += 5&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="145" name="wifeBedroomCleaning01" tags="noreturn chore" position="600,1850" size="100,100">&lt;!-- When the player is cleaning the Master Bedroom and the Wife enters the room --&gt;

The bedroom are fortunately much easier to clean since they are smaller than the main rooms. You&#39;re in the middle of tidying up when $wife.name walks in and looks around.

&lt;&lt;= $wife.speak(&quot;Nope, this just isn&#39;t goood enough.&quot;)&gt;&gt; She grabs you and points underneath the bed. &lt;&lt;= $wife.speak(&quot;You need to get right under the beds and clean there as well.&quot;)&gt;&gt;

It looks like you&#39;re not getting out of this without doing what she says. You take the vacuum and and click it down so it will slide under the bed and get on your hands knees to finish the job.

&lt;&lt;chooseOption &quot;Put some effort in.&quot;&gt;&gt;

You work as hard as you can to cover the whole area. It takes s while but when you&#39;re done $wife.name seems happy with your work.

&lt;&lt;= $wife.speak(&quot;Make sure you keep putting that effort in.&quot;)&gt;&gt;

She leaves the room so you can continue with your work.

&lt;&lt;set $time.addTime({day:0, hour: 0, minute: 10})&gt;&gt;
&lt;&lt;set $player.submission += 1&gt;&gt;
&lt;&lt;option &quot;Do it quickly.&quot;&gt;&gt;

You run the vacuum over the floor as quickly as you can. About halfway through you hear $wife.name behind you.

&lt;&lt;= $wife.speak(&quot;For goodness sake! Put some effort in.&quot;)&gt;&gt;

You feel her put her heeled shoe on your butt and push you further under the bed. It&#39;s definitely easier to get the hard to reach places now. Just before you finish her foot slips and the narrow heel of her shoe pushes right up against your rear entrance.

&lt;&lt;= $player.speak(&quot;Ow!&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Hurry up and finish.&quot;)&gt;&gt; She keep her heel right where it loanded.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Did she do that on purpose?&lt;/i&gt;&quot;)&gt;&gt;

You finish the job and $wife.name removes her foot.

&lt;&lt;= $wife.speak(&quot;See that you don&#39;t waste my time with this in the future.&quot;)&gt;&gt;

&lt;&lt;set $time.addTime({day:0, hour: 0, minute: 20})&gt;&gt;&lt;br&gt;
&lt;&lt;set $player.boldness += 1&gt;&gt;
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;!-- Daughter schedule events --&gt;</tw-passagedata><tw-passagedata pid="146" name="daughterGymSquat01" tags="noreturn chore" position="725,1850" size="100,100">&lt;!-- Requires daughter in the Gym --&gt;

You hear loud grunting as you enter the room and can see $daughter.name in the middle of her workout. She&#39;s currently in the middle of a set of squats with heavy weights on her shoulders. It&#39;s a little embarassing seeing her lifting weights that you would probably struggle with. She spots you in the mirror and gives you a wink without missing a rep.

[img[setup.ImagePath + &quot;character/daughter/gym_barbellsquat01.gif&quot;]]
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="147" name="daughterGymArms01" tags="noreturn chore" position="850,1850" size="100,100">&lt;!-- Requires daughter in the Gym --&gt;

As you enter the room you see $daughter.name in the middle of her workout. She&#39;s lying on one of the benches lifting a barbell behind her head. You&#39;re a bit jealous seeing her do excercises that you doubt you could ever even attempt. From this angle you can see right down her top and the light sheen of sweat on her breasts.

[img[setup.ImagePath + &quot;character/daughter/gym_overheadcurl01.gif&quot;]]

You so distracted that you miss a step. There&#39;s a loud crash as one of your bucket goes tumbling over. $daughter.name looks at you from her position ont he bench. You wait for her to call you out for being a perve but she just smiles devilishly and goes back to finishing her set.
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="148" name="daughterGymChinup01" tags="noreturn chore" position="975,1850" size="100,100">&lt;!-- Requires daughter in the Gym --&gt;

You back into the gym with you cleaning equipment and turn to see $daughter.name. She has her back to you and is currenlty halfway through a set of chin ups. Her skin is gleaming with sweat and her well defined shoulder muscles are straining with the effort. 

[img[setup.ImagePath + &quot;character/daughter/gym_chinups01.gif&quot;]]

You look down at your thin arms and wonder if you could even complete one chin up. $daughter.name drops to the ground after finsihing the set and turns around to grab her drink. As she&#39;s taking a long sip she turns slightly to let some of the water spalsh against her chest before feining surpsrise and wiping it away with her towel. She gives you a wink before turning around and starting another set.
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="149" name="daughterPoolSwimming01" tags="noreturn chore" position="1100,1850" size="100,100">&lt;!-- Requires daughter in the Pool --&gt;

$daughter.name is relaxing in the warm water of the pool. She doesn&#39;t notice you at first and you catch yourself staring at her body, her swimsuit holding tight against it.

[img[setup.ImagePath + &quot;character/daughter/pool_01.jpg&quot;]]

She takes a breath dips under the water. When she comes back up and open her eyes she sees you looking at her. $daughter.name smiles and winks at you.

&lt;&lt;= $daughter.speak(&quot;Care to join me?&quot;)&gt;&gt;

You jolt back to your senses when you realise you were still staring. &lt;&lt;= $player.speak(&quot;Um. I have to, uh.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Suit yourself.&quot;)&gt;&gt;

With that she dives forward and starts swimming laps and leaving you to awkwardly go about your day.
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="150" name="daughterPoolSwimming02" tags="noreturn chore" position="1225,1850" size="100,100">&lt;!-- Requires daughter in the Pool --&gt;

When you get to the large pool you can see $daughter.name here swimming laps.

[img[setup.ImagePath + &quot;character/daughter/pool_02.jpg&quot;]]

Your not a swimming expert but her pace seems pretty fast. It makes you wonder if you should&#39;ve taken up swimming to help develope your slim frame. You continue what you were doing and $daughter.name eventually finishes her session. $daughter.name spots you and then pushes herself up onto the edge of the pool, thrusting her chest out to give you a good view of her swimsuit.

&lt;&lt;= $daughter.speak(&quot;I think that was a new record for me. Care to try and beat it?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;I&#39;ve never been much of a swimmer.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Pity.&quot;)&gt;&gt;

$daughter.name walks over to where she put her towel. This time you catch yourself before you stare too long and then get back to your duties.
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;</tw-passagedata><tw-passagedata pid="151" name="daughterGardenReading01" tags="noreturn chore" position="100,1975" size="100,100">&lt;!-- Requires daughter in the Garden (Need to make sure this doesn&#39;t interrupt the special event in the Daughter Path) --&gt;

$daughter.name is resting under some shade with a small picnic and a pile of books nearby. The casual white dress she&#39;s wearing that flows down her toned body and stops just above her knees to show off her calves. This is one of the few times your see her wearing glasses as well. She has her long blonde hair loose and it glistens in the light.

[img[setup.ImagePath + &quot;character/daughter/garden_reading_01.jpg&quot;]]
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;</tw-passagedata><tw-passagedata pid="152" name="daughterDaughterBdRmStudying01" tags="noreturn chore" position="225,1975" size="100,100">&lt;!-- Requires daughter in the DaughterBdRm --&gt;

You knock on the door to $daughter.name&#39;s room. She calls for you to come in. You head inside with your cleaning supplies and see $daughter.name is sitting at her computer wth her glasses on. Normally she&#39;d tease you or say hi but it looks like she&#39;s pretty focused right now.

[img[setup.ImagePath + &quot;character/daughter/computer_01.jpg&quot;]]

You do your best not to disturb her as you to go about your business.</tw-passagedata><tw-passagedata pid="153" name="daughterDaughterBdRmStudying02" tags="noreturn chore" position="350,1975" size="100,100">&lt;!-- Requires daughter in the DaughterBdRm --&gt;

You know $daughter.name is normally in her room right now. There&#39;s no answer so you poke head and see she is sitting on the floor at the base of her bed with her laptop in front of her.

[img[setup.ImagePath + &quot;character/daughter/computer_02.jpg&quot;]]

She doesn&#39;t react to you entering so as you to go about your business and try not to distract her.</tw-passagedata><tw-passagedata pid="154" name="daughterLaundryTease01" tags="noreturn chore" position="475,1975" size="100,100">&lt;!-- Requires player in the Laundry and a high acceptance from the Daughter (set up the trigger but have the number be 100 so it doesn&#39;t active until we know what number will be appropriate) --&gt;

It takes a bit of time to collect everything from all the hampers but now you&#39;re ready to get the washing started. You&#39;re in the middle of separating all the various loads when $daughter.name comes in wearing her sweaty gym equipment.

&lt;&lt;= $daughter.speak(&quot;Whew. Just in time.&quot;)&gt;&gt;

You&#39;re about ask what for when $daughter.name takes her top off. The top is quickly followed by her shoes, socks and shorts. She is not wearing anything underneath them, at all.

&lt;&lt;= $daughter.speak(&quot;Throw these in with the rest will you.&quot;)&gt;&gt;

You stand stock still as she throws them to you. Some of the items land on your shoulders. You would react but you&#39;re pretty sure yor brain just got scramble.$daughter.name just giggle as she spins around and bounces out of the room.

It takes a long few minutes for your brain to reboot.

&lt;&lt;= $player.speak(&quot;What the hell just happened?&quot;)&gt;&gt;
&lt;&lt;= $player.increaseArousal(25)&gt;&gt;</tw-passagedata><tw-passagedata pid="155" name="daughterLaundryPlayerNude01" tags="noreturn chore" position="600,1975" size="100,100">&lt;!--
&lt;!-- When the player is doing the Laundry and the Daughter enters the room --&gt; --&gt;

Since you don&#39;t have any spare clothes that means you need to keep the one&#39;s you normally wear clean. You strip down and throw the few items you have in the wash and put it on a fast cycle.

It doesn&#39;t take too long so you busy yourself folding the washing that&#39;s already clean.

You bend down to put some of the linen away when the door to the laundry open.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;The lock you idiot!&lt;/i&gt;&quot;)&gt;&gt;

You spin around and see $daughter.name standing there, trying to use her hand to cover her large smile as she snickers.

&lt;&lt;= $daughter.speak(&quot;Um, I just wanted to stop in and say hi.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Aaah... Um.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Do you maybe want to cover up?&quot;)&gt;&gt;

You snatch up one of the nearby towels and quickly cover yourself.

&lt;&lt;= $daughter.speak(&quot;You know what? That&#39;s ok. You look busy.&quot;)&gt;&gt;

$daughter.name leaves and you hear her burst into laughter as soon as she&#39;s out of sight.

&lt;!-- Daughter interactive events --&gt;</tw-passagedata><tw-passagedata pid="156" name="choreEvent_DaughterChat02" tags="noreturn chore" position="725,1975" size="100,100">&lt;!-- player is in the same room in the house (not gym, garden, pool) --&gt;

As you are moving into the room $daughter.name arrives at the same time.

She smiles at you and says. &lt;&lt;= $daughter.speak(&quot;Hey $player.name.&quot;)&gt;&gt;

She walks and gives you a quick hug. &lt;&lt;= $daughter.speak(&quot;So what have you been up to?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;I know she&#39;s being nice but come on.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Just cleaning, same as always.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;It must be boring.&quot;)&gt;&gt; $daughter.name looks you up and down. &lt;&lt;= $daughter.speak(&quot;You should really get into the gym every once in a while. You&#39;re all skin and bones.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;I&#39;m in there plenty. Only to clean though.&quot;)&gt;&gt;

&lt;&lt;if $daughter.acceptance &gt;= 2&gt;&gt;
	&lt;&lt;= $daughter.speak(&quot;I might talk to Mum about giving you gym privaliges. Then maybe we could work out together. We cen build your stamina up and get you away from the daily grind.&quot;)&gt;&gt;

	You stammer for a moment at the opportunity for something new to do. &lt;&lt;= $player.speak(&quot;Uh... I mean... If you want. I would like that.&quot;)&gt;&gt; Never mind being close to $daughter.name in her gym clothes while you both work out.
&lt;&lt;else&gt;&gt;
	&lt;&lt;= $daughter.speak(&quot;Oh well. Chin up. I&#39;m sure things will get better for you eventually.&quot;)&gt;&gt;

	&lt;&lt;= $player.speak(&quot;Yeah. Sure.&quot;)&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Well. I&#39;ll talk to you later then.&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="157" name="daughterDaughterBdRmStudying03" tags="noreturn chore" position="850,1975" size="100,100">&lt;!-- Requires daughter in the DaughterBdRm and has a random % chance of occuring (todo: increase arousal) --&gt;

You enter $daughter.name&#39;s room. She&#39;s at her desk right now working on something but stops when she sees you come in.

&lt;&lt;= $daughter.speak(&quot;He $player.name. Perfect timing, can you have a look at something for me?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Ah... sure&quot;&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Awesome.&quot;)&gt;&gt;

$daughter.name stands up and you sit down at her tablet. There&#39;s a lot of technical data on the screen and you recognise a few words but mostly it looks like a foreign language.

&lt;&lt;= $daughter.speak(&quot;So I&#39;m trying find way to increase protein absorption to assist with skeletal reshaping in...&quot;)&gt;&gt;

$daughter.name starts talking but your can hardly under stand most of it. Aside from that she has already gotten very close. So much so that you can feel the warmth of her skin on your. You dfo your best to focus on what she is saying but you catch sight of something you can&#39;t resist.

[img[setup.ImagePath + &quot;character/daughter/studyflirt01.jpg&quot;]]

&lt;&lt;= $daughter.speak(&quot;Hello? Earth to $player.name.&quot;)&gt;&gt;

You don&#39;t know how long you were staring but $daughter.name stands back with her hands on her hips.

&lt;&lt;= $daughter.speak(&quot;Well, what do you think?&quot;)&gt;&gt;

Everything she said either made no sense or you missed it completely. Your brain scramble for something to say.

&lt;&lt;= $player.speak(&quot;I&#39;m sorry. This is all really cool but I don&#39;t have a lot of time to study this kind of thing so I&#39;m a little rusty.&quot;)&gt;&gt; You gesture to the cleaning products at the door.

$daughter.name follows your gesture and then turns back. &lt;&lt;= $daughter.speak(&quot;That&#39;s ok. To be honest just saying it all out aloud helped clear it up anyway. Thanks.&quot;)&gt;&gt;

She puts a hand you on the shoulder and smiles warmly. You just sit there a moment enjoying the friendly contact.

&lt;&lt;= $daughter.speak(&quot;Uh. I kind of need my seat back.&quot;)&gt;&gt;

You shoot up and nervously get back to what you are doing while $daughter.name giggles behind you.

&lt;&lt;set $time.addTime({day:0, hour: 0, minute:10})&gt;&gt;
&lt;&lt;option &quot;Sorry. Duty calls.&quot;&gt;&gt;
&lt;&lt;= $daughter.speak(&quot;Damn. I wish you had more free time.&quot;)&gt;&gt;

$daughter.name gets back to what she was doing and you do the same.

&lt;!-- Cook schedule events --&gt;</tw-passagedata><tw-passagedata pid="158" name="cookKitchenCutting01" tags="noreturn chore" position="975,1975" size="100,100">&lt;!-- Requires Cook in the Kitchen --&gt;

You can see $cook.name is here going about his business. You&#39;re a little concerned a stiff breeze might knock him over and it&#39;s slow going and he creeps around the room. Once he&#39;s back at the counter he completely changes pace. It&#39;s amazing watching him work though since he knows his setup like the back of his hand. He reaches for a knife without looking and immediately his speed changes and he has a plate of vegetables chopped in seconds.

[img[setup.ImagePath + &quot;character/cook/cutting01.gif&quot;]]

It gets you wondering where he learned those knife skills...

&lt;!-- Cook interactive events --&gt;</tw-passagedata><tw-passagedata pid="159" name="cookKitchenCutting02" tags="noreturn chore" position="1100,1975" size="100,100">&lt;!-- Requires Cook in the Kitchen and has a random % chance of occuring (todo: increase cooking skills) --&gt;

You can see $cook.name is here going about his business. It&#39;s nice to stop every now and then to watch him work, almost like when you used to watch those videos online that show flowers growing or wood being carved

[img[setup.ImagePath + &quot;character/cook/cutting01.gif&quot;]]

$cook.name catches you staring at him while he works.

&lt;&lt;= $cook.speak(&quot;If you&#39;re going to just stand there you might as well help out.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Assist $cook.name.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Sure.&quot;)&gt;&gt;

$cook.name once again surprises you buy having a small work space set up for you in moments and a stack of vegetables in front of you. You begin cutting them but it doesn&#39;t take long before you hear $cook.name grumbling.

&lt;&lt;= $cook.speak(&quot;You&#39;re not doing right. Here.&quot;)&gt;&gt;

He walks around behind you and reaches around to grab your arms. You stiffen up as his chest presses against your back.

&lt;&lt;= $cook.speak(&quot;You need to find a rythm.&quot;)&gt;&gt;

$cook.name guides your hands as he quickly help you slice what&#39;s in front of you.

&lt;&lt;= $cook.speak(&quot;Don&#39;t worry about the knife, worry about the food.&quot;)&gt;&gt;

You notice his fingers have slipped between yours and he&#39;s pressing against you in a very intimate way.

[img[setup.ImagePath + &quot;character/cook/cutting02.jpg&quot;]]

After few minutes everything is done and $cook.name steps away.

&lt;&lt;= $cook.speak(&quot;If you end up hurting yourself just make sure any mess in my kitchen gets cleaned up.&quot;)&gt;&gt;
&lt;&lt;set $cook.addAppreciation(1)&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 0, minute:10})&gt;&gt;
&lt;&lt;option &quot;Leave $cook.name to work.&quot;&gt;&gt;
You shake your head to say no and $cook.name hurumphs.

&lt;&lt;= $cook.speak(&quot;Then stop gawking. I&#39;m sure you&#39;ve got better things to do.&quot;)&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;!-- Gardner schedule events --&gt;

[&quot;Main Menu&quot;, &quot;Backgrounds&quot;, &quot;Settings&quot;, &quot;Music&quot;, &quot;Time&quot;, &quot;Dropdown Select&quot;, &quot;Capture&quot;].random()</tw-passagedata><tw-passagedata pid="160" name="gardnerGardenBossy01" tags="noreturn chore" position="1225,1975" size="100,100">&lt;!-- Player is sweeping the Garden, Gardner is present and has a random % chance of occuring --&gt;

After you finish up sweeping you so to put the broom back in the shed. The shed is fairly spacious since it holds everything $gardner.name needs to keep the grounds looking good. It&#39;s very disorganised but he knows where everything goes so you try your best to keep things as is. The only issue is that he&#39;s fairly tall so you have to reach most for anything not pile against a wall.

You&#39;re reaching to put the broom back when you slip and tilt forward suddenly. You let go of the broom and brace yourself on the bench in front of you. The broom just barely catches the hook before it slips off and clatters into another pile of tools.

$gardner.name is in the shed before you can even push away from the counter.

&lt;&lt;= $gardner.speak(&quot;A little too difficult for you huh?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;How did he get in here so fast?&lt;/i&gt;&quot;)&gt;&gt;

$gardner.name walks up behind you and reaches forward to grab the broom. &lt;&lt;= $gardner.speak(&quot;Here, let me help.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Let him help.&quot;&gt;&gt;

His long arm grabs the broom handle but not before his chest presses up against your back. Positioned how you are it pushes you up against the counter. Given his size you would probably have a hard time getting free right now.

&lt;&lt;= $gardner.speak(&quot;You know if this is too hard for you I can find something a bit easier?&quot;)&gt;&gt;

You can feel his warm breath on you ear and his crotch presses up against your butt. You&#39;re pretty sure that&#39;s not a flashlight in his pocket although it feels as hard as one.

&lt;&lt;= $player.speak(&quot;Um... what you have me doing is fine thank you.&quot;)&gt;&gt;

&lt;&lt;= $gardner.speak(&quot;Suit yourself.&quot;)&gt;&gt;

$gardner.name hangs up the broom and pushes away from you leaving you to finish up.
&lt;&lt;set $gardner.addAppreciation(1)&gt;&gt;
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;
&lt;&lt;option &quot;Say you&#39;ve got it.&quot;&gt;&gt;

&lt;&lt;= $gardner.speak(&quot;Suit yourself. Just be sure you don&#39;t make a mess.&quot;)&gt;&gt;

You quickly pick up the broom and hang it on its hook before finishing up.
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="161" name="gardnerPoolBossy01" tags="noreturn chore" position="100,2100" size="100,100">&lt;!-- Player is sweeping the Pool, Gardner is present and has a random % chance of occuring --&gt;

$gardner.name is spraying down the windwos while you tidy up the leaves and other loose debris. It&#39;s seems a littel backwards for him to be doing this before you&#39;ve finished sweeping but you&#39;re pretty sure if you question his method it will be followed by a talk about him being the grounds keeper and not you.

You turn to grab you bag of clippings when a gush of water pours over you.

&lt;&lt;= $gardner.speak(&quot;Woah! Watch it there.&quot;)&gt;&gt;

You&#39;re quickly soaked from head to toe in water with $gardner.name standing there and quickly turning his hose off.

&lt;&lt;= $gardner.speak(&quot;Quick, come here and I&#39;ll dry you off.&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Let him help.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Um... thanks.&quot;)&gt;&gt;

$gardner.name takes one of the nearby towels and wraps it around you. He pulls you very close as her rubs your shoulder and then wraps his arm around you to dry your back. You can smell fresh cut grass and flowers on his clothes. He keeps toweling you off and you jostle about in his strong embrace. Eventually  you end pressed up against his chest.

&lt;&lt;= $player.speak(&quot;You&#39;re getting all wet.&quot;)&gt;&gt;

&lt;&lt;= $gardner.speak(&quot;That&#39;s ok. Just making sure you&#39;re comfortable.&quot;)&gt;&gt;

A particularly hard shove presses your against his groin and you can feel either the handle of one of his tools or...

&lt;&lt;= $gardner.speak(&quot;There you go.&quot;)&gt;&gt; $gardner.name abruptly steps back leaving you dryer and a little confused. &lt;&lt;= $gardner.speak(&quot;Make sure you&#39;re more careful. We don&#39;t want you getting sick.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Sure.&quot;)&gt;&gt;

You pick up the broom and get back to work.

&lt;&lt;set $gardner.addAppreciation(1)&gt;&gt;
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;
&lt;&lt;option &quot;Just grab a towel and dry yourself.&quot;&gt;&gt;
Ignoring him you reach down to grab one of the towels laying nearby and just start drying yourself off as best you can.

&lt;&lt;= $gardner.speak(&quot;Suit yourself. If you catch a chill it&#39;s not on me.&quot;)&gt;&gt;

$gardner.name keeps cleaning the windows while you dry off and then finish up what you were doing.
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;!-- Player Solo Events --&gt;</tw-passagedata><tw-passagedata pid="162" name="gardenRelax01" tags="noreturn chore" position="225,2100" size="100,100">&lt;!--  --&gt;

&lt;!-- Group Events --&gt;</tw-passagedata><tw-passagedata pid="163" name="breakfastPJs01" tags="noreturn chore" position="350,2100" size="100,100">&lt;!-- Random % chance during [wakeUp] (todo: auto fails weekly chores) --&gt;

&lt;&lt;= $wife.speak(&quot;Good morning dear.&quot;)&gt;&gt;

$wife.name enteres the dining room and give $owner.name a quick peck on the cheek. She decided to come to breakfast still in her long silk dressing gown. The deep purple fabric shimmers as she takes a seat next to her husband. You come over to pour some tea when she gestures with her cup. As the steam rises you lose focus on the task for a moment. 

$wife.name&#39;s dressing gown has come undone slightly and revealed her bosom underneath. She&#39;s wearing a lacey red bra underneath that&#39;s almost transparent making it revealing in a very sexy way.

&lt;&lt;chooseOption &quot;Keep looking.&quot;&gt;&gt;
The sight is very enticing. You swear if you angle forward just a bit you might able to see a bit more. Unfortunately...

&lt;&lt;= $wife.speak(&quot;Ouch!&quot;)&gt;&gt;

The teacup clatters to the ground as $wife.name shakes her hand from where it overflowed and the hot water got on her. She looks at you and sands up, clearly furious.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;I&#39;m dead.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;Dear.&quot;)&gt;&gt;

You both tuRn to $owner.title. He&#39;s staring strait at you with that calm, intense look.

&lt;&lt;= $owner.speak(&quot;I think you need to apologise $player.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Is that all?&quot;)&gt;&gt;

$owner.title holds up his hand and gestures for you to apologise to $wife.name.

&lt;&lt;= $player.speak(&quot;Sorry $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;No. On your knees.&quot;)&gt;&gt;

$wife.name grins evily and your cheeks flush. If it was someone other than $owner.name you might protest but you know better.

You drop to your knees and apologise again.

&lt;&lt;= $owner.speak(&quot;Lower.&quot;)&gt;&gt; He says calmly.

You bow slightly.

&lt;&lt;= $owner.speak(&quot;Lower.&quot;)&gt;&gt;

He continues until your head is touching the ground and you are prostrating yourself in front of $wife.name.

&lt;&lt;= $player.speak(&quot;Sorry $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Don&#39;t worry about it $player.name.&quot;)&gt;&gt; She pats the back of your head gently with her foot. &lt;&lt;= $wife.speak(&quot;I&#39;m sure you just did it for some attention but be sure you&#39;re more careful next time.&quot;)&gt;&gt;

She sits back down and everyone else gets back to their breakfast as if nothing had happened. You, however are very careful to pay attention to what you are doing and shift nervously everytime $owner.title looks up.

&lt;&lt;link &quot;Return to your room.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $time.addTime({day:0, hour: 1, minute: 0})&gt;&gt;
&lt;&lt;set $player.submission += 1&gt;&gt;
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Pay attention.&quot;&gt;&gt;
You decide to focus on what you are doing. The teacup is almost full and you manage to catch yourself before it spills over. You finish off by adding a dolop of cream and then continue serving the rest of breakfast.
[[Return to your room.|PlayerBdRm]]
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="164" name="breakfastPJs02" tags="noreturn chore" position="475,2100" size="100,100">&lt;!-- Random % chance during [wakeUp] --&gt;

Breakfast is almost halfway done when $daughter.name pads in to the room rubbing her eyes. It was clearly a long night her. Her blonde hair is bairly kept back in a loose ponytail and her eyes are bloodshot. This doesn&#39;t detract fromt he fact she&#39;s wearing nothing but a lacey black thong and a white tanks top that is so thin you can see the outline of her nipples underneath.

&lt;&lt;= $wife.speak(&quot;$daughter.name, really?&quot;)&gt;&gt;

$daughter.name mumbles something incoherant before sitting at the table. She quickly down a glass of juice and then begins to to devouring whatever is within her reach. $butler.name coughs from beside you and you jump a little before getting back to work.

You bring another glass of juice over. $daughter.name takes a swig while her mouth is still half full of some pastry. One of the strap of her top has slid down her shoulder but you can&#39;t quite see anything from this angle.

There are some plates nearby that are close enough to empty that you could clear them.

&lt;&lt;chooseOption &quot;Steal a glance as you do.&quot;&gt;&gt;
You lean forward to reach for the plates. A glance to the side show the top has ridden down far enough that the hem is being just barely held up by her nippple. One small jostle is all it would take for it to...

&lt;&lt;= $owner.speak(&quot;$player.title.&quot;)&gt;&gt;

$owner.name is looking strait at you and you shoot back up strait.

&lt;&lt;= $player.speak(&quot;Yes $owner.title.&quot;)&gt;&gt;

He stares at you for a long moment, so long that you shift uncomfortabley. $owner.name turns to $wife.name.

&lt;&lt;= $owner.speak(&quot;Take care of this little problem for the day before you leave dear.&quot;)&gt;&gt;

$wife.name was watching silently eating her own food the whole time. She smiles at him and pats his cheek affectionately.

&lt;&lt;= $wife.speak(&quot;Of course dear.&quot;)&gt;&gt; She stands up and $butler.name pulls her chair back quickly. &lt;&lt;= $wife.speak(&quot;Come with me $player.name.&quot;)&gt;&gt;

You fall in behind her and she leads you to the master bedroom. You heart sinks as $wife.name walks into the dressing room and you realise what is about to happen. She pulls out the familiar pink cage.

&lt;&lt;= $wife.speak(&quot;My husband really doesn&#39;t like people ogling his daughter. Come on.&quot;)&gt;&gt; She gestures for you to take you pants off.

Once they are off $wife.name kneels down in fron of you. &lt;&lt;= $wife.speak(&quot;You know he wanted to keep it on you all day, everyday but I managed to talk him out of it.&quot;)&gt;&gt; 

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Gee, thanks...&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;I can put it on myself $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Hush.&quot;)&gt;&gt;She slips the plastc cage over your manhood and locks it shut with a click. &lt;&lt;= $wife.speak(&quot;There you go. Safely sealed away so you don&#39;t have any more naughty urges. You can come back for the key at the end of the day.&quot;)&gt;&gt;

$wife.name stands and leaves you to pull your pants back up and hurry back the dining room.
&lt;&lt;link &quot;Return to your room.&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;= $player.inv.addItem($shop.getAsTemp(&quot;Pink chastity cage&quot;), 1, true)&gt;&gt;
&lt;&lt;= $player.increaseArousal(10)&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Just clear the plates.&quot;&gt;&gt;
You take the plates and put them on a tray before heading back to the kitchen.

As you do you see $owner.name watching you from behind his tablet. You suspect you dodged a bullet on that one.
[[Return to your room.|PlayerBdRm]]
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="165" name="DocumentationInit" tags="init" position="600,2100" size="100,100">&lt;&lt;set $tooltips to {
	&quot;disable-tips&quot; : &quot;Tooltips can be disabled in the settings tab, accessible through the bar on the left.&quot;
}&gt;&gt;</tw-passagedata><tw-passagedata pid="166" name="bodyPartInit" tags="init" position="725,2100" size="100,100">&lt;!-- todo --&gt;

&lt;&lt;set $bodyPart to {
	desc: {
		hairColor : [
			&quot;brown&quot;, &quot;black&quot;, &quot;brown&quot;, &quot;aubrun&quot;
		],
		hairLength : [
			&quot;short&quot;, &quot;medium&quot;, &quot;long&quot;
		],
		eyeColor : [
			&quot;blue&quot;, &quot;brown&quot;, &quot;black&quot;
		],
		face: [
			&quot;Your face is fairly plain and ordinary, almost like a blank slate. You don&#39;t exactly turn any heads which is probably why you&#39;ve never been on a date before.&quot;
		],
		lips: [
			&quot;You have flat, average lips.&quot;
		],
		skin: [
			&quot;Your skin is pale with a smattering of blemishes on it. There&#39;s one the stands out more that the rest that you really wish you could get rid of.&quot;
		],
		chest: [
			&quot;You don&#39;t really exercise so your chest isn&#39;t much to look at.&quot;
		],
		butt: [
			&quot;Your butt barely has any definition. Maybe if you exercised, but as it is, some might even call it flat.&quot;
		],
		hips: [
			&quot;Yep. One set of skinny hips.&quot;
		],
		crotch: [
			&quot;You would call your penis average. At least that&#39;s what you tell yourself.&quot;
		],
		legs: [
			&quot;Your skinny legs have a fair amount of hair on them. There&#39;s barely any hint of muscle.&quot;
		]
	}
}&gt;&gt;</tw-passagedata><tw-passagedata pid="167" name="characterInit" tags="init" position="850,2100" size="100,100">&lt;&lt;script&gt;&gt;
//-- PLAYER --------------------------------------------------------------------

State.variables.player = new Player();

//-- NPC -----------------------------------------------------------------------

State.variables.owner = new NPC({
	name: &quot;Mr Sono&quot;,
	color: {
		light: &quot;#2C302E&quot;,
		dark: &quot;#555958&quot;
	},
	title: &quot;Sir&quot;,
	displayPos: true
});
State.variables.owner.schedule.currRoom = &quot;MasterBdRm&quot;;
State.variables.owner.schedule.addPoint(&quot;Dining&quot;, {hour: 6, minute:0}, {hour: 8, minute: 0});
State.variables.owner.schedule.addPoint(&quot;Void&quot;, {hour: 8, minute:0}, {hour: 18, minute: 0});
State.variables.owner.schedule.addPoint(&quot;Office&quot;, {hour: 18, minute: 0}, {hour: 20, minute: 0});
State.variables.owner.schedule.addPoint(&quot;Lounge&quot;, {hour: 20, minute: 0}, {hour: 22, minute: 0});
State.variables.owner.schedule.addPoint(&quot;MasterBdRm&quot;, {hour: 22, minute: 0}, {hour: 6, minute: 0});

State.variables.wife = new NPC({
	name: &quot;Mrs Sono&quot;,
	color: {
		light: &quot;#621708&quot;, 
		dark: &quot;#81412F&quot;
	}, 
	title: &quot;Ma&#39;am&quot;,
	displayPos: true
});
State.variables.wife.schedule.currRoom = &quot;MasterBdRm&quot;;
State.variables.wife.schedule.addPoint(&quot;Dining&quot;, {hour: 6, minute:0}, {hour: 8, minute: 0});
State.variables.wife.schedule.addPoint(&quot;Void&quot;, {hour: 8, minute: 0}, {hour: 15, minute: 0});
State.variables.wife.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 15, minute: 0}, {hour: 16, minute: 0});
State.variables.wife.schedule.addPoint(&quot;Office&quot;, {hour: 16, minute: 0}, {hour: 18, minute: 0});
State.variables.wife.schedule.addPoint(&quot;Gym&quot;, {hour: 18, minute:0}, {hour: 20, minute: 0});
State.variables.wife.schedule.addPoint(&quot;Lounge&quot;, {hour: 20, minute: 0}, {hour: 22, minute: 0});
State.variables.wife.schedule.addPoint(&quot;MasterBdRm&quot;, {hour: 22, minute: 0}, {hour: 6, minute: 0});

State.variables.daughter = new NPC({
	name: &quot;Angeline&quot;,
	color: {
		light: &quot;#D0918A&quot;, 
		dark: &quot;#D0918A&quot;
	}, 
	title: &quot;Ms Sono&quot;,
	displayPos: true
});
State.variables.daughter.schedule.currRoom = &quot;DaughterBdRm&quot;;
State.variables.daughter.schedule.addPoint(&quot;Dining&quot;, {hour: 6, minute:0}, {hour: 8, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 8, minute:0}, {hour: 9, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;Gym&quot;, {hour: 9, minute:0}, {hour: 11, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;Pool&quot;, {hour: 11, minute:0}, {hour: 12, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 12, minute:0}, {hour: 13, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;Garden&quot;, {hour: 13, minute:0}, {hour: 15, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;DaughterBdRm&quot;, {hour: 15, minute:0}, {hour: 18, minute: 0});
State.variables.daughter.schedule.addPoint(&quot;Void&quot;, {hour: 18, minute:0}, {hour: 6, minute: 0});

State.variables.son = new NPC({
	name: &quot;Mr Sono&quot;, 
	color: {
		light: &quot;#69A8AD&quot;, 
		dark: &quot;#69A8AD&quot;
	}, 
	title: &quot;Mr Sono&quot;,
	displayPos: false
});
State.variables.son.schedule.currRoom = &quot;SonBdRm&quot;;
State.variables.son.schedule.addPoint(&quot;Void&quot;, {hour: 0, minute:0}, {hour: 24, minute: 0});

State.variables.butler = new NPC({
	name: &quot;Mr Benson&quot;, 
	color: {
		light: &quot;#634669&quot;, 
		dark: &quot;#634669&quot;
	}, 
	title: &quot;Mr Benson&quot;,
	displayPos: true
});
State.variables.butler.schedule.currRoom = &quot;Lounge&quot;;
State.variables.butler.schedule.addPoint(&quot;Dining&quot;, {hour: 6, minute:0}, {hour: 8, minute: 0});
State.variables.butler.schedule.addPoint(&quot;Void&quot;, {hour: 8, minute:0}, {hour: 18, minute: 0});
State.variables.butler.schedule.addPoint(&quot;Office&quot;, {hour: 18, minute: 0}, {hour: 20, minute: 0});
State.variables.butler.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 20, minute:0}, {hour: 6, minute: 0});
State.variables.butler.schedule.addPoint(&quot;Void&quot;, {hour: 22, minute: 0}, {hour: 6, minute: 0});

State.variables.therapist = new NPC({
	name: &quot;Liv&quot;,
	color: {
		light: &quot;#621708&quot;, 
		dark: &quot;#81412F&quot;
	}, 
	title: &quot;Dr Miller&quot;,
	displayPos: true
});
State.variables.therapist.schedule.currRoom = &quot;Void&quot;;
//State.variables.therapist.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 8, minute:0}, {hour: 12, minute: 30});
State.variables.therapist.schedule.addPoint(&quot;Void&quot;, {hour:12, minute: 30}, {hour: 8, minute:30});

State.variables.cook = new NPC({
	name: &quot;Ivan&quot;, 
	color: {
		light: &quot;#E2B05D&quot;, 
		dark: &quot;#F6C467&quot;
	}, 
	title: &quot;Cook&quot;,
	displayPos: true
});
State.variables.cook.schedule.currRoom = &quot;Kitchen&quot;;
State.variables.cook.schedule.addPoint(&quot;Kitchen&quot;, {hour: 12, minute:0}, {hour: 16, minute: 0});
State.variables.cook.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 16, minute:0}, {hour: 17, minute: 0});
State.variables.cook.schedule.addPoint(&quot;Kitchen&quot;, {hour: 17, minute:0}, {hour: 20, minute: 0});
State.variables.cook.schedule.addPoint(&quot;Void&quot;, {hour: 20, minute: 0}, {hour: 12, minute: 0});

State.variables.gardner = new NPC({
	name: &quot;Juan&quot;, 
	color: {
		light: &quot;#00916E&quot;, 
		dark: &quot;#00916E&quot;
	}, 
	title: &quot;Juan&quot;,
	displayPos: true
});
State.variables.gardner.schedule.currRoom = &quot;Garden&quot;;
State.variables.gardner.schedule.addPoint(&quot;Garden&quot;, {hour: 6, minute:0}, {hour: 12, minute: 0});
State.variables.gardner.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 12, minute:0}, {hour: 13, minute: 0});
State.variables.gardner.schedule.addPoint(&quot;Pool&quot;, {hour: 13, minute:0}, {hour: 15, minute: 0});
State.variables.gardner.schedule.addPoint(&quot;Void&quot;, {hour: 15, minute:0}, {hour: 6, minute: 0});

State.variables.caterer = new NPC({
	name: &quot;Mason&quot;, 
	color: {
		light: &quot;#EE6123&quot;, 
		dark: &quot;#EE6123&quot;
	}, 
	title: &quot;Chef&quot;,
	displayPos: false
});
State.variables.caterer.schedule.currRoom = &quot;Void&quot;;
//State.variables.caterer.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 8, minute:0}, {hour: 12, minute: 30});
State.variables.caterer.schedule.addPoint(&quot;Void&quot;, {hour:12, minute: 30}, {hour: 8, minute:30});

State.variables.suitor = new NPC({
	name: &quot;Rick&quot;, 
	color: {
		light: &quot;#D08816&quot;, 
		dark: &quot;#D08816&quot;
	}, 
	title: &quot;Mr Stone&quot;,
	displayPos: false
});
State.variables.suitor.schedule.currRoom = &quot;Void&quot;;
//State.variables.suitor.schedule.addPoint(&quot;FreeRoam&quot;, {hour: 8, minute:0}, {hour: 12, minute: 30});
State.variables.caterer.schedule.addPoint(&quot;Void&quot;, {hour:12, minute: 30}, {hour: 8, minute:30});

window.npcList = [
	&quot;owner&quot;, 
	&quot;wife&quot;, 
	&quot;daughter&quot;, 
	&quot;son&quot;, 
	&quot;butler&quot;, 
	&quot;cook&quot;, 
	&quot;gardner&quot;, 
	&quot;caterer&quot;, 
	&quot;suitor&quot;
];

State.variables.minorNPC = [];
&lt;&lt;/script&gt;&gt;</tw-passagedata><tw-passagedata pid="168" name="choresInit" tags="init" position="975,2100" size="100,100">&lt;!--  Chores  --&gt;

&lt;&lt;= $mansion.addChore(&quot;Foyer&quot;, new Chore({
	name: &quot;Clean Foyer&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;foyerCleaning&quot;, weight:1}, 
		{name: &quot;foyerSweepMop&quot;, weight: 2}, 
		{name: &quot;foyerDusting&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [1])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;LowerHall&quot;, new Chore({
	name: &quot;Clean Hall&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;hallCleaning&quot;, weight:1}, 
		{name: &quot;hallDusting&quot;, weight: 2}, 
		{name: &quot;hallSweepMop&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [1])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;UpperHall&quot;, new Chore({
	name: &quot;Clean Upper Hall&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;hallCleaning&quot;, weight:1}, 
		{name: &quot;hallDusting&quot;, weight: 2}, 
		{name: &quot;hallSweepMop&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [4])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Garden&quot;, new Chore({
	name: &quot;Clean Garden&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;gardenCleaning&quot;, weight:1}, 
		{name: &quot;gardenSweep&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [5])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Pool&quot;, new Chore({
	name: &quot;Clean Pool&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;poolCleaning&quot;, weight:1}, 
		{name: &quot;poolSweep&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [5])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Kitchen&quot;, new Chore({
	name: &quot;Do the dishes in the kitchen&quot;,
	duration: {minute: 30}, 
	passages: [
		{name: &quot;kitchenDishes&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [2])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Kitchen&quot;, new Chore({
	name: &quot;Clean the kitchen&quot;, 
	duration: {minute:30}, 
	passages:[
		{name: &quot;kitchenClean&quot;, weight: 1},
		{name: &quot;kitchenSweepMop&quot;, weight: 1}
	], 
	staminaCost: 10,
}), [2])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Laundry&quot;, new Chore({
	name: &quot;Wash Linen in the laundry&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;laundryLinen&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [2])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Laundry&quot;, new Chore({
	name: &quot;Wash Clothes in the laundry&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;laundryClothes&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [2])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Lounge&quot;, new Chore({
	name: &quot;Clean Lounge&quot;, 
	duration: {hour: 2}, 
	passages:[
		{name: &quot;loungeCleaning&quot;, weight:1}, 
		{name: &quot;loungeDusting&quot;, weight: 2}, 
		{name: &quot;loungeSweepMop&quot;, weight: 2}, 
		{name: &quot;loungeWindows&quot;, weight: 2}
	], 
	staminaCost: 2, 
}), [3])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Dining&quot;, new Chore({
	name: &quot;Clean Dining Room&quot;, 
	duration: {hour: 2}, 
	passages:[
		{name: &quot;diningCleaning&quot;, weight:1}, 
		{name: &quot;diningDusting&quot;, weight: 2}, 
		{name: &quot;diningSweepMop&quot;, weight: 2}, 
		{name: &quot;diningWindows&quot;, weight: 2}
	], 
	staminaCost: 2, 
}), [3])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;MasterBdRm&quot;, new Chore({
	name: &quot;Clean Master Bedroom&quot;, 
	duration: {hour: 1},
	passages:[
		{name: &quot;masterBdRmCleaning&quot;, weight:1}, 
		{name: &quot;masterBdRmDusting&quot;, weight: 2}, 
		{name: &quot;masterBdRmVacuum&quot;, weight: 2}, 
		{name: &quot;masterBdRmWindows&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [3])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;MasterBathRm&quot;, new Chore({
	name: &quot;Clean Master Bathroom&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;masterBathRmCleaning&quot;, weight:1}, 
		{name: &quot;masterBathRmSweepMop&quot;, weight: 2}, 
		{name: &quot;masterBathRmSink&quot;, weight: 2}, 
		{name: &quot;masterBathRmToilet&quot;, weight: 2}, 
		{name: &quot;masterBathRmShower&quot;, weight: 2}, 
		{name: &quot;masterBathRmBath&quot;, weight: 2}
	], 
	staminaCost: 2, 
}), [3])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Office&quot;, new Chore({
	name: &quot;Clean Office&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;officeCleaning&quot;, weight:1}, 
		{name: &quot;officeDusting&quot;, weight: 2}, 
		{name: &quot;officeVacuum&quot;, weight: 2}, 
		{name: &quot;officeWindows&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [1])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;Gym&quot;, new Chore({
	name: &quot;Clean Gym&quot;, 
	duration: {hour: 2}, 
	passages:[
		{name: &quot;gymCleaning&quot;, weight:1}, 
		{name: &quot;gymSweepMop&quot;, weight: 2}, 
		{name: &quot;gymWindows&quot;, weight: 2}
	], 
	staminaCost: 2, 
}), [5])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;PlayerBdRm&quot;, new Chore({
	name: &quot;Tidy your room&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;playerBdRmCleaning&quot;, weight:1}, 
		{name: &quot;playerBdRmClean&quot;, weight: 1}
	], 
	staminaCost: 10, 
}), [1])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;DaughterBdRm&quot;, new Chore({
	name: &quot;Clean the daughter&#39;s bedroom&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;daughterBdRmcleaning&quot;, weight:1}, 
		{name: &quot;daughterBdRmDusting&quot;, weight: 2}, 
		{name: &quot;daughterBdRmVacuum&quot;, weight: 2}, 
		{name: &quot;daughterBdRmWindows&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [4])&gt;&gt;
&lt;&lt;= $mansion.addChore(&quot;GuestRm&quot;, new Chore({
	name: &quot;Clean the guest room&quot;, 
	duration: {hour: 1}, 
	passages:[
		{name: &quot;guestRmCleaning&quot;, weight:1}, 
		{name: &quot;guestRmDusting&quot;, weight: 2}, 
		{name: &quot;guestRmVacuum&quot;, weight: 2}, 
		{name: &quot;guestRmWindows&quot;, weight: 2}
	], 
	staminaCost: 10, 
}), [4])&gt;&gt;</tw-passagedata><tw-passagedata pid="169" name="eventInit" tags="event" position="1100,2100" size="100,100">&lt;!-- Unique events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;specialEvent&quot;, new Event({
	name: &quot;End of the week review&quot;,
	passage: &quot;endOfWeekRecapStart&quot;,
	inline:false,
	repeats:true,
	tags: {tag: &quot;every&quot;, data: [
		{tag : &quot;day&quot;, data: {day: &quot;Sunday&quot;}, expected: true},
		{tag : &quot;time&quot;, data: {time: &quot;Evening&quot;}, expected: true},
	], expected: true}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;specialEvent&quot;, new Event({
	name: &quot;Something feels different.&quot;,
	passage: &quot;mansionCPartyIntro01&quot;,
	inline: false,
	repeats: false,
	tags: {tag: &quot;every&quot;, data: [
		{tag : &quot;weekEven&quot;, data: {}, expected: false},
		{tag : &quot;day&quot;, data: {day: &quot;Saturday&quot;}, expected: true},
		{tag : &quot;time&quot;, data: {time: &quot;Morning&quot;}, expected: true},
	], expected: true}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;specialEvent&quot;, new Event({
	name: &quot;Time to get the cage off.&quot;,
	passage: &quot;therapistPathStart01&quot;,
	inline: false,
	repeats: false,
	tags: {
		tag: &quot;flag&quot;, data: {flag: &quot;therapyPathStart&quot;, state: 1}, expected: true
	}
}))&gt;&gt;

&lt;!-- Wife schedule events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;Office&quot;, new Event({
	name: &quot;wifeOffice01&quot;, 
	passage: &quot;wifeOffice01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;wife&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;wifeGym01&quot;, 
	passage: &quot;wifeGym01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;wife&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;wifeGym02&quot;, 
	passage: &quot;wifeGym02&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;wife&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;wifeGym03&quot;, 
	passage: &quot;wifeGym03&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;wife&quot;}, expected: true
	}
}))&gt;&gt;

&lt;!-- Daughter events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;daughterGymSquat01&quot;, 
	passage: &quot;daughterGymSquat01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;daughterGymArms01&quot;, 
	passage: &quot;daughterGymArms01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Gym&quot;, new Event({
	name: &quot;daughterGymChinup01&quot;, 
	passage: &quot;daughterGymChinup01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Pool&quot;, new Event({
	name: &quot;daughterPoolSwimming01&quot;, 
	passage: &quot;daughterPoolSwimming01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Pool&quot;, new Event({
	name: &quot;daughterPoolSwimming02&quot;, 
	passage: &quot;daughterPoolSwimming02&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Garden&quot;, new Event({
	name: &quot;daughterGardenReading01&quot;, 
	passage: &quot;daughterGardenReading01&quot;, 
	inline:true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;DaughterBdRm&quot;, new Event({
	name: &quot;daughterDaughterBdRmStudying01&quot;, 
	passage: &quot;daughterDaughterBdRmStudying01&quot;, 
	inline:true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;DaughterBdRm&quot;, new Event({
	name: &quot;daughterDaughterBdRmStudying02&quot;, 
	passage: &quot;daughterDaughterBdRmStudying02&quot;, 
	inline:true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;DaughterBdRm&quot;, new Event({
	name: &quot;daughterDaughterBdRmStudying03&quot;, 
	passage: &quot;daughterDaughterBdRmStudying03&quot;, 
	inline:true, 
	repeats:true,
	tags: {
		tag: &quot;every&quot;, data: [{
			tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
		},{
			tag: &quot;appreciation&quot;, data: {npc: &quot;daughter&quot;, value: 1}, expeceted: true
		}], expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Lounge&quot;, new Event({
	name: &quot;choreEvent_DaughterChat02&quot;, 
	passage: &quot;choreEvent_DaughterChat02&quot;, 
	inline:true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
	}
}))&gt;&gt;

&lt;!-- Daughter story events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;Garden&quot;, new Event({
	name: &quot;daughterPath03GardenChatA&quot;, 
	passage: &quot;daughterPath03GardenChatA&quot;, 
	inline:true, 
	repeats:false,
	tags: {
		tag: &quot;every&quot;, data: [{
			tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
		},{
			tag: &quot;appreciation&quot;, data: {npc: &quot;daughter&quot;, value: 1}, expected: true
		}], expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Foyer&quot;, new Event({
	name: &quot;daughterPath04IntroDate01&quot;, 
	passage: &quot;daughterPath04IntroDate01&quot;, 
	inline:true, 
	repeats:false, 
	tags: {
		tag: &quot;every&quot;, data: [{
			tag: &quot;day&quot;, data: {day: &quot;Thursday&quot;}, expected: true
		},{
			tag: &quot;isPresent&quot;, data: {npc: &quot;daughter&quot;}, expected: true
		},{
			tag: &quot;appreciation&quot;, data: {npc: &quot;daughter&quot;, value: 2}, expeceted: true
		}], expected: true
	}
}))&gt;&gt;

&lt;!-- Group events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;Lounge&quot;, new Event({
	name: &quot;wifeOwnerLounge01&quot;, 
	passage: &quot;wifeOwnerLounge01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;every&quot;, data: [{
			tag: &quot;isPresent&quot;, data: {npc: &quot;wife&quot;}, expected: true
		},{
			tag: &quot;isPresent&quot;, data: {npc: &quot;owner&quot;}, expected: true
		}], expected: true
	}
}))&gt;&gt;

&lt;!-- Cook events --&gt;

&lt;&lt;= $mansion.addEvent(&quot;Kitchen&quot;, new Event({
	name: &quot;cookKitchenCutting01&quot;, 
	passage: &quot;cookKitchenCutting01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;cook&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Kitchen&quot;, new Event({
	name: &quot;cookKitchenCutting02&quot;, 
	passage: &quot;cookKitchenCutting02&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;cook&quot;}, expected: true
	}
}))&gt;&gt;

&lt;!-- Gardner events

&lt;&lt;= $mansion.addEvent(&quot;Garden&quot;, new Event({
	name: &quot;gardnerGardenBossy01&quot;, 
	passage: &quot;gardnerGardenBossy01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;gardner&quot;}, expected: true
	}
}))&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Pool&quot;, new Event({
	name: &quot;gardnerPoolBossy01&quot;, 
	passage: &quot;gardnerPoolBossy01&quot;, 
	inline: true, 
	repeats:true, 
	tags: {
		tag: &quot;isPresent&quot;, data: {npc: &quot;gardner&quot;}, expected: true
	}
}))&gt;&gt;

 --&gt;</tw-passagedata><tw-passagedata pid="170" name="clothesInit" tags="init" position="1225,2100" size="100,100">&lt;&lt;set $shop to new Shop({name: &quot;Main shop&quot;, id:&quot;shop&quot;})&gt;&gt;

&lt;&lt;= $shop.addCategory(&quot;Wig&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Top&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Dress&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Bottom&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Bra&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Underwear&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Hoisery&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Shoes&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Accessory&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Toys&quot;)&gt;&gt;
&lt;&lt;= $shop.addCategory(&quot;Items&quot;)&gt;&gt;

&lt;!-- Wigs --&gt;

&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Short Black Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	color: &quot;black&quot;,
	length: &quot;short&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Short Brown Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	color: &quot;brown&quot;,
	length: &quot;short&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Short Blonde Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	color: &quot;blonde&quot;,
	length: &quot;short&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Short Aubrun Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	color: &quot;aubrun&quot;,
	length: &quot;short&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Medium Black Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	color: &quot;black&quot;,
	length: &quot;medium&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Medium Brown Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	color: &quot;brown&quot;,
	length: &quot;medium&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Medium Blonde Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	color: &quot;blonde&quot;,
	length: &quot;medium&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Medium Aubrun Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	color: &quot;aubrun&quot;,
	length: &quot;medium&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Long Black Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 20,
	price: 0,
	color: &quot;black&quot;,
	length: &quot;long&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Long Brown Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 20,
	price: 0,
	color: &quot;brown&quot;,
	length: &quot;long&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Long Blonde Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 20,
	price: 0,
	color: &quot;blonde&quot;,
	length: &quot;long&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Wig&quot;, {
	name: &quot;Long Aubrun Wig&quot;,
	tags: [&quot;wig&quot;, &quot;equippable&quot;],
	femininity: 20,
	price: 0,
	color: &quot;aubrun&quot;,
	length: &quot;long&quot;
}, 1)&gt;&gt;

&lt;!-- Underwear --&gt;

&lt;&lt;= $shop.addItem(&quot;Underwear&quot;, {
	name: &quot;Pink stripped panties&quot;,
	tags: [&quot;underwear&quot;, &quot;equipped&quot;],
	femininity: 10,
	price: 0,
	img: &quot;items/wearables/panties/plain_02.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Underwear&quot;, {
	name: &quot;Lacey black silk panties&quot;,
	tags: [&quot;underwear&quot;, &quot;equipped&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/panties/lace_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Bras --&gt;

&lt;&lt;= $shop.addItem(&quot;Bra&quot;, {
	name: &quot;Pink stripped bra&quot;,
	tags: [&quot;bra&quot;, &quot;equipped&quot;],
	femininity: 10,
	price: 0,
	img: &quot;items/wearables/bra/plain_02.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Bra&quot;, {
	name: &quot;Lacey black silk bra&quot;,
	tags: [&quot;bra&quot;, &quot;equipped&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/bra/lace_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Tops --&gt;

&lt;&lt;= $shop.addItem(&quot;Top&quot;, {
	name: &quot;Black camisole&quot;,
	tags: [&quot;shirt&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/tops/top_02.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Dresses --&gt;

&lt;&lt;= $shop.addItem(&quot;Dress&quot;, {
	name: &quot;Black summer dress&quot;,
	tags: [&quot;shirt&quot;, &quot;pants&quot;, &quot;equippable&quot;],
	femininity: 25,
	price: 0,
	img: &quot;items/wearables/dress/summerdress_02.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Dress&quot;, {
	name: &quot;Stylised maid outfit&quot;,
	tags: [&quot;shirt&quot;, &quot;pants&quot;, &quot;equippable&quot;],
	femininity: 25,
	price: 0,
	img: &quot;items/wearables/dress/maid_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Bottoms --&gt;

&lt;&lt;= $shop.addItem(&quot;Bottom&quot;, {
	name: &quot;Tartan school skirt&quot;,
	tags: [&quot;pants&quot;, &quot;equippable&quot;],
	femininity: 25,
	price: 0,
	img: &quot;items/wearables/bottoms/skirt_02.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Hosiery --&gt;

&lt;&lt;= $shop.addItem(&quot;Hoisery&quot;, {
	name: &quot;Black Stockings with garter belt&quot;,
	tags: [&quot;hoisery&quot;, &quot;equippable&quot;],
	femininity: 20,
	price: 0,
	img: &quot;items/wearables/hoisery/stockings_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Shoes --&gt;

&lt;&lt;= $shop.addItem(&quot;Shoes&quot;, {
	name: &quot;Black leather mary jane heels&quot;,
	tags: [&quot;shoe&quot;, &quot;equippable&quot;],
	femininity: 5,
	price: 0,
	img: &quot;items/wearables/shoes/heels_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Shoes&quot;, {
	name: &quot;Black leather block heels&quot;,
	tags: [&quot;shoe&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/shoes/heels_02.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Shoes&quot;, {
	name: &quot;Black leather high heels&quot;,
	tags: [&quot;shoe&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/shoes/heels_03.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Accessories --&gt;

&lt;&lt;= $shop.addItem(&quot;Accessory&quot;, {
	name: &quot;Maid headdress&quot;,
	tags: [&quot;accessory-head&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	img: &quot;items/wearables/accessories/headband_maid_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Accessory&quot;, {
	name: &quot;Black choker&quot;,
	tags: [&quot;accessory-neck&quot;, &quot;equippable&quot;],
	femininity: 10,
	price: 0,
	img: &quot;items/wearables/accessories/choker_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Accessory&quot;, {
	name: &quot;Frilly black and white choker&quot;,
	tags: [&quot;accessory-neck&quot;, &quot;equippable&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/accessories/choker_02.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Accessory&quot;, {
	name: &quot;Black corset&quot;,
	tags: [&quot;bra&quot;, &quot;equipped&quot;],
	femininity: 15,
	price: 0,
	img: &quot;items/wearables/accessories/corset_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Toys --&gt;

&lt;&lt;= $shop.addItem(&quot;Toys&quot;, {
	name: &quot;Pink chastity cage&quot;,
	tags: [&quot;toy-front&quot;, &quot;equippable&quot;],
	femininity: 5,
	price: 0,
	img: &quot;items/wearables/toy/cage_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Items (non wearables) --&gt;

&lt;&lt;= $shop.addItem(&quot;Items&quot;, {
	name: &quot;Basic razor&quot;,
	tags: [&quot;razor&quot;],
	price: 0,
	efficiency: 10
})&gt;&gt;
&lt;&lt;= $shop.addItem(&quot;Items&quot;, {
	name: &quot;Rayn Hair Removal Cream&quot;,
	tags: [&quot;razor&quot;],
	price: 0,
	efficiency: 10
})&gt;&gt;



&lt;!-- Base clothes (already equipped) --&gt;
&lt;&lt;= $player.inv.addItem({
	name: &quot;Plain Shirt&quot;, 
	tags: [&quot;shirt&quot;, &quot;equipped&quot;],
	img: &quot;items/wearables/default/default_shirt.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name: &quot;Mens jeans&quot;, 
	tags: [&quot;pants&quot;, &quot;equipped&quot;],
	img: &quot;items/wearables/default/default_pants.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name: &quot;Plain sneakers&quot;, 
	tags: [&quot;shoe&quot;, &quot;equipped&quot;],
	img: &quot;items/wearables/default/default_shoes.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name: &quot;White gym socks&quot;, 
	tags: [&quot;hoisery&quot;, &quot;equipped&quot;],
	img: &quot;items/wearables/default/default_socks.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name: &quot;Plain boxers&quot;, 
	tags: [&quot;underwear&quot;, &quot;equipped&quot;],
	img: &quot;items/wearables/panties/mbriefs_01.jpg&quot;
}, 1)&gt;&gt;

&lt;!-- Wardrobe items (can be equipped once femininity is high enougth) --&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Female cut T-shirt&quot;, 
	tags : [&quot;shirt&quot;, &quot;equippable&quot;],
	femininity: 10, 
	img: &quot;items/wearables/tops/top_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Modest skirt&quot;, 
	tags : [&quot;pants&quot;, &quot;equippable&quot;],
	femininity: 25, 
	img: &quot;items/wearables/bottoms/skirt_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Plain white panties&quot;, 
	tags : [&quot;underwear&quot;, &quot;equippable&quot;],
	femininity: 10, 
	img: &quot;items/wearables/panties/plain_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Plain white bra&quot;, 
	tags : [&quot;bra&quot;, &quot;equippable&quot;],
	femininity: 10, 
	img: &quot;items/wearables/bra/plain_01.jpg&quot;
}, 1)&gt;&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Teal summer dress&quot;, 
	tags : [&quot;shirt&quot;, &quot;pants&quot;, &quot;equippable&quot;],
	femininity: 25, 
	img: &quot;items/wearables/dress/summerdress_01.jpg&quot;
}, 1)&gt;&gt;
&lt;!--&lt;&lt;= $player.inv.addItem({
	name:&quot;Tight jeans&quot;, 
	tags : [&quot;pants&quot;, &quot;equippable&quot;],
	femininity: 10, 
	img: &quot;items/wearables/bottoms/jeans_01.jpg&quot;
}, 1)&gt;&gt;--&gt;
&lt;&lt;= $player.inv.addItem({
	name:&quot;Flat shoes&quot;, 
	tags : [&quot;shoe&quot;, &quot;equippable&quot;],
	femininity: 10, 
	img: &quot;items/wearables/shoes/flats_01.jpg&quot;
}, 1)&gt;&gt;</tw-passagedata><tw-passagedata pid="171" name="roomInit" tags="init" position="100,2225" size="100,100">&lt;!--  Mansion  --&gt;

&lt;&lt;set $mansion to new Mansion({})&gt;&gt;

&lt;!--  Rooms  --&gt;

&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Foyer&quot;, 
	id: &quot;Foyer&quot;, 
	img: [
		&quot;Foyer.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Lounge&quot;, 
		&quot;Kitchen&quot;, 
		&quot;Dining&quot;, 
		&quot;UpperHall&quot;, 
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Lower Hall&quot;, 
	id: &quot;LowerHall&quot;, 
	adjacentRooms: [
		&quot;Foyer&quot;, 
		&quot;MasterBdRm&quot;, 
		&quot;Office&quot;, 
		&quot;PlayerBdRm&quot;, 
		&quot;Laundry&quot;, 
		&quot;Kitchen&quot;, 
		&quot;Dining&quot;, 
		&quot;Garden&quot;, 
		&quot;Lounge&quot;,
		&quot;UpperHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Upper Hall&quot;, 
	id: &quot;UpperHall&quot;, 
	adjacentRooms: [
		&quot;Foyer&quot;, 
		&quot;SonBdRm&quot;, 
		&quot;DaughterBdRm&quot;, 
		&quot;GuestRm&quot;,
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Garden&quot;, 
	id: &quot;Garden&quot;, 
	img: [
		&quot;Garden1.jpg&quot;, 
		&quot;Garden2.jpg&quot;, 
		&quot;Garden3.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Lounge&quot;, 
		&quot;Pool&quot;, 
		&quot;Dining&quot;, 
		&quot;Kitchen&quot;, 
		&quot;Laundry&quot;, 
		&quot;Gym&quot;, 
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Kitchen&quot;, 
	id: &quot;Kitchen&quot;, 
	img: [
		&quot;Kitchen.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Lounge&quot;, 
		&quot;Dining&quot;,
		&quot;Garden&quot;, 
		&quot;Foyer&quot;, 
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Laundry&quot;, 
	id: &quot;Laundry&quot;, 
	img: [
		&quot;Laundry.jpg&quot;
	], 
	adjacentRooms: [
		&quot;LowerHall&quot;, 
		&quot;Garden&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Lounge&quot;, 
	id: &quot;Lounge&quot;, 
	img: [
		&quot;Lounge.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Foyer&quot;, 
		&quot;Kitchen&quot;, 
		&quot;Dining&quot;, 
		&quot;LowerHall&quot;, 
		&quot;Garden&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Dining Room&quot;, 
	id: &quot;Dining&quot;, 
	img: [
		&quot;Dining.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Foyer&quot;, 
		&quot;Kitchen&quot;, 
		&quot;LowerHall&quot;, 
		&quot;Lounge&quot;, 
		&quot;Garden&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Master bedroom&quot;, 
	id: &quot;MasterBdRm&quot;, 
	img: [
		&quot;Bedroom.jpg&quot;, 
		&quot;Bathroom.jpg&quot;, 
		&quot;Closet1.jpg&quot;, 
		&quot;Closet2.jpg&quot;
	], 
	adjacentRooms: [
		&quot;MasterBathRm&quot;, 
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Master bathroom&quot;, 
	id: &quot;MasterBathRm&quot;, 
	img: [
		&quot;Bathroom.jpg&quot;
	], 
	adjacentRooms: [
		&quot;MasterBdRm&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Office&quot;, 
	id: &quot;Office&quot;, 
	img: [
		&quot;Office.jpg&quot;
	], 
	adjacentRooms: [
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Your bedroom&quot;, 
	id: &quot;PlayerBdRm&quot;, 
	img: [
		&quot;Bedroom.jpg&quot;
	], 
	adjacentRooms: [
		&quot;LowerHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Pool&quot;, 
	id: &quot;Pool&quot;, 
	img: [
		&quot;Pool.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Garden&quot;, 
		&quot;Gym&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Gym&quot;, 
	id: &quot;Gym&quot;, 
	img: [
		&quot;Gym1.jpg&quot;
	], 
	adjacentRooms: [
		&quot;Garden&quot;, 
		&quot;Pool&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Mystery room&quot;, 
	id: &quot;SonBdRm&quot;, 
	img: [
		&quot;Locked.jpg&quot;, 
		&quot;Bedroom.jpg&quot;, 
		&quot;Bathroom.jpg&quot;, 
		&quot;Closet.jpg&quot;
	], 
	adjacentRooms: [
		&quot;UpperHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Daughter&#39;s bedroom&quot;, 
	id: &quot;DaughterBdRm&quot;, 
	img: [
		&quot;Bedroom.jpg&quot;, 
		&quot;Bathroom.jpg&quot;, 
		&quot;Closet.jpg&quot;
	], 
	adjacentRooms: [
		&quot;UpperHall&quot;
	]
}))&gt;&gt;
&lt;&lt;= $mansion.addRoom(new Room({
	name: &quot;Guest room&quot;, 
	id: &quot;GuestRm&quot;, 
	img: [
		&quot;Bedroom.jpg&quot;, 
		&quot;Bathroom.jpg&quot;, 
		&quot;Closet.jpg&quot;
	], 
	adjacentRooms: [
		&quot;UpperHall&quot;
	]
}))&gt;&gt;</tw-passagedata><tw-passagedata pid="172" name="StoryInit" tags="nodebug init" position="225,2225" size="100,100">&lt;&lt;set $version to &quot;V0.2.0&quot;&gt;&gt;
&lt;&lt;set $debug to true&gt;&gt;
&lt;&lt;set $firstTime to recall(&#39;firstTime&#39;, true)&gt;&gt;&lt;&lt;= memorize(&#39;firstTime&#39;, false)&gt;&gt;

&lt;&lt;set $lastTime to {abs: 0, rel: 0, tp: 0}&gt;&gt;
&lt;&lt;set $time to new Timer({day: 2, time: {hour: 19, minute: 0}})&gt;&gt;

&lt;&lt;set $flags to {
	CUFF : 0,
	manorIntro : 0,
	partyRule : false,
	gymUnlocked : false,
	wardrobeEdit : true,
	filterDone: false,
	therapyPath : 0,
	daugherDate: 0,
	suitorIntroPanic: null,
	kissedSuitor: false,
	cpartyBonus: false,
	cpartyPenalty: false
}&gt;&gt;

&lt;&lt;set $bluePinkGradient to [&quot;#0200b8&quot;,&quot;#0501b8&quot;,&quot;#0701b7&quot;,&quot;#0901b7&quot;,&quot;#0b01b7&quot;,&quot;#0e02b7&quot;,&quot;#1002b7&quot;,&quot;#1202b6&quot;,&quot;#1403b6&quot;,&quot;#1703b6&quot;,&quot;#1903b6&quot;,&quot;#1b04b6&quot;,&quot;#1e04b6&quot;,&quot;#2004b5&quot;,&quot;#2204b5&quot;,&quot;#2405b5&quot;,&quot;#2705b5&quot;,&quot;#2905b5&quot;,&quot;#2b06b4&quot;,&quot;#2e06b4&quot;,&quot;#3006b4&quot;,&quot;#3207b4&quot;,&quot;#3407b4&quot;,&quot;#3707b3&quot;,&quot;#3907b3&quot;,&quot;#3b08b3&quot;,&quot;#3d08b3&quot;,&quot;#4008b3&quot;,&quot;#4209b3&quot;,&quot;#4409b2&quot;,&quot;#4709b2&quot;,&quot;#490ab2&quot;,&quot;#4b0ab2&quot;,&quot;#4d0ab2&quot;,&quot;#500ab1&quot;,&quot;#520bb1&quot;,&quot;#540bb1&quot;,&quot;#570bb1&quot;,&quot;#590cb1&quot;,&quot;#5b0cb0&quot;,&quot;#5d0cb0&quot;,&quot;#600cb0&quot;,&quot;#620db0&quot;,&quot;#640db0&quot;,&quot;#660db0&quot;,&quot;#690eaf&quot;,&quot;#6b0eaf&quot;,&quot;#6d0eaf&quot;,&quot;#700faf&quot;,&quot;#720faf&quot;,&quot;#740fae&quot;,&quot;#760fae&quot;,&quot;#7910ae&quot;,&quot;#7b10ae&quot;,&quot;#7d10ae&quot;,&quot;#8011ad&quot;,&quot;#8211ad&quot;,&quot;#8411ad&quot;,&quot;#8612ad&quot;,&quot;#8912ad&quot;,&quot;#8b12ad&quot;,&quot;#8d12ac&quot;,&quot;#8f13ac&quot;,&quot;#9213ac&quot;,&quot;#9413ac&quot;,&quot;#9614ac&quot;,&quot;#9914ab&quot;,&quot;#9b14ab&quot;,&quot;#9d14ab&quot;,&quot;#9f15ab&quot;,&quot;#a215ab&quot;,&quot;#a415aa&quot;,&quot;#a616aa&quot;,&quot;#a916aa&quot;,&quot;#ab16aa&quot;,&quot;#ad17aa&quot;,&quot;#af17aa&quot;,&quot;#b217a9&quot;,&quot;#b417a9&quot;,&quot;#b618a9&quot;,&quot;#b818a9&quot;,&quot;#bb18a9&quot;,&quot;#bd19a8&quot;,&quot;#bf19a8&quot;,&quot;#c219a8&quot;,&quot;#c41aa8&quot;,&quot;#c61aa8&quot;,&quot;#c81aa7&quot;,&quot;#cb1aa7&quot;,&quot;#cd1ba7&quot;,&quot;#cf1ba7&quot;,&quot;#d21ba7&quot;,&quot;#d41ca7&quot;,&quot;#d61ca6&quot;,&quot;#d81ca6&quot;,&quot;#db1da6&quot;,&quot;#dd1da6&quot;,&quot;#df1da6&quot;,&quot;#e11da5&quot;,&quot;#e41ea5&quot;]&gt;&gt;

&lt;&lt;include &quot;DocumentationInit&quot;&gt;&gt;
&lt;&lt;include &quot;characterInit&quot;&gt;&gt;
&lt;&lt;include &quot;clothesInit&quot;&gt;&gt;
&lt;&lt;include &quot;roomInit&quot;&gt;&gt;
&lt;&lt;include &quot;choresInit&quot;&gt;&gt;
&lt;&lt;include &quot;eventInit&quot;&gt;&gt;
&lt;&lt;include &quot;bodyPartInit&quot;&gt;&gt;</tw-passagedata><tw-passagedata pid="173" name="Intro1" tags="intro tutorial" position="350,2225" size="100,100">As far as you can remember, your early childhood was fairly normal with two loving parents, but you tragically lost them in an accident. You didn&#39;t have any other relatives, so you were raised in foster care. It wasn&#39;t a perfect upbrining, but you got by.

At one point, you were lucky enough to get accepted on a scholarship to a prestigious academy. It was a great opportunity so you took it. For the last few months, you&#39;ve been on an exchange trip overseas to a small country that recently opened up its borders after a long period of isolationism.

They were well known for being the foremost experts in medical and computer technology. You&#39;re not sure if you got as much from it as you could have but it was a great trip and now you&#39;re looking forward to going home.

The driver taking you to your airport lets everyone know that they&#39;ll be taking a quick break soon. After pulling into a nearby road stop, you get out to strech your legs  and grab a bite to eat.

You were enjoying your snack when a shady looking man took the seat accross from you.

&lt;&lt;= Character.speakAnonymous(&quot;Hey kid, you look like a smart person ready to make some money. I&#39;m wondering if you wouldn&#39;t mind helping me out getting this package to some friend of mine.&quot;, &quot;Peru&quot;)&gt;&gt;

He holds out a plain brown box in front of you. It&#39;s clear this person is up to no good.

[img[setup.ImagePath + &quot;items/general/brownbox.jpg&quot;]]

&lt;&lt;= Character.speakAnonymous(&quot;The address is on the box and if you do, my friend will be really thankfull and pay you a big chunk of change for your trouble.&quot;, &quot;Peru&quot;)&gt;&gt;

The man is rubbing his fingers together with a sly smile.

[[Sounds like a good deal to me.|Intro2]]
[[Nope. Stranger danger.|EndHomeSweetHome]]</tw-passagedata><tw-passagedata pid="174" name="Intro2" tags="intro tutorial" position="475,2225" size="100,100">&lt;&lt;= $player.speak(&quot;Sure. I can help you out.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Great! you&#39;re a life saver. Have a safe trip.&quot;,&quot;Peru&quot;)&gt;&gt;

With that, the man hands over the package.

The package looks ordinary enough. You give it a shake, but don&#39;t hear anything inside. It&#39;s best to leave it alone since it might be something private.

&lt;&lt;= $player.speak(&quot;What&#39;s in...&quot;)&gt;&gt;

You look up, but the man is already getting into a nearby car and driving away.

You srug before finishing your food and getting back on the bus and you [[continue your trip to the airport|Intro3]]</tw-passagedata><tw-passagedata pid="175" name="Intro3" tags="intro tutorial" position="600,2225" size="100,100">You get to the airport later that day. There have been a lot of visitors since the borders were opened so the queue for security is long. You play with your queue. Half an hour layer, you finally reach the front.

It doesn&#39;t take long to reach the airport and get to the security check-in. You hadn&#39;t really thought much about the box until you&#39;re putting it on the conveyor for the x-ray machine along with the rest of your suff. One of the gard waves at you through the metal detector. While you&#39;re waiting at the other end, an old lady in front of you drops her bag so you duck down to pick it.

&lt;&lt;= Character.speakAnonymous(&quot;Oh why, thank you, young man.&quot;,&quot;YellowGreen&quot;)&gt;&gt;

She smiles warmly as you hand her the bag and then rejoins her group.

When you turn back to the conveyor, a security guard is standing there holding the brown box you were given earlier in the day.

&lt;&lt;= Character.speakAnonymous(&quot;I this package yours son?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

His face is pretty neutral.

&lt;&lt;= $player.speak(&quot;Um, yes.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Please step to the side sir.&quot;, &quot;GoldenRod&quot;)&gt;&gt;

You move to grab your other bag, but another guard picks it up for you. You follow the guards directions and can see now there are two other more nearby, so they are surrounding you. They arren&#39;t particulary close, but it&#39;s clear running wouln&#39;t be a good option.

&lt;&lt;= Character.speakAnonymous(&quot;You know smuggling is illegal, right?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Then why where you trying to get this out of the country?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

The box is still closed.

&lt;&lt;= $player.speak(&quot;I don&#39;t even know what&#39;s in there. Some guy asked me to deliver it to his friend back home.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;What&#39;s his name?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;$player.name, you idiot!&lt;/i&gt; He didn&#39;t say.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;So you&#39;re in the habit of taking strange packages from people you don&#39;t know?&quot;, &quot;GoldenRod&quot;)&gt;&gt;

You stand there, panicking and unsure of how to reposnd.

&lt;&lt;= Character.speakAnonymous(&quot;Please follow us son.&quot;, &quot;GoldenRod&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Follow the guard&quot;&gt;&gt;
&lt;&lt;goto &quot;Intro4&quot;&gt;&gt;
&lt;&lt;option &quot;Make a run for it&quot;&gt;&gt;
You start running and try to make a break for it, but the guards are ready for it. They quickly tackle you to the ground and have you restrained in no time.

[[Get taken away.|Intro4]]
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="176" name="Intro4" tags="intro tutorial" position="725,2225" size="100,100">The next few days are a whirlwind as some of the most efficient judicial systems in the world throw the book at you. You are quickly found guilty of attempted smuggling and are given a massive 23456cr fine!

You don&#39;t know the currency exchange rate but you know you definitely can&#39;t afford it. There is a strict no extradition policy and your home country is hesitant to help as the power this small country wields is considerable. You&#39;re on your own.

You are currently in a meeting room with your Sentencing Officer waiting to find out what they will do with you. A tall dominering man who looks in his fifties. He&#39;s the only one you&#39;re allowed to talk with at this point since the trial is already over.

&lt;&lt;= Character.speakAnonymous(&quot;You&#39;re in a tight bind here young man. The courts have already assessed your finances and we know you can&#39;t pay your fine.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

To the mans credit he has been making a sincere effort to help but he can only do so much.

&lt;&lt;= Character.speakAnonymous(&quot;Given that this is your first offence I&#39;m willing to offer you two options. First, we could ship you off to a labour camp. It&#39;s hard work but you&#39;re guaranteed to pay off you debt in a few years. You&#39;ll answer to the state though so don&#39;t think it will be easy.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

One of the reasons this county was isolated from the rest of the world is its policies on slavery and indentured servitude.

&lt;&lt;= Character.speakAnonymous(&quot;Second you could agree to indentured servitude. You&#39;ll be signed over to an owner and you&#39;ll work for them. You&#39;ll work off your debt eventually but it&#39;s dependant on how well your owner thinks you are doing so you need to make sure they&#39;re happy.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

Having anyone being in control of your life doesn&#39;t sound great.

&lt;&lt;= Character.speakAnonymous(&quot;Well. I&#39;ll leave it to you. [[Hard Labour|EndHardLabour]] or [[Indentured Servitude|Intro5]]?&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="177" name="Intro5" tags="intro tutorial" position="850,2225" size="100,100">The Sentencing Officer does some quick paper work and then pushes foward a tablet with a form open on it titled &lt;b&gt;Private Indenture Contract&lt;/b&gt;.

&lt;&lt;= Character.speakAnonymous(&quot;This is a standard private contract but has a few addendums from your potential owner. If you want this deal you&#39;ll need to sign it and then you will become their ward. If you see any discrepancies in your personal details please correct them before signing.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

You scan through the document making note of the main clauses:
		
&lt;ul&gt;
&lt;li&gt;As per the Servant Rights Act you forfeit all rights to your Owner up to a minimum standard.&lt;/li&gt;
&lt;li&gt;The State Repayment Plan requires you to meet a weekly quota to repay your debt.&lt;/li&gt;
&lt;li&gt;The Owner Protection Clause  allows the value of the work completed to be determined by the Owner.&lt;/li&gt;
&lt;li&gt;The Community Protection Act requires you to be restricted to your household at all times unless under Owner supervision or the Owner grants you special permission to leave.&lt;/li&gt;
&lt;/ul&gt;

It goes further into all the laws regulation but the bottom line is if you want this deal you have to sign.
		
The last section shows your personal information.

&lt;div id=&quot;player-customisation-form&quot;&gt;\
&lt;h3&gt;Personnal information of the &lt;em&gt;Indured Servant&lt;/em&gt;&lt;/h3&gt;
Name: &lt;&lt;textbox &quot;$player.name&quot; $player.name &quot;Intro6&quot; true&gt;&gt;
&lt;/div&gt;

[[Sign the contract|Intro6][$flags.CUFF++]]</tw-passagedata><tw-passagedata pid="178" name="Intro6" tags="intro tutorial" position="975,2225" size="100,100">You sign your rights away and with that you are now an indentured servant. You know enough to know this basically makes you a slave with a few basic human rights but that&#39;s it.

The Sentencing Officer takes away the contract a woman comes in with a box. She doesn’t saying anything as she sits next to you and pulls you hand over.

&lt;&lt;= Character.speakAnonymous(&quot;You&#39;ll be tagged with a personal Correction Update and Flagging Flexile.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt; 

The Sentencing Officer pulls out a book and slides it over to you with the acronym CUFF on the front. 

&lt;&lt;= Character.speakAnonymous(&quot;This has all the information you need to know about the device but basically it lets us or your owner track you and your progress.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

The woman wraps a black band around your wrist and uses a tool to press button which forces the two ends to fuse together.

&lt;&lt;= Character.speakAnonymous(&quot;It links to your debt account and can be used to withdraw funds. Make sure you use this carefully though and any purchase made while a servant will be added to your debt. A few other features to note are the instant messaging system and scheduler to help you and your owner keep track of any assigned tasks.&quot;, &quot;DarkGoldenRod&quot;)&gt;&gt;

With the formalities complete you get taken away so you can be sent to your owners. You ask about your things before leaving and get told they will kept by the state until the debt is paid off. Looks like you&#39;re stuck with only the clothes on your back for now.

[[Be taken to your owner.|manorIntro01]]</tw-passagedata><tw-passagedata pid="179" name="StorySubtitle" tags="nodebug" position="1100,2225" size="100,100">Version $version</tw-passagedata><tw-passagedata pid="180" name="StoryAuthor" tags="nodebug" position="1225,2225" size="100,100">By FreeShot and Yaflow</tw-passagedata><tw-passagedata pid="181" name="Start" tags="startPassage" position="100,2350" size="100,100">&lt;div id=&#39;game-title-info&#39;&gt;&lt;span id=&#39;game-title&#39;&gt;Community Service&lt;/span&gt;
&lt;span id=&#39;game-author&#39;&gt;A game by FreeShot and Yaflow&lt;/span&gt;&lt;/div&gt;

&lt;div class=&quot;warning&quot;&gt;\
This game is intended for a mature audience. If you are too young, please &lt;a class=&quot;link-internal&quot; href=&quot;https://www.google.fr&quot;&gt;leave.&lt;/a&gt;

Here is the [[changelog]] for the current version of the game.

Feel free to &lt;a href=&quot;https://discord.gg/c7pP7mY&quot;&gt;join our discord&lt;/a&gt;
&lt;/div&gt;
&lt;&lt;tooltips &quot;info&quot; &quot;disable-tips&quot;&gt;&gt;&lt;&lt;/tooltips&gt;&gt;
[[Start the game|Intro1]]
&lt;&lt;if !$firstTime&gt;&gt;
&lt;&lt;link &quot;Skip the introduction (Start with the default character)&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $flags to {
	CUFF : 3,
	manorIntro : 1
}&gt;&gt;
&lt;&lt;= $time.setDate({day: 2, hour: 22, minute: 0})&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;chooseOption &quot;Skip the introduction (Start with the default character)&quot;&gt;&gt;
Are you sure you want to skip the intro (Not recommended for first timers)?
&lt;&lt;link &quot;Yes&quot; &quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;set $flags to {
	CUFF : 3,
	manorIntro : 1
}&gt;&gt;
&lt;&lt;= $time.setDate({day: 2, hour: 22, minute: 0})&gt;&gt;
&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="182" name="manorIntro01" tags="tutorial" position="225,2350" size="100,100">You&#39;re taken to a car and then driven through the city to the high-rise area and eventually stopped in front of one of the tall buildings. Your guard walks you to the elevator and presses the button to the top floor. The doors open to a foyer with an older man waiting around dressed in a suit, his hands behind his back and a plain disinterested look on his face.

&lt;&lt;= Character.speakAnonymous(&quot;State correction here with your new servant.&quot;,&quot;DarkGoldenRod&quot;)&gt;&gt;

The guard shoves you forward.

The man looks you up and down. The appraising stare makes you feel uncomfortable, as if you were examined like stock on a farm.

He looks back to the guard with out even adressing you. &lt;&lt;= $butler.speak(&quot;Of course.&quot;)&gt;&gt; The older man gestures to your CUFF. &lt;&lt;= $butler.speak(&quot;If you please.&quot;)&gt;&gt;

The guard grabs it. &lt;&lt;= Character.speakAnonymous(&quot;Welcome to your new home, kid.&quot;,&quot;DarkGoldenRod&quot;)&gt;&gt;

He uses a hand held device to re-code your tracker to this location. The older man adds a passcode and the guard leaves without another word.

&lt;&lt;= $butler.speak(&quot;Follow me.&quot;)&gt;&gt;

With that, the man turns around and walks into the estate proper.

[[Follow|manorIntro02]]</tw-passagedata><tw-passagedata pid="183" name="manorIntro02" tags="tutorial" position="350,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;Foyer&quot;)&gt;&gt;
You follow the older man and the main door opens into a wide foyer. The room is ornately decorated and you can see a flight of stairs leading to a second floor and corridors going to other parts of the estate.

&lt;&lt;= $butler.speak(&quot;You may call me $butler.name&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Hi, my name&#39;s...&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;$player.name. Yes, I am well aware. We&#39;ve been missing a servant for some time now, so $owner.name was quick to aquire your contract. Your predecessor was a valuable and competent asset and we expect the same from you&quot;)&gt;&gt;

He continues walking through the foyer and into the main lounge

You follow $butler.name to the [[Main Lounge|manorIntro03][$flags.CUFF++]]</tw-passagedata><tw-passagedata pid="184" name="manorIntro03" tags="tutorial" position="475,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;Lounge&quot;)&gt;&gt;
This is the main sitting room and is central to the rest of the building. It has a few lounges as well as a large tv and fireplace.

&lt;&lt;= $player.speak(&quot;So, what am I supposed to be doing around here?&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;As I was in the process of explaining, you are here to tend all the Sono family&#39;s needs around the household. You will clean, perform maintenance and occasionally cook.&lt;b&gt;AL&lt;/b&gt; should have been updated your CUFF with a full list of the rules. I suggest you familliarise yourself with them as any breach will not be tolerated&quot;)&gt;&gt;

Your [[CUFF]] beeps and a tiny red light flashes on and off.

&lt;&lt;= $butler.speak(&quot;Now follow me to the [[Kitchen|manorIntro04]]&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="185" name="manorIntro04" tags="tutorial" position="600,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;Kitchen&quot;)&gt;&gt;
You enter the large open kitchen. It looks just as lavish as the rest of the rooms so far. There are enough appliances and cooking ustencils for a small army of cooks. The only person there though is an older man going about his buisness.

[img[setup.ImagePath + &quot;character/staff/chef_placeholder1.jpg&quot;]]

&lt;&lt;= $butler.speak(&quot;$cook.name cooks all the meals and caters for any smaller gathering on the estate. He starts later in the day which is why you will be taking over for breakfast.&quot;)&gt;&gt;

&lt;&lt;= $cook.speak(&quot;Appreciate the help. Just make sure you leave my kitchen clean.&quot;)&gt;&gt;

The old chef points his knife at you to emphasize his point.

&lt;&lt;= $butler.speak(&quot;You can familiarise yourself with the kitchen later. Follow me to the [[Gardens|manorIntro05]] and I will introduce you to the grounds keeper.&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="186" name="manorIntro05" tags="tutorial" position="725,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;Garden&quot;)&gt;&gt;
You follow $butler.name outside. You expected to be looking out over the city but instead a large yard surrounded by trees hides the city outside. There are fountains, flower beds and even a little gazebo.

There is also a fenced off pool to the side with a pool house that looks like it might have some gym equipment inside.

&lt;&lt;= $butler.speak(&quot;Now, before you get any ideas, I will remind you that facility access is by permission only which you will need to earn.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;I wasn&#39;t going to use them...&quot;)&gt;&gt;, you mumble to yourself.

Off on one of the far side, you see a man working away in one of the gardens.

&lt;&lt;= $butler.speak(&quot;That&#39;s $gardner.name. We won&#39;t bother him since he&#39;s busy at the moment but you will be expected to aide him. He&#39;s good at what he does but injured himself a while ago so needs a young back to help.&quot;)&gt;&gt;

$butler.name glances at your slight frame and then back to $gardner.name.

&lt;&lt;= $butler.speak(&quot;Any help will do.&quot;)&gt;&gt;

You watch as the grounds keeper drops what he is doing and grabs his back in pain as if to emphasise the point.

&lt;&lt;= $butler.speak(&quot;Now follow me.&quot;)&gt;&gt;

$butler.name walks back inside, through the kitchen and back to the foyer.

&lt;&lt;= $butler.speak(&quot;As you can see, the estate is expansive. Until you get familiar with it, just return to the foyer as it leads to most areas on the lower floor. I&#39;ll show you the upstairs rooms.&quot;)&gt;&gt;

Follow $butler.name up the stairs to the [[Upper Hall|manorIntro06]]</tw-passagedata><tw-passagedata pid="187" name="manorIntro06" tags="tutorial" position="850,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;UpperHall&quot;)&gt;&gt;
The upper hall streches for some way to the other rooms of the estate. Near one landing, you see two women in conversation.

Both look similar, but one is clearly younger than the other. They&#39;re both quite beatiful as well and carry themselves like they know it but with enough grace not to be showing it off.

The younger one is talking about a recent holiday which sends a little pang of nervousness given your recent problems.

&lt;&lt;= $butler.speak(&quot;Excuse me $wife.title, $daughter.title.&quot;)&gt;&gt;

$butler.name bows slightly to each woman.

&lt;&lt;= $wife.speak(&quot;Yes $butler.name ?&quot;)&gt;&gt;, the older woman answers

&lt;&lt;= $butler.speak(&quot;I would like to introduce $player.name. This is the new servant for the contract $owner.title acquired recently.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Well, well. What a cutie.&quot;)&gt;&gt; The younger daughter grins and winks as she looks at you up and down.

$wife.name walks towards you. You hold out your hand, but she ignores it and walks around and examines you. You shift nervously.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;It feels like she&#39;s checking out a piece of meat.&lt;/i&gt;&quot;)&gt;&gt; You think to yourself.

&lt;&lt;= $wife.speak(&quot;He&#39;s a bit unkempt, but he&#39;ll do.&quot;)&gt;&gt;

$wife.name stops in front of you.

&lt;&lt;= $wife.speak(&quot;I expect you to keep things up to the standard we&#39;ve become accustomed to. I don&#39;t need to waste time training another maid.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;I&#39;ll do my best.&quot;)&gt;&gt;

A stern look crosses over $wife.name&#39;s face.

&lt;&lt;= $wife.speak(&quot;You will address me as $wife.title at all times and my husband as $owner.title. Is that understood ?&quot;)&gt;&gt;

You stammer. &lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Good. You&#39;ll also refer to my daughter as $daughter.title and my son as $son.title&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Geez Mum, you&#39;re making him nervous.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;They need a firm hand to get the best out of them.&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;If you please $wife.title. I need to get $player.name acquainted with the rest of the estate.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Of course $butler.name. Make sure to come straight at me if he gives you any trouble.&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;Of course $wife.title.&quot;)&gt;&gt;

$butler.name bows slightly and then continues [[showing you around the manor.|manorIntro07]]</tw-passagedata><tw-passagedata pid="188" name="manorIntro07" tags="tutorial" position="975,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;PlayerBdRm&quot;)&gt;&gt;
Although there is a lot of space the layout is pretty easy to follow. It looks like any time you get lost you could jsut head to either the Upper or Lower Hall and you could find most of the other space there.

Eventually $butler.name leads you to the back corridors and into a small living space.

&lt;&lt;= $butler.speak(&quot;This is where you&#39;ll be staying from now on. You can do what you want with this space, but you are expected to keep it clean to the same standards as the rest of the estate.&quot;)&gt;&gt;

At first glance it seems like a nice room. It&#39;s defienitely not large, with just enough room to move and not at all the like the prison cell you were expecting.

&lt;&lt;= $butler.speak(&quot;You can stay there for now. I will come and collect you when $owner.name is ready to meet you.&quot;)&gt;&gt;

$butler.name closes the door behind you, leaving you alone. With nothing better to do you explore the small space.

The drawers are mostly empty and there are some magazines and books on the shelves. You have a quick look through them but they&#39;re mostly women&#39;s magazines. There is a computer under the small desk but it doesn&#39;t seem to be working right now.

You investigate the and inside you find some items left by the last person who stayed here. Unfortunately, it all looks like women&#39;s clothing.

[[Warbrobe|playerRoomWardrobe]]

There is a small attached bathroom. It doesn&#39;t have a lot of space either and the window is actually just a cleverly hidden light but at least it looks like it&#39;s for your private use.

[img[setup.ImagePath + &quot;estate/PlayerBdRm/Bathroom.jpg&quot;]]

Overall it looks like cheap but well maintained student accomodation.

[[Meet your master|manorIntro08]]</tw-passagedata><tw-passagedata pid="189" name="manorIntro08" tags="tutorial" position="1100,2350" size="100,100">&lt;&lt;= $mansion.display(&quot;Office&quot;)&gt;&gt;
You sit, bored, in the room for a few hours until at exactly 7pm, the door opens and $butler.name walks in.

&lt;&lt;= $butler.speak(&quot;$owner.name is waiting for you in his office.&quot;)&gt;&gt;

He turns around and starts walking clearly expecting you to follow.

Not wanting to push your luck, you quickly catch up and fall in behind $butler.name. He takes you back to the study and you see $owner.name sitting behing his desk, working at his computer.

&lt;&lt;= $owner.speak(&quot;I expect $butler.name has already gone over the rules and updated your CUFF accordingly ?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $owner.title.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;Very good. You will answer to $butler.name after myself and my wife at all times. I expect you to adjust to this life quickly and up to his standards. Your weekly performance will be assessed based on his report. That means if he&#39;s not impressed, I&#39;m not impressed. Is that understood?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $owner.title.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;$butler.name?&quot;)&gt;&gt;

The older man replies &lt;&lt;= $butler.speak(&quot;Yes $owner.title.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;See that he understands how to present himself as well. Slouching doesn&#39;t benefit his slight figure.&quot;)&gt;&gt;

&lt;&lt;= $butler.speak(&quot;As you wish, $owner.title.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;That will be all.&quot;)&gt;&gt;

You follow $butler.name out of the office and down the hall.

&lt;&lt;= $butler.speak(&quot;The terminal in you room has now been enabled. You should use it during your free time to familiarise yourself with the skills required for your duties.&quot;)&gt;&gt;

$butler.name leads you back to your &lt;&lt;link &quot;small living space&quot;&quot;PlayerBdRm&quot;&gt;&gt;
&lt;&lt;= $flags.manorIntro++&gt;&gt;&lt;&lt;= $flags.CUFF++&gt;&gt;
&lt;&lt;= $time.setDate({hour:22, minute:0})&gt;&gt;
&lt;&lt;/link&gt;&gt;.</tw-passagedata><tw-passagedata pid="190" name="StoryCaption" tags="nodebug nobr" position="1225,2350" size="100,100">&lt;table id=&quot;menuInfo&quot;&gt;
&lt;&lt;if $flags.manorIntro &gt; 0&gt;&gt;
&lt;tr id=&quot;date&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;Day &lt;&lt;= $time.day + 1&gt;&gt;: $time.weekDayFormat&lt;/td&gt;&lt;/tr&gt;
&lt;tr id=&quot;time&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;&lt;&lt;= $time.clock&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;&lt;/if&gt;&gt;
&lt;tr id=&quot;stamina&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;Stamina: &lt;&lt;= $player.getStaminaBar()&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;&lt;if $flags.CUFF &gt; 0 &gt;&gt;
&lt;tr id=&quot;cuff&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;[[CUFF]]&lt;/td&gt;&lt;/tr&gt;
&lt;&lt;else&gt;&gt;
&lt;tr id=&quot;cuff&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;CUFF&lt;/td&gt;&lt;/tr&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if !$late&gt;&gt;
&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;Daily Chores
&lt;&lt;= $mansion.displayChores(false, $flags.filterDone, true)&gt;&gt;&lt;/td&gt;&lt;/tr&gt;
&lt;&lt;/if&gt;&gt;
&lt;tr&gt;&lt;td cospan=&quot;2&quot;&gt;Missed chores: $player.choresLate&lt;/td&gt;&lt;/tr&gt;
&lt;/table&gt;

&lt;&lt;for _npc range npcList&gt;&gt;
&lt;&lt;if State.variables[_npc].displayPos &amp;&amp; State.variables[_npc].schedule.currRoom !== &quot;Void&quot;&gt;&gt;
_npc: &lt;&lt;= State.variables[_npc].schedule.estimateLoc()&gt;&gt;&lt;br&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/for&gt;&gt;

&lt;!-- &lt;tr id=&quot;arousal&quot;&gt;&lt;td colspan=&quot;2&quot;&gt;Arousal: &lt;&lt;= $player.getArousalBar()&gt;&gt;&lt;/td&gt;&lt;/tr&gt; --&gt;</tw-passagedata><tw-passagedata pid="191" name="CUFF" tags="noreturn mainMenu menu" position="100,2475" size="100,100">&lt;&lt;if $flags.CUFF === 1&gt;&gt;
&lt;&lt;= Character.speakAnonymous(&quot;Cuff must be initialised by the owner.&quot;, &quot;orange&quot;)&gt;&gt;
&lt;&lt;else&gt;&gt;
[[Chore list|playerToDoList]]
[[Player Attributes|skills]]
[[Inventory|inventory]]
[[Description|playerDescription]]
[[Rules|rules]]
&lt;&lt;/if&gt;&gt;

[[Return|$return]]</tw-passagedata><tw-passagedata pid="192" name="playerToDoList" tags="noreturn menu" position="225,2475" size="100,100">&lt;span class=&quot;toggleButton&quot;&gt;&lt;&lt;button &quot;Filter done&quot;&gt;&gt;&lt;/span&gt;
&lt;&lt;set $flags.filterDone = !$flags.filterDone&gt;&gt;
&lt;&lt;replace &#39;#to_do-list&#39;&gt;&gt;
&lt;&lt;= $mansion.displayChores(false, $flags.filterDone)&gt;&gt;
&lt;&lt;/replace&gt;&gt;
&lt;&lt;/button&gt;&gt;
&lt;span id=&#39;to_do-list&#39;&gt;
&lt;&lt;= $mansion.displayChores(false, $flags.filterDone)&gt;&gt;
&lt;/span&gt;

[[Return|$return]]</tw-passagedata><tw-passagedata pid="193" name="skills" tags="noreturn menu" position="350,2475" size="100,100">!!Skills:
&lt;&lt;for _i range Object.keys($player.stats)&gt;&gt;
_i: &lt;&lt;= $player.getStatBar(_i)&gt;&gt; (lvl &lt;&lt;= $player.getStat(_i)&gt;&gt;)
&lt;&lt;/for&gt;&gt;

!!Stats:
Player Name: &lt;&lt;if $flags.partyRule is true&gt;&gt;$player.femName&lt;&lt;else&gt;&gt;$player.name&lt;&lt;/if&gt;&gt;

Debt: $player.debt cr
Money: $player.money cr

Femininity: $player.femininity
Appearance: $player.appearance
Submission: $player.submission
Boldness: $player.boldness

Stamina: $player.stamina.current
Arousal: $player.arousal.current

[[Return|$return]]</tw-passagedata><tw-passagedata pid="194" name="inventory" tags="noreturn menu" position="475,2475" size="100,100">&lt;&lt;= $player.inv.listItem(&quot;$player.inv&quot;, [&quot;equipped&quot;], undefined, &quot;Currently wearing&quot;, false)&gt;&gt;

&lt;&lt;= $player.inv.listItem(&quot;$player.inv&quot;, [&quot;equippable&quot;], undefined, &quot;Wardrobe&quot;, false)&gt;&gt;

[[Return|$return]]</tw-passagedata><tw-passagedata pid="195" name="rules" tags="noreturn menu" position="600,2475" size="100,100">&lt;h1 id=&quot;RuleTitle&quot;&gt;Rules&lt;/h1&gt;\
&lt;ol class=&quot;rules&quot;&gt;\
&lt;li&gt;You will be required to be available 24/7 but unless otherwise stated every you will have a free day every 7th day.&lt;/li&gt;
&lt;li&gt;Must be presentable and in clean clothes at all times.&lt;/li&gt;
&lt;li&gt;Obey all instructions from other residents of the estate.&lt;/li&gt;
&lt;li&gt;Offsite excursions are only allowed on approval from Mr or Mrs Sono.&lt;/li&gt;
&lt;li&gt;Performance will be assessed regularly at the the discretion of Mr and Mrs Sono.&lt;/li&gt;
&lt;li&gt;Punishment for not meeting the requirements of your duties will be at the discretion of Mr and Mrs Sono.&lt;/li&gt;
&lt;&lt;nobr&gt;&gt;
&lt;&lt;if $flags.gymUnlocked is true&gt;&gt;
&lt;li&gt;Use of any of the facilities on site is permitted between 8am to 10pm.&lt;/li&gt;
&lt;&lt;else&gt;&gt;
&lt;li&gt;You are NOT permitted to use any of the onsite facilities outside of you normal chores.&lt;/li&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $flags.partyRule is true&gt;&gt;
&lt;li&gt;$caterer.name will require your assistance at $wife.name&#39;s biweekly gathering. You must be in full uniform and assist guest as required.&lt;/li&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;\
&lt;/ol&gt;
[[Return|$return]]</tw-passagedata><tw-passagedata pid="196" name="PassageFooter" tags="nodebug" position="725,2475" size="100,100">&lt;&lt;if ![&quot;PlayerBdRm&quot;, &quot;sleep&quot;, &quot;gameover&quot;, &quot;event&quot;].includes(passage()) &amp;&amp; $mansion.currentEvent === &quot;&quot; &amp;&amp; $time.inInterval(&quot;sleep&quot;, &quot;wakeup&quot;)&gt;&gt;
&lt;&lt;set $late to true&gt;&gt;
&lt;&lt;= $mansion.findRoom(&quot;PlayerBdRm&quot;).getPassage(&quot;Your CUFF buzzes on your wrist. You check and see it&#39;s time for you to return to your room and rest for the night.&quot;)&gt;&gt;
&lt;&lt;else&gt;&gt;
&lt;&lt;set $late to false&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if ([&quot;init&quot;].some(function(tag) {return tags().includes(tag)}) === false)&gt;&gt;
&lt;&lt;= schedule($lastTime.rel / 5)&gt;&gt;
&lt;&lt;set _last = $lastTime.abs&gt;&gt;
&lt;&lt;set $lastTime.abs = (($time.day * 24 + $time.time.hour) * 60 + $time.time.minute)&gt;&gt;
&lt;&lt;set $lastTime.rel = $lastTime.abs - _last&gt;&gt;
&lt;&lt;/if&gt;&gt;

&lt;&lt;if $debug&gt;&gt;&lt;&lt;include &#39;debug-passage&#39;&gt;&gt;&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="197" name="daughterPath01Homedrunk" tags="noreturn chore" position="850,2475" size="100,100">&lt;!-- Random % chance when the player eneters the foyer - does not repeat --&gt;

Trigger: First Thursday night (last thing to happen before the player goes to bed)

As you are finishing up in the Foyer you hear the buzzer for the main door rings. Before you can answer it $wife.name storms into view, clearly furious.
 
&lt;&lt;= $wife.speak(&quot;That damned girl will be the death of me!&quot;)&gt;&gt;
 
She abruptly opens the door and you can see $daughter.name with two security guards standing on either side of her. You can tell by her swaying back and forth that the guards are clearly the only thing keeping her upright.
 
&lt;&lt;= $wife.speak(&quot;For goodness sake $daughter.name.&quot;)&gt;&gt; $wife.name grabs $daughter.name arm and pulls her inside.
 
&lt;&lt;= $daughter.speak(&quot;Heeeeey. Easy.&quot;)&gt;&gt; Her slurred speech pretty much confirms she is drunk.
 
&lt;&lt;= $wife.speak(&quot;Thank you gentlemen. You&#39;re dismissed.&quot;)&gt;&gt;
 
$wife.name slams the door shut.
 
&lt;&lt;= $wife.speak(&quot;Drunk again? Really?&quot;)&gt;&gt;
 
&lt;&lt;= $daughter.speak(&quot;It was just some cocktails with my friends. We didn&#39;t do anything.&quot;)&gt;&gt;
 
&lt;&lt;= $wife.speak(&quot;You almost set a bar on fire! I had hoped your education would train you out of that kind of behaviour but you&#39;ve gone strait back into your old habits.&quot;)&gt;&gt;
 
$daughter.name yanks her arm free and stumbles a bit. &lt;&lt;= $daughter.speak(&quot;I finished my degree. What more do you want? I just wana have fun!&quot;)&gt;&gt;
 
&lt;&lt;= $wife.speak(&quot;I won&#39;t talk to you like this. Go upstairs and sleep it off.&quot;)&gt;&gt;

$wife.name points to the stairs.
 
&lt;&lt;= $daughter.speak(&quot;Aaaaw. But I&#39;m not sleepy.&quot;)&gt;&gt; $daughter.name still turns anyway and starts stumbling forwards.
 
She spots you standing nearby.
 
&lt;&lt;= $daughter.speak(&quot;Heeeey $player.name. Look at you. All cute and domesticated.&quot;)&gt;&gt; She stumbles over and squeezes your cheeks. &lt;&lt;speak $daughter.speak(&quot;I could just gobble you up.&quot;)&gt;&gt;
 
&lt;&lt;= $wife.speak(&quot;$daughter.name!&quot;)&gt;&gt;
 
&lt;&lt;= $daughter.speak(&quot;Fine.&quot;)&gt;&gt; $daughter.name lets go and heads up the stairs.
 
$wife.name starts heading back into the estate. &lt;&lt;= $wife.speak(&quot;This is the last time.&quot;)&gt;&gt; She grumbles to herself.</tw-passagedata><tw-passagedata pid="198" name="daughterPath02ServeA" tags="" position="975,2475" size="100,100">&lt;!-- happens the 1st time the player serves the Daughter at the cocktail party - does not repeat --&gt;

&lt;&lt;= $daughter.speak(&quot;Hey $player.femName. You really are working this new look of yours.&quot;)&gt;&gt;

She leans in a bit closer.

&lt;&lt;= $daughter.speak(&quot;I think I&#39;m getting a little jealous of all the eyes on that cute butt of yours.&quot;)&gt;&gt;

Blushing furiously you reach down to fix the hem of your skirt as if ready for it to fly up at any moment to reveal what&#39;s underneath then.

&lt;&lt;chooseOption &quot;Get annoyed.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;The sooner I get out of this damned dress the better.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Oh well. Maybe you&#39;ll get used to it or just learn to take a compliment.&quot;)&gt;&gt;

$daughter.name turns back to her conversation so you can continue serving.

&lt;&lt;link &quot;&lt;&lt;= $wife.speak(&#39;Continue serving&#39;)&gt;&gt;&quot; &quot;mansionCPartyServing01&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Thank her... begrudgingly.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;Thank you $daughter.title. I guess.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Come on. Just $daughter.name. To be honest I kind of wish we could get out of here and go to a pub for a beer.&quot;)&gt;&gt;

&lt;&lt;link &quot;I&#39;d drink more than a beer if I could.&quot; &quot;daughterPath02ServeB&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="199" name="daughterPath02ServeB" tags="" position="1100,2475" size="100,100">&lt;!-- continues from previous passage --&gt;

&lt;&lt;= $player.speak(&quot;I&#39;d take a case if I could get some of these eyes off me.&quot;)&gt;&gt;

$daughter.name laughs. &lt;&lt;= $daughter.speak(&quot;I should sneak you out of here sometime. Although I think the eyes wouldn&#39;t stop staring at a cutey like you.&quot;)&gt;&gt;

You roll your eyes but she just chuckles &lt;&lt;if $suitor.appreciation &gt;= 1&gt;&gt; and leans forwards to whisper.

&lt;&lt;= $daughter.speak(&quot;Just between us girls, I caught $suitor.name checking you out before and he&#39;s not easy to impress, trust me.&quot;)&gt;&gt;

You look at her wide eyed but before you can reply $daughter.name winks &lt;&lt;/if&gt;&gt;and turns back to her conversation to leave you to your duties.

[[Continue serving|mansionCPartyServing01]]

&lt;&lt;set $daughter.addAppreciation(1)&gt;&gt;</tw-passagedata><tw-passagedata pid="200" name="daughterPath03GardenChatA" tags="event" position="1225,2475" size="100,100">&lt;!-- happens the first time the player sees the Daughter in the Garden after they are nice to her in daughterPath02ServeA - does not repeat - should occur instead of daughterGardenReading01 one time and then the generic event should be happening again--&gt;

$daughter.name is resting under some shade with a small picnic and a pile of books nearby. The casual white dress she&#39;s wearing that flows down her toned body and stops just above her knees to show off her calves. This is one of the few times your see her wearing glasses as well. She has her long blonde hair loose and the light makes it glisten.

[img[setup.ImagePath + &quot;character/daughter/garden_reading_01.jpg&quot;]]

You find yourself curious about what she spends her time reading so wander nearby. $daughter.name looks up at you through her glasses and her face brightens.

&lt;&lt;= $daughter.speak(&quot;Hey $player.name. Out here to enjoy the sun?&quot;)&gt;&gt;

You look down at your broom and then back up to her.

&lt;&lt;chooseOption &quot;She&#39;s just being nice.&quot;&gt;&gt;
Despite ignoring the circumstance of your situation she is possibly the only person who isn&#39;t treating you like a slave, at least most of the time. There&#39;s nothing wrong with having a friendly conversation.

&lt;&lt;= $player.speak(&quot;Well $daughter.title, I&#39;m kinda in the middle of sweeping but the sun is out so I guess you&#39;re right.&quot;)&gt;&gt;

She chuckles. &lt;&lt;= $daughter.speak(&quot;Yeah, someone needs to keep $gardner.name happy. Wouldn&#39;t want someone tripping over a stray blade of grass right?&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Heh. Yeah he really takes this garden seriously.&quot;)&gt;&gt;

You gesture to the stack of books on her blanket.

&lt;&lt;link &quot;&lt;&lt;= $player.speak(&#39;A little light reading?&#39;)&gt;&gt;&quot; &quot;daughterPath03GardenChatB&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;She&#39;s either oblivious or making fun of you.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;It&#39;s either sweeping or prison. Not a lot of choice really.&quot;)&gt;&gt;

$daughter.name frouns &lt;&lt;= $daughter.speak(&quot;I&#39;m surprised you&#39;re so snarky about a little sweeping if those are your options.&quot;)&gt;&gt; She snaps her book closed and begins packing up her little picnic. &lt;&lt;= $daughter.speak(&quot;You could try to make the most of it by trying to enjoy what you have. Maybe you should get back to work and remember your situation could get a lot worse if you keep up that attitude.&quot;)&gt;&gt;

Not wanting to push your luck your go &lt;&lt;link &quot;back to what you were doing.&quot; &quot;return&quot;&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="201" name="daughterPath03GardenChatB" tags="" position="100,2600" size="100,100">&lt;!-- continues from previous passage --&gt; 

&lt;&lt;= $player.speak(&quot;That&#39;s quite a pile you&#39;ve built up $daughter.title.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Come on $player.name, just call me $daughter.name.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Ok, $daughter.name.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Care to join me for a bit?&quot;)&gt;&gt;

You look around to see if anyone is watching.

&lt;&lt;= $daughter.speak(&quot;Oh don&#39;t worry. The big bad won&#39;t be home for hours.&quot;)&gt;&gt; She pats the spot next to her on the blanket.

With one more glance around you put the broom down and take a seat next to her.

&lt;&lt;= $daughter.speak(&quot;It&#39;s about my degree.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Huh?&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;The books. I&#39;m keeping up my reading.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;What ldid you get your degree in?&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Advanced Biomedicine and Genetic Mechanics.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Holy crap!&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Yeah, I know. Not what you were thinking about me right? People see me and think rich girl with good looks who couldn&#39;t possibly have a brain.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Well sort of but I&#39;m just impressed because you&#39;re so young. That sounds like the kind of thing most people spend their lives trying to accomplish.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Well people keep telling me I was some kind of prodigy. To be honest having such a head start because of Dad did help. I got all the tutors and resources I needed. Not like some other people.&quot;)&gt;&gt;

$daughter.name seems thoughful, almost as if she regrets having such an advantage. &lt;&lt;= $player.speak(&quot;Well some people are lucky but the ones that make it are usually the ones that make the best of the lucky shots they have.&quot;)&gt;&gt;

She smiles again and brushes a stray hair behind her ear. &lt;&lt;= $daughter.speak(&quot;That&#39;s nice of you to say.&quot;)&gt;&gt;

There&#39;s a moment of awkward silence before she continues. &lt;&lt;= $daughter.speak(&quot;So tell me about where you&#39;re from.&quot;)&gt;&gt;

You both begin trading details of your homes and upbringing. There aren&#39;t many parallels but $daughter.name is so easy to talk to you find yourself getting swept up in the conversation. Besides, it&#39;s just nice to be chatting with someone close your own age for once.

After a while the sound of laughter dies down and it&#39;s time to get back to what you were doing.

&lt;&lt;= $player.speak(&quot;Well thanks for the chat but duty calls.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;No problem. It&#39;s nice to have someone to just talk with.&quot;)&gt;&gt;

You smile and then get &lt;&lt;return &quot;back to what you were doing.&quot;&gt;&gt;

&lt;&lt;set $time.addTime({day:0, hour: 0, minute:30})&gt;&gt;
&lt;!--&lt;&lt;set $daughter.addAppreciation(1)&gt;&gt;--&gt;
&lt;&lt;= $mansion.removeEvent(&quot;Garden&quot;, &quot;daughterPath03GardenChatA&quot;)&gt;&gt;</tw-passagedata><tw-passagedata pid="202" name="daughterPath04IntroDate01" tags="" position="225,2600" size="100,100">&lt;!-- requires being nice to the Daughter in daughterPath03GardenChatA and then seeing the Daughter in the Foyer --&gt;

You hear the sounds of $daughter.name and $wife.name arguing as they enter the room.

&lt;&lt;= $daughter.speak(&quot;You can&#39;t just keep me locked up here!&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I&#39;m pretty sure I can. Every time you leave this estate to go out for the night security has to carry you back home.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;I can figure out a way past them and you know it you might as well just let me go out.&quot;)&gt;&gt;

$wife.name has her hands on her hips and is about to reply when she spots you. She thinks for a moment and then smiles.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;This can&#39;t be good.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;How about a compromise?&quot;)&gt;&gt;

$daughter.name seems suspicous. &lt;&lt;= $daughter.speak(&quot;I&#39;m listening.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I&#39;ll let you go out and have fun with no security to keep watch. But you have to take a chaperone.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;How is that any different to having security with me?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Because this chaperone can&#39;t tell you what to do but will have hell to pay if you get in trouble.&quot;)&gt;&gt; $wife.name gestures at you and $daughter.name follows her gaze before smiling as well.

&lt;&lt;= $daughter.speak(&quot;I can live with that.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;That&#39;s probably worse.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;$player.name come over here.&quot;)&gt;&gt;

You approach $wife.name and $daughter.name.
 
&lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;It seems you have an opportunity to improve your situation. $daughter.name has been getting into trouble of late and I would like you to escort her out tonight and keep her out of trouble. If you do I will consider it as a bonus to your debt. What do you say?&quot;)&gt;&gt;

You quickly weight up the pros and cons. On the one hand you&#39;ll be responsible for keeping $daughter.name from partying too hard without even being able to tell her what to do. On the other it&#39;s a chance to get out and relax for a night and possibly even be rewarded for it. That and $daughter.name seems like the closest thing you have to a friend here.

Judging from the look on $wife.name&#39;s face you get the feeling that you won&#39;t get this offer again.

&lt;&lt;chooseOption &quot;Agree.&quot;&gt;&gt;
Before you can finish agreeing $daughter.name claps her hands excitedly. &lt;&lt;= $daughter.speak(&quot;Awesome, it&#39;s a date then. I&#39;ll go get ready. Meet you at the door in a bit.&quot;)&gt;&gt;

$daughter.name rushes off to do whatever she was doing to get ready.

&lt;&lt;= $player.speak(&quot;A date?&quot;)&gt;&gt; You stammer.

&lt;&lt;= $wife.speak(&quot;Hmm, yes, about that.&quot;)&gt;&gt; $wife.name starts walking to the master bedroom. &lt;&lt;= $wife.speak(&quot;Follow me.&quot;)&gt;&gt;

[[Follow|daughterPath04IntroDate02]]
&lt;&lt;set $daughterDateIntro to true&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;

&lt;!--	&lt;&lt;link &quot;Disagree.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#firstdate01&quot;&gt;&gt;
			$daughter.name slumps at your response and is clearly upset but she leaves before you can say anything.
			
			&lt;&lt;= $wife.speak(&quot;A shame. Well back to work now.&quot;)&gt;&gt;
			
			$wife.name follows after $daughter.name leaving you to your chores.
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;--&gt;</tw-passagedata><tw-passagedata pid="203" name="daughterPath04IntroDate02" tags="" position="350,2600" size="100,100">You follow $wife.name towards the Master Bedroom

&lt;&lt;= $wife.speak(&quot;$daughter.name will be in charge but if she gets into any sort of trouble you will be held accountable.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;How can I keep her out of trouble if she&#39;s in charge?&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;You&#39;ll have to figure something out.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Now about this &lt;i&gt;date&lt;/i&gt;. My husband has raised concerns about his daughter living under the same roof as a horny boy.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;I&#39;m not that bad.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;I&#39;ve been managing to stave him off for you so far but I think you spending a night out with $daughter.name may be a problem.&quot;)&gt;&gt;

You both enter the walk in closet. $wife.name opens one of teh cupboards and pulls out a pink box.

&lt;&lt;= $wife.speak(&quot;If you don&#39;t want to raise suspicions you have one option.&quot;)&gt;&gt;

She reaches into the box and her hand comes back out with the pink chastity cage dangling on one finger.

&lt;&lt;= $player.speak(&quot;Um...&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;This is non-negotiable.&quot;)&gt;&gt; The look on her face makes it clear there will be major consequences if you don&#39;t put it on.

She puts the cage down and box down, making sure to take the key with her, and walks past you.

&lt;&lt;= $wife.speak(&quot;Enjoy your evening.&quot;)&gt;&gt;

[[Stare at it like it will bite you.|daughterPath04IntroDate03a]]
[[Reluctantly put it on.|daughterPath04IntroDate03b]]</tw-passagedata><tw-passagedata pid="204" name="daughterPath04IntroDate03a" tags="" position="475,2600" size="100,100">You start at the small piece of pink plastic for a moment. It&#39;s tiny but terrifying at the same time.

[img[setup.ImagePath + &quot;items/wearables/toys/cage_02.jpg&quot;]]

&lt;&lt;= $player.speak(&quot;How many of these things does she have?&quot;)&gt;&gt;

The cage just sits there, mocking you.

&lt;&lt;= $player.speak(&quot;I only have to wear it one night.&quot;)&gt;&gt;

You drop your pants and slip the cool plastic on. It&#39;s a little difficult because you are semi hard but eventually your slip your member into the sleeve and then clip the base around yourself before snapping it closed. The lock engages itself before you can second guess the choice and like that your masculinity is sealed away until $wife.name releases you.

You tug at it in a half hearted attempt to remove it but the cage is shut tight.

It still feels alien but as the hard plastic warms up there is a slight tingle of familiarity.

&lt;&lt;= $player.speak(&quot;I only have to wear it one night. Then it&#39;s coming straight off.&quot;)&gt;&gt;

You&#39;re not sure who you are trying to convince.

[[Head to the door|daughterPath04IntroDate04]]
&lt;&lt;set $daughterFirstDateWaited to true&gt;&gt;</tw-passagedata><tw-passagedata pid="205" name="daughterPath04IntroDate03b" tags="" position="600,2600" size="100,100">Knowing there is no other way, you drop your pants and pick the small piece of plastic up.

[img[setup.ImagePath + &quot;items/wearables/toys/cage_02.jpg&quot;]]

&lt;&lt;= $player.speak(&quot;&lt;i&gt;It&#39;s kind of small. Why does she have more than one?&lt;/i&gt;&quot;)&gt;&gt;

You begin putting it on. It&#39;s a little difficult because you are semi hard but eventually you slip your member into the sleeve. You feel a weird mixture of relief and aprehension at finding it a little difficult to fit into the plastic tube. Once you have it setttled you clip the base around yourself before snapping it closed. The lock engages itself before you can second guess the choice and like that your masculinity is sealed away until $wife.name releases you.

It still feels alien but as the hard plastic warms up there is a slight tingle of familiarity.

&lt;&lt;= $player.speak(&quot;I only have to wear it one night. Then it&#39;s coming straight off.&quot;)&gt;&gt;

You&#39;re not sure who you are trying to convince.

[[Head to the door|daughterPath04IntroDate04]]</tw-passagedata><tw-passagedata pid="206" name="daughterPath04IntroDate04" tags="" position="725,2600" size="100,100">&lt;&lt;if $daughterFirstDateWaited is true&gt;&gt; 
You pull your clothes back up and head the main entrance.

You find $daughter.name is already waiting as you arrive.

[img[setup.ImagePath + &quot;events/daughterdate/firstdate_dress01.jpg&quot;]]

You miss a beat as you see she is wearing one of the smallest cocktail dresses you&#39;ve ever seen. It reaches down to just above mid-thigh and the cut shows plenty of cleavage. You feel your cock twitch in its cage as it tries and fails to get erect forcing you to shift uncomfortably.

&lt;&lt;= $daughter.speak(&quot;What took you so long? Come on.&quot;)&gt;&gt;
&lt;&lt;else&gt;&gt;
You head to the foyer and wait for $daughter.name.

Eventually she walks around the corner and cocks her hips to one side.

[img[setup.ImagePath + &quot;events/daughterdate/firstdate_dress01.jpg&quot;]]

Your jaw drops as you see she is wearing one of the smallest cocktail dresses you&#39;ve ever seen. It reaches down to just above mid-thigh and the cut shows plenty of cleavage. You feel your cock twitch in its cage as it tries and fails to get erect forcing you to shift uncomfortably.

&lt;&lt;= $daughter.speak(&quot;I know right?&quot;)&gt;&gt;

She loops her arm in yours and you head out.
&lt;&lt;/if&gt;&gt;

She loops her arm in yours and you head out through the main doors for the first time since you arrived.

[[Continue.|daughterDateSetup01]]

&lt;&lt;set $flags.daughterDate to 1&gt;&gt;
&lt;&lt;set $flags.therapyPath to 1&gt;&gt;
&lt;&lt;= $mansion.addEvent(&quot;Foyer&quot;, new Event({
	name: &quot;daughterDateSetup01&quot;, 
	passage: &quot;daughterDateSetup01&quot;, 
	inline:true, 
	repeats:true, 
	tags: [&quot;Thursday&quot;, &quot;NeedDaughter&quot;]
}))&gt;&gt;</tw-passagedata><tw-passagedata pid="207" name="daughterPath04IntroDate05" tags="" position="850,2600" size="100,100">&lt;!-- happens the first time the player leaves for the daughter date --&gt;

This is the first real chance you&#39;ve had to check out the city since this whole mess started. $daughter.name calls a car and you are both picked up to be taken to the place she&#39;s chosen.

As you sit down she slides over next to you and keeps a hold of your arm. It feels good to have an attractive woman on your arm but your restrained member keeps reminding you of its presense.

The drive through the streets is so calming though. There&#39;s something about not being stuck in the same walls and being expected to be at everyone&#39;s beck and call that is really taking the edge off.</tw-passagedata><tw-passagedata pid="208" name="daughterPath04IntroDate06" tags="" position="975,2600" size="100,100">&lt;!-- happens the first time the player returns from a daughter date --&gt;

You and $daughter.name come in through the main door and into the foyer. Everyone else is already asleep so there are only a few dim lights filtering from in from outside. As you walk her towards the stairs you both bump into one of the tables and it bangs against the wall.

$daughter.name presses a finger to her mouth. &lt;&lt;= $daughter.speak(&quot;Shhhhhhhh.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;You shhhhhhhh.&quot;)&gt;&gt;

You both grin playfully as you steer through the darkness and $daughter.name says. &lt;&lt;= $daughter.speak(&quot;Don&#39;t forget that you don&#39;t get to tell me what to do. No matter how cute you are.&quot;)&gt;&gt; She boops you on the nose.

You both stand there for a moment in silence.

 &lt;&lt;= $daughter.speak(&quot;It&#39;s nice... having a friend in the house to hang out with.&quot;)&gt;&gt;

 You rub your CUFF and reply. &lt;&lt;= $player.speak(&quot;Yeah. I liked it. Despite everything.&quot;)&gt;&gt;

 &lt;&lt;= $daughter.speak(&quot;Aaaaww. You&#39;re sweet $player.femName.&quot;)&gt;&gt;

Without warning $daughter.name leans forward and presses her mouth to yours. You body reacts on it&#39;s own you and embrace the kiss without realising. Her soft lips part slightly and you mirror the action, as if you are both in perfect synch. One of her hands makes its way around your waist and grabs your rear. The other has already found its way to your chest and is massaging it gently. Despite $daughter.name&#39;s wandering hands the sweet and soft kiss feels far more chaste than you were expecting it to be.

$daughter.name pulls away and smiles. &lt;&lt;= $daughter.speak(&quot;Night $player.femName.&quot;)&gt;&gt;. With that she turns and quickly walks up the stairs.

Not thinking too much on it you turn and head back to your room.

[[sleep]]

&lt;&lt;= $time.setDate({day:0, hour: 23, minute:0})&gt;&gt;
&lt;&lt;= $player.increaseArousal(50)&gt;&gt;</tw-passagedata><tw-passagedata pid="209" name="daughterPath04IntroDate07" tags="" position="1100,2600" size="100,100">&lt;!-- happens the first time the player wakes up after a Daughter date --&gt;


&lt;&lt;set $player.rest(50)&gt;&gt;
&lt;&lt;= $mansion.resetChores()&gt;&gt;


[[PlayerBdRm]]

You scan your cuff to check your current quota before starting the day and see you&#39;ve lost XXXX credits.

&quot;What the fuck!?&quot;

Quickly scanning through your credit history you see a huge number of charges last night from all the places you went to with $daughter.name.

She made you pay for the whole thing.

&gt; on talking to *d* after this (one time only)

&quot;You made me pay for everything last night!&quot;

&quot;Of course. You took me out on a date.&quot;

&quot;That&#39;s not the point. You know what kind of situation I&#39;m in. I thought we were… well, at least friends.&quot;

&quot;We are. That&#39;s why I got you out of the house for a bit to relax. That&#39;s at least worth a night out.&quot;

&quot;You should have checked with me first.&quot;

&quot;Oh well. If it&#39;s too much to ask I guess we can just not go out again.&quot; You feel a bit of regret at that, both for losing a bit of freedom and for how sad she seems. &quot;I&#39;ll have tell mother that you can&#39;t take me out anymore.&quot;

In head &quot;Oh no.&quot;

&quot;Wait.&quot;

&quot;Yeah?&quot;

If she tells *w* about this then there&#39;s no telling how she will react. *d* looks really disappointed as well. Do really want to lose the only person who&#39;s treating you decently.

Option
&gt; Hell no! I need to pay off my debt.

Closes daughter path

&quot;Never mind.&quot;

*d* heads out of the room and leaves you to your duties. You find out later that she decided to get her own place and start her career. Both of you cross paths every now and again but the relationship is never the same.

&gt; You guys are sort of friends. Maybe you&#39;ll have to work a bit harder to afford a bit of freedom?

D path stays open

&quot;I guess it was kind of fun. It was nice to get out of here too.&quot;

&quot;Awesome!&quot; d runs up and gives you a warm hug. You just stand there like a stunned animal. Her hips press against you, reminding you of the plastic still tight around your cock.

&quot;Well just let me know we you want to head out again. Mother will probably only allow me to go out with you on a Friday and Saturday so just find me then.&quot;

She bounces away like a ball of joy leaving you to your duties.</tw-passagedata><tw-passagedata pid="210" name="daughterPath04IntroDate000" tags="" position="1225,2600" size="100,100">&gt; see w for the key</tw-passagedata><tw-passagedata pid="211" name="suitorPathIntro01" tags="" position="100,2725" size="100,100">&lt;!-- happens during the first cocktail party - does not repeat --&gt;&gt;

$wife.name gestures for you to come over with your tray. She&#39;s standing with $owner.name and another man who stands out a bit as he isn&#39;t as dressed up as everyone else. He&#39;s wearing stylish jeans with plain shoes and nice t-shirt. There is a design on the shirt but it&#39;s half covered by his casual business jacket. He&#39;s staring right into your eyes as you walk over.

suitor.apreciation = $suitor.apreciation

&lt;&lt;= $wife.speak(&quot;$suitor.name what can we get you to start off?&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;A glass of bourbon. $caterer.name knows the bottle.&quot;)&gt;&gt; He doesn&#39;t stop looking and you nervously break eye contact with him.

&lt;&lt;= $wife.speak(&quot;You heard the man. Off you go.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;Yes $wife.title.&quot;)&gt;&gt;

You leave and come back with the drink a few moments later.

&lt;&lt;= $suitor.speak(&quot;I&#39;d heard you had wrangled a new contract. You&#39;ve done well for yourselves once again.&quot;)&gt;&gt;

&lt;&lt;= $owner.speak(&quot;She&#39;s performing *performance stats*. $player.femName, this is $suitor.title.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Yes, he&#39;s one of our most important business partners so make sure you look after him tonight.&quot;)&gt;&gt; you catch $wife.name touches $suitor.title back low enough to be an obvious flirt.

&lt;&lt;= $owner.speak(&quot;He&#39;s one of the driving forces between opening up trade with outside nations. He&#39;s also the man behind most of our renewable energy technology.&quot;)&gt;&gt;

&lt;&lt;= $wife.speak(&quot;Although he&#39;s a bit behind the times when it comes to our indenture policies.&quot;)&gt;&gt; $wife.name gives him a playful tap on the chest with the back of her hand. &lt;&lt;= $wife.speak(&quot;When will you finally bite the bullet and stop objecting to male servitude. They&#39;re just as culpable as women when it comes to crime.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;This guy is the reason I&#39;m stuck dressed like a girl.&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;nobr&gt;&gt;
&lt;span id=&quot;suitorinterest&quot;&gt;
	&lt;&lt;link &quot;Show an interest in his work to score some points with $wife.name.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorinterest&quot;&gt;&gt;
			&lt;&lt;= $player.speak(&quot;I didn&#39;t know one person was responsible for keeping all the lights running here. I would like to hear about…&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= $wife.speak(&quot;Some other time. $suitor.title has his drink and there are other guests. That will be all for now $player.femName.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= $suitor.speak(&quot;Maybe I can stop by some other time when you&#39;re not in such high demand?&quot;)&gt;&gt; He&#39;s still looking at you but now with a slight smile. Unlike some other people, his eyes stay on yours. It seems like he&#39;s just being nice but given your current attire it&#39;s a little unnerving.&lt;br&gt;
 			&lt;br&gt;
			&lt;&lt;= $wife.speak(&quot;You&#39;re always welcome $suitor.name. We love having you over.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			You bow your head and [[Get back to work.|mansionCPartyServing01]]
			&lt;&lt;set $suitor.addAppreciation(1)&gt;&gt;
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;&lt;br&gt;
	&lt;&lt;link &quot;I don&#39;t want to talk to this guy.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorinterest&quot;&gt;&gt;
			&lt;&lt;= $player.speak(&quot;Well if you&#39;ll excuse me. I need to keep doing the rounds.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= $wife.speak(&quot;Of course $player.femName. Off you go.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			You bow your head and [[Get back to work.|mansionCPartyServing01]]
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;/span&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="212" name="suitorPathIntro02" tags="" position="225,2725" size="100,100">&lt;!-- happens as it&#39;s own party event if the player showed an interest in suitorPathIntro01 --&gt;

After taking  moment to catch your breath you start heading back to the kitchen. As you round a corner you bump into one of the guests. You know he&#39;s been drinking all night since you&#39;ve been serving his drinks and dodging his groping hands.

&lt;&lt;= Character.speakAnonymous(&quot;Well, well.&quot;, &quot;Peru&quot;)&gt;&gt; You can smell the whiskey on his breath. &lt;&lt;= Character.speakAnonymous(&quot;Fancy bumping into you here cutie.&quot;, &quot;Peru&quot;)&gt;&gt;

Every word has a slur to it as he gets way too far inside your personal space. You start backing away uncomfortably but he grabs you by the waist and pulls you towards him. His other hand reaches around and grabs your butt through the maid skirt. You can feel your chastity cage dangerously close to his leg.

[img[setup.ImagePath + &quot;character/suitor/suitor_intro_assgrab.gif&quot;]]

&lt;&lt;nobr&gt;&gt;
&lt;span id=&quot;suitorRescue01&quot;&gt;
	&lt;&lt;link &quot;No fucking way!&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorRescue01&quot;&gt;&gt;
			&lt;&lt;= $player.speak(&quot;Hey let go of me!&quot;)&gt;&gt; You struggle against his grip but his hands keep worming their way around you.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= Character.speakAnonymous(&quot;I&#39;ve always wondered how *owner* keeps finding fine fillies like you. Maybe I should ask him to loan you to me for a weekend away. You&#39;d enjoy that, right gorgeous?&quot;, &quot;Peru&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= $player.speak(&quot;I don&#39;t think so.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= Character.speakAnonymous(&quot;Aw, don&#39;t be like that.&quot;, &quot;Peru&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			One of his hands is slowly inching your skirt up your legs until you can feel his fingers brush past your stockings and rub the bare skin of your thigh.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= Character.speakAnonymous(&quot;Come on sweetie. Give us a kiss.&quot;, &quot;Peru&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			His breath is gross as he leans forward with his lips pursed. You try pull away again but he&#39;s backed you up against the wall.&lt;br&gt;
			&lt;br&gt;
			Your heart is thumping hard when [[you here a voice nearby.|suitorPathIntro03]]
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;&lt;br&gt;
	&lt;&lt;link &quot;Hope for him stop.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorRescue01&quot;&gt;&gt;
			You try to pull yourself out of his grasp but his groping hands keep a hold of you.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= Character.speakAnonymous(&quot;I&#39;ve always wondered how $owner.name keeps finding fine fillies like you. Maybe I should ask him to loan you to me for a weekend away. You&#39;d enjoy that, right gorgeous?&quot;, &quot;Peru&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			You try to turn away from him but his hands are eveywhere. One of them is slowly inching your skirt up your legs until you can feel his fingers brush past your stockings and rub the bare skin of your thigh.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= Character.speakAnonymous(&quot;Come on sweetie. Give us a kiss.&quot;, &quot;Peru&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			His breath is gross as he leans forward with his lips pursed. You shrink back against the wall behind you, knowing there&#39;s no way for you to stop him.&lt;br&gt;
			&lt;br&gt;
			Your heart is thumping hard when [[you here a voice nearby.|suitorPathIntro03]]
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;/span&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="213" name="suitorPathIntro03" tags="" position="350,2725" size="100,100">&lt;&lt;= $suitor.speak(&quot;I don&#39;t think she&#39;s enjoying that.&quot;)&gt;&gt;

The man turns and you can see $suitor.title standing not far away with arms crossed.

&lt;&lt;= Character.speakAnonymous(&quot;We&#39;re having fun.&quot;, &quot;Peru&quot;)&gt;&gt; The man pulls you closer and you feel his thigh jostle your caged member.

&lt;&lt;= $suitor.speak(&quot;One of you is.&quot;)&gt;&gt; $suitor.title starts walking closer. He&#39;s moving with such confidence the other man loosens his grip a little, not enough for you to get free though. &lt;&lt;= $suitor.speak(&quot;$player.femName you had some questions about my work earlier and I&#39;ve convinced $wife.givenName to let me pull you aside for a while. Shall we?&quot;)&gt;&gt;

$suitor.title holds out his hand but you&#39;re too busy wrestling with the drunk to take it.

&lt;&lt;= Character.speakAnonymous(&quot;We were having a moment here. Why don&#39;t you leave us alone. You can have her after.&quot;, &quot;Peru&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;You&#39;re going to let her go now.&quot;)&gt;&gt;

&lt;&lt;= Character.speakAnonymous(&quot;Or what?&quot;, &quot;Peru&quot;)&gt;&gt;

$suitor.title grabs the man&#39;s shoulder and leans forward to whisper something in his ear. Despite being close you can&#39;t quite catch what is being said but the drunks eyes widen. He pulls his hands away from your ass as if they had been burned.

&lt;&lt;= Character.speakAnonymous(&quot;Ok, ok. No need to get personal. It&#39;s a party after all.&quot;, &quot;Peru&quot;)&gt;&gt;

Without taking his hand off the man&#39;s shoulder $suitor.title guides him away and then gives him a soft shove. You quickly pull you skirt back down lest it reveal you trapped penis underneath.

&lt;&lt;= $player.speak(&quot;Thank you. I really wasn&#39;t having a good time.&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;Let&#39;s go get a drink.&quot;)&gt;&gt; $suitor.title gently puts his hand on your shoulder to get you to follow him.

&lt;&lt;= $player.speak(&quot;But $wife.name...&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;I did actually speak to her. You seemed curious about what I do.&quot;)&gt;&gt;

[[Follow him to the study.|suitorPathIntro04]]
[[Don&#39;t encourage this further.|suitorPathIntroEnd1]]</tw-passagedata><tw-passagedata pid="214" name="suitorPathIntroEnd1" tags="" position="475,2725" size="100,100">&lt;!-- To do: minus points for leading him on then rejecting him and add a comment when being assessed --&gt;

&lt;&lt;= $player.speak(&quot;Sorry $suitor.title but I really should be getting back to work.&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;But I thought you had a interest in my work.&quot;)&gt;&gt; He looks genuinely confused. 

&lt;&lt;= $player.speak(&quot;Well.. um, sort of. But I&#39;m here to work for $owner.name. You understand right?&quot;)&gt;&gt;

His demeanour quickly changes and it&#39;s obvious he&#39;s not impressed. &lt;&lt;= $suitor.speak(&quot;Very well. I guess you&#39;re just another flirty slave then.&quot;)&gt;&gt;

He turns and heads to the foyer. You can even hear the door slam over the din of the party.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Shit. That&#39;s going to have consequences.&lt;/i&gt;&quot;)&gt;&gt;

[[Get back to the party.|mansionCPartyServing01]]

&lt;&lt;set $suitor.acceptance -= 1&gt;&gt;</tw-passagedata><tw-passagedata pid="215" name="suitorPathIntro04" tags="" position="600,2725" size="100,100">$suitor.title gestures for you to sit down as he walks over to the small bar $owner.name keeps stocked.

&lt;&lt;nobr&gt;&gt;
&lt;span id=&quot;suitorRescue02&quot;&gt;
	&lt;&lt;link &quot;Hesitate.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorRescue02&quot;&gt;&gt;
			You stand there, unsure what to do. $suitor.title turns around with two drinks in his hand.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;= $suitor.speak(&quot;Come on. You&#39;ve been working hard on your feet all night. You&#39;ve earned a little break.&quot;)&gt;&gt;&lt;br&gt;
			&lt;br&gt;
			Almost at the mention of your feet you feel them throbbing in the heels $wife.name put you in.&lt;br&gt;
			&lt;br&gt;
			&lt;&lt;nobr&gt;&gt;
			&lt;span id=&quot;suitorRescue03&quot;&gt;
				&lt;&lt;link &quot;Sit.&quot;&gt;&gt;
					&lt;&lt;replace &quot;#suitorRescue03&quot;&gt;&gt;
						You take a seat on one of the lounges, making sure to straighten your skirt out to keep it from riding up too high.&lt;br&gt;
						&lt;br&gt;
						$suitor.title takes the spot next to you. You half expected him to be all over you already but there&#39;s a nice, respectable gap between you. He hands you your drink.&lt;br&gt;
						&lt;br&gt;
						[[Thank him.|suitorPathIntro05]]
					&lt;&lt;/replace&gt;&gt;
				&lt;&lt;/link&gt;&gt;&lt;br&gt;
			&lt;/span&gt;&lt;&lt;/nobr&gt;&gt;
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;&lt;br&gt;
&lt;/span&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="216" name="suitorPathIntro05" tags="" position="725,2725" size="100,100">&lt;&lt;= $player.speak(&quot;Thank you $suitor.title.&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;Just $suitor.name. I don&#39;t like it when people call be $suitor.title. Make sure you don&#39;t regardless of who we&#39;re around.&quot;)&gt;&gt;

For moment his tone became very commanding. It was subtle, the same as $owner.name when he gives you an order and reminds you that $suitor.title... no $suitor.name is basically is charge here.

He holds out his glass and clinks it against yours.

[img[setup.ImagePath + &quot;character/suitor/suitor_intro_clink.gif&quot;]]

&lt;&lt;= $suitor.speak(&quot;Cheers.&quot;)&gt;&gt;

&lt;&lt;nobr&gt;&gt;
&lt;span id=&quot;suitorRescue04&quot;&gt;
	&lt;&lt;link &quot;Down it, it&#39;s been a long night.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorRescue04&quot;&gt;&gt;
			Your down the drink in one go and $suitor.name chuckles.&lt;br&gt;
 			&lt;br&gt;
			&lt;&lt;= $suitor.speak(&quot;A woman after my own heart.&quot;)&gt;&gt; He follows suit and downs his drink before getting up to make [[another.|suitorPathIntro06]]
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;&lt;br&gt;
	&lt;&lt;link &quot;Sip the drink and savour this moment of peace.&quot;&gt;&gt;
		&lt;&lt;replace &quot;#suitorRescue04&quot;&gt;&gt;
			$suitor.name gives a half smile and just downs his before getting up to make [[another.|suitorPathIntro06]]
		&lt;&lt;/replace&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;/span&gt;&lt;&lt;/nobr&gt;&gt;</tw-passagedata><tw-passagedata pid="217" name="suitorPathIntro06" tags="" position="850,2725" size="100,100">&lt;&lt;= $suitor.speak(&quot;So you were curious about my work?&quot;)&gt;&gt;

You sit quietly for a moment and look at the door that&#39;s now closed leaving you two alone. $suitor.name turns back around and see&#39;s you sitting nervously.

&lt;&lt;= $suitor.speak(&quot;Don&#39;t worry. I just didn&#39;t want the noise cutting into our conversation.&quot;)&gt;&gt; He re-joins you on the lounge. &lt;&lt;= $suitor.speak(&quot;Most people at these things are just here for the drinks and gossip. I never get to talk about what I do. Did you have some questions?&quot;)&gt;&gt;

You spend the next little while chatting with $suitor.name about what he does. It&#39;s all very fascinating and you tell he&#39;s enjoying the conversation by how animated he gets when responding to a good question. The friendly conversation along with the liquor has you feeling relaxed for the first time in a while.

[[Relax and enjoy the company.|suitorPathIntro07]]</tw-passagedata><tw-passagedata pid="218" name="suitorPathIntro07" tags="" position="975,2725" size="100,100">You lose track of time in the conversation. He tells one particularly good joke that has you laughing, you absentmindedly grab his arm as you both enjoy the humour. You feel a touch on your leg and see $suitor.name has placed his hand on it. Before you can react there&#39;s a knock at the door and $daughter.name comes in.

&lt;&lt;= $daughter.speak(&quot;Sorry $suitor.name. We need $player.femName or $caterer.name is going to have kittens.&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;Well then. Back to it I suppose.&quot;)&gt;&gt; $suitor.name stand up and holds his hand out to help you out of the seat.

You take it, it wouldn&#39;t be polite to refuse. He hands you his glass so you can take it to the kitchen. &lt;&lt;= $player.speak(&quot;&lt;i&gt;When did he get me a cocktail?&lt;/i&gt;&quot;)&gt;&gt; You take it and barely notice his hand on your lower back as you both head to the door. $daughter.name is still waiting with a smile on her face.

&lt;&lt;= $daughter.speak(&quot;What have you two been doing in there all alone.&quot;)&gt;&gt;

Your cheeks flush as you realise the implication.

&lt;&lt;= $player.speak(&quot;Um, we were just...&quot;)&gt;&gt;

You start to pull away but $suitor.name holds onto your shoulder. &lt;&lt;= $suitor.speak(&quot;Talking business. $player.femName has a keen mind I wanted to get away from all the idle chatter for a bit. Don&#39;t go spreading any rumours.&quot;)&gt;&gt;

&lt;&lt;= $daughter.speak(&quot;Sure. Whatever you say.&quot;)&gt;&gt; $daughter.name, still grinning at you, takes $suitor.names other hand. &lt;&lt;= $daughter.speak(&quot;Back to $caterer.name $player.femName, before he storms out in protest.&quot;)&gt;&gt;

The two of them start chatting as you head [[back to the kitchen.|mansionCPartyServing01]]</tw-passagedata><tw-passagedata pid="219" name="suitorPathIntro08" tags="" position="1100,2725" size="100,100">&lt;!-- happens at the end of the party if the player maintained teh auitor relationship --&gt;

As evening winds down you&#39;re mostly stuck in the kitchen cleaning up with $caterer.name. People have been leaving for a while now and the estate is mostly empty.

You&#39;re elbow deep in water when $wife.name and $suitor.name walk in. $wife.name is laughing at something she found funny while hanging off of $suitor.name&#39;s arm but you barely notice them.

&lt;&lt;= $suitor.speak(&quot;Well. It&#39;s late so I think it&#39;s time for me to head off.&quot;)&gt;&gt; $suitor.name says.

&lt;&lt;= $wife.speak(&quot;Yes, well it was lovely having you over again. You must visit more often.&quot;)&gt;&gt;

You pick up a stack of dishes and put them in the cupboard. As you look up $suitor.name is giving you a side look.

&lt;&lt;= $suitor.speak(&quot;I might do just that. We&#39;ll see how busy my schedule is.&quot;)&gt;&gt;

The look doesn&#39;t go unnoticed by $wife.name who follows his eyes to you.

&lt;&lt;= $wife.speak(&quot;I look forward to it.&quot;)&gt;&gt; $wife.name gives him a hug and a quick peck on the cheek before turning back to you. &lt;&lt;= $wife.speak(&quot;$player.femName. See my guest to the door. After that you can finish up for the night.&quot;)&gt;&gt;

$wife.name heads off to the master bedroom to join $owner.name leaving you alone with $suitor.name.

&lt;&lt;= $player.speak(&quot;Um, this way sir.&quot;)&gt;&gt;

$suitor.name falls in next to you as you head to the [[main entrance.|suitorPathIntro09]]</tw-passagedata><tw-passagedata pid="220" name="suitorPathIntro09" tags="" position="1225,2725" size="100,100">&lt;&lt;= $player.speak(&quot;So did you have a good night $suitor.name?&quot;)&gt;&gt;

&lt;&lt;= $suitor.speak(&quot;Some parts were better than others. A particularly engaging conversation with a lovely young woman was probably the highlight.&quot;)&gt;&gt;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Lucky girl.&lt;/i&gt;&quot;)&gt;&gt; You think to yourself sarcastically.

You both reach the door and you bw your head slightly.

&lt;&lt;= $player.speak(&quot;Well goodnight $suitor.name.&quot;)&gt;&gt;

You turn to leave when $suitor.name stops you with an out held hand. You turn back to face him.

&lt;&lt;= $player.speak(&quot;Yes sir?&quot;)&gt;&gt;

$suitor.name gently places a hand on your shoulder and starts leaning towards you.

[[Panic!|suitorPathIntro10][$flags.suitorIntroPanic to true]]
[[Stay calm.|suitorPathIntro10][$flags.suitorIntroPanic to false]]</tw-passagedata><tw-passagedata pid="221" name="suitorPathIntro10" tags="" position="100,2850" size="100,100">&lt;&lt;if $flags.suitorIntroPanic is true&gt;&gt;
	You quickly take a step back but he follows and you find yourself pinned between $suitor.name and the main doors.
&lt;&lt;else&gt;&gt;
	Your heart thumps in your chest hoping this is just a hug.
&lt;&lt;/if&gt;&gt;

[img[setup.ImagePath + &quot;character/suitor/suitor_intro_kiss.gif&quot;]]

$suitor.name pulls you towards him before bringing his lips to yours. It takes a moment to register the firm yet gentle kiss and then another beat before it clicks you are dressed as a girl being kissed by a man.

Unsure how to respond you lock up as $suitor.name continues the kiss. He holds you against him and you can feel the pressure of his firm chest squishing your &quot;breasts&quot;. Your heart is pounding underneath.

You try to wiggle free but his hold is firm and you have nowhere to go. He mistakes the struggle for enthusiasm and you feel his tongue push between your lips and explore your mouth.

Eventually $suitor.name pulls back and cups your face with his hand.

&lt;&lt;= $suitor.speak(&quot;Until next time.&quot;)&gt;&gt;

With that he lets himself out, [[leaving you alone in the foyer.|suitorPathIntro11]]</tw-passagedata><tw-passagedata pid="222" name="suitorPathIntro11" tags="" position="225,2850" size="100,100">Your brain is scrambled as you try to reign in your thoughts and process what just happened. The events of the evening quickly play through your mind and you realise he was flirting the whole time. He mussuitorIntroPanicsuitorIntroPanict&#39;ve thought you being friendly was you returning the affection. Which it wasn&#39;t.

You shift your hips again as you realise your caged member is pressing against the hard plastic after being brought to life by the kiss.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;I definitely wasn&#39;t flirting back...&lt;/i&gt;&quot;)&gt;&gt;

[[Finish cleaning up.|mansionCPartyFinish01]]

&lt;&lt;set $flags.kissedSuitor to true&gt;&gt;</tw-passagedata><tw-passagedata pid="223" name="therapistPathStart01" tags="" position="350,2850" size="100,100">&lt;&lt;if $flags.daughterDate is 1&gt;&gt;

You find w and ask her for the key. She pulls it off of her necklace and hands it to you.

&quot;You hold onto everything for now.&quot;

&quot;Thanks w.&quot;

&quot;I suspect you&#39;ll need it again. Given that kiss you shared with my daughter last night I doubt o will leave you two alone without it.&quot;

Your heart just into to your throat as your realise she knows what happened.

&quot;But… um.. It was just.&quot;

&quot;I know what it was. You were making out with my daughter.&quot; She has her arms crossed and it&#39;s clear she&#39;s going to take no excuse. &quot;Did you really think we wouldn&#39;t be keeping an eye everything that happened? Despite my insurance o wasn&#39;t going to trust you alone with our daughter.&quot;

In head - &quot;Fuck.&quot; The look of panic on your face is clearly saying a thousand words.

&quot;Well if I&#39;m going to keep this quiet I suggest we do something about your pent up urges.&quot; She glances at your crotch for a moment. &quot;I&#39;m sending you to spend some time with a friend of mine. She&#39;ll help relieve any pent up frustration.&quot;

&quot;What do you mean maam?&quot;

&quot;She&#39;s an expert at dealing with these sorts of things. I tyhink you&#39;ll find spending time with her quite... satisfying.&quot;

Is she sending you to have sex with someone?

&quot;I&#39;ll make a weekly appointment starting at 6pm tomorrow. Be sure you don&#39;t miss it or there will be severe consequences.&quot;

&quot;Yes maam.&quot;

With that she leaves you alone so you can go unlock yourself.

&lt;!-- todo: player has to go back to their room to unlock it--&gt;

[[daughterPath04IntroDate07]]

&lt;&lt;/if&gt;&gt;

&lt;&lt;= $mansion.addEvent(&quot;Foyer&quot;, new Event({
	name: &quot;therapySetup01&quot;, 
	passage: &quot;therapySetup01&quot;, 
	inline:true, 
	repeats:true, 
	tags: [&quot;Monday&quot;, &quot;Evening&quot;]
}))&gt;&gt;

&lt;&lt;set $flags.therapyPath to 2&gt;&gt;

[[PlayerBdRm]]</tw-passagedata><tw-passagedata pid="224" name="therapistPathIntro01" tags="" position="475,2850" size="100,100">Escort &quot;Wait here.&quot;</tw-passagedata><tw-passagedata pid="225" name="playerDescription" tags="nobr noreturn menu" position="600,2850" size="100,100">You are &lt;&lt;= $player.name&gt;&gt;.&lt;br&gt;
&lt;&lt;if $player.isHidden(&quot;hair&quot;) === undefined&gt;&gt;
  You have
&lt;&lt;else&gt;&gt;
  You wear a &lt;&lt;= $player.isHidden(&quot;hair&quot;)&gt;&gt; hiding your
&lt;&lt;/if&gt;&gt;
&lt;&lt;= $player.getDesc(&quot;hairLength&quot;)&gt;&gt; &lt;&lt;= $player.getDesc(&quot;hairColor&quot;)&gt;&gt; hairs. &lt;&lt;if $player.hasEquipped(&quot;accessory-head&quot;)&gt;&gt;On your head rests a &lt;&lt;= $player.hasEquipped(&quot;accessory-head&quot;)&gt;&gt;&lt;&lt;/if&gt;&gt;

&lt;br&gt;

You have &lt;&lt;= $player.getDesc(&quot;eyeColor&quot;)&gt;&gt; eyes. &lt;br&gt;

&lt;&lt;= $player.getDesc(&quot;face&quot;)&gt;&gt;
&lt;&lt;= $player.getDesc(&quot;lips&quot;)&gt;&gt; 
&lt;&lt;if $player.hasEquipped(&quot;accessory-neck&quot;)&gt;&gt; On your neck rests a &lt;&lt;= $player.hasEquipped(&quot;accessory-neck&quot;)&gt;&gt;.&lt;&lt;/if&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;skin&quot;)&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;chest&quot;)&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;butt&quot;)&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;hips&quot;)&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;crotch&quot;)&gt;&gt; &lt;br&gt;
&lt;&lt;= $player.getDesc(&quot;legs&quot;)&gt;&gt; &lt;br&gt;

&lt;&lt;for _bp range [&quot;chest&quot;, &quot;crotch&quot;, &quot;legs&quot;]&gt;&gt;
  &lt;&lt;if $player.isHidden(_bp) !== undefined&gt;&gt;
    Your _bp is hidden by your &lt;&lt;= $player.isHidden(_bp)&gt;&gt;.
  &lt;&lt;else&gt;&gt;
    Your _bp is exposed for anyone to see.
  &lt;&lt;/if&gt;&gt;
  &lt;br&gt;
&lt;&lt;/for&gt;&gt;

&lt;&lt;if $player.hasEquipped([&quot;toy-front&quot;])&gt;&gt;
You are currently using a &lt;&lt;= $player.inv.filter([&quot;toy-front&quot;, &quot;equipped&quot;])[0].item.name&gt;&gt;.
&lt;&lt;/if&gt;&gt;
&lt;&lt;if $player.hasEquipped([&quot;toy-back&quot;])&gt;&gt;
You are currently using a &lt;&lt;= $player.inv.filter([&quot;toy-back&quot;, &quot;equipped&quot;])[0].item.name&gt;&gt;.
&lt;&lt;/if&gt;&gt;
&lt;br&gt;
[[Return|$return]]</tw-passagedata><tw-passagedata pid="226" name="PlayerBdRm" tags="playerRoom room" position="725,2850" size="100,100">&lt;&lt;= $mansion.display(&quot;PlayerBdRm&quot;)&gt;&gt;

A simple room with a single bed, wardrobe, desk and a small adjoined bathroom.

Its furnishings are plain with little to no decorations.

Desk
	There is nothing here at the moment
	
&lt;&lt;nobr&gt;&gt;
&lt;&lt;set _event to $mansion.checkSpecialEvents()&gt;&gt;
&lt;&lt;if _event !== &quot;&quot;&gt;&gt;
	&lt;&lt;= _event&gt;&gt;
&lt;&lt;elseif $time.inInterval(&quot;sleep&quot;, &quot;wakeup&quot;)&gt;&gt;
	[[Go to bed|sleep]]
&lt;&lt;else&gt;&gt;
	Got to the bathroom and:&lt;br&gt;
	[[Shower|playerRoomShower]]&lt;br&gt;&lt;br&gt;
	Check the [[Wardrobe|playerRoomWardrobe]]&lt;br&gt;
	Use the [[Computer|playerRoomComputerMenu]]&lt;br&gt;
	Read something from the [[Bookshelf|playerRoomBookshelfMenu]]&lt;br&gt;
	[[Check your to do list.|playerToDoList]]&lt;br&gt;&lt;br&gt;
	&lt;&lt;link &quot;Rest&quot;&gt;&gt;
		&lt;&lt;set $time.addTime({day:0, hour:1, minute: 0})&gt;&gt;
		&lt;&lt;set $player.rest()&gt;&gt;
		&lt;&lt;goto `passage()`&gt;&gt;
	&lt;&lt;/link&gt;&gt;&lt;br&gt;
	&lt;&lt;link &quot;Stay here until the end of the day.&quot;&gt;&gt;
		&lt;&lt;= $time.setDate({day:0, hour:22, minute:0})&gt;&gt;
		&lt;&lt;goto `passage()`&gt;&gt;
	&lt;&lt;/link&gt;&gt;
	&lt;&lt;= $mansion.findRoom($player.currRoom).getAdjacentRooms()&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;

&lt;&lt;= $mansion.findRoom(&quot;PlayerBdRm&quot;).displayChores(&quot;&quot;, true)&gt;&gt;
&lt;&lt;if $time.compareTime({hour:18, minute:0}) === 1&gt;&gt;
&lt;&lt;= $time.setDate({hour:22})&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="227" name="playerRoomShower" tags="playerRoom" position="850,2850" size="100,100">&lt;&lt;tooltips &quot;comment&quot;&gt;&gt;
At the moment, the shower is only used as a way to gain some stamina back without taking too much time. Later, it will be changed to raise the player&#39;s personnal hygene.
&lt;&lt;/tooltips&gt;&gt;
[img[setup.ImagePath + &quot;events/bath_routine/shower01.gif&quot;]]

You turn on the warm stream of water and step into the shower. You soap up and wash yourself clean. This moment of relaxation feels great, almost as if your worreis are washing away with the water.
&lt;&lt;set $time.addTime({hour:0, minute: 15})&gt;&gt;&lt;&lt;= $player.rest(5)&gt;&gt;
&lt;&lt;return &#39;Finish&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="228" name="playerRoomWardrobe" tags="playerRoom" position="975,2850" size="100,100">&lt;&lt;= $player.inv.listItem(&quot;$player.inv&quot;, [&quot;equipped&quot;], undefined, &quot;Currently wearing&quot;, $mansion.currentEvent === &quot;&quot;)&gt;&gt;

&lt;&lt;= $player.inv.listItem(&quot;$player.inv&quot;, [&quot;equippable&quot;], undefined, &quot;Wardrobe&quot;, $mansion.currentEvent === &quot;&quot;)&gt;&gt;

&lt;&lt;return &#39;Finish&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="229" name="playerRoomComputerMenu" tags="playerRoom" position="1100,2850" size="100,100">The computer has a pretty basic setup and your access is limited.

Training:

	[[Cleaning For The Delicate House Maid (read for 1 hour)|playerRoomComputerCleaning]]
	[[Etiquette Tips For Submissive Servers (read for 1 hour)|playerRoomComputerServing]]

Games: 

	[[Household (play for 1 hour)|playerRoomComputerGame]]

[[Stop using the computer|PlayerBdRm]]</tw-passagedata><tw-passagedata pid="230" name="playerRoomComputerCleaning" tags="playerRoom" position="1225,2850" size="100,100">You load up the tutorial titled &quot;Cleaning For The Delicate House Maid&quot;

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Why can&#39;t it just say How to Clean?&lt;/i&gt;&quot;)&gt;&gt;

It has a lot of general tips and tricks such as the difference between &quot;zone cleaning&quot; and &quot;task cleaning&quot;, always working top to bottom and left to right. The further you read to more in depth the information gets right down to the different components of the cleaning products you should use.

Throughout the guide you see example of the different method. Each one has a picture of a woman in a cute maid outfit. The hem line of the skirt is a little high and you can see the tops of her stockings in some pictures. This usually in the section about how to present yourself, the proper work attire and how to under stand the needs of your host. It&#39;s all a bit more risqué than you would expect a professional guide to be but you enjoy looking at the alluring model anyway.

It&#39;s also seems unsually thorough on the methods for keeping your apron pure white at all times.

&lt;&lt;= $player.speak(&quot;&lt;i&gt;Maybe I should get my own apron...&lt;/i&gt;&quot;)&gt;&gt;

&lt;&lt;return &#39;Back to the menu&#39;&gt;&gt;

&lt;&lt;set $time.addTime({hour:1})&gt;&gt;
&lt;&lt;= $player.levelUp(&quot;cleaning&quot;, 1)&gt;&gt;</tw-passagedata><tw-passagedata pid="231" name="playerRoomComputerServing" tags="playerRoom" position="100,2975" size="100,100">You load up &quot;Etiquette Tips For Submissive Servers&quot;

The training manual runs you through all the best practices when performing table service. Serve from a guest’s left, using your left hand, and clear from their right, using your right hand. Don’t let a wine, beer, or spirits bottle touch the glass you’re pouring into. Never reach across a guest to serve another guest unless you are flirting with them and wish to present your bosom.

The guide become more unorthodox from this point. You always find yourself wondering who the hell wrote them.

How to flirt with guests and comport yourself by keeping you chest out and chin up. A big part of the second half focuses around the &quot;Four bees of serving.&quot;

	- Be pleasant, it’s your role to present a sweet and friendly demeanor.

	- Be attentive, constantly scan the room, and if a guest needs attention it is your role to assist them in any way they desire.

	- Be patient, never interrupt a conversation, you are to be seen not heard. Wait for a guest to address you before asking what they would like from you.

	- Be discreet, don’t have audible conversations with other servers within earshot of guests. Gossip is encouraged of course but only if it is to embarrass yourself or get the attention of a guest.

&lt;&lt;return &#39;Back to the menu&#39;&gt;&gt;

&lt;&lt;set $time.addTime({hour:1})&gt;&gt;
&lt;&lt;= $player.levelUp(&quot;serving&quot;, 1)&gt;&gt;</tw-passagedata><tw-passagedata pid="232" name="playerRoomComputerGame" tags="playerRoom" position="225,2975" size="100,100">You load up the game and begin to play. It&#39;s mostly a choose you own adventure type story about a man who must navigate the day to day life of managing a household. It&#39;s an ok game with a few bugs. The chore system is a bit too grindy and some of the NPC descriptions are a bit flat but other than that it&#39;s fun to play.

Halfway through your session you get this weird sense in the back of your shoulders, almost like someone is watching you. You feel the need to look at the fourth wall of your room and wink.
&lt;&lt;set $time.addTime({hour:1})&gt;&gt;&lt;&lt;= $player.rest(5)&gt;&gt;
&lt;&lt;return &#39;Back to the menu&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="233" name="playerRoomBookshelfMenu" tags="playerRoom" position="350,2975" size="100,100">You scan through the limited selection of reading material and decide to read...

[[Provincial|playerRoomBookshelfProvincial]]
[[Rouge|playerRoomBookshelfRouge]]
[[Cheeky Lady|playerRoomBookshelfCheekyLady]]

[[Step away from the shelf|PlayerBdRm]]</tw-passagedata><tw-passagedata pid="234" name="playerRoomBookshelfProvincial" tags="playerRoom" position="475,2975" size="100,100">Still in dev

Fashion
Entertainment

&lt;&lt;return &#39;Put it back on the shelf&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="235" name="playerRoomBookshelfRouge" tags="playerRoom" position="600,2975" size="100,100">Still in dev

Make up
Gossip

&lt;&lt;return &#39;Put it back on the shelf&#39;&gt;&gt;</tw-passagedata><tw-passagedata pid="236" name="playerRoomBookshelfCheekyLady" tags="playerRoom" position="725,2975" size="100,100">Still in dev

Lady porn

&lt;&lt;return &#39;Put it back on the shelf&#39;&gt;&gt;
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;</tw-passagedata><tw-passagedata pid="237" name="RoomDescription" tags="room nobr" position="850,2975" size="100,100">&lt;&lt;= $mansion.findRoom($player.currRoom).display()&gt;&gt;&lt;br&gt;
&lt;&lt;set _npc to $mansion.findRoom($player.currRoom).getNPC()&gt;&gt;
&lt;&lt;if _npc !== &quot;&quot;&gt;&gt;
&lt;&lt;= _npc&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;= $mansion.findRoom($player.currRoom).getEvent()&gt;&gt;
&lt;br&gt;
&lt;&lt;set _chores to $mansion.findRoom($player.currRoom).displayChores(true, true, false, false)&gt;&gt;
&lt;&lt;if _chores !== &quot;&quot;&gt;&gt;
Chores:
&lt;&lt;= _chores&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;br&gt;
&lt;&lt;if !$late&gt;&gt;
From here, you can go to &lt;&lt;= $mansion.findRoom($player.currRoom).getAdjacentRooms()&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="238" name="shopTest" tags="" position="975,2975" size="100,100">&lt;&lt;= $shop.name&gt;&gt;
&lt;&lt;= $shop.listItem()&gt;&gt;


&lt;&lt;= $player.inv.listItem(&quot;$player.inv&quot;)&gt;&gt;

&lt;&lt;return&gt;&gt;</tw-passagedata><tw-passagedata pid="239" name="sleep" tags="sleep Save" position="1100,2975" size="100,100">[img[setup.ImagePath + &quot;events/sleep/sleep1.jpg&quot;]]

You turn in for the night and try to get some rest. You shut the lights off and tuck yourself under the sheets. It&#39;s been a long day so it&#39;s not long before you drift off to sleep.
&lt;&lt;if $mansion.currentEvent.startsWith(&quot;mansionCParty&quot;)&gt;&gt;
There&#39;s a knock on your door later that night. You groggily answer it to find $daughter.name standing there.

&lt;&lt;= $daughter.speak(&quot;Come on. I have a surprise for you.&quot;)&gt;&gt;

You glance down and see she is in a thin night dress and your mind races at the possibilities. $daughter.name takes you hand and leads you through the mansion. You&#39;re too busy watching her nightie bounce up and down to pay much attention to where you are going. She leads you through a door and turns to close it behind you. The room is dark and you can hardly see the details.

Before you can speak $daughter.name shoves you down to the ground. You roll onto your back and see her shadowy form reach down towards you. Fingers slip into the waist of your panties and start pulling them over your svelt thighs, past your ankles before tossing them to the side. The hands start spreading your knees as the figure leans over the top of you.

&lt;&lt;= $suitor.speak(&quot;I can&#39;t wait to be inside of you.&quot;)&gt;&gt;

You feel something warm and firm press against the your womanhood before the figure thrusts forwards and...

[[Start the next day|mansionCPartyIntro32]]
&lt;&lt;elseif $daughterDateIntro is true&gt;&gt;
When you get to your room you flop onto the bed. The thump makes you acutley aware of the hard plastic of the cage. You quickly roll over and pull down your pants to remove it but realise it&#39;s locked and you don&#39;t have a key. After the goodnight kiss your trapped member is straining to get a erect but the pink prison is preventing it.

You reach down and fiddle with the cage for a moment in an effort to remove it. All this does is prove it is locked tight with no chance of coming off. To make things worse the jostling of the cage made the pressure even more intense as your body reacts to your trying to play with yourself.

Defeated, you turn the light out and do you best to fall asleep. No position is comfotable though as your thoughts drifts back to $daughter.name, how she looked in that outfit, the kiss you shared, the sway of her hips as she walked up the stairs.

It&#39;s some time before you&#39;re able to drift off but your sexy dreams provide little sanctuary.

[[Start the next day|daughterPath04IntroDate07]]
&lt;&lt;else&gt;&gt;
[[Start the next day|wakeUp]]
&lt;&lt;/if&gt;&gt;

&lt;&lt;set $player.voice.current = $player.voice.absolute&gt;&gt;
&lt;&lt;= $player.increaseArousal(5)&gt;&gt;</tw-passagedata><tw-passagedata pid="240" name="wakeUp" tags="sleep" position="1225,2975" size="100,100">The CUFF alarm goes off at 6 am sharp and you quickly slap your hand to your wrist and set it to snooze. It&#39;s not long before the room lights start to come on forcing you to get up and start the day.

&lt;&lt;nobr&gt;&gt;
&lt;&lt;= $time.setDate(&quot;wakeup&quot;)&gt;&gt;
&lt;&lt;set _event to $mansion.checkSpecialEvents()&gt;&gt;
&lt;&lt;if _event != &quot;&quot;&gt;&gt;
	&lt;&lt;= _event&gt;&gt;
&lt;&lt;else&gt;&gt;
You head to your small bathroom and sit down to relieve yourself. After that you jump in the shower and quickly wash yourself before getting out and shaving. Once you&#39;re dressed you head out to the kitchen and start getting things ready for breakfast.&lt;br&gt;
&lt;br&gt;
&lt;&lt;nobr&gt;&gt;
	&lt;&lt;switch random(4)&gt;&gt;
		&lt;&lt;case 1&gt;&gt;
			&lt;&lt;include &quot;breakfastPJs01&quot;&gt;&gt;
		&lt;&lt;case 2&gt;&gt;
			&lt;&lt;include &quot;breakfastPJs02&quot;&gt;&gt;
		&lt;&lt;case 3&gt;&gt;
			&lt;&lt;include &quot;ownerBreakfastBossy01&quot;&gt;&gt;
		&lt;&lt;default&gt;&gt;
			$butler.name is already in there to help setup. Fortunately the family isn&#39;t particularly fussy in the morning so you can serve a simple continental breakfast. You fill trays with cereal, fruits, pastries and a platter of jams and spreads and place them on the dining room table.&lt;br&gt;
			&lt;br&gt;
			[img[setup.ImagePath + &quot;events/chores/general_breakfast/bfast_continental01.jpg&quot;]]&lt;br&gt;
			&lt;br&gt;
			$owner.name is first to the table as usual. $butler.name helps you bring out the coffee and tea. Over the next hour or two everyone in the estate spends time in the dining room eating and chatting about what they have planned for the day. You attend to anything unique they request until everyone is satisfied and leaves to go about their day. $butler.name leaves with $owner.name so you are alone to do the clean up.&lt;br&gt;
			&lt;br&gt;
			Once everything is tidy you grab a bite to eat and go back to your room.&lt;br&gt;
			&lt;br&gt;
			[[Return to your room.|PlayerBdRm]]
	&lt;&lt;/switch&gt;&gt;
&lt;&lt;= $time.addTime({hour: 2, minute:0})&gt;&gt;
&lt;&lt;/nobr&gt;&gt;
&lt;&lt;/if&gt;&gt;
&lt;&lt;/nobr&gt;&gt;

&lt;&lt;set $player.rest()&gt;&gt;
&lt;&lt;= $mansion.resetChores()&gt;&gt;</tw-passagedata><tw-passagedata pid="241" name="debtDescription" tags="" position="100,3100" size="100,100">Debt: 23456

Weekly reduction: 100

Bonuses

Chore hard work: 50
Cocktail Party good peformance: 25
Daughter Date successful: 25

Penalties

Chores failed: no debt reduction +1 week until labour camp
Cocktail Party bad peformance: 50
Daughter date failed: 100</tw-passagedata><tw-passagedata pid="242" name="endOfWeekRecapStart" tags="event" position="225,3100" size="100,100">Before you turn in for the night you report to the study. $owner.name is sitting behind his desk with $butler.name standing patiently nearby.

He goes over what he thinks you did well and what needs improvement.

&lt;&lt;if $flags.cpartyBonus is true&gt;&gt;
	&lt;&lt;include &quot;endOfWeekCpartyBonus&quot;&gt;&gt;
&lt;&lt;elseif $flags.cpartyPenalty is true&gt;&gt;
	&lt;&lt;include &quot;endOfWeekCpartyPenalty&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;

Chores missed: &lt;&lt;= $player.choresLate&gt;&gt;

&lt;&lt;if $player.choresLate &gt; 4&gt;&gt;
	&lt;&lt;include &quot;endOfWeekRecapBad&quot;&gt;&gt;
&lt;&lt;elseif $player.choresLate &gt; 0&gt;&gt;
	&lt;&lt;include &quot;endOfWeekRecapNeutral&quot;&gt;&gt;
&lt;&lt;else&gt;&gt;
	&lt;&lt;include &quot;endOfWeekRecapGood&quot;&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="243" name="endOfWeekRecapBad" tags="event" position="350,3100" size="100,100">&lt;&lt;= $owner.speak(&quot;Overall your performance for your general duties this week was lackluster so I have decided to withhold your reduction in debt.&quot;)&gt;&gt;

Your shoulders slump as this essentially adds another week to your indenturement.

&lt;&lt;if $player.weeksFailed &gt;= 3&gt;&gt;
	&lt;&lt;include &quot;endChoresFailed01&quot;&gt;&gt;
&lt;&lt;elseif $player.weeksFailed &gt;= 2&gt;&gt;
	It seems $owner.name isn&#39;t finished though.

	&lt;&lt;= $owner.speak(&quot;Not only that but your continued failure to meet expectations has not gone unnoticed. See that this doesn&#39;t happen again or next week we will have to re-evaluate this arrangement.&quot;)&gt;&gt;

	With that warning $owner.name dismisses you. The message was pretty clear. Dont screw up this week or else.

	&lt;&lt;link &quot;Go to bed.&quot; &quot;sleep&quot;&gt;&gt;
	&lt;&lt;set $player.weeksFailed += 1&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;&lt;else&gt;&gt;
	&lt;&lt;= $owner.speak(&quot;See that this doesn&#39;t happen regularly or I may be forced to take more direct action.&quot;)&gt;&gt;

	With nothing further to comment on $owner.name dismisses you.

	&lt;&lt;link &quot;Go to bed.&quot; &quot;sleep&quot;&gt;&gt;
	&lt;&lt;set $player.weeksFailed += 1&gt;&gt;
	&lt;&lt;/link&gt;&gt;
&lt;&lt;/if&gt;&gt;</tw-passagedata><tw-passagedata pid="244" name="endOfWeekRecapNeutral" tags="event" position="475,3100" size="100,100">&lt;&lt;set $player.weeksFailed = 0&gt;&gt;
&lt;&lt;= $owner.speak(&quot;Overall your performance around the estate has met my expectations so your debt has been reduced by a further 100cr.&quot;)&gt;&gt;

You breathe a sigh of relief. You are now one week closer to all this being over.

&lt;&lt;= $owner.speak(&quot;See that you maintain this level of effort moving forward.&quot;)&gt;&gt;

&lt;&lt;link &quot;Go to bed.&quot; &quot;sleep&quot;&gt;&gt;
&lt;&lt;set $player.debt -= 100&gt;&gt;
&lt;&lt;/link&gt;&gt;</tw-passagedata><tw-passagedata pid="245" name="endOfWeekRecapGood" tags="event" position="600,3100" size="100,100">&lt;&lt;set $player.weeksFailed = 0&gt;&gt;
&lt;&lt;= $owner.speak(&quot;It seems that everyone has been impressed with your level of effort around the estate this week so your debt has been reduced by the agreed amount.&quot;)&gt;&gt;

You breathe a sigh of relief as the extra work has paid off. You are now one week closer to all this being over.

&lt;&lt;= $owner.speak(&quot;I&#39;ve also decided to add a little bonus too. You can choose to have this added to the reduction in debt or keep the funds separate for use as you see fit. Which would you prefer?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Reduce your debt.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;I would like the amount removed from my debt $owner.title.&quot;)&gt;&gt;

$owner.name nods and makes the neccessary changes before dismissing you.

&lt;&lt;link &quot;Go to bed.&quot; &quot;sleep&quot;&gt;&gt;&lt;&lt;set $player.debt -= 50&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;option &quot;Keep the bonus.&quot;&gt;&gt;

&lt;&lt;= $player.speak(&quot;I would like to keep the funds separate $owner.title.&quot;)&gt;&gt;
&lt;&lt;end&gt;&gt;

$owner.name nods and makes the neccessary changes before dismissing you.

&lt;&lt;link &quot;Go to bed.&quot; &quot;sleep&quot;&gt;&gt;&lt;&lt;set $player.money += 50&gt;&gt;&lt;&lt;/link&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="246" name="endOfWeekCpartyBonus" tags="event" position="725,3100" size="100,100">&lt;&lt;= $owner.speak(&quot;It seems $caterer.name and my wife were very please with your performance at the party on the weekend. As this reflects well on me and my household I have decided to provide you with an additional 25cr. What would you like to do with the addtional funds?&quot;)&gt;&gt;

&lt;&lt;chooseOption &quot;Reduce your debt.&quot;&gt;&gt;
&lt;&lt;= $player.speak(&quot;I would like the amount removed from my debt $owner.title.&quot;)&gt;&gt;
&lt;&lt;set $player.debt -= 25&gt;&gt;
&lt;&lt;option &quot;Keep the bonus.&quot;&gt;&gt;

&lt;&lt;= $player.speak(&quot;I would like to keep the funds separate $owner.title.&quot;)&gt;&gt;
&lt;&lt;set $player.money += 25&gt;&gt;
&lt;&lt;end&gt;&gt;
&lt;&lt;/chooseOption&gt;&gt;</tw-passagedata><tw-passagedata pid="247" name="endOfWeekCpartyPenalty" tags="event" position="850,3100" size="100,100">&lt;&lt;= $owner.speak(&quot;In regards to your performance at the party over the weekend my wife and $caterer.name were less than satisfied with your work. This has created a poor image of how my household is run which is unacceptable. I have decided to increase your debt by an additional 50cr&quot;)&gt;&gt;&lt;&lt;set $player.debt += 50&gt;&gt;</tw-passagedata></tw-storydata>
	<script id="script-sugarcube" type="text/javascript">
	/*! SugarCube JS */
	if(document.documentElement.getAttribute("data-init")==="loading"){!function(window,document,jQuery,undefined){"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),_slicedToArray=function(){function e(e,t){var r=[],n=!0,a=!1,i=undefined;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done)&&(r.push(o.value),!t||r.length!==t);n=!0);}catch(e){a=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(a)throw i}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},errorPrologRegExp=/^(?:(?:uncaught\s+(?:exception:\s+)?)?\w*(?:error|exception|_err):\s+)+/i,Alert=function(){function e(e,t,r,n){var a="fatal"===e,i="Apologies! "+(a?"A fatal":"An")+" error has occurred.";i+=a?" Aborting.":" You may be able to continue, but some parts may not work properly.",null==t&&null==r||(i+="\n\nError",null!=t&&(i+=" ["+t+"]"),i+=null!=r?": "+r.replace(errorPrologRegExp,"")+".":": unknown error."),"object"===(void 0===n?"undefined":_typeof(n))&&n.stack&&(i+="\n\nStack Trace:\n"+n.stack),window.alert(i)}function t(t,r,n){e(null,t,r,n)}function r(t,r,n){e("fatal",t,r,n)}return function(e){window.onerror=function(n,a,i,o,s){"complete"===document.readyState?t(null,n,s):(r(null,n,s),window.onerror=e,"function"==typeof window.onerror&&window.onerror.apply(this,arguments))}}(window.onerror),Object.freeze(Object.defineProperties({},{error:{value:t},fatal:{value:r}}))}(),Patterns=function(){var e=function(){var e=new Map([[" ","\\u0020"],["\f","\\f"],["\n","\\n"],["\r","\\r"],["\t","\\t"],["\v","\\v"],[" ","\\u00a0"],[" ","\\u1680"],["᠎","\\u180e"],[" ","\\u2000"],[" ","\\u2001"],[" ","\\u2002"],[" ","\\u2003"],[" ","\\u2004"],[" ","\\u2005"],[" ","\\u2006"],[" ","\\u2007"],[" ","\\u2008"],[" ","\\u2009"],[" ","\\u200a"],["\u2028","\\u2028"],["\u2029","\\u2029"],[" ","\\u202f"],[" ","\\u205f"],["　","\\u3000"],["\ufeff","\\ufeff"]]),t=/^\s$/,r="";return e.forEach(function(e,n){t.test(n)||(r+=e)}),r?"[\\s"+r+"]":"\\s"}(),t="\\s"===e?"\\S":e.replace(/^\[/,"[^"),r="[0-9A-Z_a-z\\-\\u00c0-\\u00d6\\u00d8-\\u00f6\\u00f8-\\u00ff\\u0150\\u0170\\u0151\\u0171]",n=r.replace("\\-",""),a=function(){return"("+r+"+)\\(([^\\)\\|\\n]+)\\):|("+r+"+):([^;\\|\\n]+);|((?:\\."+r+"+)+);|((?:#"+r+"+)+);"}();return Object.freeze({space:e,spaceNoTerminator:"[\\u0020\\f\\t\\v\\u00a0\\u1680\\u180e\\u2000-\\u200a\\u202f\\u205f\\u3000\\ufeff]",lineTerminator:"[\\n\\r\\u2028\\u2029]",notSpace:t,anyChar:"(?:.|[\\n\\r\\u2028\\u2029])",anyLetter:r,anyLetterStrict:n,identifierFirstChar:"[$A-Z_a-z]",identifierNextChar:"[$0-9A-Z_a-z]",identifier:"[$A-Z_a-z][$0-9A-Z_a-z]*",variableSigil:"[$_]",variable:"[$_][$A-Z_a-z][$0-9A-Z_a-z]*",macroName:"[A-Za-z][\\w-]*|[=-]",templateName:"[A-Za-z][\\w-]*",cssImage:"\\[[<>]?[Ii][Mm][Gg]\\[(?:\\s|\\S)*?\\]\\]+",inlineCss:a,url:"(?:file|https?|mailto|ftp|javascript|irc|news|data):[^\\s'\"]+"})}();!function(){!function(e){if(e&&e.prototype&&null==e.prototype.firstElementChild){var t=Node.ELEMENT_NODE;Object.defineProperty(e.prototype,"firstElementChild",{get:function(){for(var e=this.childNodes,r=0;r<e.length;++r){var n=e[r];if(n.nodeType===t)return n}return null}})}}(window.Node||window.Element)}(),function(){function e(e,t){var r=Number.parseInt(e,10)||0;if(r<1)return"";var n=void 0===t?"":String(t);for(""===n&&(n=" ");n.length<r;){var a=n.length,i=r-a;n+=a>i?n.slice(0,i):n}return n.length>r&&(n=n.slice(0,r)),n}var t=function(){function e(e,n){var a=String(e);if(!a)return a;switch(n){case"start":return t.test(a)?a.replace(t,""):a;case"end":return r.test(a)?a.replace(r,""):a;default:throw new Error('_trimString called with incorrect where parameter value: "'+n+'"')}}var t=new RegExp("^"+Patterns.space+Patterns.space+"*"),r=new RegExp(""+Patterns.space+Patterns.space+"*$");return e}();Array.prototype.flat||Object.defineProperty(Array.prototype,"flat",{configurable:!0,writable:!0,value:function(){function e(){if(null==this)throw new TypeError("Array.prototype.flat called on null or undefined");var t=0===arguments.length?1:Number(arguments[0])||0;return t<1?Array.prototype.slice.call(this):Array.prototype.reduce.call(this,function(r,n){return n instanceof Array?r.push.apply(r,_toConsumableArray(e.call(n,t-1))):r.push(n),r},[])}return e}()}),Array.prototype.flatMap||Object.defineProperty(Array.prototype,"flatMap",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatMap called on null or undefined");return Array.prototype.map.apply(this,arguments).flat()}}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includes called on null or undefined");if(0===arguments.length)return!1;var e=this.length>>>0;if(0===e)return!1;var t=arguments[0],r=Number(arguments[1])||0;for(r<0&&(r=Math.max(0,e+r));r<e;++r){var n=this[r];if(n===t||n!==n&&t!==t)return!0}return!1}}),Object.entries||Object.defineProperty(Object,"entries",{configurable:!0,writable:!0,value:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e)throw new TypeError("Object.entries object parameter must be an object");return Object.keys(e).map(function(t){return[t,e[t]]})}}),Object.fromEntries||Object.defineProperty(Object,"fromEntries",{configurable:!0,writable:!0,value:function(e){return Array.from(e).reduce(function(e,t){if(Object(t)!==t)throw new TypeError("Object.fromEntries iterable parameter must yield objects");return t[0]in e?Object.defineProperty(e,t[0],{configurable:!0,enumerable:!0,writable:!0,value:t[1]}):e[t[0]]=t[1],e},{})}}),Object.getOwnPropertyDescriptors||Object.defineProperty(Object,"getOwnPropertyDescriptors",{configurable:!0,writable:!0,value:function(e){if(null==e)throw new TypeError("Object.getOwnPropertyDescriptors object parameter is null or undefined");var t=Object(e);return Reflect.ownKeys(t).reduce(function(e,r){var n=Object.getOwnPropertyDescriptor(t,r);return void 0!==n&&(r in e?Object.defineProperty(e,r,{configurable:!0,enumerable:!0,writable:!0,value:n}):e[r]=n),e},{})}}),Object.values||Object.defineProperty(Object,"values",{configurable:!0,writable:!0,value:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e)throw new TypeError("Object.values object parameter must be an object");return Object.keys(e).map(function(t){return e[t]})}}),String.prototype.padStart||Object.defineProperty(String.prototype,"padStart",{configurable:!0,writable:!0,value:function(t,r){if(null==this)throw new TypeError("String.prototype.padStart called on null or undefined");var n=String(this),a=n.length,i=Number.parseInt(t,10);return i<=a?n:e(i-a,r)+n}}),String.prototype.padEnd||Object.defineProperty(String.prototype,"padEnd",{configurable:!0,writable:!0,value:function(t,r){if(null==this)throw new TypeError("String.prototype.padEnd called on null or undefined");var n=String(this),a=n.length,i=Number.parseInt(t,10);return i<=a?n:n+e(i-a,r)}}),String.prototype.trimStart||Object.defineProperty(String.prototype,"trimStart",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimStart called on null or undefined");return t(this,"start")}}),String.prototype.trimLeft||Object.defineProperty(String.prototype,"trimLeft",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimLeft called on null or undefined");return t(this,"start")}}),String.prototype.trimEnd||Object.defineProperty(String.prototype,"trimEnd",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimEnd called on null or undefined");return t(this,"end")}}),String.prototype.trimRight||Object.defineProperty(String.prototype,"trimRight",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.trimRight called on null or undefined");return t(this,"end")}})}(),function(){function _random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("_random called with insufficient parameters");case 1:e=0,t=arguments[0];break;default:e=arguments[0],t=arguments[1]}if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(_nativeMathRandom()*(t-e+1))+e}function _randomIndex(e,t){var r=void 0,n=void 0;switch(t.length){case 1:r=0,n=e-1;break;case 2:r=0,n=Math.trunc(t[1]);break;default:r=Math.trunc(t[1]),n=Math.trunc(t[2])}return Number.isNaN(r)?r=0:!Number.isFinite(r)||r>=e?r=e-1:r<0&&(r=e+r)<0&&(r=0),Number.isNaN(n)?n=0:!Number.isFinite(n)||n>=e?n=e-1:n<0&&(n=e+n)<0&&(n=e-1),_random(r,n)}function _getCodePointStartAndEnd(e,t){var r=e.charCodeAt(t);if(Number.isNaN(r))return{char:"",start:-1,end:-1};if(r<55296||r>57343)return{char:e.charAt(t),start:t,end:t};if(r>=55296&&r<=56319){var n=t+1;if(n>=e.length)throw new Error("high surrogate without trailing low surrogate");var a=e.charCodeAt(n);if(a<56320||a>57343)throw new Error("high surrogate without trailing low surrogate");return{char:e.charAt(t)+e.charAt(n),start:t,end:n}}if(0===t)throw new Error("low surrogate without leading high surrogate");var i=t-1,o=e.charCodeAt(i);if(o<55296||o>56319)throw new Error("low surrogate without leading high surrogate");return{char:e.charAt(i)+e.charAt(t),start:i,end:t}}var _nativeMathRandom=Math.random;Object.defineProperty(Array,"random",{configurable:!0,writable:!0,value:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e||!Object.prototype.hasOwnProperty.call(e,"length"))throw new TypeError("Array.random array parameter must be an array or array-lke object");var t=e.length>>>0;if(0!==t){return e[0===arguments.length?_random(0,t-1):_randomIndex(t,Array.prototype.slice.call(arguments,1))]}}}),Object.defineProperty(Array.prototype,"concatUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.concatUnique called on null or undefined");var e=Array.from(this);if(0===arguments.length)return e;var t=Array.prototype.reduce.call(arguments,function(e,t){return e.concat(t)},[]),r=t.length;if(0===r)return e;for(var n=Array.prototype.indexOf,a=Array.prototype.push,i=0;i<r;++i){var o=t[i];-1===n.call(e,o)&&a.call(e,o)}return e}}),Object.defineProperty(Array.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.count called on null or undefined");for(var e=Array.prototype.indexOf,t=arguments[0],r=Number(arguments[1])||0,n=0;-1!==(r=e.call(this,t,r));)++n,++r;return n}}),Object.defineProperty(Array.prototype,"delete",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.delete called on null or undefined");if(0===arguments.length)return[];var e=this.length>>>0;if(0===e)return[];for(var t=Array.prototype.concat.apply([],arguments),r=t.length,n=[],a=0;a<e;++a)for(var i=this[a],o=0;o<r;++o){var s=t[o];if(i===s||i!==i&&s!==s){n.push(a);break}}for(var u=[],l=0,c=n.length;l<c;++l)u[l]=this[n[l]];for(var d=Array.prototype.splice,f=n.length-1;f>=0;--f)d.call(this,n[f],1);return u}}),Object.defineProperty(Array.prototype,"deleteAt",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.deleteAt called on null or undefined");if(0===arguments.length)return[];var e=this.length>>>0;if(0===e)return[];for(var t=Array.prototype.splice,r=[].concat(_toConsumableArray(new Set(Array.prototype.concat.apply([],arguments).map(function(t){return t<0?Math.max(0,e+t):t})).values())),n=[].concat(_toConsumableArray(r)).sort(function(e,t){return t-e}),a=[],i=0,o=r.length;i<o;++i)a[i]=this[r[i]];for(var s=0,u=n.length;s<u;++s)t.call(this,n[s],1);return a}}),Object.defineProperty(Array.prototype,"deleteWith",{configurable:!0,writable:!0,value:function(e,t){if(null==this)throw new TypeError("Array.prototype.deleteWith called on null or undefined");if("function"!=typeof e)throw new Error("Array.prototype.deleteWith predicate parameter must be a function");var r=this.length>>>0;if(0===r)return[];for(var n=Array.prototype.splice,a=[],i=[],o=0;o<r;++o)e.call(t,this[o],o,this)&&(i.push(this[o]),a.push(o));for(var s=a.length-1;s>=0;--s)n.call(this,a[s],1);return i}}),Object.defineProperty(Array.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.first called on null or undefined");if(0!=this.length>>>0)return this[0]}}),Object.defineProperty(Array.prototype,"includesAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAll called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAll.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(!Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!1;return!0}}),Object.defineProperty(Array.prototype,"includesAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.includesAny called on null or undefined");if(1===arguments.length)return Array.isArray(arguments[0])?Array.prototype.includesAny.apply(this,arguments[0]):Array.prototype.includes.apply(this,arguments);for(var e=0,t=arguments.length;e<t;++e)if(Array.prototype.some.call(this,function(e){return e===this.val||e!==e&&this.val!==this.val},{val:arguments[e]}))return!0;return!1}}),Object.defineProperty(Array.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.last called on null or undefined");var e=this.length>>>0;if(0!==e)return this[e-1]}}),Object.defineProperty(Array.prototype,"pluck",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pluck called on null or undefined");var e=this.length>>>0;if(0!==e){var t=0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)));return Array.prototype.splice.call(this,t,1)[0]}}}),Object.defineProperty(Array.prototype,"pluckMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.pluckMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.pluckMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var n=Array.prototype.splice,a=[],i=t-1;do{a.push(n.call(this,_random(0,i--),1)[0])}while(a.length<r);return a}}),Object.defineProperty(Array.prototype,"pushUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.pushUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.push,n=0;n<e;++n){var a=arguments[n];-1===t.call(this,a)&&r.call(this,a)}return this.length>>>0}}),Object.defineProperty(Array.prototype,"random",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.random called on null or undefined");var e=this.length>>>0;if(0!==e){return this[0===arguments.length?_random(0,e-1):_randomIndex(e,[].concat(Array.prototype.slice.call(arguments)))]}}}),Object.defineProperty(Array.prototype,"randomMany",{configurable:!0,writable:!0,value:function(e){if(null==this)throw new TypeError("Array.prototype.randomMany called on null or undefined");var t=this.length>>>0;if(0===t)return[];var r=Math.trunc(e);if(!Number.isInteger(r))throw new Error("Array.prototype.randomMany want parameter must be an integer");if(r<1)return[];r>t&&(r=t);var n=new Map,a=[],i=t-1;do{var o=void 0;do{o=_random(0,i)}while(n.has(o));n.set(o,!0),a.push(this[o])}while(a.length<r);return a}}),Object.defineProperty(Array.prototype,"shuffle",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.shuffle called on null or undefined");var e=this.length>>>0;if(0===e)return this;for(var t=e-1;t>0;--t){var r=Math.floor(_nativeMathRandom()*(t+1));if(t!==r){var n=this[t];this[t]=this[r],this[r]=n}}return this}}),Object.defineProperty(Array.prototype,"unshiftUnique",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.unshiftUnique called on null or undefined");var e=arguments.length;if(0===e)return this.length>>>0;for(var t=Array.prototype.indexOf,r=Array.prototype.unshift,n=0;n<e;++n){var a=arguments[n];-1===t.call(this,a)&&r.call(this,a)}return this.length>>>0}}),Object.defineProperty(Function.prototype,"partial",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Function.prototype.partial called on null or undefined");var e=Array.prototype.slice,t=this,r=e.call(arguments,0);return function(){for(var n=[],a=0,i=0;i<r.length;++i)n.push(r[i]===undefined?arguments[a++]:r[i]);return t.apply(this,n.concat(e.call(arguments,a)))}}}),Object.defineProperty(Math,"clamp",{configurable:!0,writable:!0,value:function(e,t,r){var n=Number(e);return Number.isNaN(n)?NaN:n.clamp(t,r)}}),Object.defineProperty(Math,"easeInOut",{configurable:!0,writable:!0,value:function(e){return 1-(Math.cos(Number(e)*Math.PI)+1)/2}}),Object.defineProperty(Number.prototype,"clamp",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Number.prototype.clamp called on null or undefined");if(2!==arguments.length)throw new Error("Number.prototype.clamp called with an incorrect number of parameters");var e=Number(arguments[0]),t=Number(arguments[1]);if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.min(Math.max(this,e),t)}}),RegExp.escape||function(){var e=/[\\^$*+?.()|[\]{}]/g,t=new RegExp(e.source);Object.defineProperty(RegExp,"escape",{configurable:!0,writable:!0,value:function(r){var n=String(r);return n&&t.test(n)?n.replace(e,"\\$&"):n}})}(),function(){var e=/{(\d+)(?:,([+-]?\d+))?}/g,t=new RegExp(e.source);Object.defineProperty(String,"format",{configurable:!0,writable:!0,value:function(r){function n(e,t,r){if(!t)return e;var n=Math.abs(t)-e.length;if(n<1)return e;var a=String(r).repeat(n);return t<0?e+a:a+e}if(arguments.length<2)return 0===arguments.length?"":r;var a=2===arguments.length&&Array.isArray(arguments[1])?[].concat(_toConsumableArray(arguments[1])):Array.prototype.slice.call(arguments,1);return 0===a.length?r:t.test(r)?(e.lastIndex=0,r.replace(e,function(e,t,r){var i=a[t];if(null==i)return"";for(;"function"==typeof i;)i=i();switch(void 0===i?"undefined":_typeof(i)){case"string":break;case"object":i=JSON.stringify(i);break;default:i=String(i)}return n(i,r?Number.parseInt(r,10):0," ")})):r}})}(),Object.defineProperty(String.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.contains called on null or undefined");return-1!==String.prototype.indexOf.apply(this,arguments)}}),Object.defineProperty(String.prototype,"count",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.count called on null or undefined");var e=String(arguments[0]||"");if(""===e)return 0;for(var t=String.prototype.indexOf,r=e.length,n=Number(arguments[1])||0,a=0;-1!==(n=t.call(this,e,n));)++a,n+=r;return a}}),Object.defineProperty(String.prototype,"first",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.first called on null or undefined");return _getCodePointStartAndEnd(String(this),0).char}}),Object.defineProperty(String.prototype,"last",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.last called on null or undefined");var e=String(this);return _getCodePointStartAndEnd(e,e.length-1).char}}),Object.defineProperty(String.prototype,"splice",{configurable:!0,writable:!0,value:function(e,t,r){if(null==this)throw new TypeError("String.prototype.splice called on null or undefined");var n=this.length>>>0;if(0===n)return"";var a=Number(e);Number.isSafeInteger(a)?a<0&&(a+=n)<0&&(a=0):a=0,a>n&&(a=n);var i=Number(t);(!Number.isSafeInteger(i)||i<0)&&(i=0);var o=this.slice(0,a);return void 0!==r&&(o+=r),a+i<n&&(o+=this.slice(a+i)),o}}),Object.defineProperty(String.prototype,"splitOrEmpty",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.splitOrEmpty called on null or undefined");return""===String(this)?[]:String.prototype.split.apply(this,arguments)}}),Object.defineProperty(String.prototype,"toLocaleUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toLocaleUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,n=t.end;return-1===n?"":r.toLocaleUpperCase()+e.slice(n+1)}}),Object.defineProperty(String.prototype,"toUpperFirst",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.toUpperFirst called on null or undefined");var e=String(this),t=_getCodePointStartAndEnd(e,0),r=t.char,n=t.end;return-1===n?"":r.toUpperCase()+e.slice(n+1)}}),Object.defineProperty(Date.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:date)",this.toISOString()]}}),Object.defineProperty(Function.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)","("+this.toString()+")"]}}),Object.defineProperty(Map.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:map)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(RegExp.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:eval)",this.toString()]}}),Object.defineProperty(Set.prototype,"toJSON",{configurable:!0,writable:!0,value:function(){return["(revive:set)",[].concat(_toConsumableArray(this))]}}),Object.defineProperty(JSON,"reviveWrapper",{configurable:!0,writable:!0,value:function(e,t){if("string"!=typeof e)throw new TypeError("JSON.reviveWrapper code parameter must be a string");return["(revive:eval)",[e,t]]}}),Object.defineProperty(JSON,"_real_parse",{value:JSON.parse}),Object.defineProperty(JSON,"parse",{configurable:!0,writable:!0,value:function value(text,reviver){return JSON._real_parse(text,function(key,val){var value=val;if(Array.isArray(value)&&2===value.length)switch(value[0]){case"(revive:set)":value=new Set(value[1]);break;case"(revive:map)":value=new Map(value[1]);break;case"(revive:date)":value=new Date(value[1]);break;case"(revive:eval)":try{if(Array.isArray(value[1])){var $ReviveData$=value[1][1];value=eval(value[1][0])}else value=eval(value[1])}catch(e){}}else if("string"==typeof value&&"@@revive@@"===value.slice(0,10))try{value=eval(value.slice(10))}catch(e){}if("function"==typeof reviver)try{value=reviver(key,value)}catch(e){}return value})}}),Object.defineProperty(Array.prototype,"contains",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.contains called on null or undefined");return Array.prototype.includes.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAll",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAll called on null or undefined");return Array.prototype.includesAll.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"containsAny",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.containsAny called on null or undefined");return Array.prototype.includesAny.apply(this,arguments)}}),Object.defineProperty(Array.prototype,"flatten",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("Array.prototype.flatten called on null or undefined");return Array.prototype.flat.call(this,1/0)}}),Object.defineProperty(String.prototype,"readBracketedList",{configurable:!0,writable:!0,value:function(){if(null==this)throw new TypeError("String.prototype.readBracketedList called on null or undefined");for(var e=new RegExp("(?:\\[\\[((?:\\s|\\S)*?)\\]\\])|([^\"'\\s]\\S*)","gm"),t=[],r=void 0;null!==(r=e.exec(this));)r[1]?t.push(r[1]):r[2]&&t.push(r[2]);return t}})}();var Browser=function(){var e=navigator.userAgent.toLowerCase(),t=e.includes("windows phone"),r=Object.freeze({Android:!t&&e.includes("android"),BlackBerry:/blackberry|bb10/.test(e),iOS:!t&&/ip(?:hone|ad|od)/.test(e),Opera:!t&&("object"===_typeof(window.operamini)||e.includes("opera mini")),Windows:t||/iemobile|wpdesktop/.test(e),any:function(){return r.Android||r.BlackBerry||r.iOS||r.Opera||r.Windows}}),n=!r.Windows&&!/khtml|trident|edge/.test(e)&&e.includes("gecko"),a=!e.includes("opera")&&/msie|trident/.test(e),i=a?function(){var t=/(?:msie\s+|rv:)(\d+\.\d)/.exec(e);return t?Number(t[1]):0}():null,o=e.includes("opera")||e.includes(" opr/"),s=o?function(){var t=new RegExp((/khtml|chrome/.test(e)?"opr":"version")+"\\/(\\d+\\.\\d+)"),r=t.exec(e);return r?Number(r[1]):0}():null,u=e.includes("vivaldi");return Object.freeze({userAgent:e,isMobile:r,isGecko:n,isIE:a,ieVersion:i,isOpera:o,operaVersion:s,isVivaldi:u})}(),Has=function(){var e=function(){try{return"function"==typeof document.createElement("audio").canPlayType}catch(e){}return!1}(),t=e&&function(){try{var e=document.createElement("audio").play();return e.catch(function(){}),e instanceof Promise}catch(e){}return!1}(),r=function(){try{return"Blob"in window&&"File"in window&&"FileList"in window&&"FileReader"in window&&!Browser.isMobile.any()&&(!Browser.isOpera||Browser.operaVersion>=15)}catch(e){}return!1}(),n=function(){try{return"geolocation"in navigator&&"function"==typeof navigator.geolocation.getCurrentPosition&&"function"==typeof navigator.geolocation.watchPosition}catch(e){}return!1}(),a=function(){try{return"MutationObserver"in window&&"function"==typeof window.MutationObserver}catch(e){}return!1}(),i=function(){try{return"performance"in window&&"function"==typeof window.performance.now}catch(e){}return!1}(),o=function(){try{return"ontouchstart"in window||!!window.DocumentTouch&&document instanceof window.DocumentTouch||!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints}catch(e){}return!1}(),s=function(){try{for(var e=new Map([["transition","transitionend"],["MSTransition","msTransitionEnd"],["WebkitTransition","webkitTransitionEnd"],["MozTransition","transitionend"]]),t=[].concat(_toConsumableArray(e.keys())),r=document.createElement("div"),n=0;n<t.length;++n)if(r.style[t[n]]!==undefined)return e.get(t[n])}catch(e){}return!1}();return Object.freeze({audio:e,audioPromise:t,fileAPI:r,geolocation:n,mutationObserver:a,performance:i,touch:o,transitionEndEvent:s})}(),Visibility=function(){function e(){return Boolean(r&&document[r.hiddenProperty])}function t(){return r&&document[r.stateProperty]||"visible"}var r=function(){try{return Object.freeze([{hiddenProperty:"hidden",stateProperty:"visibilityState",changeEvent:"visibilitychange"},{hiddenProperty:"webkitHidden",stateProperty:"webkitVisibilityState",changeEvent:"webkitvisibilitychange"},{hiddenProperty:"mozHidden",stateProperty:"mozVisibilityState",changeEvent:"mozvisibilitychange"},{hiddenProperty:"msHidden",stateProperty:"msVisibilityState",changeEvent:"msvisibilitychange"}].find(function(e){return e.hiddenProperty in document}))}catch(e){}return null}();return Object.freeze(Object.defineProperties({},{isHidden:{value:e},state:{value:t},hiddenProperty:{value:r.hiddenProperty},stateProperty:{value:r.stateProperty},changeEvent:{value:r.changeEvent}}))}(),_ref3=function(){function e(t){if("object"!==(void 0===t?"undefined":_typeof(t))||null===t)return t;if(t instanceof String)return String(t);if(t instanceof Number)return Number(t);if(t instanceof Boolean)return Boolean(t);if("function"==typeof t.clone)return t.clone(!0);if(t.nodeType&&"function"==typeof t.cloneNode)return t.cloneNode(!0);var r=void 0;return t instanceof Array?r=new Array(t.length):t instanceof Date?r=new Date(t.getTime()):t instanceof Map?(r=new Map,t.forEach(function(t,n){return r.set(n,e(t))})):t instanceof RegExp?r=new RegExp(t):t instanceof Set?(r=new Set,t.forEach(function(t){return r.add(e(t))})):r=Object.create(Object.getPrototypeOf(t)),Object.keys(t).forEach(function(n){return r[n]=e(t[n])}),r}function t(e){for(var t=document.createDocumentFragment(),r=document.createElement("p"),n=void 0;null!==(n=e.firstChild);){if(n.nodeType===Node.ELEMENT_NODE){switch(n.nodeName.toUpperCase()){case"BR":if(null!==n.nextSibling&&n.nextSibling.nodeType===Node.ELEMENT_NODE&&"BR"===n.nextSibling.nodeName.toUpperCase()){e.removeChild(n.nextSibling),e.removeChild(n),t.appendChild(r),r=document.createElement("p");continue}if(!r.hasChildNodes()){e.removeChild(n);continue}break;case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":r.hasChildNodes()&&(t.appendChild(r),r=document.createElement("p")),t.appendChild(n);continue}}r.appendChild(n)}r.hasChildNodes()&&t.appendChild(r),e.appendChild(t)}function r(){try{return document.activeElement||null}catch(e){return null}}function n(e,t,r){var n="object"===(void 0===e?"undefined":_typeof(e))?e:document.getElementById(e);if(null==n)return null;var a=Array.isArray(t)?t:[t];jQuery(n).empty();for(var i=0,o=a.length;i<o;++i)if(Story.has(a[i]))return new Wikifier(n,Story.get(a[i]).processText().trim()),n;if(null!=r){var s=String(r).trim();""!==s&&new Wikifier(n,s)}return n}function a(e,t,r){var n=jQuery(document.createElement("div")),a=jQuery(document.createElement("button")),i=jQuery(document.createElement("pre")),o=L10n.get("errorTitle")+": "+(t||"unknown error");return a.addClass("error-toggle").ariaClick({label:L10n.get("errorToggle")},function(){a.hasClass("enabled")?(a.removeClass("enabled"),i.attr({"aria-hidden":!0,hidden:"hidden"})):(a.addClass("enabled"),i.removeAttr("aria-hidden hidden"))}).appendTo(n),jQuery(document.createElement("span")).addClass("error").text(o).appendTo(n),jQuery(document.createElement("code")).text(r).appendTo(i),i.addClass("error-source").attr({"aria-hidden":!0,hidden:"hidden"}).appendTo(n),n.addClass("error-view").appendTo(e),console.warn(o+"\n\t"+r.replace(/\n/g,"\n\t")),!1}function i(e,t){var r=i;switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return t;break;case"object":if(null===e)return t;if(Array.isArray(e))return e.map(function(e){return r(e,t)}).join(", ");if(e instanceof Set)return[].concat(_toConsumableArray(e)).map(function(e){return r(e,t)}).join(", ");if(e instanceof Map){return"{ "+[].concat(_toConsumableArray(e)).map(function(e){var n=_slicedToArray(e,2),a=n[0],i=n[1];return r(a,t)+" → "+r(i,t)}).join(", ")+" }"}return e instanceof Date?e.toLocaleString():"function"==typeof e.toString?e.toString():Object.prototype.toString.call(e);case"function":case"undefined":return t}return String(e)}return Object.freeze(Object.defineProperties({},{clone:{value:e},convertBreaks:{value:t},safeActiveElement:{value:r},setPageElement:{value:n},throwError:{value:a},toStringOrDefault:{value:i}}))
}(),clone=_ref3.clone,convertBreaks=_ref3.convertBreaks,safeActiveElement=_ref3.safeActiveElement,setPageElement=_ref3.setPageElement,throwError=_ref3.throwError,toStringOrDefault=_ref3.toStringOrDefault;!function(){function e(e){13!==e.which&&32!==e.which||(e.preventDefault(),jQuery(safeActiveElement()||this).trigger("click"))}function t(e){return function(){var t=jQuery(this);t.ariaIsDisabled()||(t.is("[aria-pressed]")&&t.attr("aria-pressed","true"===t.attr("aria-pressed")?"false":"true"),e.apply(this,arguments))}}function r(e){return t(function(){jQuery(this).off(".aria-clickable").removeAttr("tabindex aria-controls aria-pressed").not("a,button").removeAttr("role").end().filter("button").prop("disabled",!0),e.apply(this,arguments)})}jQuery.fn.extend({ariaClick:function(n,a){if(0===this.length||0===arguments.length)return this;var i=n,o=a;return null==o&&(o=i,i=undefined),i=jQuery.extend({namespace:undefined,one:!1,selector:undefined,data:undefined,controls:undefined,pressed:undefined,label:undefined},i),"string"!=typeof i.namespace?i.namespace="":"."!==i.namespace[0]&&(i.namespace="."+i.namespace),"boolean"==typeof i.pressed&&(i.pressed=i.pressed?"true":"false"),this.filter("button").prop("type","button"),this.not("a,button").attr("role","button"),this.attr("tabindex",0),null!=i.controls&&this.attr("aria-controls",i.controls),null!=i.pressed&&this.attr("aria-pressed",i.pressed),null!=i.label&&this.attr({"aria-label":i.label,title:i.label}),this.not("button").on("keypress.aria-clickable"+i.namespace,i.selector,e),this.on("click.aria-clickable"+i.namespace,i.selector,i.data,i.one?r(o):t(o)),this},ariaDisabled:function(e){if(0===this.length||0===arguments.length)return this;var t=this.not("button,fieldset,input,menuitem,optgroup,option,select,textarea"),r=this.filter("button,fieldset,input,menuitem,optgroup,option,select,textarea");return e?(t.each(function(){this.setAttribute("disabled",""),this.setAttribute("aria-disabled","")}),r.each(function(){this.disabled=!0,this.setAttribute("aria-disabled","")})):(t.each(function(){this.removeAttribute("disabled"),this.removeAttribute("aria-disabled")}),r.each(function(){this.disabled=!1,this.removeAttribute("aria-disabled")})),this},ariaIsDisabled:function(){return this.is("[disabled]")}})}(),function(){jQuery.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(0!==r.length){var a=document.createDocumentFragment();r.forEach(function(t){return new Wikifier(a,t,e)});var i=[].concat(_toConsumableArray(a.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(i.length>0)throw new Error(i.join("; "))}},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];this.wikiWithOptions.apply(this,[undefined].concat(t))}}),jQuery.fn.extend({wikiWithOptions:function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(0===this.length||0===r.length)return this;var a=document.createDocumentFragment();return r.forEach(function(t){return new Wikifier(a,t,e)}),this.append(a),this},wiki:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.wikiWithOptions.apply(this,[undefined].concat(t))}})}();var Util=function(){function e(e){if(e instanceof Array)return Object.freeze(e.reduce(function(e,t,r){return e[t]=r,e},Object.create(null)));if(e instanceof Object)return Object.freeze(Object.assign(Object.create(null),e));throw new TypeError("Util.toEnum obj parameter must be an array or generic object")}function t(e){return Object.prototype.toString.call(e).slice(8,-1)}function r(e){if(null===e)return"null";var t=void 0===e?"undefined":_typeof(e);return"object"===t?Object.prototype.toString.call(e).slice(8,-1):t}function n(e){var t=void 0;switch(void 0===e?"undefined":_typeof(e)){case"number":t=e;break;case"string":t=Number(e);break;default:return!1}return!Number.isNaN(t)&&Number.isFinite(t)}function a(e){return"boolean"==typeof e||"string"==typeof e&&("true"===e||"false"===e)}function i(e,t){return e===t||e!==e&&t!==t}function o(e){var t=String(e).trim(),r=t.replace(/[^\w\s\u2013\u2014-]+/g,"").replace(/[_\s\u2013\u2014-]+/g,"-").toLocaleLowerCase();return v.test(r)?t.replace(m,"").replace(/[_\s\u2013\u2014-]+/g,"-"):r}function s(e){if(null==e)return"";var t=String(e);return t&&b.test(t)?t.replace(y,function(e){return w[e]}):t}function u(e){if(null==e)return"";var t=String(e);return t&&S.test(t)?t.replace(k,function(e){return E[e.toLowerCase()]}):t}function l(e,t){var r=String(e),n=Math.trunc(t),a=r.charCodeAt(n);if(Number.isNaN(a))return{char:"",start:-1,end:-1};var i={char:r.charAt(n),start:n,end:n};if(a<55296||a>57343)return i;if(a>=55296&&a<=56319){var o=n+1;if(o>=r.length)return i;var s=r.charCodeAt(o);return s<56320||s>57343?i:(i.char=i.char+r.charAt(o),i.end=o,i)}if(0===n)return i;var u=n-1,l=r.charCodeAt(u);return l<55296||l>56319?i:(i.char=r.charAt(u)+i.char,i.start=u,i)}function c(){return j.now()}function d(e){var t=x.exec(String(e));if(null===t)throw new SyntaxError('invalid time value syntax: "'+e+'"');var r=Number(t[1]);if(1===t[2].length&&(r*=1e3),Number.isNaN(r)||!Number.isFinite(r))throw new RangeError('invalid time value: "'+e+'"');return r}function f(e){if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)){var r=void 0;switch(void 0===e?"undefined":_typeof(e)){case"string":r='"'+e+'"';break;case"number":r=String(e);break;default:r=t(e)}throw new Error("invalid milliseconds: "+r)}return e+"ms"}function p(e){if(!e.includes("-"))switch(e){case"bgcolor":return"backgroundColor";case"float":return"cssFloat";default:return e}return("-ms-"===e.slice(0,4)?e.slice(1):e).split("-").map(function(e,t){return 0===t?e:e.toUpperFirst()}).join("")}function h(e){var t=document.createElement("a"),r=Object.create(null);t.href=e,t.search&&t.search.replace(/^\?/,"").splitOrEmpty(/(?:&(?:amp;)?|;)/).forEach(function(e){var t=e.split("="),n=_slicedToArray(t,2),a=n[0],i=n[1];r[a]=i});var n=t.host&&"/"!==t.pathname[0]?"/"+t.pathname:t.pathname;return{href:t.href,protocol:t.protocol,host:t.host,hostname:t.hostname,port:t.port,path:""+n+t.search,pathname:n,query:t.search,search:t.search,queries:r,searches:r,hash:t.hash}}function g(e,t,r){if("object"!==(void 0===e?"undefined":_typeof(e))||null===e)throw new Error("Util.newExceptionFrom original parameter must be an object");if("function"!=typeof t)throw new Error("Util.newExceptionFrom exceptionType parameter must be an error type constructor");var n=new t(e.message);void 0!==e.name&&(n.name=e.name),void 0!==e.code&&(n.code=e.code),void 0!==e.columnNumber&&(n.columnNumber=e.columnNumber),void 0!==e.description&&(n.description=e.description),void 0!==e.fileName&&(n.fileName=e.fileName),void 0!==e.lineNumber&&(n.lineNumber=e.lineNumber),void 0!==e.number&&(n.number=e.number),void 0!==e.stack&&(n.stack=e.stack);var a=void 0===r?"undefined":_typeof(r);if("undefined"!==a)if("object"===a&&null!==r)Object.assign(n,r);else{if("string"!==a)throw new Error("Util.newExceptionFrom override parameter must be an object or string");n.message=r}return n}var m=/[\x00-\x1f"#$%&'*+,\/:;<=>?\\^`|\x7f-\x9f]+/g,v=/^-*$/,y=/[&<>"'`]/g,b=new RegExp(y.source),w=Object.freeze({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"}),k=/&(?:amp|#38|#x26|lt|#60|#x3c|gt|#62|#x3e|quot|#34|#x22|apos|#39|#x27|#96|#x60);/gi,S=new RegExp(k.source,"i"),E=Object.freeze({"&amp;":"&","&#38;":"&","&#x26;":"&","&lt;":"<","&#60;":"<","&#x3c;":"<","&gt;":">","&#62;":">","&#x3e;":">","&quot;":'"',"&#34;":'"',"&#x22;":'"',"&apos;":"'","&#39;":"'","&#x27;":"'","&#96;":"`","&#x60;":"`"}),j=Has.performance?performance:Date,x=/^([+-]?(?:\d*\.)?\d+)([Mm]?[Ss])$/;return Object.freeze(Object.defineProperties({},{toEnum:{value:e},toStringTag:{value:t},getType:{value:r},isNumeric:{value:n},isBoolean:{value:a},sameValueZero:{value:i},slugify:{value:o},escape:{value:s},unescape:{value:u},charAndPosAt:{value:l},fromCssTime:{value:d},toCssTime:{value:f},fromCssProperty:{value:p},parseUrl:{value:h},newExceptionFrom:{value:g},now:{value:c},random:{value:Math.random},entityEncode:{value:s},entityDecode:{value:u},evalExpression:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),SimpleStore=function(){function e(e,n){if(r)return r.create(e,n);for(var a=0;a<t.length;++a)if(t[a].init(e,n))return r=t[a],r.create(e,n);throw new Error("no valid storage adapters found")}var t=[],r=null;return Object.freeze(Object.defineProperties({},{adapters:{value:t},create:{value:e}}))}();SimpleStore.adapters.push(function(){function e(){function e(e){try{var t=window[e],r="_sc_"+String(Date.now());t.setItem(r,r);var n=t.getItem(r)===r;return t.removeItem(r),n}catch(e){}return!1}return r=e("localStorage")&&e("sessionStorage")}function t(e,t){if(!r)throw new Error("adapter not initialized");return new n(e,t)}var r=!1,n=function(){function e(t,r){_classCallCheck(this,e);var n=t+".",a=null,i=null;r?(a=window.localStorage,i="localStorage"):(a=window.sessionStorage,i="sessionStorage"),Object.defineProperties(this,{_engine:{value:a},_prefix:{value:n},_prefixRe:{value:new RegExp("^"+RegExp.escape(n))},name:{value:i},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){for(var e=[],t=0;t<this._engine.length;++t){var r=this._engine.key(t);this._prefixRe.test(r)&&e.push(r.replace(this._prefixRe,""))}return e}},{key:"has",value:function(e){return!("string"!=typeof e||!e)&&this._engine.hasOwnProperty(this._prefix+e)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=this._engine.getItem(this._prefix+t);return null==r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{this._engine.setItem(this._prefix+t,e._serialize(r))}catch(e){if(/quota.?(?:exceeded|reached)/i.test(e.name+e.message))throw Util.newExceptionFrom(e,Error,this.name+" quota exceeded");throw e}return!0}},{key:"delete",value:function(e){return!("string"!=typeof e||!e)&&(this._engine.removeItem(this._prefix+e),!0)}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_serialize",value:function(e){return LZString.compressToUTF16(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromUTF16(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}()),SimpleStore.adapters.push(function(){function e(e){try{var t="_sc_"+String(Date.now());o._setCookie(t,o._serialize(t),undefined),i=o._deserialize(o._getCookie(t))===t,o._setCookie(t,undefined,a)}catch(e){i=!1}return i&&r(e),i}function t(e,t){if(!i)throw new Error("adapter not initialized");return new o(e,t)}function r(e){if(""!==document.cookie)for(var t=e+".",r=new RegExp("^"+RegExp.escape(t)),i=e+"!.",s=e+"*.",u=/\.(?:state|rcWarn)$/,l=document.cookie.split(/;\s*/),c=0;c<l.length;++c){var d=l[c].split("="),f=decodeURIComponent(d[0]);if(r.test(f)){var p=decodeURIComponent(d[1]);""!==p&&function(){var e=!u.test(f);o._setCookie(f,undefined,a),o._setCookie(f.replace(r,function(){return e?i:s}),p,e?n:undefined)}()}}}var n="Tue, 19 Jan 2038 03:14:07 GMT",a="Thu, 01 Jan 1970 00:00:00 GMT",i=!1,o=function(){function e(t,r){_classCallCheck(this,e);var n=t+(r?"!":"*")+".";Object.defineProperties(this,{_prefix:{value:n},_prefixRe:{value:new RegExp("^"+RegExp.escape(n))},name:{value:"cookie"},id:{value:t},persistent:{value:!!r}})}return _createClass(e,[{key:"size",value:function(){return this.keys().length}},{key:"keys",value:function(){if(""===document.cookie)return[];for(var e=document.cookie.split(/;\s*/),t=[],r=0;r<e.length;++r){var n=e[r].split("="),a=decodeURIComponent(n[0]);if(this._prefixRe.test(a)){""!==decodeURIComponent(n[1])&&t.push(a.replace(this._prefixRe,""))}}return t}},{key:"has",value:function(t){return!("string"!=typeof t||!t)&&null!==e._getCookie(this._prefix+t)}},{key:"get",value:function(t){if("string"!=typeof t||!t)return null;var r=e._getCookie(this._prefix+t);return null===r?null:e._deserialize(r)}},{key:"set",value:function(t,r){if("string"!=typeof t||!t)return!1;try{if(e._setCookie(this._prefix+t,e._serialize(r),this.persistent?n:undefined),!this.has(t))throw new Error("unknown validation error during set")}catch(e){throw Util.newExceptionFrom(e,Error,"cookie error: "+e.message)}return!0}},{key:"delete",value:function(t){if("string"!=typeof t||!t||!this.has(t))return!1;try{if(e._setCookie(this._prefix+t,undefined,a),this.has(t))throw new Error("unknown validation error during delete")}catch(e){throw Util.newExceptionFrom(e,Error,"cookie error: "+e.message)}return!0}},{key:"clear",value:function(){for(var e=this.keys(),t=0,r=e.length;t<r;++t)this.delete(e[t]);return!0}},{key:"length",get:function(){return this.keys().length}}],[{key:"_getCookie",value:function(e){if(!e||""===document.cookie)return null;for(var t=document.cookie.split(/;\s*/),r=0;r<t.length;++r){var n=t[r].split("=");if(e===decodeURIComponent(n[0])){return decodeURIComponent(n[1])||null}}return null}},{key:"_setCookie",value:function(e,t,r){if(e){var n=encodeURIComponent(e)+"=";null!=t&&(n+=encodeURIComponent(t)),null!=r&&(n+="; expires="+r),n+="; path=/",document.cookie=n}}},{key:"_serialize",value:function(e){return LZString.compressToBase64(JSON.stringify(e))}},{key:"_deserialize",value:function(e){return JSON.parse(LZString.decompressFromBase64(e))}}]),e}();return Object.freeze(Object.defineProperties({},{init:{value:e},create:{value:t}}))}());var DebugView=function(){return function(){function e(t,r,n,a){_classCallCheck(this,e),Object.defineProperties(this,{parent:{value:t},view:{value:document.createElement("span")},break:{value:document.createElement("wbr")}}),jQuery(this.view).attr({title:a,"aria-label":a,"data-type":null!=r?r:"","data-name":null!=n?n:""}).addClass("debug"),jQuery(this.break).addClass("debug hidden"),this.parent.appendChild(this.view),this.parent.appendChild(this.break)}return _createClass(e,[{key:"append",value:function(e){return jQuery(this.view).append(e),this}},{key:"modes",value:function(e){if(null==e){var t={};return this.view.className.splitOrEmpty(/\s+/).forEach(function(e){"debug"!==e&&(t[e]=!0)}),t}if("object"===(void 0===e?"undefined":_typeof(e)))return Object.keys(e).forEach(function(t){this[e[t]?"addClass":"removeClass"](t)},jQuery(this.view)),this;throw new Error("DebugView.prototype.modes options parameter must be an object or null/undefined")}},{key:"remove",value:function(){var e=jQuery(this.view);this.view.hasChildNodes()&&e.contents().appendTo(this.parent),e.remove(),jQuery(this.break).remove()}},{key:"output",get:function(){return this.view}},{key:"type",get:function(){return this.view.getAttribute("data-type")},set:function(e){this.view.setAttribute("data-type",null!=e?e:"")}},{key:"name",get:function(){return this.view.getAttribute("data-name")},set:function(e){this.view.setAttribute("data-name",null!=e?e:"")}},{key:"title",get:function(){return this.view.title},set:function(e){this.view.title=e}}],[{key:"isEnabled",value:function(){return"enabled"===jQuery(document.documentElement).attr("data-debug-view")}},{key:"enable",value:function(){jQuery(document.documentElement).attr("data-debug-view","enabled"),jQuery.event.trigger(":debugviewupdate")}},{key:"disable",value:function(){jQuery(document.documentElement).removeAttr("data-debug-view"),jQuery.event.trigger(":debugviewupdate")}},{key:"toggle",value:function(){"enabled"===jQuery(document.documentElement).attr("data-debug-view")?e.disable():e.enable()}}]),e}()}(),PRNGWrapper=function(){return function(){function e(t,r){_classCallCheck(this,e),Object.defineProperties(this,new Math.seedrandom(t,r,function(e,t){return{_prng:{value:e},seed:{writable:!0,value:t},pull:{writable:!0,value:0},random:{value:function(){return++this.pull,this._prng()}}}}))}return _createClass(e,null,[{key:"marshal",value:function(e){if(!e||!e.hasOwnProperty("seed")||!e.hasOwnProperty("pull"))throw new Error("PRNG is missing required data");return{seed:e.seed,pull:e.pull}}},{key:"unmarshal",value:function(t){if(!t||!t.hasOwnProperty("seed")||!t.hasOwnProperty("pull"))throw new Error("PRNG object is missing required data");for(var r=new e(t.seed,!1),n=t.pull;n>0;--n)r.random();return r}}]),e}()}(),StyleWrapper=function(){var e=new RegExp(Patterns.cssImage,"g"),t=new RegExp(Patterns.cssImage);return function(){function r(e){if(_classCallCheck(this,r),null==e)throw new TypeError("StyleWrapper style parameter must be an HTMLStyleElement object");Object.defineProperties(this,{style:{value:e}})}return _createClass(r,[{key:"isEmpty",value:function(){return 0===this.style.cssRules.length}},{key:"set",value:function(e){this.clear(),this.add(e)}},{key:"add",value:function(r){var n=r;t.test(n)&&(e.lastIndex=0,n=n.replace(e,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var n=Story.get(r);n.tags.includes("Twine.image")&&(r=n.text.trim())}return'url("'+r.replace(/"/g,"%22")+'")'})),this.style.styleSheet?this.style.styleSheet.cssText+=n:this.style.appendChild(document.createTextNode(n))}},{key:"clear",value:function(){this.style.styleSheet?this.style.styleSheet.cssText="":jQuery(this.style).empty()}}]),r}()}(),Diff=function(){function e(t,n){for(var a=Object.prototype.toString,i=t instanceof Array,o=[].concat(Object.keys(t),Object.keys(n)).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}),s={},u=void 0,l=function(e){return e===u},c=0,d=o.length;c<d;++c){var f=o[c],p=t[f],h=n[f];if(t.hasOwnProperty(f))if(n.hasOwnProperty(f)){if(p===h)continue;if((void 0===p?"undefined":_typeof(p))===(void 0===h?"undefined":_typeof(h)))if("function"==typeof p)p.toString()!==h.toString()&&(s[f]=[r.Copy,h]);else if("object"!==(void 0===p?"undefined":_typeof(p))||null===p)s[f]=[r.Copy,h];else{var g=a.call(p),m=a.call(h);if(g===m)if(p instanceof Date)Number(p)!==Number(h)&&(s[f]=[r.Copy,clone(h)]);else if(p instanceof Map)s[f]=[r.Copy,clone(h)];else if(p instanceof RegExp)p.toString()!==h.toString()&&(s[f]=[r.Copy,clone(h)]);else if(p instanceof Set)s[f]=[r.Copy,clone(h)];else if("[object Object]"!==g)s[f]=[r.Copy,clone(h)];else{var v=e(p,h);null!==v&&(s[f]=v)}else s[f]=[r.Copy,clone(h)]}else s[f]=[r.Copy,"object"!==(void 0===h?"undefined":_typeof(h))||null===h?h:clone(h)]}else if(i&&Util.isNumeric(f)){var y=Number(f);if(!u){u="";do{u+="~"}while(o.some(l));s[u]=[r.SpliceArray,y,y]}y<s[u][1]&&(s[u][1]=y),y>s[u][2]&&(s[u][2]=y)}else s[f]=r.Delete;else s[f]=[r.Copy,"object"!==(void 0===h?"undefined":_typeof(h))||null===h?h:clone(h)]}return Object.keys(s).length>0?s:null}function t(e,n){for(var a=Object.keys(n||{}),i=clone(e),o=0,s=a.length;o<s;++o){var u=a[o],l=n[u];if(l===r.Delete)delete i[u];else if(l instanceof Array)switch(l[0]){case r.SpliceArray:i.splice(l[1],l[2]-l[1]+1);break;case r.Copy:i[u]=clone(l[1]);break;case r.CopyDate:i[u]=new Date(l[1])}else i[u]=t(i[u],l)}return i}var r=Util.toEnum({Delete:0,SpliceArray:1,Copy:2,CopyDate:3});return Object.freeze(Object.defineProperties({},{Op:{value:r},diff:{value:e},patch:{value:t}}))}(),L10n=function(){function e(){r()}function t(e,t){if(!e)return"";var r=function(e){var t=void 0;return e.some(function(e){return!!l10nStrings.hasOwnProperty(e)&&(t=e,!0)}),t}(Array.isArray(e)?e:[e]);if(!r)return"";for(var i=l10nStrings[r],o=0;a.test(i);){if(++o>50)throw new Error("L10n.get exceeded maximum replacement iterations, probable infinite loop");n.lastIndex=0,i=i.replace(n,function(e){var r=e.slice(1,-1);return t&&t.hasOwnProperty(r)?t[r]:l10nStrings.hasOwnProperty(r)?l10nStrings[r]:void 0})}return i}function r(){strings&&Object.keys(strings).length>0&&Object.keys(l10nStrings).forEach(function(e){try{var t=void 0;switch(e){case"identity":t=strings.identity;break;case"aborting":t=strings.aborting;break;case"cancel":t=strings.cancel;break;case"close":t=strings.close;break;case"ok":t=strings.ok;break;case"errorTitle":t=strings.errors.title;break;case"errorNonexistentPassage":t=strings.errors.nonexistentPassage;break;case"errorSaveMissingData":t=strings.errors.saveMissingData;break;case"errorSaveIdMismatch":t=strings.errors.saveIdMismatch;break;case"warningDegraded":t=strings.warnings.degraded;break;case"debugViewTitle":t=strings.debugView.title;break;case"debugViewToggle":t=strings.debugView.toggle;break;case"uiBarToggle":t=strings.uiBar.toggle;break;case"uiBarBackward":t=strings.uiBar.backward;break;case"uiBarForward":t=strings.uiBar.forward;break;case"uiBarJumpto":t=strings.uiBar.jumpto;break;case"jumptoTitle":t=strings.jumpto.title;break;case"jumptoTurn":t=strings.jumpto.turn;break;case"jumptoUnavailable":t=strings.jumpto.unavailable;break;case"savesTitle":t=strings.saves.title;break;case"savesDisallowed":t=strings.saves.disallowed;break;case"savesIncapable":t=strings.saves.incapable;break;case"savesLabelAuto":t=strings.saves.labelAuto;break;case"savesLabelDelete":t=strings.saves.labelDelete;break;case"savesLabelExport":t=strings.saves.labelExport;break;case"savesLabelImport":t=strings.saves.labelImport;break;case"savesLabelLoad":t=strings.saves.labelLoad;break;case"savesLabelClear":t=strings.saves.labelClear;break;case"savesLabelSave":t=strings.saves.labelSave;break;case"savesLabelSlot":t=strings.saves.labelSlot;break;case"savesUnavailable":t=strings.saves.unavailable;break;case"savesUnknownDate":t=strings.saves.unknownDate;break;case"settingsTitle":t=strings.settings.title;break;case"settingsOff":t=strings.settings.off;break;case"settingsOn":t=strings.settings.on;break;case"settingsReset":t=strings.settings.reset;break;case"restartTitle":t=strings.restart.title;break;case"restartPrompt":t=strings.restart.prompt;break;case"shareTitle":t=strings.share.title;break;case"autoloadTitle":t=strings.autoload.title;break;case"autoloadCancel":t=strings.autoload.cancel;break;case"autoloadOk":t=strings.autoload.ok;break;case"autoloadPrompt":t=strings.autoload.prompt;break;case"macroBackText":t=strings.macros.back.text;break;case"macroReturnText":t=strings.macros.return.text}t&&(l10nStrings[e]=t.replace(/%\w+%/g,function(e){return"{"+e.slice(1,-1)+"}"}))}catch(e){}})}var n=/\{\w+\}/g,a=new RegExp(n.source);return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:t}}))}(),strings={errors:{},warnings:{},debugView:{},uiBar:{},jumpto:{},saves:{},settings:{},restart:{},share:{},autoload:{},macros:{back:{},return:{}}},l10nStrings={identity:"game",aborting:"Aborting",cancel:"Cancel",close:"Close",ok:"OK",errorTitle:"Error",errorToggle:"Toggle the error view",errorNonexistentPassage:'the passage "{passage}" does not exist',errorSaveMissingData:"save is missing required data. Either the loaded file is not a save or the save has become corrupted",errorSaveIdMismatch:"save is from the wrong {identity}",_warningIntroLacking:"Your browser either lacks or has disabled",_warningOutroDegraded:", so this {identity} is running in a degraded mode. You may be able to continue, however, some parts may not work properly.",warningNoWebStorage:"{_warningIntroLacking} the Web Storage API{_warningOutroDegraded}",warningDegraded:"{_warningIntroLacking} some of the capabilities required by this {identity}{_warningOutroDegraded}",debugBarToggle:"Toggle the debug bar",debugBarNoWatches:"— no watches set —",debugBarAddWatch:"Add watch",debugBarDeleteWatch:"Delete watch",debugBarWatchAll:"Watch all",debugBarWatchNone:"Delete all",debugBarLabelAdd:"Add",debugBarLabelWatch:"Watch",debugBarLabelTurn:"Turn",debugBarLabelViews:"Views",debugBarViewsToggle:"Toggle the debug views",debugBarWatchToggle:"Toggle the watch panel",uiBarToggle:"Toggle the UI bar",uiBarBackward:"Go backward within the {identity} history",uiBarForward:"Go forward within the {identity} history",uiBarJumpto:"Jump to a specific point within the {identity} history",jumptoTitle:"Jump To",jumptoTurn:"Turn",jumptoUnavailable:"No jump points currently available…",savesTitle:"Saves",savesDisallowed:"Saving has been disallowed on this passage.",savesIncapable:"{_warningIntroLacking} the capabilities required to support saves, so saves have been disabled for this session.",savesLabelAuto:"Autosave",savesLabelDelete:"Delete",savesLabelExport:"Save to Disk…",savesLabelImport:"Load from Disk…",savesLabelLoad:"Load",savesLabelClear:"Delete All",savesLabelSave:"Save",savesLabelSlot:"Slot",savesUnavailable:"No save slots found…",savesUnknownDate:"unknown",settingsTitle:"Settings",settingsOff:"Off",settingsOn:"On",settingsReset:"Reset to Defaults",restartTitle:"Restart",restartPrompt:"Are you sure that you want to restart? Unsaved progress will be lost.",shareTitle:"Share",autoloadTitle:"Autoload",autoloadCancel:"Go to start",autoloadOk:"Load autosave",autoloadPrompt:"An autosave exists. Load it now or go to the start?",macroBackText:"Back",macroReturnText:"Return"},Config=function(){function e(){throw new Error("Config.history.mode has been deprecated and is no longer used by SugarCube, please remove it from your code")}function t(){throw new Error("Config.history.tracking has been deprecated, use Config.history.maxStates instead")}var r=!1,n=!1,a=!1,i=0,o=!0,s=!0,u=!0,l=100,c=!0,d=1e3,f=void 0,p=void 0,h=!1,g=!1,m=void 0,v=void 0,y=void 0,b=void 0,w=void 0,k="untitled-story",S=void 0,E=void 0,j=void 0,x=8,O=void 0,T=800,C=!0;return Object.freeze({get debug(){return r},set debug(e){r=Boolean(e)},get addVisitedLinkClass(){return n},set addVisitedLinkClass(e){n=Boolean(e)},get cleanupWikifierOutput(){return a},set cleanupWikifierOutput(e){a=Boolean(e)},get loadDelay(){return i},set loadDelay(e){if(!Number.isSafeInteger(e)||e<0)throw new RangeError("Config.loadDelay must be a non-negative integer");i=e},audio:Object.freeze({get pauseOnFadeToZero(){return o},set pauseOnFadeToZero(e){o=Boolean(e)},get preloadMetadata(){return s},set preloadMetadata(e){s=Boolean(e)}}),history:Object.freeze({get controls(){return u},set controls(e){if((u=Boolean(e))&&1===l)throw u=!1,new Error("Config.history.controls must be false when Config.history.maxStates is 1")},get maxStates(){return l},set maxStates(e){if(!Number.isSafeInteger(e)||e<0)throw new RangeError("Config.history.maxStates must be a non-negative integer");l=e,u&&1===e&&(u=!1)},get mode(){e()},set mode(t){e()},get tracking(){t()},set tracking(e){t()}}),macros:Object.freeze({get ifAssignmentError(){return c},set ifAssignmentError(e){c=Boolean(e)},get maxLoopIterations(){return d},set maxLoopIterations(e){if(!Number.isSafeInteger(e)||e<0)throw new RangeError("Config.macros.maxLoopIterations must be a non-negative integer");d=e}}),navigation:Object.freeze({get override(){return f},set override(e){if(!(null==e||e instanceof Function))throw new TypeError("Config.navigation.override must be a function or null/undefined (received: "+Util.getType(e)+")");f=e}}),passages:Object.freeze({get descriptions(){return p},set descriptions(e){if(null!=e){var t=Util.getType(e);if("boolean"!==t&&"Object"!==t&&"function"!==t)throw new TypeError("Config.passages.descriptions must be a boolean, object, function, or null/undefined (received: "+t+")")}p=e},get displayTitles(){return h},set displayTitles(e){h=Boolean(e)},get nobr(){return g},set nobr(e){g=Boolean(e)},get onProcess(){return v},set onProcess(e){if(null!=e){var t=Util.getType(e);if("function"!==t)throw new TypeError("Config.passages.onProcess must be a function or null/undefined (received: "+t+")")}v=e},get start(){return m},set start(e){if(null!=e){var t=Util.getType(e);if("string"!==t)throw new TypeError("Config.passages.start must be a string or null/undefined (received: "+t+")")}m=e},get transitionOut(){return y},set transitionOut(e){if(null!=e){var t=Util.getType(e);if("string"!==t&&("number"!==t||!Number.isSafeInteger(e)||e<0))throw new TypeError("Config.passages.transitionOut must be a string, non-negative integer, or null/undefined (received: "+t+")")}y=e}}),saves:Object.freeze({get autoload(){return b},set autoload(e){if(null!=e){var t=Util.getType(e);if("boolean"!==t&&"string"!==t&&"function"!==t)throw new TypeError("Config.saves.autoload must be a boolean, string, function, or null/undefined (received: "+t+")")}b=e},get autosave(){return w},set autosave(e){if(null!=e){var t=Util.getType(e);if("string"===t)return void(w=[e]);if("boolean"!==t&&("Array"!==t||!e.every(function(e){return"string"==typeof e}))&&"function"!==t)throw new TypeError("Config.saves.autosave must be a boolean, Array of strings, function, or null/undefined (received: "+t+("Array"===t?" of mixed":"")+")")}w=e},get id(){return k},set id(e){if("string"!=typeof e||""===e)throw new TypeError("Config.saves.id must be a non-empty string (received: "+Util.getType(e)+")");k=e},get isAllowed(){return S},set isAllowed(e){if(!(null==e||e instanceof Function))throw new TypeError("Config.saves.isAllowed must be a function or null/undefined (received: "+Util.getType(e)+")");S=e},get onLoad(){return E},set onLoad(e){if(!(null==e||e instanceof Function))throw new TypeError("Config.saves.onLoad must be a function or null/undefined (received: "+Util.getType(e)+")");E=e},get onSave(){return j},set onSave(e){if(!(null==e||e instanceof Function))throw new TypeError("Config.saves.onSave must be a function or null/undefined (received: "+Util.getType(e)+")");j=e},get slots(){return x},set slots(e){if(!Number.isSafeInteger(e)||e<0)throw new RangeError("Config.saves.slots must be a non-negative integer");x=e},get version(){return O},set version(e){O=e}}),ui:Object.freeze({get stowBarInitially(){return T},set stowBarInitially(e){var t=Util.getType(e);if("boolean"!==t&&("number"!==t||!Number.isSafeInteger(e)||e<0))throw new TypeError("Config.passages.transitionOut must be a boolean or non-negative integer (received: "+t+")");T=e},get updateStoryElements(){return C},set updateStoryElements(e){C=Boolean(e)}})})}(),SimpleAudio=function(){function e(){if(arguments.length<2){var e=[];throw arguments.length<1&&e.push("track ID"),arguments.length<2&&e.push("sources"),new Error("no "+e.join(" or ")+" specified")}var t=String(arguments[0]).trim(),r='track ID "'+t+'"';if(_.test(t))throw new Error("invalid "+r+": track IDs must not contain colons or whitespace");var n=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1),a=void 0;try{a=T(n)}catch(e){throw new Error(r+": error during track initialization: "+e.message)}if(Config.debug&&!a.hasSource())throw new Error(r+": no supported audio sources found");N.has(t)&&N.get(t)._destroy(),N.set(t,a)}function t(e){return N.has(e)&&N.get(e)._destroy(),N.delete(e)}function r(){N.forEach(function(e){return e._destroy()}),N.clear()}function n(e){return N.has(e)}function a(e){return N.get(e)||null}function i(){if(arguments.length<2){var e=[];throw arguments.length<1&&e.push("group ID"),arguments.length<2&&e.push("track IDs"),new Error("no "+e.join(" or ")+" specified")}var t=String(arguments[0]).trim(),r='group ID "'+t+'"';if(":"!==t[0]||_.test(t.slice(1)))throw new Error("invalid "+r+": group IDs must start with a colon and must not contain colons or whitespace");if(A.includes(t))throw new Error("cannot clobber special "+r);var n=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1),a=void 0;try{a=new Set(n.map(function(e){if(!N.has(e))throw new Error('track "'+e+'" does not exist');return e}))}catch(e){throw new Error(r+": error during group initialization: "+e.message)}I.set(t,Object.freeze(Array.from(a)))}function o(e){return I.delete(e)}function s(){I.clear()}function u(e){return I.has(e)}function l(e){return I.get(e)||null}function c(){if(arguments.length<2){var e=[];throw arguments.length<1&&e.push("list ID"),
arguments.length<2&&e.push("track IDs"),new Error("no "+e.join(" or ")+" specified")}var t=String(arguments[0]).trim(),r='list ID "'+t+'"';if(_.test(t))return this.error("invalid "+r+": list IDs must not contain colons or whitespace");var n=Array.isArray(arguments[1])?Array.from(arguments[1]):Array.from(arguments).slice(1),a=void 0;try{a=new B(n.map(function(e){if(null===e)throw new Error("track descriptor must be a string or object (type: null)");switch(void 0===e?"undefined":_typeof(e)){case"string":e={id:e};break;case"object":if(!e.hasOwnProperty("id")&&!e.hasOwnProperty("sources"))throw new Error('track descriptor must contain one of either an "id" or a "sources" property');if(e.hasOwnProperty("id")&&e.hasOwnProperty("sources"))throw new Error('track descriptor must contain either an "id" or a "sources" property, not both');break;default:throw new Error("track descriptor must be a string or object (type: "+(void 0===e?"undefined":_typeof(e))+")")}var t=void 0,r=void 0,n=void 0;if(e.hasOwnProperty("id")){if("string"!=typeof e.id)throw new Error('"id" property must be a string');if(!N.has(e.id))throw new Error('track "'+e.id+'" does not exist');r=N.get(e.id)}else if(e.hasOwnProperty("sources")){if(!Array.isArray(e.sources)||0===e.sources.length)throw new Error('"sources" property must be a non-empty array');if(e.hasOwnProperty("own"))throw new Error('"own" property is not allowed with the "sources" property');try{r=T(e.sources),t=!0}catch(e){throw new Error("error during track initialization: "+e.message)}if(Config.debug&&!r.hasSource())throw new Error("no supported audio sources found")}if(e.hasOwnProperty("own")){if("boolean"!=typeof e.own)throw new Error('"own" property must be a boolean');t=e.own,t&&(r=r.clone())}if(e.hasOwnProperty("volume")){if("number"!=typeof e.volume||Number.isNaN(e.volume)||!Number.isFinite(e.volume)||e.volume<0)throw new Error('"volume" property must be a non-negative finite number');n=e.volume}return{own:null!=t&&t,track:r,volume:null!=n?n:r.volume()}}))}catch(e){throw new Error(r+": error during playlist initialization: "+e.message)}D.has(t)&&D.get(t)._destroy(),D.set(t,a)}function d(e){return D.has(e)&&D.get(e)._destroy(),D.delete(e)}function f(){D.forEach(function(e){return e._destroy()}),D.clear()}function p(e){return D.has(e)}function h(e){return D.get(e)||null}function g(){if(0===arguments.length)throw new Error("no track selector specified");var e=String(arguments[0]).trim(),t=new Set;try{var r=function e(t){var r=t.id,a=void 0;switch(r){case":all":a=n;break;case":looped":a=n.filter(function(e){return N.get(e).loop()});break;case":muted":a=n.filter(function(e){return N.get(e).mute()});break;case":paused":a=n.filter(function(e){return N.get(e).isPaused()});break;case":playing":a=n.filter(function(e){return N.get(e).isPlaying()});break;default:a=":"===r[0]?I.get(r):[r]}if(t.hasOwnProperty("not")){var i=t.not.map(function(t){return e(t)}).flat(1/0);a=a.filter(function(e){return!i.includes(e)})}return a},n=Array.from(N.keys());V(e).forEach(function(e){return r(e).forEach(function(e){if(!N.has(e))throw new Error('track "'+e+'" does not exist');t.add(e)})})}catch(e){throw new Error("error during runner initialization: "+e.message)}return new U(t)}function m(){O("load")}function v(){O("loadwithscreen")}function y(e){if(null==e)return R;R=!!e,O("mute",R)}function b(e){if(null==e)return W;if(W=!!e){var t=Visibility.changeEvent+".SimpleAudio_masterMuteOnHidden";jQuery(document).off(t).on(t,function(){return y(Visibility.isHidden())}),Visibility.isHidden()&&y(!0)}else jQuery(document).off(".SimpleAudio_masterMuteOnHidden")}function w(e){if(null==e)return M;if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e))throw new Error("rate must be a finite number");M=Math.clamp(e,.2,5),O("rate",M)}function k(){O("stop")}function S(){O("unload")}function E(e){if(null==e)return Q;if("number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e))throw new Error("volume must be a finite number");Q=Math.clamp(e,0,1),O("volume",Q)}function j(e,t){if("function"!=typeof t)throw new Error("callback parameter must be a function");L.set(e,t)}function x(e){L.delete(e)}function O(e,t){L.forEach(function(r){return r(e,t)})}function T(e){return new F(e.map(function(e){if("data:"!==e.slice(0,5)&&Story.has(e)){var t=Story.get(e);if(t.tags.includes("Twine.audio"))return t.text.trim()}var r=P.exec(e);return null===r?e:{format:r[1],src:r[2]}}))}var C=Object.freeze(["click","contextmenu","dblclick","keyup","mouseup","pointerup","touchend"]),A=Object.freeze([":not",":all",":looped",":muted",":paused",":playing"]),P=/^([\w-]+)\s*\|\s*(\S.*)$/,_=/[:\s]/,N=new Map,I=new Map,D=new Map,L=new Map,M=1,Q=1,R=!1,W=!1,F=function(){function e(t){if(_classCallCheck(this,e),t instanceof Array)this._create(t);else{if(!(t instanceof e))throw new Error("sources parameter must be either an array, of URIs or source objects, or an AudioTrack instance");this._copy(t)}}return _createClass(e,[{key:"_create",value:function(t){var r=/^data:\s*audio\/([^;,]+)\s*[;,]/i,n=/\.([^.\/\\]+)$/,a=e.getType,i=[],o=document.createElement("audio");o.preload="none",t.forEach(function(e){var t=null;switch(void 0===e?"undefined":_typeof(e)){case"string":var s=void 0;if("data:"===e.slice(0,5)){if(null===(s=r.exec(e)))throw new Error("source data URI missing media type")}else if(null===(s=n.exec(Util.parseUrl(e).pathname)))throw new Error("source URL missing file extension");var u=a(s[1]);null!==u&&(t={src:e,type:u});break;case"object":if(null===e)throw new Error("source object cannot be null");if(!e.hasOwnProperty("src"))throw new Error('source object missing required "src" property');if(!e.hasOwnProperty("format"))throw new Error('source object missing required "format" property');var l=a(e.format);null!==l&&(t={src:e.src,type:l});break;default:throw new Error("invalid source value (type: "+(void 0===e?"undefined":_typeof(e))+")")}if(null!==t){Browser.isOpera&&(t.type=t.type.replace(/;.*$/,""));var c=document.createElement("source");c.src=t.src,c.type=t.type,o.appendChild(c),i.push(t)}}),o.hasChildNodes()&&Config.audio.preloadMetadata&&(o.preload="metadata"),this._finalize(o,i,clone(t))}},{key:"_copy",value:function(e){this._finalize(e.audio.cloneNode(!0),clone(e.sources),clone(e.originals))}},{key:"_finalize",value:function(e,t,r){var n=this;Object.defineProperties(this,{audio:{configurable:!0,value:e},sources:{value:Object.freeze(t)},originals:{value:Object.freeze(r)},_error:{writable:!0,value:!1},_faderId:{writable:!0,value:null},_mute:{writable:!0,value:!1},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1}}),jQuery(this.audio).on("loadstart.AudioTrack",function(){return n._error=!1}).on("error.AudioTrack",function(){return n._error=!0}).find("source:last-of-type").on("error.AudioTrack",function(){return n._trigger("error")}),j(this,function(e){if(!n.audio)return void x(n);switch(e){case"loadwithscreen":if(n.hasSource()){var t=LoadScreen.lock();n.one("canplaythrough.AudioTrack_loadwithscreen error.AudioTrack_loadwithscreen",function(){jQuery(this).off(".AudioTrack_loadwithscreen"),LoadScreen.unlock(t)}).load()}break;case"load":n.load();break;case"mute":n._updateAudioMute();break;case"rate":n._updateAudioRate();break;case"stop":n.stop();break;case"volume":n._updateAudioVolume();break;case"unload":n.unload()}}),this._updateAudioMute(),this._updateAudioRate(),this._updateAudioVolume()}},{key:"_trigger",value:function(e){jQuery(this.audio).triggerHandler(e)}},{key:"_destroy",value:function(){x(this),this.audio&&(jQuery(this.audio).off(),this.unload(),this._error=!0,delete this.audio)}},{key:"clone",value:function(){return new e(this)}},{key:"load",value:function(){var e=this;if(this.fadeStop(),this.audio.pause(),!this.audio.hasChildNodes()){if(0===this.sources.length)return;this.sources.forEach(function(t){var r=document.createElement("source");r.src=t.src,r.type=t.type,e.audio.appendChild(r)})}"auto"!==this.audio.preload&&(this.audio.preload="auto"),this.isLoading()||this.audio.load()}},{key:"unload",value:function(){this.fadeStop(),this.stop();var e=this.audio;for(e.preload="none";e.hasChildNodes();)e.removeChild(e.firstChild);e.load()}},{key:"play",value:function(){var e=this;return this.hasSource()?this.isUnloaded()?Promise.reject(new Error("no sources are loaded")):this.isFailed()?Promise.reject(new Error("failed to load any of the sources")):("auto"!==this.audio.preload&&(this.audio.preload="auto"),Has.audioPromise?this.audio.play():new Promise(function(t,r){jQuery(e.audio).off(".AudioTrack_play").one("error.AudioTrack_play playing.AudioTrack_play",function(n){jQuery(e).off(".AudioTrack_play"),"error"===n.type?r(new Error("unknown error")):t()}),e.audio.play()})):Promise.reject(new Error("none of the candidate sources were acceptable"))}},{key:"playWhenAllowed",value:function(){var e=this;this.play().catch(function(){var t=C.map(function(e){return e+".AudioTrack_playWhenAllowed"}).join(" ");jQuery(document).one(t,function(){jQuery(document).off(".AudioTrack_playWhenAllowed"),e.audio.play()})})}},{key:"pause",value:function(){this.audio.pause()}},{key:"stop",value:function(){this.audio.pause(),this.time(0),this._trigger(":stopped")}},{key:"fade",value:function(e,t,r){var n=this;if("number"!=typeof e)throw new TypeError("duration parameter must be a number");if("number"!=typeof t)throw new TypeError("toVolume parameter must be a number");if(null!=r&&"number"!=typeof r)throw new TypeError("fromVolume parameter must be a number");if(!this.hasSource())return Promise.reject(new Error("none of the candidate sources were acceptable"));if(this.isUnloaded())return Promise.reject(new Error("no sources are loaded"));if(this.isFailed())return Promise.reject(new Error("failed to load any of the sources"));this.fadeStop();var a=Math.clamp(null==r?this.volume():r,0,1),i=Math.clamp(t,0,1);return a!==i?(this.volume(a),jQuery(this.audio).off("timeupdate.AudioTrack_fade").one("timeupdate.AudioTrack_fade",function(){var t=void 0,r=void 0;a<i?(t=a,r=i):(t=i,r=a);var o=Math.max(e,1),s=(i-a)/(o/.025);n._trigger(":fading"),n._faderId=setInterval(function(){if(!n.isPlaying())return void n.fadeStop();n.volume(Math.clamp(n.volume()+s,t,r)),Config.audio.pauseOnFadeToZero&&0===n.volume()&&n.pause(),n.volume()===i&&(n.fadeStop(),n._trigger(":faded"))},25)}),this.play()):void 0}},{key:"fadeIn",value:function(e,t){return this.fade(e,1,t)}},{key:"fadeOut",value:function(e,t){return this.fade(e,0,t)}},{key:"fadeStop",value:function(){null!==this._faderId&&(clearInterval(this._faderId),this._faderId=null)}},{key:"loop",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return null==e?this.audio.loop:(this.audio.loop=!!e,this)})},{key:"mute",value:function(e){return null==e?this._mute:(this._mute=!!e,this._updateAudioMute(),this)}},{key:"_updateAudioMute",value:function(){this.audio.muted=this._mute||R}},{key:"rate",value:function(e){if(null==e)return this._rate;if("number"!=typeof e)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(e,.2,5),this._updateAudioRate(),this}},{key:"_updateAudioRate",value:function(){this.audio.playbackRate=Math.clamp(this._rate*M,.2,5)}},{key:"time",value:function(e){var t=this;if(null==e)return this.audio.currentTime;if("number"!=typeof e)throw new TypeError("time parameter must be a number");return this.hasMetadata()?this.audio.currentTime=e:jQuery(this.audio).off("loadedmetadata.AudioTrack_time").one("loadedmetadata.AudioTrack_time",function(){return t.audio.currentTime=e}),this}},{key:"volume",value:function(e){if(null==e)return this._volume;if("number"!=typeof e)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(e,0,1),this._updateAudioVolume(),this}},{key:"_updateAudioVolume",value:function(){this.audio.volume=Math.clamp(this._volume*Q,0,1)}},{key:"duration",value:function(){return this.audio.duration}},{key:"remaining",value:function(){return this.audio.duration-this.audio.currentTime}},{key:"isFailed",value:function(){return this._error}},{key:"isLoading",value:function(){return this.audio.networkState===HTMLMediaElement.NETWORK_LOADING}},{key:"isUnloaded",value:function(){return!this.audio.hasChildNodes()}},{key:"isUnavailable",value:function(){return!this.hasSource()||this.isUnloaded()||this.isFailed()}},{key:"isPlaying",value:function(){return!this.audio.paused&&this.hasSomeData()}},{key:"isPaused",value:function(){return this.audio.paused&&(this.audio.duration===1/0||this.audio.currentTime>0)&&!this.audio.ended}},{key:"isStopped",value:function(){return this.audio.paused&&0===this.audio.currentTime}},{key:"isEnded",value:function(){return this.audio.ended}},{key:"isFading",value:function(){return null!==this._faderId}},{key:"isSeeking",value:function(){return this.audio.seeking}},{key:"hasSource",value:function(){return this.sources.length>0}},{key:"hasNoData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_NOTHING}},{key:"hasMetadata",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_METADATA}},{key:"hasSomeData",value:function(){return this.audio.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA}},{key:"hasData",value:function(){return this.audio.readyState===HTMLMediaElement.HAVE_ENOUGH_DATA}},{key:"on",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return jQuery.fn.on.apply(jQuery(this.audio),t),this}},{key:"one",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return jQuery.fn.one.apply(jQuery(this.audio),t),this}},{key:"off",value:function(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return jQuery.fn.off.apply(jQuery(this.audio),t),this}}],[{key:"_verifyType",value:function(t){if(!t||!Has.audio)return null;var r=e._types;if(!r.hasOwnProperty(t)){var n=document.createElement("audio");r[t]=""!==n.canPlayType(t).replace(/^no$/i,"")}return r[t]?t:null}},{key:"getType",value:function(t){if(!t||!Has.audio)return null;var r=e.formats,n=t.toLowerCase(),a=r.hasOwnProperty(n)?r[n]:"audio/"+n;return e._verifyType(a)}},{key:"canPlayFormat",value:function(t){return null!==e.getType(t)}},{key:"canPlayType",value:function(t){return null!==e._verifyType(t)}}]),e}();Object.defineProperties(F,{formats:{value:{aac:"audio/aac",caf:"audio/x-caf","x-caf":"audio/x-caf",mp3:'audio/mpeg; codecs="mp3"',mpeg:'audio/mpeg; codecs="mp3"',m4a:"audio/mp4",mp4:"audio/mp4","x-m4a":"audio/mp4","x-mp4":"audio/mp4",oga:"audio/ogg",ogg:"audio/ogg",opus:'audio/ogg; codecs="opus"',wav:"audio/wav",wave:"audio/wav",weba:"audio/webm",webm:"audio/webm"}},_types:{value:{}}});var B=function(){function e(t){if(_classCallCheck(this,e),t instanceof Array)this._create(t);else{if(!(t instanceof e))throw new Error("tracks parameter must be either an array, of track objects, or an AudioTrack instance");this._copy(t)}}return _createClass(e,[{key:"_create",value:function(e){var t=this;this._finalize(e.map(function(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("tracks parameter array members must be objects");var r=void 0,n=void 0,a=void 0,i=void 0;if(e instanceof F)r=!0,n=e.rate(),a=e.clone(),i=e.volume();else{if(!e.hasOwnProperty("track"))throw new Error('track object missing required "track" property');if(!(e.track instanceof F))throw new Error('track object\'s "track" property must be an AudioTrack object');r=e.hasOwnProperty("own")&&e.own,n=e.hasOwnProperty("rate")?e.rate:e.track.rate(),a=e.track,i=e.hasOwnProperty("volume")?e.volume:e.track.volume()}return a.stop(),a.loop(!1),a.mute(!1),a.rate(n),a.volume(i),a.on("ended.AudioList",function(){return t._onEnd()}),{own:r,track:a,volume:i,rate:n}}))}},{key:"_copy",value:function(e){this._finalize(clone(e.tracks))}},{key:"_finalize",value:function(e){Object.defineProperties(this,{tracks:{configurable:!0,value:Object.freeze(e)},queue:{configurable:!0,value:[]},current:{writable:!0,value:null},_rate:{writable:!0,value:1},_volume:{writable:!0,value:1},_mute:{writable:!0,value:!1},_loop:{writable:!0,value:!1},_shuffle:{writable:!0,value:!1}})}},{key:"_destroy",value:function(){this.stop(),this.tracks.filter(function(e){return e.own}).forEach(function(e){return e.track._destroy()}),delete this.tracks,delete this.queue}},{key:"load",value:function(){this.tracks.forEach(function(e){return e.track.load()})}},{key:"unload",value:function(){this.stop(),this.tracks.forEach(function(e){return e.track.unload()})}},{key:"play",value:function(){return null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||(0===this.queue.length&&this._fillQueue(),this._next())?this.current.track.play():Promise.reject(new Error("no tracks were available"))}},{key:"playWhenAllowed",value:function(){var e=this;this.play().catch(function(){var t=C.map(function(e){return e+".AudioList_playWhenAllowed"}).join(" ");jQuery(document).one(t,function(){jQuery(document).off(".AudioList_playWhenAllowed"),e.play()})})}},{key:"pause",value:function(){null!==this.current&&this.current.track.pause()}},{key:"stop",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null),this._drainQueue()}},{key:"skip",value:function(){this._next()?this.current.track.play():this._loop&&this.play()}},{key:"fade",value:function(e,t,r){if("number"!=typeof e)throw new TypeError("duration parameter must be a number");if("number"!=typeof t)throw new TypeError("toVolume parameter must be a number");if(null!=r&&"number"!=typeof r)throw new TypeError("fromVolume parameter must be a number");if(0===this.queue.length&&this._fillQueue(),null!==this.current&&!this.current.track.isUnavailable()&&!this.current.track.isEnded()||this._next()){var n=Math.clamp(t,0,1)*this.current.volume,a=void 0;return null!=r&&(a=Math.clamp(r,0,1)*this.current.volume),this._volume=t,this.current.track.fade(e,n,a)}}},{key:"fadeIn",value:function(e,t){return this.fade(e,1,t)}},{key:"fadeOut",value:function(e,t){return this.fade(e,0,t)}},{key:"fadeStop",value:function(){null!==this.current&&this.current.track.fadeStop()}},{key:"loop",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(e){return null==e?this._loop:(this._loop=!!e,this)})},{key:"mute",value:function(e){return null==e?this._mute:(this._mute=!!e,null!==this.current&&this.current.track.mute(this._mute),this)}},{key:"rate",value:function(e){if(null==e)return this._rate;if("number"!=typeof e)throw new TypeError("rate parameter must be a number");return this._rate=Math.clamp(e,.2,5),null!==this.current&&this.current.track.rate(this._rate*this.current.rate),this}},{key:"shuffle",value:function(e){var t=this;if(null==e)return this._shuffle;if(this._shuffle=!!e,this.queue.length>0&&(this._fillQueue(),!this._shuffle&&null!==this.current&&this.queue.length>1)){var r=this.queue.findIndex(function(e){return e===t.current});if(-1!==r){var n;(n=this.queue).push.apply(n,_toConsumableArray(this.queue.splice(0,r+1)))}}return this}},{key:"volume",value:function(e){if(null==e)return this._volume;if("number"!=typeof e)throw new TypeError("volume parameter must be a number");return this._volume=Math.clamp(e,0,1),null!==this.current&&this.current.track.volume(this._volume*this.current.volume),this}},{key:"duration",value:function(){if(arguments.length>0)throw new Error("duration takes no parameters");return this.tracks.map(function(e){return e.track.duration()}).reduce(function(e,t){return e+t},0)}},{key:"remaining",value:function(){if(arguments.length>0)throw new Error("remaining takes no parameters");var e=this.queue.map(function(e){return e.track.duration()}).reduce(function(e,t){return e+t},0);return null!==this.current&&(e+=this.current.track.remaining()),e}},{key:"time",value:function(){if(arguments.length>0)throw new Error("time takes no parameters");return this.duration()-this.remaining()}},{key:"isPlaying",value:function(){return null!==this.current&&this.current.track.isPlaying()}},{key:"isPaused",value:function(){return null===this.current||this.current.track.isPaused()}},{key:"isStopped",value:function(){return 0===this.queue.length&&null===this.current}},{key:"isEnded",value:function(){return 0===this.queue.length&&(null===this.current||this.current.track.isEnded())}},{key:"isFading",value:function(){return null!==this.current&&this.current.track.isFading()}},{key:"_next",value:function(){null!==this.current&&(this.current.track.stop(),this.current=null);for(var e=void 0;e=this.queue.shift();)if(!e.track.isUnavailable()){this.current=e;break}return null!==this.current&&(this.current.track.mute(this._mute),this.current.track.rate(this._rate*this.current.rate),this.current.track.volume(this._volume*this.current.volume),this.current.track.loop(!1),!0)}},{key:"_onEnd",value:function(){if(0===this.queue.length){if(!this._loop)return;this._fillQueue()}this._next()&&this.current.track.play()}},{key:"_drainQueue",value:function(){this.queue.splice(0)}},{key:"_fillQueue",value:function(){var e;this._drainQueue(),(e=this.queue).push.apply(e,_toConsumableArray(this.tracks.filter(function(e){return!e.track.isUnavailable()}))),0!==this.queue.length&&this._shuffle&&(this.queue.shuffle(),this.queue.length>1&&this.queue[0]===this.current&&this.queue.push(this.queue.shift()))}}]),e}(),U=function(){function e(t){if(_classCallCheck(this,e),!(t instanceof Set||t instanceof e))throw new TypeError("list parameter must be a Set or a AudioRunner instance");Object.defineProperties(this,{trackIds:{value:new Set(t instanceof e?t.trackIds:t)}})}return _createClass(e,[{key:"load",value:function(){e._run(this.trackIds,F.prototype.load)}},{key:"unload",value:function(){e._run(this.trackIds,F.prototype.unload)}},{key:"play",value:function(){e._run(this.trackIds,F.prototype.play)}},{key:"playWhenAllowed",value:function(){e._run(this.trackIds,F.prototype.playWhenAllowed)}},{key:"pause",value:function(){e._run(this.trackIds,F.prototype.pause)}},{key:"stop",value:function(){e._run(this.trackIds,F.prototype.stop)}},{key:"fade",value:function(t,r,n){if(null==t||null==r)throw new Error("fade requires parameters");e._run(this.trackIds,F.prototype.fade,t,r,n)}},{key:"fadeIn",value:function(t,r){if(null==t)throw new Error("fadeIn requires a parameter");e._run(this.trackIds,F.prototype.fadeIn,t,1,r)}},{key:"fadeOut",value:function(t,r){if(null==t)throw new Error("fadeOut requires a parameter");e._run(this.trackIds,F.prototype.fadeOut,t,0,r)}},{key:"fadeStop",value:function(){e._run(this.trackIds,F.prototype.fadeStop)}},{key:"loop",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(t){if(null==t)throw new Error("loop requires a parameter");return e._run(this.trackIds,F.prototype.loop,t),this})},{key:"mute",value:function(t){if(null==t)throw new Error("mute requires a parameter");return e._run(this.trackIds,F.prototype.mute,t),this}},{key:"rate",value:function(t){if(null==t)throw new Error("rate requires a parameter");return e._run(this.trackIds,F.prototype.rate,t),this}},{key:"time",value:function(t){if(null==t)throw new Error("time requires a parameter");return e._run(this.trackIds,F.prototype.time,t),this}},{key:"volume",value:function(t){if(null==t)throw new Error("volume requires a parameter");return e._run(this.trackIds,F.prototype.volume,t),this}},{key:"on",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e._run.apply(e,[this.trackIds,F.prototype.on].concat(r)),this}},{key:"one",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e._run.apply(e,[this.trackIds,F.prototype.one].concat(r)),this}},{key:"off",value:function(){for(var t=arguments.length,r=Array(t),n=0;n<t;n++)r[n]=arguments[n];return e._run.apply(e,[this.trackIds,F.prototype.off].concat(r)),this}}],[{key:"_run",value:function(e,t){for(var r=arguments.length,n=Array(r>2?r-2:0),a=2;a<r;a++)n[a-2]=arguments[a];e.forEach(function(e){var r=N.get(e);r&&t.apply(r,n)})}}]),e}(),V=function(){function e(e,t){var a=void 0;if(r.lastIndex=t,null===(a=r.exec(e))||"("!==a[0])throw new Error('invalid ":not()" syntax: missing parentheticals');n.lastIndex=r.lastIndex;for(var i=r.lastIndex,o={str:"",nextMatch:-1},s=1;null!==(a=n.exec(e));)if("("===a[0]?++s:--s,s<1){o.nextMatch=n.lastIndex,o.str=e.slice(i,o.nextMatch-1);break}return o}function t(r){for(var n=[],a=/:?[^\s:()]+/g,i=void 0;null!==(i=a.exec(r));){var o=i[0];if(":not"===o){if(0===n.length)throw new Error('invalid negation: no group ID preceded ":not()"');var s=n[n.length-1];if(":"!==s.id[0])throw new Error('invalid negation of track "'+s.id+'": only groups may be negated with ":not()"');var u=e(r,a.lastIndex);if(-1===u.nextMatch)throw new Error('unknown error parsing ":not()"');a.lastIndex=u.nextMatch,s.not=t(u.str)}else n.push({id:o})}return n}var r=/\S/g,n=/[()]/g;return t}();return Object.freeze(Object.defineProperties({},{tracks:{value:Object.freeze(Object.defineProperties({},{add:{value:e},delete:{value:t},clear:{value:r},has:{value:n},get:{value:a}}))},groups:{value:Object.freeze(Object.defineProperties({},{add:{value:i},delete:{value:o},clear:{value:s},has:{value:u},get:{value:l}}))},lists:{value:Object.freeze(Object.defineProperties({},{add:{value:c},delete:{value:d},clear:{value:f},has:{value:p},get:{value:h}}))},select:{value:g},load:{value:m},loadWithScreen:{value:v},mute:{value:y},muteOnHidden:{value:b},rate:{value:w},stop:{value:k},unload:{value:S},volume:{value:E}}))}(),State=function(){function e(){session.delete("state"),$=[],J=c(),G=-1,Z=[],Y=null===Y?null:new PRNGWrapper(Y.seed,!1)}function t(){if(session.has("state")){var e=session.get("state");return null!=e&&(n(e),!0)}return!1}function r(e){var t={index:G};return e?t.history=clone($):t.delta=A($),Z.length>0&&(t.expired=[].concat(_toConsumableArray(Z))),null!==Y&&(t.seed=Y.seed),t}function n(e,t){if(null==e)throw new Error("state object is null or undefined");if(!e.hasOwnProperty(t?"history":"delta")||0===e[t?"history":"delta"].length)throw new Error("state object has no history or history is empty");if(!e.hasOwnProperty("index"))throw new Error("state object has no index");if(null!==Y&&!e.hasOwnProperty("seed"))throw new Error("state object has no seed, but PRNG is enabled");if(null===Y&&e.hasOwnProperty("seed"))throw new Error("state object has seed, but PRNG is disabled");$=t?clone(e.history):P(e.delta),G=e.index,Z=e.hasOwnProperty("expired")?[].concat(_toConsumableArray(e.expired)):[],e.hasOwnProperty("seed")&&(Y.seed=e.seed),g(G)}function a(){return r(!0)}function i(e){return n(e,!0)}function o(){return Z}function s(){return Z.length+v()}function u(){return Z.concat($.slice(0,v()).map(function(e){return e.title}))}function l(e){return null!=e&&""!==e&&(!!Z.includes(e)||!!$.slice(0,v()).some(function(t){return t.title===e}))}function c(e,t){return{title:null==e?"":String(e),variables:null==t?{}:clone(t)}}function d(){return J}function f(){return G}function p(){return J.title}function h(){return J.variables}function g(e){if(null==e)throw new Error("moment activation attempted with null or undefined");switch(void 0===e?"undefined":_typeof(e)){case"object":J=clone(e);break;case"number":if(b())throw new Error("moment activation attempted with index on empty history");if(e<0||e>=y())throw new RangeError("moment activation attempted with out-of-bounds index; need [0, "+(y()-1)+"], got "+e);J=clone($[e]);break;default:throw new TypeError('moment activation attempted with a "'+(void 0===e?"undefined":_typeof(e))+'"; must be an object or valid history stack index')}return null!==Y&&(Y=PRNGWrapper.unmarshal({seed:Y.seed,pull:J.pull})),session.set("state",r()),jQuery.event.trigger(":historyupdate"),J}function m(){return $}function v(){return G+1}function y(){return $.length}function b(){return 0===$.length}function w(){return $.length>0?$[G]:null}function k(){return $.length>0?$[$.length-1]:null}function S(){return $.length>0?$[0]:null}function E(e){return b()||e<0||e>G?null:$[e]}function j(e){if(b())return null;var t=1+(e?Math.abs(e):0);return t>v()?null:$[v()-t]}function x(e){if(b()||null==e||""===e)return!1;for(var t=G;t>=0;--t)if($[t].title===e)return!0;return!1}function O(e){if(v()<y()&&$.splice(v(),y()-v()),$.push(c(e,J.variables)),Y&&(k().pull=Y.pull),Config.history.maxStates>0)for(;y()>Config.history.maxStates;)Z.push($.shift().title);return G=y()-1,g(G),v()}function T(e){return!(null==e||e<0||e>=y()||e===G)&&(G=e,g(G),!0)}function C(e){return null!=e&&0!==e&&T(G+e)}function A(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,n=e.length;r<n;++r)t.push(Diff.diff(e[r-1],e[r]));return t}function P(e){if(!Array.isArray(e))return null;if(0===e.length)return[];for(var t=[clone(e[0])],r=1,n=e.length;r<n;++r)t.push(Diff.patch(t[r-1],e[r]));return t}function _(e,t){if(!b()){var r=void 0;throw r="the Story JavaScript",new Error("State.initPRNG must be called during initialization, within either "+r+" or the StoryInit special passage")}Y=new PRNGWrapper(e,t),J.pull=Y.pull}function N(){return null!==Y}function I(){return Y?Y.pull:NaN}function D(){return Y?Y.seed:null}function L(){return Y?Y.random():Math.random()}function M(){K={},TempVariables=K}function Q(){return K}function R(e){var t=F(e);if(null!==t){for(var r=t.names,n=t.store,a=0,i=r.length;a<i;++a){if(void 0===n[r[a]])return;n=n[r[a]]}return n}}function W(e,t){var r=F(e);if(null===r)return!1;for(var n=r.names,a=n.pop(),i=r.store,o=0,s=n.length;o<s;++o){if(void 0===i[n[o]])return!1;i=i[n[o]]}return i[a]=t,!0}function F(e){for(var t={store:"$"===e[0]?State.variables:State.temporary,names:[]},r=e,n=void 0;null!==(n=X.exec(r));)r=r.slice(n[0].length),n[1]?t.names.push(n[1]):n[2]?t.names.push(n[2]):n[3]?t.names.push(n[3]):n[4]?t.names.push(n[4]):n[5]?t.names.push(R(n[5])):n[6]&&t.names.push(Number(n[6]));return""===r?t:null}function B(){storage.delete(ee)}function U(e){if("string"!=typeof e)throw new TypeError("State.metadata.delete key parameter must be a string (received: "+(void 0===e?"undefined":_typeof(e))+")");var t=storage.get(ee);t&&t.hasOwnProperty(e)&&(1===Object.keys(t).length?storage.delete(ee):(delete t[e],storage.set(ee,t)))}function V(e){if("string"!=typeof e)throw new TypeError("State.metadata.get key parameter must be a string (received: "+(void 0===e?"undefined":_typeof(e))+")");var t=storage.get(ee);return t&&t.hasOwnProperty(e)?t[e]:undefined}function z(e){if("string"!=typeof e)throw new TypeError("State.metadata.has key parameter must be a string (received: "+(void 0===e?"undefined":_typeof(e))+")");var t=storage.get(ee);return t&&t.hasOwnProperty(e)}function q(e,t){if("string"!=typeof e)throw new TypeError("State.metadata.set key parameter must be a string (received: "+(void 0===e?"undefined":_typeof(e))+")");if(void 0===t)U(e);else{var r=storage.get(ee)||{};r[e]=t,storage.set(ee,r)}}function H(){var e=storage.get(ee);return e?Object.keys(e).length:0}var $=[],J=c(),G=-1,Z=[],Y=null,K={},X=new RegExp("^(?:"+Patterns.variableSigil+"("+Patterns.identifier+")|\\.("+Patterns.identifier+")|\\[(?:(?:\"((?:\\\\.|[^\"\\\\])+)\")|(?:'((?:\\\\.|[^'\\\\])+)')|("+Patterns.variableSigil+Patterns.identifierFirstChar+".*)|(\\d+))\\])"),ee="metadata";return Object.freeze(Object.defineProperties({},{reset:{value:e},restore:{value:t},marshalForSave:{value:a},unmarshalForSave:{value:i},expired:{get:o},turns:{get:s},passages:{get:u},hasPlayed:{value:l},active:{get:d},activeIndex:{get:f},passage:{get:p},variables:{get:h},history:{get:m},length:{get:v},size:{get:y},isEmpty:{value:b},current:{get:w},top:{get:k},bottom:{get:S},index:{value:E},peek:{value:j},has:{value:x},create:{value:O},goTo:{value:T},go:{value:C},deltaEncode:{value:A},deltaDecode:{value:P},prng:{value:Object.freeze(Object.defineProperties({},{init:{value:_},isEnabled:{value:N},pull:{get:I},seed:{get:D}}))},random:{value:L},clearTemporary:{value:M},temporary:{get:Q},getVar:{
value:R},setVar:{value:W},metadata:{value:Object.freeze(Object.defineProperties({},{clear:{value:B},delete:{value:U},get:{value:V},has:{value:z},set:{value:q},size:{get:H}}))},initPRNG:{value:_},restart:{value:function(){return Engine.restart()}},backward:{value:function(){return Engine.backward()}},forward:{value:function(){return Engine.forward()}},display:{value:function(){return Engine.display.apply(Engine,arguments)}},show:{value:function(){return Engine.show.apply(Engine,arguments)}},play:{value:function(){return Engine.play.apply(Engine,arguments)}}}))}(),Scripting=function(){function addAccessibleClickHandler(e,t,r,n,a){if(arguments.length<2)throw new Error("addAccessibleClickHandler insufficient number of parameters");var i=void 0,o=void 0;if("function"==typeof t?(i=t,o={namespace:n,one:!!r}):(i=r,o={namespace:a,one:!!n,selector:t}),"function"!=typeof i)throw new TypeError("addAccessibleClickHandler handler parameter must be a function");return jQuery(e).ariaClick(o,i)}function insertElement(e,t,r,n,a,i){var o=jQuery(document.createElement(t));return r&&o.attr("id",r),n&&o.addClass(n),i&&o.attr("title",i),a&&o.text(a),e&&o.appendTo(e),o[0]}function insertText(e,t){jQuery(e).append(document.createTextNode(t))}function removeChildren(e){jQuery(e).empty()}function removeElement(e){jQuery(e).remove()}function fade(e,t){function r(){i+=.05*a,n(o,Math.easeInOut(i)),(1===a&&i>=1||-1===a&&i<=0)&&(e.style.visibility="in"===t.fade?"visible":"hidden",o.parentNode.replaceChild(e,o),o=null,window.clearInterval(s),t.onComplete&&t.onComplete())}function n(e,t){e.style.zoom=1,e.style.filter="alpha(opacity="+Math.floor(100*t)+")",e.style.opacity=t}var a="in"===t.fade?1:-1,i=void 0,o=e.cloneNode(!0),s=void 0;e.parentNode.replaceChild(o,e),"in"===t.fade?(i=0,o.style.visibility="visible"):i=1,n(o,i),s=window.setInterval(r,25)}function scrollWindowTo(e,t){function r(){l+=a,window.scroll(0,i+u*(s*Math.easeInOut(l))),l>=1&&window.clearInterval(c)}function n(e){for(var t=0;e.offsetParent;)t+=e.offsetTop,e=e.offsetParent;return t}var a=null!=t?Number(t):.1;Number.isNaN(a)||!Number.isFinite(a)||a<0?a=.1:a>1&&(a=1);var i=window.scrollY?window.scrollY:document.body.scrollTop,o=function(e){var t=n(e),r=t+e.offsetHeight,a=window.scrollY?window.scrollY:document.body.scrollTop,i=window.innerHeight?window.innerHeight:document.body.clientHeight,o=a+i;return t>=a&&r>o&&e.offsetHeight<i?t-(i-e.offsetHeight)+20:t}(e),s=Math.abs(i-o),u=i>o?-1:1,l=0,c=void 0;c=window.setInterval(r,25)}function either(){if(0!==arguments.length)return Array.prototype.concat.apply([],arguments).random()}function forget(e){if("string"!=typeof e)throw new TypeError("forget key parameter must be a string (received: "+Util.getType(e)+")");State.metadata.delete(e)}function hasVisited(){if(0===arguments.length)throw new Error("hasVisited called with insufficient parameters");if(State.isEmpty())return!1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=0,n=e.length;r<n;++r)if(!t.includes(e[r]))return!1;return!0}function lastVisited(){if(0===arguments.length)throw new Error("lastVisited called with insufficient parameters");if(State.isEmpty())return-1;for(var e=Array.prototype.concat.apply([],arguments),t=State.passages,r=t.length-1,n=State.turns,a=0,i=e.length;a<i&&n>-1;++a){var o=t.lastIndexOf(e[a]);n=Math.min(n,-1===o?-1:r-o)}return n}function memorize(e,t){if("string"!=typeof e)throw new TypeError("memorize key parameter must be a string (received: "+Util.getType(e)+")");State.metadata.set(e,t)}function passage(){return State.passage}function previous(){var e=State.passages;if(arguments.length>0){var t=Number(arguments[0]);if(!Number.isSafeInteger(t)||t<1)throw new RangeError("previous offset parameter must be a positive integer greater than zero");return e.length>t?e[e.length-1-t]:""}for(var r=e.length-2;r>=0;--r)if(e[r]!==State.passage)return e[r];return""}function random(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("random called with insufficient parameters");case 1:e=0,t=Math.trunc(arguments[0]);break;default:e=Math.trunc(arguments[0]),t=Math.trunc(arguments[1])}if(!Number.isInteger(e))throw new Error("random min parameter must be an integer");if(!Number.isInteger(t))throw new Error("random max parameter must be an integer");if(e>t){var r=[t,e];e=r[0],t=r[1]}return Math.floor(State.random()*(t-e+1))+e}function randomFloat(){var e=void 0,t=void 0;switch(arguments.length){case 0:throw new Error("randomFloat called with insufficient parameters");case 1:e=0,t=Number(arguments[0]);break;default:e=Number(arguments[0]),t=Number(arguments[1])}if(Number.isNaN(e)||!Number.isFinite(e))throw new Error("randomFloat min parameter must be a number");if(Number.isNaN(t)||!Number.isFinite(t))throw new Error("randomFloat max parameter must be a number");if(e>t){var r=[t,e];e=r[0],t=r[1]}return State.random()*(t-e)+e}function recall(e,t){if("string"!=typeof e)throw new TypeError("recall key parameter must be a string (received: "+Util.getType(e)+")");return State.metadata.has(e)?State.metadata.get(e):t}function tags(){if(0===arguments.length)return Story.get(State.passage).tags.slice(0);for(var e=Array.prototype.concat.apply([],arguments),t=[],r=0,n=e.length;r<n;++r)t=t.concat(Story.get(e[r]).tags);return t}function temporary(){return State.temporary}function time(){return null===Engine.lastPlay?0:Util.now()-Engine.lastPlay}function turns(){return State.turns}function variables(){return State.variables}function visited(){if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],0===arguments.length?[State.passage]:arguments),t=State.passages,r=State.turns,n=0,a=e.length;n<a&&r>0;++n)r=Math.min(r,t.count(e[n]));return r}function visitedTags(){if(0===arguments.length)throw new Error("visitedTags called with insufficient parameters");if(State.isEmpty())return 0;for(var e=Array.prototype.concat.apply([],arguments),t=e.length,r=State.passages,n=new Map,a=0,i=0,o=r.length;i<o;++i){var s=r[i];if(n.has(s))n.get(s)&&++a;else{var u=Story.get(s).tags;if(u.length>0){for(var l=0,c=0;c<t;++c)u.includes(e[c])&&++l;l===t?(++a,n.set(s,!0)):n.set(s,!1)}}}return a}function evalJavaScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,String(code),output)}function evalTwineScript(code,output){return function(code,output){return eval(code)}.call(output?{output:output}:null,parse(String(code)),output)}var _ref8=function(){function e(e){return Util.parseUrl(e).path.replace(/^[^\w]+|[^\w]+$/g,"").replace(/[^\w]+/g,"-").toLocaleLowerCase()}function t(t){return new Promise(function(r,n){jQuery(document.createElement("script")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):n(new Error('importScripts failed to load the script "'+t+'".'))}).appendTo(document.head).attr({id:"script-imported-"+e(t),type:"text/javascript",src:t})})}function r(t){return new Promise(function(r,n){jQuery(document.createElement("link")).one("load abort error",function(e){jQuery(e.target).off(),"load"===e.type?r(e.target):n(new Error('importStyles failed to load the stylesheet "'+t+'".'))}).appendTo(document.head).attr({id:"style-imported-"+e(t),rel:"stylesheet",href:t})})}function n(e){return e.reduce(function(e,t){return e=e.then(t)},Promise.resolve())}function a(){for(var e=arguments.length,r=Array(e),a=0;a<e;a++)r[a]=arguments[a];return Promise.all(r.map(function(e){return Array.isArray(e)?n(e.map(function(e){return function(){return t(e)}})):t(e)}))}function i(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.all(t.map(function(e){return Array.isArray(e)?n(e.map(function(e){return function(){return r(e)}})):r(e)}))}return{importScripts:a,importStyles:i}}(),importScripts=_ref8.importScripts,importStyles=_ref8.importStyles,parse=function(){function e(e){if(0!==r.lastIndex)throw new RangeError("Scripting.parse last index is non-zero at start");for(var a=e,i=void 0;null!==(i=r.exec(a));)if(i[5]){var o=i[5];if("$"===o||"_"===o)continue;if(n.test(o))o=o[0];else if("is"===o){var s=r.lastIndex,u=a.slice(s);/^\s+not\b/.test(u)&&(a=a.splice(s,u.search(/\S/)),o="isnot")}t.hasOwnProperty(o)&&(a=a.splice(i.index,o.length,t[o]),r.lastIndex+=t[o].length-o.length)}return a}var t=Object.freeze({$:"State.variables.",_:"State.temporary.",to:"=",eq:"==",neq:"!=",is:"===",isnot:"!==",gt:">",gte:">=",lt:"<",lte:"<=",and:"&&",or:"||",not:"!",def:'"undefined" !== typeof',ndef:'"undefined" === typeof'}),r=new RegExp(["(\"\"|'')",'("(?:\\\\.|[^"\\\\])+")',"('(?:\\\\.|[^'\\\\])+')","([=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}]+)","([^\"'=+\\-*\\/%<>&\\|\\^~!?:,;\\(\\)\\[\\]{}\\s]+)"].join("|"),"g"),n=new RegExp("^"+Patterns.variable);return e}();return Object.freeze(Object.defineProperties({},{parse:{value:parse},evalJavaScript:{value:evalJavaScript},evalTwineScript:{value:evalTwineScript}}))}(),_ref9=function(){return{EOF:-1,Lexer:function(){function e(t,r){if(_classCallCheck(this,e),arguments.length<2)throw new Error("Lexer constructor called with too few parameters (source:string , initialState:function)");Object.defineProperties(this,{source:{value:t},initial:{value:r},state:{writable:!0,value:r},start:{writable:!0,value:0},pos:{writable:!0,value:0},depth:{writable:!0,value:0},items:{writable:!0,value:[]},data:{writable:!0,value:{}}})}return _createClass(e,[{key:"reset",value:function(){this.state=this.initial,this.start=0,this.pos=0,this.depth=0,this.items=[],this.data={}}},{key:"run",value:function(){for(;null!==this.state;)this.state=this.state(this);return this.items}},{key:"nextItem",value:function(){for(;0===this.items.length&&null!==this.state;)this.state=this.state(this);return this.items.shift()}},{key:"next",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos++]}},{key:"peek",value:function(){return this.pos>=this.source.length?-1:this.source[this.pos]}},{key:"backup",value:function(e){this.pos-=e||1}},{key:"forward",value:function(e){this.pos+=e||1}},{key:"ignore",value:function(){this.start=this.pos}},{key:"accept",value:function(e){var t=this.next();return-1!==t&&(!!e.includes(t)||(this.backup(),!1))}},{key:"acceptRe",value:function(e){var t=this.next();return-1!==t&&(!!e.test(t)||(this.backup(),!1))}},{key:"acceptRun",value:function(e){for(;;){var t=this.next();if(-1===t)return;if(!e.includes(t))break}this.backup()}},{key:"acceptRunRe",value:function(e){for(;;){var t=this.next();if(-1===t)return;if(!e.test(t))break}this.backup()}},{key:"emit",value:function(e){this.items.push({type:e,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),this.start=this.pos}},{key:"error",value:function(e,t){if(arguments.length<2)throw new Error("Lexer.prototype.error called with too few parameters (type:number , message:string)");return this.items.push({type:e,message:t,text:this.source.slice(this.start,this.pos),start:this.start,pos:this.pos}),null}}],[{key:"enumFromNames",value:function(e){var t=e.reduce(function(e,t,r){return e[t]=r,e},{});return Object.freeze(Object.assign(Object.create(null),t))}}]),e}()}}(),EOF=_ref9.EOF,Lexer=_ref9.Lexer,Wikifier=function(){var e=0,t=function(){function t(r,n,a){_classCallCheck(this,t),t.Parser.Profile.isEmpty()&&t.Parser.Profile.compile(),Object.defineProperties(this,{source:{value:String(n)},options:{writable:!0,value:Object.assign({profile:"all"},a)},nextMatch:{writable:!0,value:0},output:{writable:!0,value:null},_rawArgs:{writable:!0,value:""}}),null==r?this.output=document.createDocumentFragment():r.jquery?this.output=r[0]:this.output=r;try{++e,this.subWikify(this.output),1===e&&Config.cleanupWikifierOutput&&convertBreaks(this.output)}finally{--e}}return _createClass(t,[{key:"subWikify",value:function(e,r,n){var a=this.output,i=void 0;this.output=e,null!=n&&"object"===(void 0===n?"undefined":_typeof(n))&&(i=this.options,this.options=Object.assign({},this.options,n));var o=t.Parser.Profile.get(this.options.profile),s=r?new RegExp("(?:"+r+")",this.options.ignoreTerminatorCase?"gim":"gm"):null,u=void 0,l=void 0;do{if(o.parserRegExp.lastIndex=this.nextMatch,s&&(s.lastIndex=this.nextMatch),l=o.parserRegExp.exec(this.source),(u=s?s.exec(this.source):null)&&(!l||u.index<=l.index))return u.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,u.index),this.matchStart=u.index,this.matchLength=u[0].length,this.matchText=u[0],this.nextMatch=s.lastIndex,this.output=a,void(i&&(this.options=i));if(l){l.index>this.nextMatch&&this.outputText(this.output,this.nextMatch,l.index),this.matchStart=l.index,this.matchLength=l[0].length,this.matchText=l[0],this.nextMatch=o.parserRegExp.lastIndex;for(var c=void 0,d=1,f=l.length;d<f;++d)if(l[d]){c=d-1;break}if(o.parsers[c].handler(this),null!=TempState.break)break}}while(u||l);null==TempState.break?this.nextMatch<this.source.length&&(this.outputText(this.output,this.nextMatch,this.source.length),this.nextMatch=this.source.length):this.output.lastChild&&this.output.lastChild.nodeType===Node.ELEMENT_NODE&&"BR"===this.output.lastChild.nodeName.toUpperCase()&&jQuery(this.output.lastChild).remove(),this.output=a,i&&(this.options=i)}},{key:"outputText",value:function(e,t,r){jQuery(e).append(document.createTextNode(this.source.substring(t,r)))}},{key:"rawArgs",value:function(){return this._rawArgs}},{key:"fullArgs",value:function(){return Scripting.parse(this._rawArgs)}}],[{key:"wikifyEval",value:function(e){var r=document.createDocumentFragment();new t(r,e);var n=r.querySelector(".error");if(null!==n)throw new Error(n.textContent.replace(errorPrologRegExp,""));return r}},{key:"createInternalLink",value:function(e,t,r,n){var a=jQuery(document.createElement("a"));return null!=t&&(a.attr("data-passage",t),Story.has(t)?(a.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(t)&&a.addClass("link-visited")):a.addClass("link-broken"),a.ariaClick({one:!0},function(){"function"==typeof n&&n(),Engine.play(t)})),r&&a.append(document.createTextNode(r)),e&&a.appendTo(e),a[0]}},{key:"createExternalLink",value:function(e,t,r){var n=jQuery(document.createElement("a")).attr("target","_blank").addClass("link-external").text(r).appendTo(e);return null!=t&&n.attr({href:t,tabindex:0}),n[0]}},{key:"isExternalLink",value:function(e){return!Story.has(e)&&(new RegExp("^"+Patterns.url,"gim").test(e)||/[\/.?#]/.test(e))}}]),t}();return Object.defineProperty(t,"Parser",{value:function(){function e(){return d}function t(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("Wikifier.Parser.add parser parameter must be an object");if(!e.hasOwnProperty("name"))throw new Error('parser object missing required "name" property');if("string"!=typeof e.name)throw new Error('parser object "name" property must be a string');if(!e.hasOwnProperty("match"))throw new Error('parser object missing required "match" property');if("string"!=typeof e.match)throw new Error('parser object "match" property must be a string');if(!e.hasOwnProperty("handler"))throw new Error('parser object missing required "handler" property');if("function"!=typeof e.handler)throw new Error('parser object "handler" property must be a function');if(e.hasOwnProperty("profiles")&&!Array.isArray(e.profiles))throw new Error('parser object "profiles" property must be an array');if(a(e.name))throw new Error('cannot clobber existing parser "'+e.name+'"');d.push(e)}function r(e){var t=d.find(function(t){return t.name===e});t&&d.delete(t)}function n(){return 0===d.length}function a(e){return!!d.find(function(t){return t.name===e})}function i(e){return d.find(function(t){return t.name===e})||null}function o(){return f}function s(){var e=d,t=e.filter(function(e){return!Array.isArray(e.profiles)||e.profiles.includes("core")});return f=Object.freeze({all:{parsers:e,parserRegExp:new RegExp(e.map(function(e){return"("+e.match+")"}).join("|"),"gm")},core:{parsers:t,parserRegExp:new RegExp(t.map(function(e){return"("+e.match+")"}).join("|"),"gm")}})}function u(){return"object"!==(void 0===f?"undefined":_typeof(f))||0===Object.keys(f).length}function l(e){if("object"!==(void 0===f?"undefined":_typeof(f))||!f.hasOwnProperty(e))throw new Error('nonexistent parser profile "'+e+'"');return f[e]}function c(e){return"object"===(void 0===f?"undefined":_typeof(f))&&f.hasOwnProperty(e)}var d=[],f=void 0;return Object.freeze(Object.defineProperties({},{parsers:{get:e},add:{value:t},delete:{value:r},isEmpty:{value:n},has:{value:a},get:{value:i},Profile:{value:Object.freeze(Object.defineProperties({},{profiles:{get:o},compile:{value:s},isEmpty:{value:u},has:{value:c},get:{value:l}}))}}))}()}),Object.defineProperties(t,{helpers:{value:{}},getValue:{value:State.getVar},setValue:{value:State.setVar},parse:{value:Scripting.parse},evalExpression:{value:Scripting.evalTwineScript},evalStatements:{value:Scripting.evalTwineScript},textPrimitives:{value:Patterns}}),Object.defineProperties(t.helpers,{inlineCss:{value:function(){function e(e){var r={classes:[],id:"",styles:{}},n=void 0;do{t.lastIndex=e.nextMatch;var a=t.exec(e.source);n=a&&a.index===e.nextMatch,n&&(a[1]?r.styles[Util.fromCssProperty(a[1])]=a[2].trim():a[3]?r.styles[Util.fromCssProperty(a[3])]=a[4].trim():a[5]?r.classes=r.classes.concat(a[5].slice(1).split(/\./)):a[6]&&(r.id=a[6].slice(1).split(/#/).pop()),e.nextMatch=t.lastIndex)}while(n);return r}var t=new RegExp(Patterns.inlineCss,"gm");return e}()},evalText:{value:function(e){var t=void 0;try{switch(t=Scripting.evalTwineScript(e),void 0===t?"undefined":_typeof(t)){case"string":""===t.trim()&&(t=e);break;case"number":t=String(t);break;default:t=e}}catch(r){t=e}return t}},evalPassageId:{value:function(e){return null==e||Story.has(e)?e:t.helpers.evalText(e)}},hasBlockContext:{value:function(e){for(var t="function"==typeof window.getComputedStyle,r=e.length-1;r>=0;--r){var n=e[r];switch(n.nodeType){case Node.ELEMENT_NODE:var a=n.nodeName.toUpperCase();if("BR"===a)return!0;var i=t?window.getComputedStyle(n,null):n.currentStyle;if(i&&i.display){if("none"===i.display)continue;return"block"===i.display}switch(a){case"ADDRESS":case"ARTICLE":case"ASIDE":case"BLOCKQUOTE":case"CENTER":case"DIV":case"DL":case"FIGURE":case"FOOTER":case"FORM":case"H1":case"H2":case"H3":case"H4":case"H5":case"H6":case"HEADER":case"HR":case"MAIN":case"NAV":case"OL":case"P":case"PRE":case"SECTION":case"TABLE":case"UL":return!0}return!1;case Node.COMMENT_NODE:continue;default:return!1}}return!0}},createShadowSetterCallback:{value:function(){function e(){if(!a&&!(a=t.Parser.get("macro")))throw new Error('cannot find "macro" parser');return a}function r(){for(var t=a||e(),r=new Set,n=t.context;null!==n;n=n.parent)n._shadows&&n._shadows.forEach(function(e){return r.add(e)});return[].concat(_toConsumableArray(r))}function n(e){var t={};return r().forEach(function(e){var r=e.slice(1),n="$"===e[0]?State.variables:State.temporary;t[e]=n[r]}),function(){var r=Object.keys(t),n=r.length>0?{}:null;try{return r.forEach(function(e){var r=e.slice(1),a="$"===e[0]?State.variables:State.temporary;a.hasOwnProperty(r)&&(n[r]=a[r]),a[r]=t[e]}),Scripting.evalJavaScript(e)}finally{r.forEach(function(e){var r=e.slice(1),a="$"===e[0]?State.variables:State.temporary;t[e]=a[r],n.hasOwnProperty(r)?a[r]=n[r]:delete a[r]})}}}var a=null;return n}()},parseSquareBracketedMarkup:{value:function(){function e(e,t){e:for(;;)switch(e.next()){case"\\":var r=e.next();if(r!==EOF&&"\n"!==r)break;case EOF:case"\n":return EOF;case t:break e}return e.pos}function t(e){if(!e.accept("["))return e.error(o.Error,"malformed square-bracketed markup");if(e.accept("["))e.data.isLink=!0,e.emit(o.LinkMeta);else{if(e.accept("<>"),!(e.accept("Ii")&&e.accept("Mm")&&e.accept("Gg")&&e.accept("[")))return e.error(o.Error,"malformed square-bracketed markup");e.data.isLink=!1,e.emit(o.ImageMeta)}return e.depth=2,r}function r(t){for(var r=t.data.isLink?"link":"image",i=s.None;;)switch(t.next()){case EOF:case"\n":return t.error(o.Error,"unterminated "+r+" markup");case'"':if(e(t,'"')===EOF)return t.error(o.Error,"unterminated double quoted string in "+r+" markup");break;case"|":i===s.None&&(i=s.LTR,t.backup(),t.emit(o.Text),t.forward(),t.emit(o.DelimLTR));break;case"-":i===s.None&&">"===t.peek()&&(i=s.LTR,t.backup(),t.emit(o.Text),t.forward(2),t.emit(o.DelimLTR));break;case"<":i===s.None&&"-"===t.peek()&&(i=s.RTL,t.backup(),t.emit(t.data.isLink?o.Link:o.Source),t.forward(2),t.emit(o.DelimRTL));break;case"[":++t.depth;break;case"]":if(1===--t.depth)switch(t.peek()){case"[":return++t.depth,t.backup(),i===s.RTL?t.emit(o.Text):t.emit(t.data.isLink?o.Link:o.Source),t.forward(2),t.emit(o.InnerMeta),t.data.isLink?a:n;case"]":return--t.depth,t.backup(),i===s.RTL?t.emit(o.Text):t.emit(t.data.isLink?o.Link:o.Source),t.forward(2),t.emit(o.RightMeta),null;default:return t.error(o.Error,"malformed "+r+" markup")}}}function n(t){for(var r=t.data.isLink?"link":"image";;)switch(t.next()){case EOF:case"\n":return t.error(o.Error,"unterminated "+r+" markup");case'"':if(e(t,'"')===EOF)return t.error(o.Error,"unterminated double quoted string in "+r+" markup link component");break;case"[":++t.depth;break;case"]":if(1===--t.depth)switch(t.peek()){case"[":return++t.depth,t.backup(),t.emit(o.Link),t.forward(2),t.emit(o.InnerMeta),a;case"]":return--t.depth,t.backup(),t.emit(o.Link),t.forward(2),t.emit(o.RightMeta),null;default:return t.error(o.Error,"malformed "+r+" markup")}}}function a(t){for(var r=t.data.isLink?"link":"image";;)switch(t.next()){case EOF:case"\n":return t.error(o.Error,"unterminated "+r+" markup");case'"':if(e(t,'"')===EOF)return t.error(o.Error,"unterminated double quoted string in "+r+" markup setter component");break;case"'":if(e(t,"'")===EOF)return t.error(o.Error,"unterminated single quoted string in "+r+" markup setter component");break;case"[":++t.depth;break;case"]":if(1===--t.depth)return"]"!==t.peek()?t.error(o.Error,"malformed "+r+" markup"):(--t.depth,t.backup(),t.emit(o.Setter),t.forward(2),t.emit(o.RightMeta),null)}}function i(e){var r=new Lexer(e.source,t);r.start=r.pos=e.matchStart;var n={},a=r.run(),i=a.last();return i&&i.type===o.Error?n.error=i.message:a.forEach(function(e){var t=e.text.trim();switch(e.type){case o.ImageMeta:n.isImage=!0,"<"===t[1]?n.align="left":">"===t[1]&&(n.align="right");break;case o.LinkMeta:n.isLink=!0;break;case o.Link:"~"===t[0]?(n.forceInternal=!0,n.link=t.slice(1)):n.link=t;break;case o.Setter:n.setter=t;break;case o.Source:n.source=t;break;case o.Text:n.text=t}}),n.pos=r.pos,n}var o=Lexer.enumFromNames(["Error","DelimLTR","DelimRTL","InnerMeta","ImageMeta","LinkMeta","Link","RightMeta","Setter","Source","Text"]),s=Lexer.enumFromNames(["None","LTR","RTL"]);return i}()}}),t}();!function(){function e(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createDocumentFragment()).append(t[1]).appendTo(e.output))}Wikifier.Parser.add({name:"quoteByBlock",profiles:["block"],match:"^<<<\\n",terminator:"^<<<\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("blockquote")).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"quoteByLine",profiles:["block"],match:"^>+",lookahead:/^>+/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=[e.output],r=0,n=e.matchLength,a=void 0,i=void 0;do{if(n>r)for(i=r;i<n;++i)t.push(jQuery(document.createElement("blockquote")).appendTo(t[t.length-1]).get(0));else if(n<r)for(i=r;i>n;--i)t.pop();r=n,e.subWikify(t[t.length-1],this.terminator),jQuery(document.createElement("br")).appendTo(t[t.length-1]),this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);a=o&&o.index===e.nextMatch,a&&(n=o[0].length,e.nextMatch+=o[0].length)}while(a)}}),Wikifier.Parser.add({name:"macro",profiles:["core"],match:"<<",lookahead:new RegExp("<<(/?"+Patterns.macroName+")(?:\\s*)((?:(?:`(?:\\\\.|[^`\\\\])*`)|(?:\"(?:\\\\.|[^\"\\\\])*\")|(?:'(?:\\\\.|[^'\\\\])*')|(?:\\[(?:[<>]?[Ii][Mm][Gg])?\\[[^\\r\\n]*?\\]\\]+)|[^>]|(?:>(?!>)))*)>>","gm"),working:{source:"",name:"",arguments:"",index:0},context:null,handler:function(e){var t=this.lookahead.lastIndex=e.matchStart;if(this.parseTag(e)){var r=e.nextMatch,n=this.working.name,a=this.working.arguments,i=void 0;try{if(!(i=Macro.get(n))){if(Macro.tags.has(n)){var o=Macro.tags.get(n);return throwError(e.output,"child tag <<"+n+">> was found outside of a call to its parent macro"+(1===o.length?"":"s")+" <<"+o.join(">>, <<")+">>",e.source.slice(t,e.nextMatch))}return throwError(e.output,"macro <<"+n+">> does not exist",e.source.slice(t,e.nextMatch))}var s=null;if(i.hasOwnProperty("tags")&&!(s=this.parseBody(e,i)))return e.nextMatch=r,throwError(e.output,"cannot find a closing tag for macro <<"+n+">>",e.source.slice(t,e.nextMatch)+"…");if("function"!=typeof i.handler)return throwError(e.output,"macro <<"+n+">> handler function "+(i.hasOwnProperty("handler")?"is not a function":"does not exist"),e.source.slice(t,e.nextMatch));var u=s?s[0].args:this.createArgs(a,this.skipArgs(i,i.name));if(i.hasOwnProperty("_MACRO_API")){this.context=new MacroContext({macro:i,name:n,args:u,payload:s,source:e.source.slice(t,e.nextMatch),parent:this.context,parser:e});try{i.handler.call(this.context)}finally{this.context=this.context.parent}}else{var l=e._rawArgs;e._rawArgs=a;try{i.handler(e.output,n,u,e,s)}finally{e._rawArgs=l}}}catch(r){return throwError(e.output,"cannot execute "+(i&&i.isWidget?"widget":"macro")+" <<"+n+">>: "+r.message,e.source.slice(t,e.nextMatch))}finally{this.working.source="",this.working.name="",this.working.arguments="",this.working.index=0}}else e.outputText(e.output,e.matchStart,e.nextMatch)},parseTag:function(e){var t=this.lookahead.exec(e.source);return!(!t||t.index!==e.matchStart||!t[1])&&(e.nextMatch=this.lookahead.lastIndex,this.working.source=e.source.slice(t.index,this.lookahead.lastIndex),this.working.name=t[1],this.working.arguments=t[2],this.working.index=t.index,!0)},parseBody:function(e,t){for(var r=this.working.name,n="/"+r,a="end"+r,i=!!Array.isArray(t.tags)&&t.tags,o=[],s=-1,u=1,l=this.working.source,c=this.working.name,d=this.working.arguments,f=e.nextMatch;-1!==(e.matchStart=e.source.indexOf(this.match,e.nextMatch));)if(this.parseTag(e)){var p=this.working.source,h=this.working.name,g=this.working.arguments,m=this.working.index,v=e.nextMatch;switch(h){case r:++u;break;case a:case n:--u;break;default:if(1===u&&i)for(var y=0,b=i.length;y<b;++y)h===i[y]&&(o.push({source:l,name:c,arguments:d,args:this.createArgs(d,this.skipArgs(t,c)),contents:e.source.slice(f,m)}),l=p,c=h,d=g,f=v)}if(0===u){o.push({source:l,name:c,arguments:d,args:this.createArgs(d,this.skipArgs(t,c)),contents:e.source.slice(f,m)}),s=v;break}}else this.lookahead.lastIndex=e.nextMatch=e.matchStart+this.match.length;return-1!==s?(e.nextMatch=s,o):null},createArgs:function(e,t){var r=t?[]:this.parseArgs(e);return Object.defineProperties(r,{raw:{value:e},full:{value:Scripting.parse(e)}}),r},skipArgs:function(e,t){if(e.hasOwnProperty("skipArgs")){var r=e.skipArgs;return"boolean"==typeof r&&r||Array.isArray(r)&&r.includes(t)}return!!e.hasOwnProperty("skipArg0")&&(e.skipArg0&&e.name===t)},parseArgs:function(){function e(e,t){e:for(;;)switch(e.next()){case"\\":var r=e.next();if(r!==EOF&&"\n"!==r)break;case EOF:case"\n":return EOF;case t:break e}return e.pos}function t(e){var t=e.source.slice(e.pos).search(c);if(t===EOF)return null;switch(0!==t&&(e.pos+=t,e.ignore()),e.next()){case"`":return r;case'"':return n;case"'":return a;case"[":return i;default:return o}}function r(r){return e(r,"`")===EOF?r.error(u.Error,"unterminated backquote expression"):(r.emit(u.Expression),t)}function n(r){return e(r,'"')===EOF?r.error(u.Error,"unterminated double quoted string"):(r.emit(u.String),t)}function a(r){return e(r,"'")===EOF?r.error(u.Error,"unterminated single quoted string"):(r.emit(u.String),t)}function i(e){var r=void 0;if(e.accept("<>IiMmGg")?(r="image",e.acceptRun("<>IiMmGg")):r="link",!e.accept("["))return e.error(u.Error,"malformed "+r+" markup");e.depth=2;e:for(;;)switch(e.next()){case"\\":var n=e.next();if(n!==EOF&&"\n"!==n)break;case EOF:case"\n":return e.error(u.Error,"unterminated "+r+" markup");case"[":++e.depth;break;case"]":if(--e.depth<0)return e.error(u.Error,"unexpected right square bracket ']'");if(1===e.depth){if("]"===e.next()){--e.depth;break e}e.backup()}}return e.emit(u.SquareBracket),t}function o(e){var r=e.source.slice(e.pos).search(l);return e.pos=r===EOF?e.source.length:e.pos+r,e.emit(u.Bareword),r===EOF?null:t}function s(e){var r=new Lexer(e,t),n=[];return r.run().forEach(function(e){var t=e.text;switch(e.type){case u.Error:throw new Error('unable to parse macro argument "'+t+'": '+e.message);case u.Bareword:if(d.test(t))t=State.getVar(t);else if(/^(?:settings|setup)[.[]/.test(t))try{t=Scripting.evalTwineScript(t)}catch(e){throw new Error('unable to parse macro argument "'+t+'": '+e.message)}else if("null"===t)t=null;else if("undefined"===t)t=undefined;else if("true"===t)t=!0;else if("false"===t)t=!1;else if("NaN"===t)t=NaN;else{var r=Number(t);Number.isNaN(r)||(t=r)}break;case u.Expression:if(""===(t=t.slice(1,-1).trim()))t=undefined;else try{t=Scripting.evalTwineScript("("+t+")")}catch(e){throw new Error('unable to parse macro argument expression "'+t+'": '+e.message)}break;case u.String:try{t=Scripting.evalJavaScript(t)}catch(e){throw new Error('unable to parse macro argument string "'+t+'": '+e.message)}break;case u.SquareBracket:var a=Wikifier.helpers.parseSquareBracketedMarkup({source:t,matchStart:0});if(a.hasOwnProperty("error"))throw new Error('unable to parse macro argument "'+t+'": '+a.error);if(a.pos<t.length)throw new Error('unable to parse macro argument "'+t+'": unexpected character(s) "'+t.slice(a.pos)+'" (pos: '+a.pos+")");a.isLink?(t={isLink:!0},t.count=a.hasOwnProperty("text")?2:1,t.link=Wikifier.helpers.evalPassageId(a.link),t.text=a.hasOwnProperty("text")?Wikifier.helpers.evalText(a.text):t.link,t.external=!a.forceInternal&&Wikifier.isExternalLink(t.link),t.setFn=a.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(a.setter)):null):a.isImage&&(t=function(e){var t={source:e,isImage:!0};if("data:"!==e.slice(0,5)&&Story.has(e)){var r=Story.get(e);r.tags.includes("Twine.image")&&(t.source=r.text,t.passage=r.title)}return t}(Wikifier.helpers.evalPassageId(a.source)),a.hasOwnProperty("align")&&(t.align=a.align),a.hasOwnProperty("text")&&(t.title=Wikifier.helpers.evalText(a.text)),a.hasOwnProperty("link")&&(t.link=Wikifier.helpers.evalPassageId(a.link),t.external=!a.forceInternal&&Wikifier.isExternalLink(t.link)),t.setFn=a.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(a.setter)):null)}n.push(t)}),n}var u=Lexer.enumFromNames(["Error","Bareword","Expression","String","SquareBracket"]),l=new RegExp(Patterns.space),c=new RegExp(Patterns.notSpace),d=new RegExp("^"+Patterns.variable);return s}()}),Wikifier.Parser.add({name:"link",profiles:["core"],match:"\\[\\[[^[]",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=Wikifier.helpers.evalPassageId(t.link),n=t.hasOwnProperty("text")?Wikifier.helpers.evalText(t.text):r,a=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,i=(Config.debug?new DebugView(e.output,"link-markup","[[link]]",e.source.slice(e.matchStart,e.nextMatch)):e).output;t.forceInternal||!Wikifier.isExternalLink(r)?Wikifier.createInternalLink(i,r,n,a):Wikifier.createExternalLink(i,r,n)}}),Wikifier.Parser.add({name:"urlLink",profiles:["core"],match:Patterns.url,handler:function(e){
e.outputText(Wikifier.createExternalLink(e.output,e.matchText),e.matchStart,e.nextMatch)}}),Wikifier.Parser.add({name:"image",profiles:["core"],match:"\\[[<>]?[Ii][Mm][Gg]\\[",handler:function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup(e);if(t.hasOwnProperty("error"))return void e.outputText(e.output,e.matchStart,e.nextMatch);e.nextMatch=t.pos;var r=void 0;Config.debug&&(r=new DebugView(e.output,"image-markup",t.hasOwnProperty("link")?"[img[][link]]":"[img[]]",e.source.slice(e.matchStart,e.nextMatch)),r.modes({block:!0}));var n=t.hasOwnProperty("setter")?Wikifier.helpers.createShadowSetterCallback(Scripting.parse(t.setter)):null,a=(Config.debug?r:e).output,i=void 0;if(t.hasOwnProperty("link")){var o=Wikifier.helpers.evalPassageId(t.link);a=t.forceInternal||!Wikifier.isExternalLink(o)?Wikifier.createInternalLink(a,o,null,n):Wikifier.createExternalLink(a,o),a.classList.add("link-image")}if(a=jQuery(document.createElement("img")).appendTo(a).get(0),i=Wikifier.helpers.evalPassageId(t.source),"data:"!==i.slice(0,5)&&Story.has(i)){var s=Story.get(i);s.tags.includes("Twine.image")&&(a.setAttribute("data-passage",s.title),i=s.text.trim())}a.src=i,t.hasOwnProperty("text")&&(a.title=Wikifier.helpers.evalText(t.text)),t.hasOwnProperty("align")&&(a.align=t.align)}}),Wikifier.Parser.add({name:"monospacedByBlock",profiles:["block"],match:"^\\{\\{\\{\\n",lookahead:/^\{\{\{\n((?:^[^\n]*\n)+?)(^\}\}\}$\n?)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){var r=jQuery(document.createElement("pre"));jQuery(document.createElement("code")).text(t[1]).appendTo(r),r.appendTo(e.output),e.nextMatch=this.lookahead.lastIndex}}}),Wikifier.Parser.add({name:"formatByChar",profiles:["core"],match:"''|//|__|\\^\\^|~~|==|\\{\\{\\{",handler:function(e){switch(e.matchText){case"''":e.subWikify(jQuery(document.createElement("strong")).appendTo(e.output).get(0),"''");break;case"//":e.subWikify(jQuery(document.createElement("em")).appendTo(e.output).get(0),"//");break;case"__":e.subWikify(jQuery(document.createElement("u")).appendTo(e.output).get(0),"__");break;case"^^":e.subWikify(jQuery(document.createElement("sup")).appendTo(e.output).get(0),"\\^\\^");break;case"~~":e.subWikify(jQuery(document.createElement("sub")).appendTo(e.output).get(0),"~~");break;case"==":e.subWikify(jQuery(document.createElement("s")).appendTo(e.output).get(0),"==");break;case"{{{":var t=/\{\{\{((?:.|\n)*?)\}\}\}/gm;t.lastIndex=e.matchStart;var r=t.exec(e.source);r&&r.index===e.matchStart&&(jQuery(document.createElement("code")).text(r[1]).appendTo(e.output),e.nextMatch=t.lastIndex)}}}),Wikifier.Parser.add({name:"customStyle",profiles:["core"],match:"@@",terminator:"@@",blockRe:/\s*\n/gm,handler:function(e){var t=Wikifier.helpers.inlineCss(e);this.blockRe.lastIndex=e.nextMatch;var r=this.blockRe.exec(e.source),n=r&&r.index===e.nextMatch,a=jQuery(document.createElement(n?"div":"span")).appendTo(e.output);0===t.classes.length&&""===t.id&&0===Object.keys(t.styles).length?a.addClass("marked"):(t.classes.forEach(function(e){return a.addClass(e)}),""!==t.id&&a.attr("id",t.id),a.css(t.styles)),n?(e.nextMatch+=r[0].length,e.subWikify(a[0],"\\n?"+this.terminator)):e.subWikify(a[0],this.terminator)}}),Wikifier.Parser.add({name:"verbatimText",profiles:["core"],match:'"{3}|<[Nn][Oo][Ww][Ii][Kk][Ii]>',lookahead:/(?:"{3}((?:.|\n)*?)"{3})|(?:<[Nn][Oo][Ww][Ii][Kk][Ii]>((?:.|\n)*?)<\/[Nn][Oo][Ww][Ii][Kk][Ii]>)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex,jQuery(document.createElement("span")).addClass("verbatim").text(t[1]||t[2]).appendTo(e.output))}}),Wikifier.Parser.add({name:"horizontalRule",profiles:["core"],match:"^----+$\\n?|<[Hh][Rr]\\s*/?>\\n?",handler:function(e){jQuery(document.createElement("hr")).appendTo(e.output)}}),Wikifier.Parser.add({name:"emdash",profiles:["core"],match:"--",handler:function(e){jQuery(document.createTextNode("—")).appendTo(e.output)}}),Wikifier.Parser.add({name:"doubleDollarSign",profiles:["core"],match:"\\${2}",handler:function(e){jQuery(document.createTextNode("$")).appendTo(e.output)}}),Wikifier.Parser.add({name:"nakedVariable",profiles:["core"],match:Patterns.variable+"(?:(?:\\."+Patterns.identifier+")|(?:\\[\\d+\\])|(?:\\[\"(?:\\\\.|[^\"\\\\])+\"\\])|(?:\\['(?:\\\\.|[^'\\\\])+'\\])|(?:\\["+Patterns.variable+"\\]))*",handler:function(e){var t=toStringOrDefault(State.getVar(e.matchText),null);null===t?jQuery(document.createTextNode(e.matchText)).appendTo(e.output):new Wikifier((Config.debug?new DebugView(e.output,"variable",e.matchText,e.matchText):e).output,t)}}),Wikifier.Parser.add({name:"template",profiles:["core"],match:"\\?"+Patterns.templateName,handler:function(e){var t=e.matchText.slice(1),r=Template.get(t),n=null;switch(r instanceof Array&&(r=r.random()),void 0===r?"undefined":_typeof(r)){case"function":try{n=toStringOrDefault(r.call({name:t}),null)}catch(r){return throwError(e.output,"cannot execute function template ?"+t+": "+r.message,e.source.slice(e.matchStart,e.nextMatch))}break;case"string":n=r}null===n?jQuery(document.createTextNode(e.matchText)).appendTo(e.output):new Wikifier((Config.debug?new DebugView(e.output,"template",e.matchText,e.matchText):e).output,n)}}),Wikifier.Parser.add({name:"heading",profiles:["block"],match:"^!{1,6}",terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.subWikify(jQuery(document.createElement("h"+e.matchLength)).appendTo(e.output).get(0),this.terminator)}}),Wikifier.Parser.add({name:"table",profiles:["block"],match:"^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",lookahead:/^\|([^\n]*)\|([fhck]?)$/gm,rowTerminator:"\\|(?:[cfhk]?)$\\n?",cellPattern:"(?:\\|([^\\n\\|]*)\\|)|(\\|[cfhk]?$\\n?)",cellTerminator:"(?:\\u0020*)\\|",rowTypes:{c:"caption",f:"tfoot",h:"thead","":"tbody"},handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));var t=jQuery(document.createElement("table")).appendTo(e.output).get(0),r=[],n=null,a=null,i=0,o=void 0;e.nextMatch=e.matchStart;do{this.lookahead.lastIndex=e.nextMatch;var s=this.lookahead.exec(e.source);if(o=s&&s.index===e.nextMatch){var u=s[2];"k"===u?(t.className=s[1],e.nextMatch+=s[0].length+1):(u!==n&&(n=u,a=jQuery(document.createElement(this.rowTypes[u])).appendTo(t)),"c"===n?(a.css("caption-side",0===i?"top":"bottom"),e.nextMatch+=1,e.subWikify(a[0],this.rowTerminator)):this.rowHandler(e,jQuery(document.createElement("tr")).appendTo(a).get(0),r),++i)}}while(o)},rowHandler:function(e,t,r){var n=this,a=new RegExp(this.cellPattern,"gm"),i=0,o=1,s=void 0;do{a.lastIndex=e.nextMatch;var u=a.exec(e.source);if(s=u&&u.index===e.nextMatch){if("~"===u[1]){var l=r[i];l&&(++l.rowCount,l.$element.attr("rowspan",l.rowCount).css("vertical-align","middle")),e.nextMatch=u.index+u[0].length-1}else if(">"===u[1])++o,e.nextMatch=u.index+u[0].length-1;else{if(u[2]){e.nextMatch=u.index+u[0].length;break}!function(){++e.nextMatch;for(var a=Wikifier.helpers.inlineCss(e),s=!1,u=!1,l=void 0;" "===e.source.substr(e.nextMatch,1);)s=!0,++e.nextMatch;"!"===e.source.substr(e.nextMatch,1)?(l=jQuery(document.createElement("th")).appendTo(t),++e.nextMatch):l=jQuery(document.createElement("td")).appendTo(t),r[i]={rowCount:1,$element:l},o>1&&(l.attr("colspan",o),o=1),e.subWikify(l[0],n.cellTerminator)," "===e.matchText.substr(e.matchText.length-2,1)&&(u=!0),a.classes.forEach(function(e){return l.addClass(e)}),""!==a.id&&l.attr("id",a.id),s&&u?a.styles["text-align"]="center":s?a.styles["text-align"]="right":u&&(a.styles["text-align"]="left"),l.css(a.styles),e.nextMatch=e.nextMatch-1}()}++i}}while(s)}}),Wikifier.Parser.add({name:"list",profiles:["block"],match:"^(?:(?:\\*+)|(?:#+))",lookahead:/^(?:(\*+)|(#+))/gm,terminator:"\\n",handler:function(e){if(!Wikifier.helpers.hasBlockContext(e.output.childNodes))return void jQuery(e.output).append(document.createTextNode(e.matchText));e.nextMatch=e.matchStart;var t=[e.output],r=null,n=0,a=void 0,i=void 0;do{this.lookahead.lastIndex=e.nextMatch;var o=this.lookahead.exec(e.source);if(a=o&&o.index===e.nextMatch){var s=o[2]?"ol":"ul",u=o[0].length;if(e.nextMatch+=o[0].length,u>n)for(i=n;i<u;++i)t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0));else if(u<n)for(i=n;i>u;--i)t.pop();else u===n&&s!==r&&(t.pop(),t.push(jQuery(document.createElement(s)).appendTo(t[t.length-1]).get(0)));n=u,r=s,e.subWikify(jQuery(document.createElement("li")).appendTo(t[t.length-1]).get(0),this.terminator)}}while(a)}}),Wikifier.Parser.add({name:"commentByBlock",profiles:["core"],match:"(?:/(?:%|\\*))|(?:\x3c!--)",lookahead:/(?:\/(%|\*)(?:(?:.|\n)*?)\1\/)|(?:<!--(?:(?:.|\n)*?)-->)/gm,handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);t&&t.index===e.matchStart&&(e.nextMatch=this.lookahead.lastIndex)}}),Wikifier.Parser.add({name:"lineContinuation",profiles:["core"],match:"\\\\"+Patterns.spaceNoTerminator+"*\\n|\\n"+Patterns.spaceNoTerminator+"*\\\\|\\n?\\\\"+Patterns.spaceNoTerminator+"*$|^"+Patterns.spaceNoTerminator+"*\\\\\\n?",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"lineBreak",profiles:["core"],match:"\\n|<[Bb][Rr]\\s*/?>",handler:function(e){e.options.nobr||jQuery(document.createElement("br")).appendTo(e.output)}}),Wikifier.Parser.add({name:"htmlCharacterReference",profiles:["core"],match:"(?:(?:&#?[0-9A-Za-z]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9A-Fa-f]|1D[C-Fc-f][0-9A-Fa-f]|20[D-Fd-f][0-9A-Fa-f]|FE2[0-9A-Fa-f])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[0-9A-Za-z]{2,8};)",handler:function(e){jQuery(document.createDocumentFragment()).append(e.matchText).appendTo(e.output)}}),Wikifier.Parser.add({name:"xmlProlog",profiles:["core"],match:"<\\?[Xx][Mm][Ll][^>]*\\?>",handler:function(e){e.nextMatch=e.matchStart+e.matchLength}}),Wikifier.Parser.add({name:"verbatimHtml",profiles:["core"],match:"<[Hh][Tt][Mm][Ll]>",lookahead:/<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/gm,handler:e}),Wikifier.Parser.add({name:"verbatimSvgTag",profiles:["core"],match:"<[Ss][Vv][Gg][^>]*>",lookahead:/(<[Ss][Vv][Gg][^>]*>(?:.|\n)*?<\/[Ss][Vv][Gg]>)/gm,handler:e}),Wikifier.Parser.add({name:"verbatimScriptTag",profiles:["core"],match:"<[Ss][Cc][Rr][Ii][Pp][Tt][^>]*>",lookahead:/(<[Ss][Cc][Rr][Ii][Pp][Tt]*>(?:.|\n)*?<\/[Ss][Cc][Rr][Ii][Pp][Tt]>)/gm,handler:e}),Wikifier.Parser.add({name:"styleTag",profiles:["core"],match:"<[Ss][Tt][Yy][Ll][Ee][^>]*>",lookahead:/(<[Ss][Tt][Yy][Ll][Ee]*>)((?:.|\n)*?)(<\/[Ss][Tt][Yy][Ll][Ee]>)/gm,imageMarkup:new RegExp(Patterns.cssImage,"g"),hasImageMarkup:new RegExp(Patterns.cssImage),handler:function(e){this.lookahead.lastIndex=e.matchStart;var t=this.lookahead.exec(e.source);if(t&&t.index===e.matchStart){e.nextMatch=this.lookahead.lastIndex;var r=t[2];this.hasImageMarkup.test(r)&&(this.imageMarkup.lastIndex=0,r=r.replace(this.imageMarkup,function(e){var t=Wikifier.helpers.parseSquareBracketedMarkup({source:e,matchStart:0});if(t.hasOwnProperty("error")||t.pos<e.length)return e;var r=t.source;if("data:"!==r.slice(0,5)&&Story.has(r)){var n=Story.get(r);n.tags.includes("Twine.image")&&(r=n.text)}return'url("'+r.replace(/"/g,"%22")+'")'})),jQuery(document.createDocumentFragment()).append(t[1]+r+t[3]).appendTo(e.output)}}}),Wikifier.Parser.add({name:"htmlTag",profiles:["core"],match:"<\\w+(?:\\s+[^\\u0000-\\u001F\\u007F-\\u009F\\s\"'>\\/=]+(?:\\s*=\\s*(?:\"[^\"]*?\"|'[^']*?'|[^\\s\"'=<>`]+))?)*\\s*\\/?>",tagRe:/^<(\w+)/,mediaElements:["audio","img","source","track","video"],nobrElements:["audio","colgroup","datalist","dl","figure","ol","optgroup","picture","select","table","tbody","tfoot","thead","tr","ul","video"],voidElements:["area","base","br","col","embed","hr","img","input","keygen","link","menuitem","meta","param","source","track","wbr"],handler:function(e){var t=this.tagRe.exec(e.matchText),r=t&&t[1],n=r&&r.toLowerCase();if(n){var a=this.voidElements.includes(n)||e.matchText.endsWith("/>"),i=this.nobrElements.includes(n),o=void 0,s=void 0;if(!a){o="<\\/"+n+"\\s*>";var u=new RegExp(o,"gim");u.lastIndex=e.matchStart,s=u.exec(e.source)}if(!a&&!s)return throwError(e.output,"cannot find a closing tag for HTML <"+r+">",e.matchText+"…");var l=e.output,c=document.createElement(e.output.tagName),d=void 0;for(c.innerHTML=e.matchText;c.firstChild;)c=c.firstChild;try{this.processAttributeDirectives(c)}catch(t){return throwError(e.output,"<"+n+">: "+t.message,e.matchText+"…")}c.hasAttribute("data-passage")&&(this.processDataAttributes(c,n),Config.debug&&(d=new DebugView(e.output,"html-"+n,n,e.matchText),d.modes({block:"img"===n,nonvoid:s}),l=d.output)),s&&(e.subWikify(c,o,{ignoreTerminatorCase:!0,nobr:i}),d&&jQuery(c).find(".debug.block").length>0&&d.modes({block:!0})),l.appendChild("track"===n?c.cloneNode(!0):c)}},processAttributeDirectives:function(e){[].concat(_toConsumableArray(e.attributes)).forEach(function(t){var r=t.name,n=t.value,a="@"===r[0];if(a||r.startsWith("sc-eval:")){var i=r.slice(a?1:8),o=void 0;try{o=Scripting.evalTwineScript(n)}catch(e){throw new Error('bad evaluation from attribute directive "'+r+'": '+e.message)}try{e.setAttribute(i,o),e.removeAttribute(r)}catch(e){throw new Error('cannot transform attribute directive "'+r+'" into attribute "'+i+'"')}}})},processDataAttributes:function(e,t){var r=e.getAttribute("data-passage");if(null!=r){var n=Wikifier.helpers.evalPassageId(r);if(n!==r&&(r=n,e.setAttribute("data-passage",n)),""!==r)if(this.mediaElements.includes(t)){if("data:"!==r.slice(0,5)&&Story.has(r)){r=Story.get(r);var a=void 0,i=void 0;switch(t){case"audio":case"video":i="Twine."+t;break;case"img":i="Twine.image";break;case"track":i="Twine.vtt";break;case"source":var o=$(e).closest("audio,picture,video");o.length&&(a=o.get(0).tagName.toLowerCase(),i="Twine."+("picture"===a?"image":a))}r.tags.includes(i)&&(e["picture"===a?"srcset":"src"]=r.text.trim())}}else{var s=e.getAttribute("data-setter"),u=void 0;null!=s&&""!==(s=String(s).trim())&&(u=Wikifier.helpers.createShadowSetterCallback(Scripting.parse(s))),Story.has(r)?(e.classList.add("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(r)&&e.classList.add("link-visited")):e.classList.add("link-broken"),jQuery(e).ariaClick({one:!0},function(){"function"==typeof u&&u.call(this),Engine.play(r)})}}}})}();var Template=function(){function e(e,t){if(!(s(t)||t instanceof Array&&t.length>0&&t.every(s)))throw new Error("invalid template type ("+e+"); templates must be: functions, strings, or an array of either");(e instanceof Array?e:[e]).forEach(function(e){if(i.has(e))throw new Error("cannot clobber existing template ?"+e);if(!o.test(e))throw new Error('invalid template name "'+e+'"');i.set(e,t)})}function t(e){(e instanceof Array?e:[e]).forEach(function(e){return i.delete(e)})}function r(e){return i.has(e)?i.get(e):null}function n(e){return i.has(e)}function a(){return i.size}var i=new Map,o=new RegExp("^(?:"+Patterns.templateName+")$"),s=function(e){var t=void 0===e?"undefined":_typeof(e);return"function"===t||"string"===t};return Object.freeze(Object.defineProperties({},{add:{value:e},delete:{value:t},get:{value:r},has:{value:n},size:{get:a}}))}(),Macro=function(){function e(t,r,a){if(Array.isArray(t))return void t.forEach(function(t){return e(t,r,a)});if(!f.test(t))throw new Error('invalid macro name "'+t+'"');if(n(t))throw new Error("cannot clobber existing macro <<"+t+">>");if(u(t))throw new Error("cannot clobber child tag <<"+t+">> of parent macro"+(1===d[t].length?"":"s")+" <<"+d[t].join(">>, <<")+">>");try{if("object"===(void 0===r?"undefined":_typeof(r)))c[t]=a?clone(r):r;else{if(!n(r))throw new Error("cannot create alias of nonexistent macro <<"+r+">>");c[t]=a?clone(c[r]):c[r]}Object.defineProperty(c,t,{writable:!1}),c[t]._MACRO_API=!0}catch(e){throw"TypeError"===e.name?new Error("cannot clobber protected macro <<"+t+">>"):new Error("unknown error when attempting to add macro <<"+t+">>: ["+e.name+"] "+e.message)}if(c[t].hasOwnProperty("tags"))if(null==c[t].tags)o(t);else{if(!Array.isArray(c[t].tags))throw new Error('bad value for "tags" property of macro <<'+t+">>");o(t,c[t].tags)}}function t(e){if(Array.isArray(e))return void e.forEach(function(e){return t(e)});if(n(e)){c[e].hasOwnProperty("tags")&&s(e);try{Object.defineProperty(c,e,{writable:!0}),delete c[e]}catch(t){throw new Error("unknown error removing macro <<"+e+">>: "+t.message)}}else if(u(e))throw new Error("cannot remove child tag <<"+e+">> of parent macro <<"+d[e]+">>")}function r(){return 0===Object.keys(c).length}function n(e){return c.hasOwnProperty(e)}function a(e){var t=null;return n(e)&&"function"==typeof c[e].handler?t=c[e]:macros.hasOwnProperty(e)&&"function"==typeof macros[e].handler&&(t=macros[e]),t}function i(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"init";Object.keys(c).forEach(function(t){"function"==typeof c[t][e]&&c[t][e](t)}),Object.keys(macros).forEach(function(t){"function"==typeof macros[t][e]&&macros[t][e](t)})}function o(e,t){if(!e)throw new Error("no parent specified");for(var r=["/"+e,"end"+e],a=[].concat(r,Array.isArray(t)?t:[]),i=0;i<a.length;++i){var o=a[i];if(n(o))throw new Error("cannot register tag for an existing macro");u(o)?d[o].includes(e)||(d[o].push(e),d[o].sort()):d[o]=[e]}}function s(e){if(!e)throw new Error("no parent specified");Object.keys(d).forEach(function(t){var r=d[t].indexOf(e);-1!==r&&(1===d[t].length?delete d[t]:d[t].splice(r,1))})}function u(e){return d.hasOwnProperty(e)}function l(e){return u(e)?d[e]:null}var c={},d={},f=new RegExp("^(?:"+Patterns.macroName+")$");return Object.freeze(Object.defineProperties({},{add:{value:e},delete:{value:t},isEmpty:{value:r},has:{value:n},get:{value:a},init:{value:i},tags:{value:Object.freeze(Object.defineProperties({},{register:{value:o},unregister:{value:s},has:{value:u},get:{value:l}}))},evalStatements:{value:function(){return Scripting.evalJavaScript.apply(Scripting,arguments)}}}))}(),MacroContext=function(){return function(){function e(t){_classCallCheck(this,e);var r=Object.assign({parent:null,macro:null,name:"",args:null,payload:null,parser:null,source:""},t);if(null===r.macro||""===r.name||null===r.parser)throw new TypeError("context object missing required properties");Object.defineProperties(this,{self:{value:r.macro},name:{value:r.name},args:{value:r.args},payload:{value:r.payload},source:{value:r.source},parent:{value:r.parent},parser:{value:r.parser},_output:{value:r.parser.output},_shadows:{writable:!0,value:null},_debugView:{writable:!0,value:null},_debugViewEnabled:{writable:!0,value:Config.debug}})}return _createClass(e,[{key:"contextHas",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return!0;return!1}},{key:"contextSelect",value:function(e){for(var t=this;null!==(t=t.parent);)if(e(t))return t;return null}},{key:"contextSelectAll",value:function(e){for(var t=[],r=this;null!==(r=r.parent);)e(r)&&t.push(r);return t}},{key:"addShadow",value:function(){var e=this;this._shadows||(this._shadows=new Set);for(var t=new RegExp("^"+Patterns.variable+"$"),r=arguments.length,n=Array(r),a=0;a<r;a++)n[a]=arguments[a];n.flat(1/0).forEach(function(r){if("string"!=typeof r)throw new TypeError("variable name must be a string; type: "+(void 0===r?"undefined":_typeof(r)));if(!t.test(r))throw new Error('invalid variable name "'+r+'"');e._shadows.add(r)})}},{key:"createShadowWrapper",value:function(e,t,r){var n=this,a=void 0;return"function"==typeof e&&(a={},this.shadowView.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;a[e]=r[t]})),function(){for(var i=arguments.length,o=Array(i),s=0;s<i;s++)o[s]=arguments[s];if("function"==typeof r&&r.apply(this,o),"function"==typeof e){var u=Object.keys(a),l=u.length>0?{}:null,c=Wikifier.Parser.get("macro"),d=void 0;try{u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;r.hasOwnProperty(t)&&(l[t]=r[t]),r[t]=a[e]}),d=c.context,c.context=n,e.apply(this,o)}finally{d!==undefined&&(c.context=d),u.forEach(function(e){var t=e.slice(1),r="$"===e[0]?State.variables:State.temporary;a[e]=r[t],l.hasOwnProperty(t)?r[t]=l[t]:delete r[t]})}}"function"==typeof t&&t.apply(this,o)}}},{key:"createDebugView",value:function(e,t){return this._debugView=new DebugView(this._output,"macro",e||this.name,t||this.source),null!==this.payload&&this.payload.length>0&&this._debugView.modes({nonvoid:!0}),this._debugViewEnabled=!0,this._debugView}},{key:"removeDebugView",value:function(){null!==this._debugView&&(this._debugView.remove(),this._debugView=null),this._debugViewEnabled=!1}},{key:"error",value:function(e,t){return throwError(this._output,"<<"+this.name+">>: "+e,t||this.source)}},{key:"output",get:function(){return this._debugViewEnabled?this.debugView.output:this._output}},{key:"shadows",get:function(){return[].concat(_toConsumableArray(this._shadows))}},{key:"shadowView",get:function(){var e=new Set;return this.contextSelectAll(function(e){return e._shadows}).forEach(function(t){return t._shadows.forEach(function(t){return e.add(t)})}),[].concat(_toConsumableArray(e))}},{key:"debugView",get:function(){return this._debugViewEnabled?null!==this._debugView?this._debugView:this.createDebugView():null}}]),e}()}();!function(){if(Macro.add("capture",{skipArgs:!0,tags:null,handler:function(){if(0===this.args.raw.length)return this.error("no story/temporary variable list specified");var e={};try{for(var t=new RegExp("("+Patterns.variable+")","g"),r=void 0;null!==(r=t.exec(this.args.raw));){var n=r[1],a=n.slice(1),i="$"===n[0]?State.variables:State.temporary;i.hasOwnProperty(a)&&(e[a]=i[a]),this.addShadow(n)}new Wikifier(this.output,this.payload[0].contents)}finally{this.shadows.forEach(function(t){var r=t.slice(1),n="$"===t[0]?State.variables:State.temporary;e.hasOwnProperty(r)?n[r]=e[r]:delete n[r]})}}}),Macro.add("set",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("unset",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story/temporary variable list specified");for(var e=new RegExp("State\\.(variables|temporary)\\.("+Patterns.identifier+")","g"),t=void 0;null!==(t=e.exec(this.args.full));){var r=State[t[1]],n=t[2];r.hasOwnProperty(n)&&delete r[n]}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remember",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(var e=storage.get("remember")||{},t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0;null!==(r=t.exec(this.args.full));){var n=r[1];e[n]=State.variables[n]}if(!storage.set("remember",e))return this.error("unknown error, cannot remember: "+this.args.raw);Config.debug&&this.debugView.modes({hidden:!0})},init:function(){var e=storage.get("remember");e&&Object.keys(e).forEach(function(t){return State.variables[t]=e[t]})}}),Macro.add("forget",{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no story variable list specified");for(var e=storage.get("remember"),t=new RegExp("State\\.variables\\.("+Patterns.identifier+")","g"),r=void 0,n=!1;null!==(r=t.exec(this.args.full));){var a=r[1];State.variables.hasOwnProperty(a)&&delete State.variables[a],e&&e.hasOwnProperty(a)&&(n=!0,delete e[a])}if(n)if(0===Object.keys(e).length){if(!storage.delete("remember"))return this.error("unknown error, cannot update remember store")}else if(!storage.set("remember",e))return this.error("unknown error, cannot update remember store");Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("run","set"),Macro.add("script",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();try{Scripting.evalJavaScript(this.payload[0].contents,e)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e),this.source+this.payload[0].contents+"<</"+this.name+">>")}Config.debug&&this.createDebugView(),e.hasChildNodes()&&this.output.appendChild(e)}}),Macro.add("include",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');Config.debug&&this.debugView.modes({block:!0}),e=Story.get(e);var t=void 0;t=this.args[1]?jQuery(document.createElement(this.args[1])).addClass(e.domId+" macro-"+this.name).attr("data-passage",e.title).appendTo(this.output):jQuery(this.output),t.wiki(e.processText())}}),Macro.add("nobr",{skipArgs:!0,tags:null,handler:function(){new Wikifier(this.output,this.payload[0].contents.replace(/^\n+|\n+$/g,"").replace(/\n+/g," "))}}),Macro.add(["print","=","-"],{skipArgs:!0,handler:function(){if(0===this.args.full.length)return this.error("no expression specified");try{var e=toStringOrDefault(Scripting.evalJavaScript(this.args.full),null);null!==e&&new Wikifier(this.output,"-"===this.name?Util.escape(e):e)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}),Macro.add("silently",{skipArgs:!0,tags:null,handler:function(){var e=document.createDocumentFragment();if(new Wikifier(e,this.payload[0].contents.trim()),Config.debug)this.debugView.modes({hidden:!0}),this.output.appendChild(e);else{var t=[].concat(_toConsumableArray(e.querySelectorAll(".error"))).map(function(e){return e.textContent});if(t.length>0)return this.error("error"+(1===t.length?"":"s")+" within contents ("+t.join("; ")+")",this.source+this.payload[0].contents+"<</"+this.name+">>")}}}),Macro.add("display","include"),Macro.add("if",{skipArgs:!0,tags:["elseif","else"],handler:function(){var e=void 0;try{var t=this.payload.length;for(e=0;e<t;++e)switch(this.payload[e].name){case"else":if(this.payload[e].args.raw.length>0)return/^\s*if\b/i.test(this.payload[e].args.raw)?this.error('whitespace is not allowed between the "else" and "if" in <<elseif>> clause'+(e>0?" (#"+e+")":"")):this.error("<<else>> does not accept a conditional expression (perhaps you meant to use <<elseif>>), invalid: "+this.payload[e].args.raw);if(e+1!==t)return this.error("<<else>> must be the final clause");break;default:if(0===this.payload[e].args.full.length)return this.error("no conditional expression specified for <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":""));if(Config.macros.ifAssignmentError&&/[^!=&^|<>*\/%+-]=[^=]/.test(this.payload[e].args.full))return this.error("assignment operator found within <<"+this.payload[e].name+">> clause"+(e>0?" (#"+e+")":"")+" (perhaps you meant to use an equality operator: ==, ===, eq, is), invalid: "+this.payload[e].args.raw)}var r=Scripting.evalJavaScript,n=!1;for(e=0;e<t;++e){if(Config.debug&&this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1}),"else"===this.payload[e].name||r(this.payload[e].args.full)){n=!0,new Wikifier(this.output,this.payload[e].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++e;e<t;++e)this.createDebugView(this.payload[e].name,this.payload[e].source).modes({nonvoid:!1,hidden:!0,invalid:!0});this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!n,invalid:!n})}}catch(t){return this.error("bad conditional expression in <<"+(0===e?"if":"elseif")+">> clause"+(e>0?" (#"+e+")":"")+": "+("object"===(void 0===t?"undefined":_typeof(t))?t.message:t))}}}),Macro.add("switch",{skipArgs:["switch"],tags:["case","default"],handler:function(){if(0===this.args.full.length)return this.error("no expression specified");var e=this.payload.length;if(1===e)return this.error("no cases specified");var t=void 0;for(t=1;t<e;++t)switch(this.payload[t].name){case"default":if(this.payload[t].args.length>0)return this.error("<<default>> does not accept values, invalid: "+this.payload[t].args.raw);if(t+1!==e)return this.error("<<default>> must be the final case");break;default:if(0===this.payload[t].args.length)return this.error("no value(s) specified for <<"+this.payload[t].name+">> (#"+t+")")}var r=void 0;try{r=Scripting.evalJavaScript(this.args.full)}catch(e){return this.error("bad evaluation: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}var n=this.debugView,a=!1;for(Config.debug&&n.modes({nonvoid:!1,hidden:!0}),t=1;t<e;++t){if(Config.debug&&this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1}),"default"===this.payload[t].name||this.payload[t].args.some(function(e){return e===r})){a=!0,new Wikifier(this.output,this.payload[t].contents);break}Config.debug&&this.debugView.modes({hidden:!0,invalid:!0})}if(Config.debug){for(++t;t<e;++t)this.createDebugView(this.payload[t].name,this.payload[t].source).modes({nonvoid:!1,hidden:!0,invalid:!0});n.modes({nonvoid:!1,hidden:!0,invalid:!a}),this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0,invalid:!a})}}}),Macro.add("for",{skipArgs:!0,tags:null,_hasRangeRe:new RegExp("^\\S"+Patterns.anyChar+"*?\\s+range\\s+\\S"+Patterns.anyChar+"*?$"),_rangeRe:new RegExp("^(?:State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s*,\\s*)?State\\.(variables|temporary)\\.("+Patterns.identifier+")\\s+range\\s+(\\S"+Patterns.anyChar+"*?)$"),_3PartRe:/^([^;]*?)\s*;\s*([^;]*?)\s*;\s*([^;]*?)$/,handler:function(){var e=this.args.full.trim(),t=this.payload[0].contents.replace(/\n$/,"");if(0===e.length)this.self._handleFor.call(this,t,null,!0,null);else if(this.self._hasRangeRe.test(e)){var r=e.match(this.self._rangeRe);if(null===r)return this.error("invalid range form syntax, format: [index ,] value range collection");this.self._handleForRange.call(this,t,{type:r[1],name:r[2]},{type:r[3],name:r[4]},r[5])}else{var n=void 0,a=void 0,i=void 0;if(-1===e.indexOf(";")){if(/^\S+\s+in\s+\S+/i.test(e))return this.error("invalid syntax, for…in is not supported; see: for…range");if(/^\S+\s+of\s+\S+/i.test(e))return this.error("invalid syntax, for…of is not supported; see: for…range");a=e}else{var o=e.match(this.self._3PartRe);if(null===o)return this.error("invalid 3-part conditional form syntax, format: [init] ; [condition] ; [post]");n=o[1],a=o[2].trim(),i=o[3],0===a.length&&(a=!0)}this.self._handleFor.call(this,t,n,a,i)}},_handleFor:function(e,t,r,n){var a=Scripting.evalJavaScript,i=!0,o=Config.macros.maxLoopIterations;Config.debug&&this.debugView.modes({block:!0});try{if(TempState.break=null,t)try{a(t)}catch(e){return this.error("bad init expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}for(;a(r);){if(--o<0)return this.error("exceeded configured maximum loop iterations ("+Config.macros.maxLoopIterations+")");if(new Wikifier(this.output,i?e.replace(/^\n/,""):e),i&&(i=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}if(n)try{a(n)}catch(e){return this.error("bad post expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}}}catch(e){return this.error("bad conditional expression: "+("object"===(void 0===e?"undefined":_typeof(e))?e.message:e))}finally{TempState.break=null}},_handleForRange:function(e,t,r,n){var a=!0,i=void 0;try{i=this.self._toRangeList(n)}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});try{TempState.break=null;for(var o=0;o<i.length;++o)if(t.name&&(State[t.type][t.name]=i[o][0]),
State[r.type][r.name]=i[o][1],new Wikifier(this.output,a?e.replace(/^\n/,""):e),a&&(a=!1),null!=TempState.break)if(1===TempState.break)TempState.break=null;else if(2===TempState.break){TempState.break=null;break}}catch(e){return this.error("object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}finally{TempState.break=null}},_toRangeList:function(e){var t=Scripting.evalJavaScript,r=void 0;try{r=t("{"===e[0]?"("+e+")":e)}catch(e){if("object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("bad range expression: "+e);throw e.message="bad range expression: "+e.message,e}var n=void 0;switch(void 0===r?"undefined":_typeof(r)){case"string":n=[];for(var a=0;a<r.length;){var i=Util.charAndPosAt(r,a);n.push([a,i.char]),a=1+i.end}break;case"object":if(Array.isArray(r))n=r.map(function(e,t){return[t,e]});else if(r instanceof Set)n=[].concat(_toConsumableArray(r)).map(function(e,t){return[t,e]});else if(r instanceof Map)n=[].concat(_toConsumableArray(r.entries()));else{if("Object"!==Util.toStringTag(r))throw new Error("unsupported range expression type: "+Util.toStringTag(r));n=Object.keys(r).map(function(e){return[e,r[e]]})}break;default:throw new Error("unsupported range expression type: "+(void 0===r?"undefined":_typeof(r)))}return n}}),Macro.add(["break","continue"],{skipArgs:!0,handler:function(){if(!this.contextHas(function(e){return"for"===e.name}))return this.error("must only be used in conjunction with its parent macro <<for>>");TempState.break="continue"===this.name?1:2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["button","link"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no "+("button"===this.name?"button":"link")+" text specified");var t=jQuery(document.createElement("button"===this.name?"button":"a")),r=void 0;if("object"===_typeof(this.args[0]))if(this.args[0].isImage){var n=jQuery(document.createElement("img")).attr("src",this.args[0].source).appendTo(t);this.args[0].hasOwnProperty("passage")&&n.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&n.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&n.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(r=this.args[0].link),r=this.args[0].link}else t.append(document.createTextNode(this.args[0].text)),r=this.args[0].link;else t.wikiWithOptions({profile:"core"},this.args[0]),r=this.args.length>1?this.args[1]:undefined;null!=r?(t.attr("data-passage",r),Story.has(r)?(t.addClass("link-internal"),Config.addVisitedLinkClass&&State.hasPlayed(r)&&t.addClass("link-visited")):t.addClass("link-broken")):t.addClass("link-internal"),t.addClass("macro-"+this.name).ariaClick({namespace:".macros",one:null!=r},this.createShadowWrapper(""!==this.payload[0].contents?function(){return Wikifier.wikifyEval(e.payload[0].contents.trim())}:null,null!=r?function(){return Engine.play(r)}:null)).appendTo(this.output)}}),Macro.add("checkbox",{isAsync:!0,handler:function(){if(this.args.length<3){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("unchecked value"),this.args.length<3&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),n=this.args[1],a=this.args[2],i=document.createElement("input");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"checkbox",tabindex:0}).addClass("macro-"+this.name).on("change.macros",this.createShadowWrapper(function(){State.setVar(t,this.checked?a:n)})).appendTo(this.output),this.args.length>3&&"checked"===this.args[3]?(i.checked=!0,State.setVar(t,a)):State.setVar(t,n)}}),Macro.add(["cycle","listbox"],{isAsync:!0,skipArgs:["optionsfrom"],tags:["option","optionsfrom"],handler:function(){var e=this;if(0===this.args.length)return this.error("no variable name specified");if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),n=this.payload.length;if(1===n)return this.error("no options specified");for(var a=this.args.length>1&&"autoselect"===this.args[1],i=[],o={option:0,optionsfrom:0},s=-1,u=1;u<n;++u){var l=this.payload[u];if("option"===l.name){if(++o.option,0===l.args.length)return this.error("no arguments specified for <<"+l.name+">> (#"+o.option+")");if(i.push({label:String(l.args[0]),value:1===l.args.length?l.args[0]:l.args[1]}),l.args.length>2&&"selected"===l.args[2]){if(a)return this.error("cannot specify both the autoselect and selected keywords");if(-1!==s)return this.error("multiple selected keywords specified for <<"+l.name+">> (#"+(s+1)+" & #"+o.option+")");s=i.length-1}}else{var c=function(){if(++o.optionsfrom,0===l.args.full.length)return{v:e.error("no expression specified for <<"+l.name+">> (#"+o.optionsfrom+")")};var t=void 0;try{var r=l.args.full;t=Scripting.evalJavaScript("{"===r[0]?"("+r+")":r)}catch(t){return{v:e.error("bad evaluation: "+("object"===(void 0===t?"undefined":_typeof(t))?t.message:t))}}if("object"!==(void 0===t?"undefined":_typeof(t))||null===t)return{v:e.error("expression must yield a supported collection or generic object (type: "+(null===t?"null":void 0===t?"undefined":_typeof(t))+")")};if(t instanceof Array||t instanceof Set)t.forEach(function(e){return i.push({label:String(e),value:e})});else if(t instanceof Map)t.forEach(function(e,t){return i.push({label:String(t),value:e})});else{var n=Util.toStringTag(t);if("Object"!==n)return{v:e.error("expression must yield a supported collection or generic object (object type: "+n+")")};Object.keys(t).forEach(function(e){return i.push({label:e,value:t[e]})})}}();if("object"===(void 0===c?"undefined":_typeof(c)))return c.v}}if(-1===s)if(a){var d=Util.sameValueZero,f=State.getVar(t),p=i.findIndex(function(e){return d(e.value,f)});s=-1===p?0:p}else s=0;if("cycle"===this.name){var h=s;jQuery(document.createElement("a")).wikiWithOptions({profile:"core"},i[s].label).addClass("macro-"+this.name).ariaClick({namespace:".macros"},this.createShadowWrapper(function(){h=(h+1)%i.length,$(this).empty().wikiWithOptions({profile:"core"},i[h].label),State.setVar(t,i[h].value)})).appendTo(this.output)}else{var g=jQuery(document.createElement("select"));i.forEach(function(e,t){jQuery(document.createElement("option")).val(t).text(e.label).appendTo(g)}),g.attr({id:this.name+"-"+r,name:this.name+"-"+r,tabindex:0}).addClass("macro-"+this.name).val(s).on("change.macros",this.createShadowWrapper(function(){State.setVar(t,i[Number(this.value)].value)})).appendTo(this.output)}State.setVar(t,i[s].value)}}),Macro.add(["linkappend","linkprepend","linkreplace"],{isAsync:!0,tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no link text specified");var t=jQuery(document.createElement("a")),r=jQuery(document.createElement("span")),n=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]);t.wikiWithOptions({profile:"core"},this.args[0]).addClass("link-internal macro-"+this.name).ariaClick({namespace:".macros",one:!0},this.createShadowWrapper(function(){if("linkreplace"===e.name?t.remove():t.wrap('<span class="macro-'+e.name+'"></span>').replaceWith(function(){return t.html()}),""!==e.payload[0].contents){var a=document.createDocumentFragment();new Wikifier(a,e.payload[0].contents),r.append(a)}n&&setTimeout(function(){return r.removeClass("macro-"+e.name+"-in")},Engine.minDomActionDelay)})).appendTo(this.output),r.addClass("macro-"+this.name+"-insert"),n&&r.addClass("macro-"+this.name+"-in"),"linkprepend"===this.name?r.insertBefore(t):r.insertAfter(t)}}),Macro.add("radiobutton",{isAsync:!0,handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("checked value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');var r=Util.slugify(t),n=this.args[1],a=document.createElement("input");TempState.hasOwnProperty(this.name)||(TempState[this.name]={}),TempState[this.name].hasOwnProperty(r)||(TempState[this.name][r]=0),jQuery(a).attr({id:this.name+"-"+r+"-"+TempState[this.name][r]++,name:this.name+"-"+r,type:"radio",tabindex:0}).addClass("macro-"+this.name).on("change.macros",this.createShadowWrapper(function(){this.checked&&State.setVar(t,n)})).appendTo(this.output),this.args.length>2&&"checked"===this.args[2]&&(a.checked=!0,State.setVar(t,n))}}),Macro.add("textarea",{isAsync:!0,handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),n=this.args[1],a="autofocus"===this.args[2],i=document.createElement("textarea");jQuery(i).attr({id:this.name+"-"+r,name:this.name+"-"+r,rows:4,tabindex:0}).addClass("macro-"+this.name).on("change.macros",this.createShadowWrapper(function(){State.setVar(t,this.value)})).appendTo(this.output),State.setVar(t,n),i.textContent=n,a&&(i.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+i.id]=function(e){delete postdisplay[e],setTimeout(function(){return i.focus()},Engine.minDomActionDelay)})}}),Macro.add("textbox",{isAsync:!0,handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("variable name"),this.args.length<2&&e.push("default value"),this.error("no "+e.join(" or ")+" specified")}if("string"!=typeof this.args[0])return this.error("variable name argument is not a string");var t=this.args[0].trim();if("$"!==t[0]&&"_"!==t[0])return this.error('variable name "'+this.args[0]+'" is missing its sigil ($ or _)');Config.debug&&this.debugView.modes({block:!0});var r=Util.slugify(t),n=this.args[1],a=document.createElement("input"),i=!1,o=void 0;this.args.length>3?(o=this.args[2],i="autofocus"===this.args[3]):this.args.length>2&&("autofocus"===this.args[2]?i=!0:o=this.args[2]),"object"===(void 0===o?"undefined":_typeof(o))&&(o=o.link),jQuery(a).attr({id:this.name+"-"+r,name:this.name+"-"+r,type:"text",tabindex:0}).addClass("macro-"+this.name).on("change.macros",this.createShadowWrapper(function(){State.setVar(t,this.value)})).on("keypress.macros",this.createShadowWrapper(function(e){13===e.which&&(e.preventDefault(),State.setVar(t,this.value),null!=o&&Engine.play(o))})).appendTo(this.output),State.setVar(t,n),a.value=n,i&&(a.setAttribute("autofocus","autofocus"),postdisplay["#autofocus:"+a.id]=function(e){delete postdisplay[e],setTimeout(function(){return a.focus()},Engine.minDomActionDelay)})}}),Macro.add("click","link"),Macro.add("actions",{handler:function(){for(var e=jQuery(document.createElement("ul")).addClass(this.name).appendTo(this.output),t=0;t<this.args.length;++t){var r=void 0,n=void 0,a=void 0,i=void 0;"object"===_typeof(this.args[t])?this.args[t].isImage?(a=jQuery(document.createElement("img")).attr("src",this.args[t].source),this.args[t].hasOwnProperty("passage")&&a.attr("data-passage",this.args[t].passage),this.args[t].hasOwnProperty("title")&&a.attr("title",this.args[t].title),this.args[t].hasOwnProperty("align")&&a.attr("align",this.args[t].align),r=this.args[t].link,i=this.args[t].setFn):(n=this.args[t].text,r=this.args[t].link,i=this.args[t].setFn):n=r=this.args[t],State.variables.hasOwnProperty("#actions")&&State.variables["#actions"].hasOwnProperty(r)&&State.variables["#actions"][r]||jQuery(Wikifier.createInternalLink(jQuery(document.createElement("li")).appendTo(e),r,null,function(e,t){return function(){State.variables.hasOwnProperty("#actions")||(State.variables["#actions"]={}),State.variables["#actions"][e]=!0,"function"==typeof t&&t()}}(r,i))).addClass("macro-"+this.name).append(a||document.createTextNode(n))}}}),Macro.add(["back","return"],{handler:function(){if(this.args.length>1)return this.error("too many arguments specified, check the documentation for details");var e=-1,t=void 0,r=void 0,n=void 0;if(1===this.args.length&&("object"===_typeof(this.args[0])?this.args[0].isImage?(n=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&n.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&n.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&n.attr("align",this.args[0].align),this.args[0].hasOwnProperty("link")&&(t=this.args[0].link)):1===this.args[0].count?t=this.args[0].link:(r=this.args[0].text,t=this.args[0].link):1===this.args.length&&(r=this.args[0])),null==t){for(var a=State.length-2;a>=0;--a)if(State.history[a].title!==State.passage){e=a,t=State.history[a].title;break}if(null==t&&"return"===this.name)for(var i=State.expired.length-1;i>=0;--i)if(State.expired[i]!==State.passage){t=State.expired[i];break}}else{if(!Story.has(t))return this.error('passage "'+t+'" does not exist');if("back"===this.name){for(var o=State.length-2;o>=0;--o)if(State.history[o].title===t){e=o;break}if(-1===e)return this.error('cannot find passage "'+t+'" in the current story history')}}if(null==t)return this.error("cannot find passage");var s=void 0;s="back"!==this.name||-1!==e?jQuery(document.createElement("a")).addClass("link-internal").ariaClick({one:!0},"return"===this.name?function(){return Engine.play(t)}:function(){return Engine.goTo(e)}):jQuery(document.createElement("span")).addClass("link-disabled"),s.addClass("macro-"+this.name).append(n||document.createTextNode(r||L10n.get("macro"+this.name.toUpperFirst()+"Text"))).appendTo(this.output)}}),Macro.add("choice",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=State.passage,t=void 0,r=void 0,n=void 0,a=void 0;if(1===this.args.length?"object"===_typeof(this.args[0])?this.args[0].isImage?(n=jQuery(document.createElement("img")).attr("src",this.args[0].source),this.args[0].hasOwnProperty("passage")&&n.attr("data-passage",this.args[0].passage),this.args[0].hasOwnProperty("title")&&n.attr("title",this.args[0].title),this.args[0].hasOwnProperty("align")&&n.attr("align",this.args[0].align),t=this.args[0].link,a=this.args[0].setFn):(r=this.args[0].text,t=this.args[0].link,a=this.args[0].setFn):r=t=this.args[0]:(t=this.args[0],r=this.args[1]),State.variables.hasOwnProperty("#choice")&&State.variables["#choice"].hasOwnProperty(e)&&State.variables["#choice"][e])return void jQuery(document.createElement("span")).addClass("link-disabled macro-"+this.name).attr("tabindex",-1).append(n||document.createTextNode(r)).appendTo(this.output);jQuery(Wikifier.createInternalLink(this.output,t,null,function(){State.variables.hasOwnProperty("#choice")||(State.variables["#choice"]={}),State.variables["#choice"][e]=!0,"function"==typeof a&&a()})).addClass("macro-"+this.name).append(n||document.createTextNode(r))}}),Macro.add(["addclass","toggleclass"],{handler:function(){if(this.args.length<2){var e=[];return this.args.length<1&&e.push("selector"),this.args.length<2&&e.push("class names"),this.error("no "+e.join(" or ")+" specified")}var t=jQuery(this.args[0]);if(0===t.length)return this.error('no elements matched the selector "'+this.args[0]+'"');switch(this.name){case"addclass":t.addClass(this.args[1].trim());break;case"toggleclass":t.toggleClass(this.args[1].trim())}Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeclass",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');this.args.length>1?e.removeClass(this.args[1].trim()):e.removeClass(),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("copy",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');jQuery(this.output).append(e.html()),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add(["append","prepend","replace"],{tags:null,handler:function(){var e=this;if(0===this.args.length)return this.error("no selector specified");var t=jQuery(this.args[0]);if(0===t.length)return this.error('no elements matched the selector "'+this.args[0]+'"');if(""!==this.payload[0].contents){var r=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),n=void 0;switch(r?(n=jQuery(document.createElement("span")),n.addClass("macro-"+this.name+"-insert macro-"+this.name+"-in"),setTimeout(function(){return n.removeClass("macro-"+e.name+"-in")},Engine.minDomActionDelay)):n=jQuery(document.createDocumentFragment()),n.wiki(this.payload[0].contents),this.name){case"replace":t.empty();case"append":t.append(n);break;case"prepend":t.prepend(n)}}else"replace"===this.name&&t.empty();Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("remove",{handler:function(){if(0===this.args.length)return this.error("no selector specified");var e=jQuery(this.args[0]);if(0===e.length)return this.error('no elements matched the selector "'+this.args[0]+'"');e.remove(),Config.debug&&this.debugView.modes({hidden:!0})}}),Has.audio){var e=function(e,t){return'only one playback action allowed per invocation, "'+e+'" cannot be combined with "'+t+'"'};Macro.add("audio",{handler:function(){if(this.args.length<2){var t=[];return this.args.length<1&&t.push("track and/or group IDs"),this.args.length<2&&t.push("actions"),this.error("no "+t.join(" or ")+" specified")}var r=void 0;try{r=SimpleAudio.select(this.args[0])}catch(e){return this.error(e.message)}for(var n=this.args.slice(1),a=void 0,i=5,o=void 0,s=void 0,u=void 0,l=void 0,c=void 0,d=void 0;n.length>0;){var f=n.shift(),p=void 0;switch(f){case"load":case"pause":case"play":case"stop":case"unload":if(a)return this.error(e(f,a));a=f;break;case"fadein":if(a)return this.error(e(f,a));a="fade",o=1;break;case"fadeout":if(a)return this.error(e(f,a));a="fade",o=0;break;case"fadeto":if(a)return this.error(e(f,a));if(0===n.length)return this.error("fadeto missing required level value");if(a="fade",p=n.shift(),o=Number.parseFloat(p),Number.isNaN(o)||!Number.isFinite(o))return this.error("cannot parse fadeto: "+p);break;case"fadeoverto":if(a)return this.error(e(f,a));if(n.length<2){var h=[];return n.length<1&&h.push("seconds"),n.length<2&&h.push("level"),this.error("fadeoverto missing required "+h.join(" and ")+" value"+(h.length>1?"s":""))}if(a="fade",p=n.shift(),i=Number.parseFloat(p),Number.isNaN(i)||!Number.isFinite(i))return this.error("cannot parse fadeoverto: "+p);if(p=n.shift(),o=Number.parseFloat(p),Number.isNaN(o)||!Number.isFinite(o))return this.error("cannot parse fadeoverto: "+p);break;case"volume":if(0===n.length)return this.error("volume missing required level value");if(p=n.shift(),d=Number.parseFloat(p),Number.isNaN(d)||!Number.isFinite(d))return this.error("cannot parse volume: "+p);break;case"mute":case"unmute":u="mute"===f;break;case"time":if(0===n.length)return this.error("time missing required seconds value");if(p=n.shift(),c=Number.parseFloat(p),Number.isNaN(c)||!Number.isFinite(c))return this.error("cannot parse time: "+p);break;case"loop":case"unloop":s="loop"===f;break;case"goto":if(0===n.length)return this.error("goto missing required passage title");if(p=n.shift(),l="object"===(void 0===p?"undefined":_typeof(p))?p.link:p,!Story.has(l))return this.error('passage "'+l+'" does not exist');break;default:return this.error("unknown action: "+f)}}try{if(null!=d&&r.volume(d),null!=c&&r.time(c),null!=u&&r.mute(u),null!=s&&r.loop(s),null!=l){var g="ended.macros.macro-"+this.name+"_goto";r.off(g).one(g,function(){r.off(g),Engine.play(l)})}switch(a){case"fade":r.fade(i,o);break;case"load":r.load();break;case"pause":r.pause();break;case"play":r.play();break;case"stop":r.stop();break;case"unload":r.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(e){return this.error("error executing action: "+e.message)}}}),Macro.add("cacheaudio",{handler:function(){var e=this;if(this.args.length<2){var t=[];return this.args.length<1&&t.push("track ID"),this.args.length<2&&t.push("sources"),this.error("no "+t.join(" or ")+" specified")}var r=String(this.args[0]).trim(),n=/^format:\s*([\w-]+)\s*;\s*/i;try{SimpleAudio.tracks.add(r,this.args.slice(1).map(function(t){if(n.test(t)){if(Config.debug)return e.error('track ID "'+r+'": format specifier migration required, "format:formatId;" → "formatId|"');t=t.replace(n,"$1|")}return t}))}catch(e){return this.error(e.message)}if(Config.debug&&!SimpleAudio.tracks.get(r).hasSource())return this.error('track ID "'+r+'": no supported audio sources found');Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("createaudiogroup",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no group ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var e=String(this.args[0]).trim(),t=[],r=1,n=this.payload.length;r<n;++r){if(this.payload[r].args.length<1)return this.error("no track ID specified");t.push(String(this.payload[r].args[0]).trim()),Config.debug&&this.createDebugView(this.payload[r].name,this.payload[r].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.groups.add(e,t)}catch(e){return this.error(e.message)}Config.debug&&this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("createplaylist",{tags:["track"],handler:function(){if(0===this.args.length)return this.error("no list ID specified");if(1===this.payload.length)return this.error("no tracks defined via <<track>>");var e=Macro.get("playlist");if(null!==e.from&&"createplaylist"!==e.from)return this.error("a playlist has already been defined with <<setplaylist>>");Config.debug&&this.debugView.modes({nonvoid:!1,hidden:!0});for(var t=String(this.args[0]).trim(),r=[],n=1,a=this.payload.length;n<a;++n){if(0===this.payload[n].args.length)return this.error("no track ID specified");for(var i={id:String(this.payload[n].args[0]).trim()},o=this.payload[n].args.slice(1);o.length>0;){var s=o.shift(),u=void 0,l=void 0;switch(s){case"copy":case"own":i.own=!0;break;case"rate":o.length>0&&o.shift();break;case"volume":if(0===o.length)return this.error("volume missing required level value");if(u=o.shift(),l=Number.parseFloat(u),Number.isNaN(l)||!Number.isFinite(l))return this.error("cannot parse volume: "+u);i.volume=l;break;default:return this.error("unknown action: "+s)}}r.push(i),Config.debug&&this.createDebugView(this.payload[n].name,this.payload[n].source).modes({nonvoid:!1,hidden:!0})}try{SimpleAudio.lists.add(t,r)}catch(e){return this.error(e.message)}null===e.from&&(e.from="createplaylist"),Config.debug&&this.createDebugView("/"+this.name,"<</"+this.name+">>").modes({nonvoid:!1,hidden:!0})}}),Macro.add("masteraudio",{handler:function(){if(0===this.args.length)return this.error("no actions specified");for(var t=this.args.slice(0),r=void 0,n=void 0,a=void 0,i=void 0;t.length>0;){var o=t.shift(),s=void 0;switch(o){case"load":case"stop":case"unload":if(r)return this.error(e(o,r));r=o;break;case"mute":case"unmute":n="mute"===o;break;case"muteonhide":case"nomuteonhide":a="muteonhide"===o;break;case"volume":if(0===t.length)return this.error("volume missing required level value");if(s=t.shift(),i=Number.parseFloat(s),Number.isNaN(i)||!Number.isFinite(i))return this.error("cannot parse volume: "+s);break;default:return this.error("unknown action: "+o)}}try{switch(null!=n&&SimpleAudio.mute(n),null!=a&&SimpleAudio.muteOnHidden(a),null!=i&&SimpleAudio.volume(i),r){case"load":SimpleAudio.load();break;case"stop":SimpleAudio.stop();break;case"unload":SimpleAudio.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(e){return this.error("error executing action: "+e.message)}}}),Macro.add("playlist",{from:null,handler:function(){var t=this.self.from;if(null===t)return this.error("no playlists have been created");var r=void 0,n=void 0;if("createplaylist"===t){if(this.args.length<2){var a=[];return this.args.length<1&&a.push("list ID"),this.args.length<2&&a.push("actions"),this.error("no "+a.join(" or ")+" specified")}var i=String(this.args[0]).trim();if(!SimpleAudio.lists.has(i))return this.error('playlist "'+i+'" does not exist');r=SimpleAudio.lists.get(i),n=this.args.slice(1)}else{if(0===this.args.length)return this.error("no actions specified");r=SimpleAudio.lists.get("setplaylist"),n=this.args.slice(0)}for(var o=void 0,s=5,u=void 0,l=void 0,c=void 0,d=void 0,f=void 0;n.length>0;){var p=n.shift(),h=void 0;switch(p){case"load":case"pause":case"play":case"skip":case"stop":case"unload":if(o)return this.error(e(p,o));o=p;break;case"fadein":if(o)return this.error(e(p,o));o="fade",u=1;break;case"fadeout":if(o)return this.error(e(p,o));o="fade",u=0;break;case"fadeto":if(o)return this.error(e(p,o));if(0===n.length)return this.error("fadeto missing required level value");if(o="fade",h=n.shift(),u=Number.parseFloat(h),Number.isNaN(u)||!Number.isFinite(u))return this.error("cannot parse fadeto: "+h);break;case"fadeoverto":if(o)return this.error(e(p,o));if(n.length<2){var g=[];return n.length<1&&g.push("seconds"),n.length<2&&g.push("level"),this.error("fadeoverto missing required "+g.join(" and ")+" value"+(g.length>1?"s":""))}if(o="fade",h=n.shift(),s=Number.parseFloat(h),Number.isNaN(s)||!Number.isFinite(s))return this.error("cannot parse fadeoverto: "+h);if(h=n.shift(),u=Number.parseFloat(h),Number.isNaN(u)||!Number.isFinite(u))return this.error("cannot parse fadeoverto: "+h);break;case"volume":if(0===n.length)return this.error("volume missing required level value");if(h=n.shift(),f=Number.parseFloat(h),Number.isNaN(f)||!Number.isFinite(f))return this.error("cannot parse volume: "+h);break;case"mute":case"unmute":c="mute"===p;break;case"loop":case"unloop":l="loop"===p;break;case"shuffle":case"unshuffle":d="shuffle"===p;break;default:return this.error("unknown action: "+p)}}try{switch(null!=f&&r.volume(f),null!=c&&r.mute(c),null!=l&&r.loop(l),null!=d&&r.shuffle(d),o){case"fade":r.fade(s,u);break;case"load":r.load();break;case"pause":r.pause();break;case"play":r.play();break;case"skip":r.skip();break;case"stop":r.stop();break;case"unload":r.unload()}Config.debug&&this.debugView.modes({hidden:!0})}catch(e){return this.error("error executing action: "+e.message)}}}),Macro.add("removeaudiogroup",{handler:function(){if(0===this.args.length)return this.error("no group ID specified");var e=String(this.args[0]).trim();if(!SimpleAudio.groups.has(e))return this.error('group "'+e+'" does not exist');SimpleAudio.groups.delete(e),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("removeplaylist",{handler:function(){if(0===this.args.length)return this.error("no list ID specified");var e=String(this.args[0]).trim();if(!SimpleAudio.lists.has(e))return this.error('playlist "'+e+'" does not exist');SimpleAudio.lists.delete(e),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("waitforaudio",{skipArgs:!0,handler:function(){SimpleAudio.loadWithScreen()}}),Macro.add("setplaylist",{handler:function(){if(0===this.args.length)return this.error("no track ID(s) specified");var e=Macro.get("playlist");if(null!==e.from&&"setplaylist"!==e.from)return this.error("playlists have already been defined with <<createplaylist>>");try{SimpleAudio.lists.add("setplaylist",this.args.slice(0))}catch(e){return this.error(e.message)}null===e.from&&(e.from="setplaylist"),Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("stopallaudio",{skipArgs:!0,handler:function(){SimpleAudio.select(":all").stop(),Config.debug&&this.debugView.modes({hidden:!0})}})}else Macro.add(["audio","cacheaudio","createaudiogroup","createplaylist","masteraudio","playlist","removeaudiogroup","removeplaylist","waitforaudio","setplaylist","stopallaudio"],{skipArgs:!0,handler:function(){Config.debug&&this.debugView.modes({hidden:!0})}});Macro.add("goto",{handler:function(){if(0===this.args.length)return this.error("no passage specified");var e=void 0;if(e="object"===_typeof(this.args[0])?this.args[0].link:this.args[0],!Story.has(e))return this.error('passage "'+e+'" does not exist');setTimeout(function(){return Engine.play(e)},Engine.minDomActionDelay)}}),Macro.add("repeat",{isAsync:!0,tags:null,timers:new Set,handler:function(){var e=this;if(0===this.args.length)return this.error("no time value specified");var t=void 0;try{t=Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0]))}catch(e){return this.error(e.message)}Config.debug&&this.debugView.modes({block:!0});var r=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),n=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerInterval(this.createShadowWrapper(function(){var t=document.createDocumentFragment();new Wikifier(t,e.payload[0].contents);var a=n;r&&(a=jQuery(document.createElement("span")).addClass("macro-repeat-insert macro-repeat-in").appendTo(a)),a.append(t),r&&setTimeout(function(){return a.removeClass("macro-repeat-in")},Engine.minDomActionDelay)}),t)},registerInterval:function(e,t){var r=this;if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var n=State.turns,a=this.timers,i=null;i=setInterval(function(){if(n!==State.turns)return clearInterval(i),void a.delete(i);var t=void 0;try{TempState.break=null,TempState.hasOwnProperty("repeatTimerId")&&(t=TempState.repeatTimerId),TempState.repeatTimerId=i,e.call(r)}finally{void 0!==t?TempState.repeatTimerId=t:delete TempState.repeatTimerId,TempState.break=null}},t),a.add(i),prehistory.hasOwnProperty("#repeat-timers-cleanup")||(prehistory["#repeat-timers-cleanup"]=function(e){delete prehistory[e],a.forEach(function(e){return clearInterval(e)}),a.clear()})}}),Macro.add("stop",{skipArgs:!0,handler:function(){if(!TempState.hasOwnProperty("repeatTimerId"))return this.error("must only be used in conjunction with its parent macro <<repeat>>");var e=Macro.get("repeat").timers,t=TempState.repeatTimerId;clearInterval(t),e.delete(t),TempState.break=2,Config.debug&&this.debugView.modes({hidden:!0})}}),Macro.add("timed",{isAsync:!0,tags:["next"],timers:new Set,handler:function(){if(0===this.args.length)return this.error("no time value specified in <<timed>>");var e=[];try{e.push({name:this.name,source:this.source,delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.args[0])),content:this.payload[0].contents})}catch(e){return this.error(e.message+" in <<timed>>")}if(this.payload.length>1){var t=void 0;try{var r=void 0;for(t=1,r=this.payload.length;t<r;++t)e.push({name:this.payload[t].name,source:this.payload[t].source,delay:0===this.payload[t].args.length?e[e.length-1].delay:Math.max(Engine.minDomActionDelay,Util.fromCssTime(this.payload[t].args[0])),content:this.payload[t].contents})}catch(e){return this.error(e.message+" in <<next>> (#"+t+")")}}Config.debug&&this.debugView.modes({block:!0});var n=this.args.length>1&&/^(?:transition|t8n)$/.test(this.args[1]),a=jQuery(document.createElement("span")).addClass("macro-"+this.name).appendTo(this.output);this.self.registerTimeout(this.createShadowWrapper(function(e){var t=document.createDocumentFragment();new Wikifier(t,e.content);var r=a;Config.debug&&"next"===e.name&&(r=jQuery(new DebugView(r[0],"macro",e.name,e.source).output)),
n&&(r=jQuery(document.createElement("span")).addClass("macro-timed-insert macro-timed-in").appendTo(r)),r.append(t),n&&setTimeout(function(){return r.removeClass("macro-timed-in")},Engine.minDomActionDelay)}),e)},registerTimeout:function(e,t){if("function"!=typeof e)throw new TypeError("callback parameter must be a function");var r=State.turns,n=this.timers,a=null,i=t.shift(),o=function o(){if(n.delete(a),r===State.turns){var s=i;null!=(i=t.shift())&&(a=setTimeout(o,i.delay),n.add(a)),e.call(this,s)}};a=setTimeout(o,i.delay),n.add(a),prehistory.hasOwnProperty("#timed-timers-cleanup")||(prehistory["#timed-timers-cleanup"]=function(e){delete prehistory[e],n.forEach(function(e){return clearTimeout(e)}),n.clear()})}}),Macro.add("widget",{tags:null,handler:function(){if(0===this.args.length)return this.error("no widget name specified");var e=this.args[0];if(Macro.has(e)){if(!Macro.get(e).isWidget)return this.error('cannot clobber existing macro "'+e+'"');Macro.delete(e)}try{Macro.add(e,{isWidget:!0,handler:function(e){return function(){var t=void 0;try{State.variables.hasOwnProperty("args")&&(t=State.variables.args),State.variables.args=[].concat(_toConsumableArray(this.args)),State.variables.args.raw=this.args.raw,State.variables.args.full=this.args.full,this.addShadow("$args");var r=document.createDocumentFragment(),n=[];if(new Wikifier(r,e),Array.from(r.querySelectorAll(".error")).forEach(function(e){n.push(e.textContent)}),0!==n.length)return this.error("error"+(n.length>1?"s":"")+" within widget contents ("+n.join("; ")+")");this.output.appendChild(r)}catch(e){return this.error("cannot execute widget: "+e.message)}finally{void 0!==t?State.variables.args=t:delete State.variables.args}}}(this.payload[0].contents)}),Config.debug&&this.debugView.modes({hidden:!0})}catch(t){return this.error('cannot create widget macro "'+e+'": '+t.message)}}})}();var Dialog=function(){function e(e,t,r,n,a){return jQuery(e).ariaClick(function(e){e.preventDefault(),"function"==typeof r&&r(e),o(t,a),"function"==typeof n&&n(e)})}function t(){var e;return(e=g).append.apply(e,arguments),Dialog}function r(){return g.get(0)}function n(e){return g.trigger(":dialogclosing"),jQuery(document).off(".dialog-close"),y?(y.disconnect(),y=null):g.off(".dialog-resize"),jQuery(window).off(".dialog-resize"),p.removeClass("open").css({left:"",right:"",top:"",bottom:""}),jQuery("#ui-bar,#story").find("[tabindex=-2]").removeAttr("aria-hidden").attr("tabindex",0),jQuery("body>[tabindex=-3]").removeAttr("aria-hidden").removeAttr("tabindex"),f.removeClass("open"),jQuery(document.documentElement).removeAttr("data-dialog"),h.empty(),g.empty().removeClass(),null!==m&&(jQuery(m).focus(),m=null),e&&e.data&&"function"==typeof e.data.closeFn&&e.data.closeFn(e),g.trigger(":dialogclose"),g.trigger(":dialogclosed"),Dialog}function a(){if(!document.getElementById("ui-dialog")){v=function(){var e=void 0;try{var t=document.createElement("p"),r=document.createElement("div");t.style.width="100%",t.style.height="200px",r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.width="100px",r.style.height="100px",r.style.visibility="hidden",r.style.overflow="hidden",r.appendChild(t),document.body.appendChild(r);var n=t.offsetWidth;r.style.overflow="auto";var a=t.offsetWidth;n===a&&(a=r.clientWidth),document.body.removeChild(r),e=n-a}catch(e){}return e||17}();var e=jQuery(document.createDocumentFragment()).append('<div id="ui-overlay" class="ui-close"></div><div id="ui-dialog" tabindex="0" role="dialog" aria-labelledby="ui-dialog-title"><div id="ui-dialog-titlebar"><h1 id="ui-dialog-title"></h1><button id="ui-dialog-close" class="ui-close" tabindex="0" aria-label="'+L10n.get("close")+'"></button></div><div id="ui-dialog-body"></div></div>');f=jQuery(e.find("#ui-overlay").get(0)),p=jQuery(e.find("#ui-dialog").get(0)),h=jQuery(e.find("#ui-dialog-title").get(0)),g=jQuery(e.find("#ui-dialog-body").get(0)),e.insertBefore("body>script#script-sugarcube")}}function i(e){return p.hasClass("open")&&(!e||e.splitOrEmpty(/\s+/).every(function(e){return g.hasClass(e)}))}function o(e,t){g.trigger(":dialogopening");var r=jQuery.extend({top:50},e),a=r.top;return i()||(m=safeActiveElement()),jQuery(document.documentElement).attr("data-dialog","open"),f.addClass("open"),null!==g[0].querySelector("img")&&g.imagesLoaded().always(function(){return d({data:{top:a}})}),jQuery("body>:not(script,#store-area,tw-storydata,#ui-bar,#ui-overlay,#ui-dialog)").attr("tabindex",-3).attr("aria-hidden",!0),jQuery("#ui-bar,#story").find("[tabindex]:not([tabindex^=-])").attr("tabindex",-2).attr("aria-hidden",!0),p.css(c(a)).addClass("open").focus(),jQuery(window).on("resize.dialog-resize",null,{top:a},jQuery.throttle(40,d)),Has.mutationObserver?(y=new MutationObserver(function(e){for(var t=0;t<e.length;++t)if("childList"===e[t].type){d({data:{top:a}});break}}),y.observe(g[0],{childList:!0,subtree:!0})):g.on("DOMNodeInserted.dialog-resize DOMNodeRemoved.dialog-resize",null,{top:a},jQuery.throttle(40,d)),jQuery(document).on("click.dialog-close",".ui-close",{closeFn:t},n).on("keypress.dialog-close",".ui-close",function(e){13!==e.which&&32!==e.which||jQuery(this).trigger("click")}),g.trigger(":dialogopen"),g.trigger(":dialogopened"),Dialog}function s(e){return d("object"===(void 0===e?"undefined":_typeof(e))?{data:e}:undefined)}function u(e,t){return g.empty().removeClass(),null!=t&&g.addClass(t),h.empty().append((null!=e?String(e):"")||" "),g.get(0)}function l(){var e;return(e=g).wiki.apply(e,arguments),Dialog}function c(e){var t=null!=e?e:50,r=jQuery(window),n={left:"",right:"",top:"",bottom:""};p.css(n);var a=r.width()-p.outerWidth(!0)-1,i=r.height()-p.outerHeight(!0)-1;return a<=32+v&&(i-=v),i<=32+v&&(a-=v),n.left=n.right=a<=32?16:a/2>>0,n.top=i<=32?n.bottom=16:i/2>t?t:n.bottom=i/2>>0,Object.keys(n).forEach(function(e){""!==n[e]&&(n[e]+="px")}),n}function d(e){var t=e&&e.data&&void 0!==e.data.top?e.data.top:50;"block"===p.css("display")&&(p.css({display:"none"}),p.css(jQuery.extend({display:""},c(t))))}var f=null,p=null,h=null,g=null,m=null,v=0,y=null;return Object.freeze(Object.defineProperties({},{append:{value:t},body:{value:r},close:{value:n},init:{value:a},isOpen:{value:i},open:{value:o},resize:{value:s},setup:{value:u},wiki:{value:l},addClickHandler:{value:e}}))}(),Engine=function(){function e(){jQuery("#init-no-js,#init-lacking").remove(),function(){var e=jQuery(document.createDocumentFragment()),t=Story.has("StoryInterface")&&Story.get("StoryInterface").text.trim();if(t){if(UIBar.destroy(),jQuery(document.head).find("#style-core-display").remove(),e.append(t),0===e.find("#passages").length)throw new Error('no element with ID "passages" found within "StoryInterface" special passage');var r=[];e.find("[data-passage]").each(function(e,t){if("passages"===t.id)throw new Error('"StoryInterface" element <'+t.nodeName.toLowerCase()+' id="passages"> must not contain a "data-passage" content attribute');var n=t.getAttribute("data-passage").trim();if(null!==t.firstElementChild)throw new Error('"StoryInterface" element <'+t.nodeName.toLowerCase()+' data-passage="'+n+'"> contains child elements');Story.has(n)&&r.push({passage:n,element:t})}),r.length>0&&(E=r),Config.ui.updateStoryElements=!1}else e.append('<div id="story" role="main"><div id="passages"></div></div>');e.insertBefore("body>script#script-sugarcube")}(),S=new StyleWrapper(function(){return jQuery(document.createElement("style")).attr({id:"style-aria-outlines",type:"text/css"}).appendTo(document.head).get(0)}()),jQuery(document).on("mousedown.aria-outlines keydown.aria-outlines",function(e){return"keydown"===e.type?m():g()})}function t(){if(Story.has("StoryInit"))try{var e=Wikifier.wikifyEval(Story.get("StoryInit").text);if(Config.debug){var t=new DebugView(document.createDocumentFragment(),"special","StoryInit","StoryInit");t.modes({hidden:!0}),t.append(e),k=t.output}}catch(e){console.error(e),Alert.error("StoryInit",e.message)}if(null==Config.passages.start)throw new Error("starting passage not selected");if(!Story.has(Config.passages.start))throw new Error('starting passage ("'+Config.passages.start+'") not found');if(jQuery(document.documentElement).focus(),State.restore())f();else{var r=!0;switch(_typeof(Config.saves.autoload)){case"boolean":Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!Save.autosave.load());break;case"string":"prompt"===Config.saves.autoload&&Save.autosave.ok()&&Save.autosave.has()&&(r=!1,UI.buildAutoload(),Dialog.open());break;case"function":Save.autosave.ok()&&Save.autosave.has()&&Config.saves.autoload()&&(r=!Save.autosave.load())}r&&p(Config.passages.start)}}function r(){LoadScreen.show(),window.scroll(0,0),State.reset(),jQuery.event.trigger(":enginerestart"),window.location.reload()}function n(){return b}function a(){return b===v.Idle}function i(){return b!==v.Idle}function o(){return b===v.Rendering}function s(){return w}function u(e){var t=State.goTo(e);return t&&f(),t}function l(e){var t=State.go(e);return t&&f(),t}function c(){return l(-1)}function d(){return l(1)}function f(){return p(State.passage,!0)}function p(e,t){var r=e;b=v.Playing,TempState={},State.clearTemporary();var n=void 0,a=void 0;if("function"==typeof Config.navigation.override)try{var i=Config.navigation.override(r);i&&(r=i)}catch(e){}var o=Story.get(r);if(jQuery.event.trigger({type:":passageinit",passage:o}),Object.keys(prehistory).forEach(function(e){"function"==typeof prehistory[e]&&prehistory[e].call(this,e)},o),t||State.create(o.title),w=Util.now(),document.body.className&&(document.body.className=""),Object.keys(predisplay).forEach(function(e){"function"==typeof predisplay[e]&&predisplay[e].call(this,e)},o),Story.has("PassageReady"))try{n=Wikifier.wikifyEval(Story.get("PassageReady").text)}catch(e){console.error(e),Alert.error("PassageReady",e.message)}b=v.Rendering;var s=jQuery(o.render()),u=document.getElementById("passages");if(u.hasChildNodes()&&("number"==typeof Config.passages.transitionOut||"string"==typeof Config.passages.transitionOut&&""!==Config.passages.transitionOut&&Has.transitionEndEvent?[].concat(_toConsumableArray(u.childNodes)).forEach(function(e){var t=jQuery(e);if(e.nodeType===Node.ELEMENT_NODE&&t.hasClass("passage")){if(t.hasClass("passage-out"))return;t.attr("id","out-"+t.attr("id")).addClass("passage-out"),"string"==typeof Config.passages.transitionOut?t.on(Has.transitionEndEvent,function(e){e.originalEvent.propertyName===Config.passages.transitionOut&&t.remove()}):setTimeout(function(){return t.remove()},Math.max(y,Config.passages.transitionOut))}else t.remove()}):jQuery(u).empty()),s.addClass("passage-in").appendTo(u),setTimeout(function(){return s.removeClass("passage-in")},y),Config.passages.displayTitles&&o.title!==Config.passages.start&&(document.title=o.title+" | "+Story.title),window.scroll(0,0),b=v.Playing,Story.has("PassageDone"))try{a=Wikifier.wikifyEval(Story.get("PassageDone").text)}catch(e){console.error(e),Alert.error("PassageDone",e.message)}if(jQuery.event.trigger({type:":passagedisplay",passage:o}),Object.keys(postdisplay).forEach(function(e){"function"==typeof postdisplay[e]&&postdisplay[e].call(this,e)},o),null!==E?E.forEach(function(e){jQuery(e.element).empty(),new Wikifier(e.element,Story.get(e.passage).processText().trim())}):Config.ui.updateStoryElements&&UIBar.update(),Config.debug){var l=void 0;null!=n&&(l=new DebugView(document.createDocumentFragment(),"special","PassageReady","PassageReady"),l.modes({hidden:!0}),l.append(n),s.prepend(l.output)),null!=a&&(l=new DebugView(document.createDocumentFragment(),"special","PassageDone","PassageDone"),l.modes({hidden:!0}),l.append(a),s.append(l.output)),1===State.turns&&null!=k&&s.prepend(k)}switch(g(),jQuery("#story").find("a[href]:not(.link-external)").addClass("link-external").end().find("a,link,button,input,select,textarea").not("[tabindex]").attr("tabindex",0),_typeof(Config.saves.autosave)){case"boolean":Config.saves.autosave&&Save.autosave.save();break;case"object":o.tags.some(function(e){return Config.saves.autosave.includes(e)})&&Save.autosave.save();break;case"function":Config.saves.autosave()&&Save.autosave.save()}return jQuery.event.trigger({type:":passageend",passage:o}),b=v.Idle,w=Util.now(),s[0]}function h(e,t,r){var n=!1;switch(r){case undefined:break;case"replace":case"back":n=!0;break;default:throw new Error('Engine.display option parameter called with obsolete value "'+r+'"; please notify the developer')}p(e,n)}function g(){S.set("*:focus{outline:none}")}function m(){S.clear()}var v=Util.toEnum({Idle:"idle",Playing:"playing",Rendering:"rendering"}),y=40,b=v.Idle,w=null,k=null,S=null,E=null;return Object.freeze(Object.defineProperties({},{States:{value:v},minDomActionDelay:{value:y},init:{value:e},start:{value:t},restart:{value:r},state:{get:n},isIdle:{value:a},isPlaying:{value:i},isRendering:{value:o},lastPlay:{get:s},goTo:{value:u},go:{value:l},backward:{value:c},forward:{value:d},show:{value:f},play:{value:p},display:{value:h}}))}(),Passage=function(){var e=void 0;e=/^(?:debug|nobr|passage|widget|twine\..*)$/i;return function(){function t(r,n){var a=this;_classCallCheck(this,t),Object.defineProperties(this,{title:{value:Util.unescape(r)},element:{value:n||null},tags:{value:Object.freeze(n&&n.hasAttribute("tags")?n.getAttribute("tags").trim().splitOrEmpty(/\s+/).sort().filter(function(e,t,r){return 0===t||r[t-1]!==e}):[])},_excerpt:{writable:!0,value:null}}),Object.defineProperties(this,{domId:{value:"passage-"+Util.slugify(this.title)},classes:{value:Object.freeze(0===this.tags.length?[]:function(){return a.tags.filter(function(t){return!e.test(t)}).map(function(e){return Util.slugify(e)})}())}})}return _createClass(t,[{key:"description",value:function(){var e=Config.passages.descriptions;if(null!=e)switch(void 0===e?"undefined":_typeof(e)){case"boolean":if(e)return this.title;break;case"object":if(e instanceof Map&&e.has(this.title))return e.get(this.title);if(e.hasOwnProperty(this.title))return e[this.title];break;case"function":var r=e.call(this);if(r)return r;break;default:throw new TypeError("Config.passages.descriptions must be a boolean, object, or function")}return null===this._excerpt&&(this._excerpt=t.getExcerptFromText(this.text)),this._excerpt}},{key:"processText",value:function(){if(null==this.element)return this.text;if(this.tags.includes("Twine.image"))return"[img["+this.text+"]]";var e=this.text;return Config.passages.onProcess&&(e=Config.passages.onProcess.call(null,{title:this.title,tags:this.tags,text:e})),(Config.passages.nobr||this.tags.includes("nobr"))&&(e=e.replace(/^\n+|\n+$/g,"").replace(/\n+/g," ")),e}},{key:"render",value:function(){var e=this,r=this.tags.length>0?this.tags.join(" "):null,n=document.createElement("div");return jQuery(n).attr({id:this.domId,"data-passage":this.title,"data-tags":r}).addClass("passage "+this.className),jQuery(document.body).attr("data-tags",r).addClass(this.className),jQuery(document.documentElement).attr("data-tags",r),jQuery.event.trigger({type:":passagestart",content:n,passage:this}),Object.keys(prerender).forEach(function(t){"function"==typeof prerender[t]&&prerender[t].call(e,n,t)}),Story.has("PassageHeader")&&new Wikifier(n,Story.get("PassageHeader").processText()),new Wikifier(n,this.processText()),Story.has("PassageFooter")&&new Wikifier(n,Story.get("PassageFooter").processText()),jQuery.event.trigger({type:":passagerender",content:n,passage:this}),Object.keys(postrender).forEach(function(t){"function"==typeof postrender[t]&&postrender[t].call(e,n,t)}),this._excerpt=t.getExcerptFromNode(n),n}},{key:"className",get:function(){return this.classes.join(" ")}},{key:"text",get:function(){if(null==this.element){var e=Util.escape(this.title);return'<div class="error-view"><span class="error">'+(L10n.get("errorTitle")+": "+L10n.get("errorNonexistentPassage",{passage:e}))+"</span></div>"}return this.element.textContent.replace(/\r/g,"")}}],[{key:"getExcerptFromNode",value:function(e,t){if(!e.hasChildNodes())return"";var r=e.textContent.trim();if(""!==r){var n=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})");r=r.replace(/\s+/g," ").match(n)}return r?r[1]+"…":"…"}},{key:"getExcerptFromText",value:function(e,t){if(""===e)return"";var r=new RegExp("(\\S+(?:\\s+\\S+){0,"+(t>0?t-1:7)+"})"),n=e.replace(/<<.*?>>/g," ").replace(/<.*?>/g," ").trim().replace(/^\s*\|.*\|.*?$/gm,"").replace(/\[[<>]?img\[[^\]]*\]\]/g,"").replace(/\[\[([^|\]]*?)(?:(?:\||->|<-)[^\]]*)?\]\]/g,"$1").replace(/^\s*!+(.*?)$/gm,"$1").replace(/'{2}|\/{2}|_{2}|@{2}/g,"").trim().replace(/\s+/g," ").match(r);return n?n[1]+"…":"…"}}]),t}()}(),Save=function(){function e(){if("cookie"===storage.name)return n(),Config.saves.autoload=undefined,Config.saves.autosave=undefined,Config.saves.isAllowed=undefined,Config.saves.onLoad=undefined,Config.saves.onSave=undefined,Config.saves.slots=0,!1;var e=r(),t=!1;Array.isArray(e)&&(e={autosave:null,slots:e},t=!0),Config.saves.slots!==e.slots.length&&(Config.saves.slots<e.slots.length?(e.slots.reverse(),e.slots=e.slots.filter(function(e){return!(null===e&&this.count>0)||(--this.count,!1)},{count:e.slots.length-Config.saves.slots}),e.slots.reverse()):Config.saves.slots>e.slots.length&&j(e.slots,Config.saves.slots-e.slots.length),t=!0),T(e.autosave)&&(t=!0);for(var a=0;a<e.slots.length;++a)T(e.slots[a])&&(t=!0);return x(e)&&(storage.delete("saves"),t=!1),t&&O(e),P=e.slots.length-1,!0}function t(){return{autosave:null,slots:j([],Config.saves.slots)}}function r(){var e=storage.get("saves");return null===e?t():e}function n(){return storage.delete("saves"),!0}function a(){return i()||d()}function i(){return"cookie"!==storage.name&&void 0!==Config.saves.autosave}function o(){return null!==r().autosave}function s(){return r().autosave}function u(){var e=r();return null!==e.autosave&&A(e.autosave)}function l(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return!1;var n=r(),a={title:e||Story.get(State.passage).description(),date:Date.now()};return null!=t&&(a.metadata=t),n.autosave=C(a),O(n)}function c(){var e=r();return e.autosave=null,O(e)}function d(){return"cookie"!==storage.name&&-1!==P}function f(){return P+1}function p(){if(!d())return 0;for(var e=r(),t=0,n=0,a=e.slots.length;n<a;++n)null!==e.slots[n]&&++t;return t}function h(){return 0===p()}function g(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])}function m(e){if(e<0||e>P)return null;var t=r();return e>=t.slots.length?null:t.slots[e]}function v(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length||null===t.slots[e])&&A(t.slots[e])}function y(e,t,n){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",function(){return UI.alert(L10n.get("savesDisallowed"))}):UI.alert(L10n.get("savesDisallowed")),!1;if(e<0||e>P)return!1;var a=r();if(e>=a.slots.length)return!1;var i={title:t||Story.get(State.passage).description(),date:Date.now()};return null!=n&&(i.metadata=n),a.slots[e]=C(i),O(a)}function b(e){if(e<0||e>P)return!1;var t=r();return!(e>=t.slots.length)&&(t.slots[e]=null,O(t))}function w(e,t){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return void(Dialog.isOpen()?$(document).one(":dialogclosed",function(){return UI.alert(L10n.get("savesDisallowed"))}):UI.alert(L10n.get("savesDisallowed")));var r=null==e?Story.domId:Util.slugify(e),n=r+"-"+function(){var e=new Date,t=e.getMonth()+1,r=e.getDate(),n=e.getHours(),a=e.getMinutes(),i=e.getSeconds();return t<10&&(t="0"+t),r<10&&(r="0"+r),n<10&&(n="0"+n),a<10&&(a="0"+a),i<10&&(i="0"+i),""+e.getFullYear()+t+r+"-"+n+a+i}()+".save",a=null==t?{}:{metadata:t},i=LZString.compressToBase64(JSON.stringify(C(a)));saveAs(new Blob([i],{type:"text/plain;charset=UTF-8"}),n)}function k(e){var t=e.target.files[0],r=new FileReader;jQuery(r).on("load",function(e){var r=e.currentTarget;if(r.result){var n=void 0;try{n=JSON.parse(/\.json$/i.test(t.name)||/^\{/.test(r.result)?r.result:LZString.decompressFromBase64(r.result))}catch(e){}A(n)}}),r.readAsText(t)}function S(e){if("function"==typeof Config.saves.isAllowed&&!Config.saves.isAllowed())return Dialog.isOpen()?$(document).one(":dialogclosed",function(){return UI.alert(L10n.get("savesDisallowed"))}):UI.alert(L10n.get("savesDisallowed")),null;var t=null==e?{}:{metadata:e};return LZString.compressToBase64(JSON.stringify(C(t)))}function E(e){var t=void 0;try{t=JSON.parse(LZString.decompressFromBase64(e))}catch(e){}return A(t)?t.metadata:null}function j(e,t){for(var r=0;r<t;++r)e.push(null);return e}function x(e){for(var t=e.slots,r=!0,n=0,a=t.length;n<a;++n)if(null!==t[n]){r=!1;break}return null===e.autosave&&r}function O(e){return x(e)?(storage.delete("saves"),!0):storage.set("saves",e)}function T(e){if(null==e||"object"!==(void 0===e?"undefined":_typeof(e)))return!1;var t=!1;return e.hasOwnProperty("state")&&e.state.hasOwnProperty("delta")&&e.state.hasOwnProperty("index")||(e.hasOwnProperty("data")?(delete e.mode,e.state={delta:State.deltaEncode(e.data)},delete e.data):e.state.hasOwnProperty("delta")?e.state.hasOwnProperty("index")||delete e.state.mode:(delete e.state.mode,e.state.delta=State.deltaEncode(e.state.history),delete e.state.history),e.state.index=e.state.delta.length-1,t=!0),e.state.hasOwnProperty("rseed")&&(e.state.seed=e.state.rseed,delete e.state.rseed,e.state.delta.forEach(function(e,t,r){r[t].hasOwnProperty("rcount")&&(r[t].pull=r[t].rcount,delete r[t].rcount)}),t=!0),(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired||e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.hasOwnProperty("expired")&&"number"==typeof e.state.expired&&delete e.state.expired,(e.state.hasOwnProperty("unique")||e.state.hasOwnProperty("last"))&&(e.state.expired=[],e.state.hasOwnProperty("unique")&&(e.state.expired.push(e.state.unique),delete e.state.unique),e.state.hasOwnProperty("last")&&(e.state.expired.push(e.state.last),delete e.state.last)),t=!0),t}function C(e){if(null!=e&&"object"!==(void 0===e?"undefined":_typeof(e)))throw new Error("supplemental parameter must be an object");var t=Object.assign({},e,{id:Config.saves.id,state:State.marshalForSave()});return Config.saves.version&&(t.version=Config.saves.version),"function"==typeof Config.saves.onSave&&Config.saves.onSave(t),t.state.delta=State.deltaEncode(t.state.history),delete t.state.history,t}function A(e){try{if(T(e),!e||!e.hasOwnProperty("id")||!e.hasOwnProperty("state"))throw new Error(L10n.get("errorSaveMissingData"));if(e.state.history=State.deltaDecode(e.state.delta),delete e.state.delta,"function"==typeof Config.saves.onLoad&&Config.saves.onLoad(e),e.id!==Config.saves.id)throw new Error(L10n.get("errorSaveIdMismatch"));State.unmarshalForSave(e.state),Engine.show()}catch(e){return UI.alert(e.message.toUpperFirst()+".</p><p>"+L10n.get("aborting")+"."),!1}return!0}var P=-1;return Object.freeze(Object.defineProperties({},{init:{value:e},get:{value:r},clear:{value:n},ok:{value:a},autosave:{value:Object.freeze(Object.defineProperties({},{ok:{value:i},has:{value:o},get:{value:s},load:{value:u},save:{value:l},delete:{value:c}}))},slots:{value:Object.freeze(Object.defineProperties({},{ok:{value:d},length:{get:f},isEmpty:{value:h},count:{value:p},has:{value:g},get:{value:m},load:{value:v},save:{value:y},delete:{value:b}}))},export:{value:w},import:{value:k},serialize:{value:S},deserialize:{value:E}}))}(),Setting=function(){function e(){if(storage.has("options")){var e=storage.get("options");null!==e&&(window.SugarCube.settings=settings=Object.assign(t(),e)),r(),storage.delete("options")}n(),m.forEach(function(e){if(e.hasOwnProperty("onInit")){var t={name:e.name,value:settings[e.name],default:e.default};e.hasOwnProperty("list")&&(t.list=e.list),e.onInit.call(t)}})}function t(){return Object.create(null)}function r(){var e=t();return Object.keys(settings).length>0&&m.filter(function(e){return e.type!==v.Header&&settings[e.name]!==e.default}).forEach(function(t){return e[t.name]=settings[t.name]}),0===Object.keys(e).length?(storage.delete("settings"),!0):storage.set("settings",e)}function n(){var e=t(),r=storage.get("settings")||t();m.filter(function(e){return e.type!==v.Header}).forEach(function(t){return e[t.name]=t.default}),window.SugarCube.settings=settings=Object.assign(e,r)}function a(){return window.SugarCube.settings=settings=t(),storage.delete("settings"),!0}function i(e){if(0===arguments.length)a(),n();else{if(null==e||!p(e))throw new Error('nonexistent setting "'+e+'"');var t=h(e);t.type!==v.Header&&(settings[e]=t.default)}return r()}function o(e,t){m.forEach(e,t)}function s(e,t,r){if(arguments.length<3){var n=[];throw arguments.length<1&&n.push("type"),arguments.length<2&&n.push("name"),arguments.length<3&&n.push("definition"),new Error("missing parameters, no "+n.join(" or ")+" specified")}if("object"!==(void 0===r?"undefined":_typeof(r)))throw new TypeError("definition parameter must be an object");if(p(t))throw new Error('cannot clobber existing setting "'+t+'"');var a={type:e,name:t,label:"string"==typeof r.label?r.label.trim():""};if("string"==typeof r.desc){var i=r.desc.trim();""!==i&&(a.desc=i)}switch(e){case v.Header:break;case v.Toggle:a.default=!!r.default;break;case v.List:if(!r.hasOwnProperty("list"))throw new Error("no list specified");if(!Array.isArray(r.list))throw new TypeError("list must be an array");if(0===r.list.length)throw new Error("list must not be empty");if(a.list=Object.freeze(r.list),null==r.default)a.default=r.list[0];else{var o=r.list.indexOf(r.default);if(-1===o)throw new Error("list does not contain default");a.default=r.list[o]}break;case v.Range:if(!r.hasOwnProperty("min"))throw new Error("no min specified");if("number"!=typeof r.min||Number.isNaN(r.min)||!Number.isFinite(r.min))throw new TypeError("min must be a finite number");if(!r.hasOwnProperty("max"))throw new Error("no max specified");if("number"!=typeof r.max||Number.isNaN(r.max)||!Number.isFinite(r.max))throw new TypeError("max must be a finite number");if(!r.hasOwnProperty("step"))throw new Error("no step specified");if("number"!=typeof r.step||Number.isNaN(r.step)||!Number.isFinite(r.step)||r.step<=0)throw new TypeError("step must be a finite number greater than zero");var s=function(){var e=String(r.step),t=e.lastIndexOf(".");return-1===t?0:e.length-t-1}();if(function(e){if(s>0){var t=Number(r.min+"e"+s),n=Number(r.step+"e"+s),a=Number(e+"e"+s)-t;return Number(a-a%n+t+"e-"+s)}var i=e-r.min;return i-i%r.step+r.min}(r.max)!==r.max)throw new RangeError("max ("+r.max+") is not a multiple of the step ("+r.step+") plus the min ("+r.min+")");if(a.max=r.max,a.min=r.min,a.step=r.step,null==r.default)a.default=r.max;else{if("number"!=typeof r.default||Number.isNaN(r.default)||!Number.isFinite(r.default))throw new TypeError("default must be a finite number");if(r.default<r.min)throw new RangeError("default ("+r.default+") is less than min ("+r.min+")");if(r.default>r.max)throw new RangeError("default ("+r.default+") is greater than max ("+r.max+")");a.default=r.default}break;default:throw new Error("unknown Setting type: "+e)}"function"==typeof r.onInit&&(a.onInit=Object.freeze(r.onInit)),"function"==typeof r.onChange&&(a.onChange=Object.freeze(r.onChange)),m.push(Object.freeze(a))}function u(e,t){s(v.Header,e,{desc:t})}function l(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[v.Toggle].concat(t))}function c(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[v.List].concat(t))}function d(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];s.apply(undefined,[v.Range].concat(t))}function f(){return 0===m.length}function p(e){return m.some(function(t){return t.name===e})}function h(e){return m.find(function(t){return t.name===e})}function g(e){p(e)&&delete settings[e];for(var t=0;t<m.length;++t)if(m[t].name===e){m.splice(t,1),g(e);break}}var m=[],v=Util.toEnum({Header:0,Toggle:1,List:2,Range:3});return Object.freeze(Object.defineProperties({},{Types:{value:v},init:{value:e},create:{value:t},save:{value:r},load:{value:n},clear:{value:a},reset:{value:i},forEach:{value:o},add:{value:s},addHeader:{value:u},addToggle:{value:l},addList:{value:c},addRange:{value:d},isEmpty:{value:f},has:{value:p},get:{value:h},delete:{value:g}}))}(),Story=function(){function e(){function e(e){if(e.tags.includesAny(n))throw new Error('starting passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return n.includes(e)}).sort().join('", "')+'"')}function t(e){if(a.includes(e.title)&&e.tags.includesAny(n))throw new Error('special passage "'+e.title+'" contains illegal tags; invalid: "'+e.tags.filter(function(e){return n.includes(e)}).sort().join('", "')+'"')}var n=["widget"],a=["PassageDone","PassageFooter","PassageHeader","PassageReady","StoryAuthor","StoryBanner","StoryCaption","StoryInit","StoryMenu","StoryShare","StorySubtitle"],i=jQuery("tw-storydata"),o=i.attr("startnode")||"";Config.passages.start=null,Config.debug=/\bdebug\b/.test(i.attr("options")),i.children("style").each(function(e){d.push(new Passage("tw-user-style-"+e,this))}),i.children("script").each(function(e){f.push(new Passage("tw-user-script-"+e,this))}),i.children('tw-passagedata:not([tags~="Twine.private"],[tags~="annotation"])').each(function(){var r=jQuery(this),n=r.attr("pid")||"",a=new Passage(r.attr("name"),this);n===o&&""!==o?(Config.passages.start=a.title,e(a),c[a.title]=a):a.tags.includes("widget")?p.push(a):(t(a),c[a.title]=a)}),g=i.attr("ifid"),r("Community Service"),Config.saves.id=Story.domId}function t(){!function(){var e=document.createElement("style");new StyleWrapper(e).add(d.map(function(e){return e.text.trim()}).join("\n")),jQuery(e).appendTo(document.head).attr({id:"style-story",type:"text/css"})}();for(var e=0;e<f.length;++e)try{Scripting.evalJavaScript(f[e].text)}catch(t){console.error(t),Alert.error(f[e].title,"object"===(void 0===t?"undefined":_typeof(t))?t.message:t)}for(var t=0;t<p.length;++t)try{Wikifier.wikifyEval(p[t].processText())}catch(e){console.error(e),Alert.error(p[t].title,"object"===(void 0===e?"undefined":_typeof(e))?e.message:e)}}function r(e){if(null==e||""===e)throw new Error("story title cannot be null or empty");if(document.title=h=Util.unescape(e),""===(m=Util.slugify(h)))if(""!==g)m=g;else for(var t=0,r=h.length;t<r;++t){var n=Util.charAndPosAt(h,t),a=n.char,i=n.start,o=n.end;m+=a.codePointAt(0).toString(16),t+=o-i}}function n(){return h}function a(){return m}function i(){return g}function o(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":return c.hasOwnProperty(String(e));case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.has title parameter cannot be "+t)}function s(e){var t=void 0===e?"undefined":_typeof(e);switch(t){case"number":case"string":var r=String(e);return c.hasOwnProperty(r)?c[r]:new Passage(r||"(unknown)");case"boolean":case"function":t="a "+t;break;case"undefined":break;default:t=null===e?"null":"an "+t}throw new TypeError("Story.get title parameter cannot be "+t)}function u(e,t){for(var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"title",n=Object.keys(c),a=[],i=0;i<n.length;++i){var o=c[n[i]];if(o.hasOwnProperty(e))switch(_typeof(o[e])){case"undefined":break;case"object":o[e]instanceof Array&&o[e].some(function(e){return e==t})&&a.push(o);break;default:o[e]==t&&a.push(o)}}return a.sort(function(e,t){return e[r]==t[r]?0:e[r]<t[r]?-1:1}),a}function l(e){var t=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"title";if("function"!=typeof e)throw new Error("Story.lookupWith filter parameter must be a function");for(var r=Object.keys(c),n=[],a=0;a<r.length;++a){var i=c[r[a]];e(i)&&n.push(i)}return n.sort(function(e,r){return e[t]==r[t]?0:e[t]<r[t]?-1:1}),n}var c={},d=[],f=[],p=[],h="",g="",m="";return Object.freeze(Object.defineProperties({},{passages:{value:c},styles:{value:d},scripts:{value:f},
widgets:{value:p},load:{value:e},init:{value:t},title:{get:n},domId:{get:a},ifId:{get:i},has:{value:o},get:{value:s},lookup:{value:u},lookupWith:{value:l}}))}(),UI=function(){function e(e,t){var r=t,n=Config.debug,a=Config.cleanupWikifierOutput;Config.debug=!1,Config.cleanupWikifierOutput=!1;try{null==r&&(r=document.createElement("ul"));var i=document.createDocumentFragment();new Wikifier(i,Story.get(e).processText().trim());var o=[].concat(_toConsumableArray(i.querySelectorAll(".error"))).map(function(e){return e.textContent.replace(errorPrologRegExp,"")});if(o.length>0)throw new Error(o.join("; "));for(;i.hasChildNodes();){var s=i.firstChild;if(s.nodeType===Node.ELEMENT_NODE&&"A"===s.nodeName.toUpperCase()){var u=document.createElement("li");r.appendChild(u),u.appendChild(s)}else i.removeChild(s)}}finally{Config.cleanupWikifierOutput=a,Config.debug=n}return r}function t(e){jQuery(Dialog.setup("Alert","alert")).append("<p>"+e+'</p><ul class="buttons"><li><button id="alert-ok" class="ui-close">'+L10n.get(["alertOk","ok"])+"</button></li></ul>");for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];Dialog.open.apply(Dialog,r)}function r(){u(),Dialog.open.apply(Dialog,arguments)}function n(){l(),Dialog.open.apply(Dialog,arguments)}function a(){c(),Dialog.open.apply(Dialog,arguments)}function i(){d(),Dialog.open.apply(Dialog,arguments)}function o(){f(),Dialog.open.apply(Dialog,arguments)}function s(){return jQuery(Dialog.setup(L10n.get("autoloadTitle"),"autoload")).append("<p>"+L10n.get("autoloadPrompt")+'</p><ul class="buttons"><li><button id="autoload-ok" class="ui-close">'+L10n.get(["autoloadOk","ok"])+'</button></li><li><button id="autoload-cancel" class="ui-close">'+L10n.get(["autoloadCancel","cancel"])+"</button></li></ul>"),jQuery(document).one("click.autoload",".ui-close",function(e){var t="autoload-ok"===e.target.id;jQuery(document).one(":dialogclosed",function(){t&&Save.autosave.load()||Engine.play(Config.passages.start)})}),!0}function u(){var e=document.createElement("ul");jQuery(Dialog.setup(L10n.get("jumptoTitle"),"jumpto list")).append(e);for(var t=State.expired.length,r=State.size-1;r>=0;--r)if(r!==State.activeIndex){var n=Story.get(State.history[r].title);n&&n.tags.includes("bookmark")&&jQuery(document.createElement("li")).append(jQuery(document.createElement("a")).ariaClick({one:!0},function(e){return function(){return jQuery(document).one(":dialogclosed",function(){return Engine.goTo(e)})}}(r)).addClass("ui-close").text(L10n.get("jumptoTurn")+" "+(t+r+1)+": "+n.description())).appendTo(e)}e.hasChildNodes()||jQuery(e).append("<li><a><em>"+L10n.get("jumptoUnavailable")+"</em></a></li>")}function l(){return jQuery(Dialog.setup(L10n.get("restartTitle"),"restart")).append("<p>"+L10n.get("restartPrompt")+'</p><ul class="buttons"><li><button id="restart-ok">'+L10n.get(["restartOk","ok"])+'</button></li><li><button id="restart-cancel" class="ui-close">'+L10n.get(["restartCancel","cancel"])+"</button></li></ul>").find("#restart-ok").ariaClick({one:!0},function(){jQuery(document).one(":dialogclosed",function(){return Engine.restart()}),Dialog.close()}),!0}function c(){function e(e,t,r,n){var a=jQuery(document.createElement("button")).attr("id","saves-"+e).html(r);return t&&a.addClass(t),n?a.ariaClick(n):a.ariaDisabled(!0),jQuery(document.createElement("li")).append(a)}var r=jQuery(Dialog.setup(L10n.get("savesTitle"),"saves")),n=Save.ok();if(n&&r.append(function(){function e(e,t,r,n,a){var i=jQuery(document.createElement("button")).attr("id","saves-"+e+"-"+n).addClass(e).html(r);return t&&i.addClass(t),a?"auto"===n?i.ariaClick({label:r+" "+L10n.get("savesLabelAuto")},function(){return a()}):i.ariaClick({label:r+" "+L10n.get("savesLabelSlot")+" "+(n+1)},function(){return a(n)}):i.ariaDisabled(!0),i}var t=Save.get(),r=jQuery(document.createElement("tbody"));if(Save.autosave.ok()){var n=jQuery(document.createElement("td")),a=jQuery(document.createElement("td")),i=jQuery(document.createElement("td")),o=jQuery(document.createElement("td"));jQuery(document.createElement("b")).attr({title:L10n.get("savesLabelAuto"),"aria-label":L10n.get("savesLabelAuto")}).text("A").appendTo(n),t.autosave?(a.append(e("load","ui-close",L10n.get("savesLabelLoad"),"auto",function(){jQuery(document).one(":dialogclosed",function(){return Save.autosave.load()})})),jQuery(document.createElement("div")).text(t.autosave.title).appendTo(i),jQuery(document.createElement("div")).addClass("datestamp").html(t.autosave.date?""+new Date(t.autosave.date).toLocaleString():"<em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(i),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto",function(){Save.autosave.delete(),c()}))):(a.append(e("load",null,L10n.get("savesLabelLoad"),"auto")),i.addClass("empty").text("•  •  •"),o.append(e("delete",null,L10n.get("savesLabelDelete"),"auto"))),jQuery(document.createElement("tr")).append(n).append(a).append(i).append(o).appendTo(r)}for(var s=0,u=t.slots.length;s<u;++s){var l=jQuery(document.createElement("td")),d=jQuery(document.createElement("td")),f=jQuery(document.createElement("td")),p=jQuery(document.createElement("td"));l.append(document.createTextNode(s+1)),t.slots[s]?(d.append(e("load","ui-close",L10n.get("savesLabelLoad"),s,function(e){jQuery(document).one(":dialogclosed",function(){return Save.slots.load(e)})})),jQuery(document.createElement("div")).text(t.slots[s].title).appendTo(f),jQuery(document.createElement("div")).addClass("datestamp").html(t.slots[s].date?""+new Date(t.slots[s].date).toLocaleString():"<em>"+L10n.get("savesUnknownDate")+"</em>").appendTo(f),p.append(e("delete",null,L10n.get("savesLabelDelete"),s,function(e){Save.slots.delete(e),c()}))):(d.append(e("save","ui-close",L10n.get("savesLabelSave"),s,Save.slots.save)),f.addClass("empty").text("•  •  •"),p.append(e("delete",null,L10n.get("savesLabelDelete"),s))),jQuery(document.createElement("tr")).append(l).append(d).append(f).append(p).appendTo(r)}return jQuery(document.createElement("table")).attr("id","saves-list").append(r)}()),n||Has.fileAPI){var a=jQuery(document.createElement("ul")).addClass("buttons").appendTo(r);return Has.fileAPI&&(a.append(e("export","ui-close",L10n.get("savesLabelExport"),function(){return Save.export()})),a.append(e("import",null,L10n.get("savesLabelImport"),function(){return r.find("#saves-import-file").trigger("click")})),jQuery(document.createElement("input")).css({display:"block",visibility:"hidden",position:"fixed",left:"-9999px",top:"-9999px",width:"1px",height:"1px"}).attr({type:"file",id:"saves-import-file",tabindex:-1,"aria-hidden":!0}).on("change",function(e){jQuery(document).one(":dialogclosed",function(){return Save.import(e)}),Dialog.close()}).appendTo(r)),n&&a.append(e("clear",null,L10n.get("savesLabelClear"),Save.autosave.has()||!Save.slots.isEmpty()?function(){Save.clear(),c()}:null)),!0}return t(L10n.get("savesIncapable")),!1}function d(){var e=jQuery(Dialog.setup(L10n.get("settingsTitle"),"settings"));return Setting.forEach(function(t){if(t.type===Setting.Types.Header){var r=t.name,n=Util.slugify(r),a=jQuery(document.createElement("div")),i=jQuery(document.createElement("h2"));return a.attr("id","header-body-"+n).append(i).appendTo(e),i.attr("id","header-heading-"+n).wiki(r),void(t.desc&&jQuery(document.createElement("p")).attr("id","header-desc-"+n).wiki(t.desc).appendTo(a))}var o=t.name,s=Util.slugify(o),u=jQuery(document.createElement("div")),l=jQuery(document.createElement("label")),c=jQuery(document.createElement("div")),d=void 0;switch(jQuery(document.createElement("div")).append(l).append(c).appendTo(u),t.desc&&jQuery(document.createElement("p")).attr("id","setting-desc-"+s).wiki(t.desc).appendTo(u),l.attr({id:"setting-label-"+s,for:"setting-control-"+s}).wiki(t.label),null==settings[o]&&(settings[o]=t.default),t.type){case Setting.Types.Toggle:d=jQuery(document.createElement("button")),settings[o]?d.addClass("enabled").text(L10n.get("settingsOn")):d.text(L10n.get("settingsOff")),d.ariaClick(function(){settings[o]?(jQuery(this).removeClass("enabled").text(L10n.get("settingsOff")),settings[o]=!1):(jQuery(this).addClass("enabled").text(L10n.get("settingsOn")),settings[o]=!0),Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:o,value:settings[o],default:t.default})});break;case Setting.Types.List:d=jQuery(document.createElement("select"));for(var f=0,p=t.list.length;f<p;++f)jQuery(document.createElement("option")).val(f).text(t.list[f]).appendTo(d);d.val(t.list.indexOf(settings[o])).attr("tabindex",0).on("change",function(){settings[o]=t.list[Number(this.value)],Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:o,value:settings[o],default:t.default,list:t.list})});break;case Setting.Types.Range:d=jQuery(document.createElement("input")),d.attr({type:"range",min:t.min,max:t.max,step:t.step,value:settings[o],tabindex:0}).on("change input",function(){settings[o]=Number(this.value),Setting.save(),t.hasOwnProperty("onChange")&&t.onChange.call({name:o,value:settings[o],default:t.default,min:t.min,max:t.max,step:t.step})}).on("keypress",function(e){13===e.which&&(e.preventDefault(),d.trigger("change"))})}d.attr("id","setting-control-"+s).appendTo(c),u.attr("id","setting-body-"+s).appendTo(e)}),e.append('<ul class="buttons"><li><button id="settings-ok" class="ui-close">'+L10n.get(["settingsOk","ok"])+'</button></li><li><button id="settings-reset">'+L10n.get("settingsReset")+"</button></li></ul>").find("#settings-reset").ariaClick({one:!0},function(){jQuery(document).one(":dialogclosed",function(){Setting.reset(),window.location.reload()}),Dialog.close()}),!0}function f(){try{jQuery(Dialog.setup(L10n.get("shareTitle"),"share list")).append(e("StoryShare"))}catch(e){return console.error(e),Alert.error("StoryShare",e.message),!1}return!0}return Object.freeze(Object.defineProperties({},{assembleLinkList:{value:e},alert:{value:t},jumpto:{value:r},restart:{value:n},saves:{value:a},settings:{value:i},share:{value:o},buildAutoload:{value:s},buildJumpto:{value:u},buildRestart:{value:l},buildSaves:{value:c},buildSettings:{value:d},buildShare:{value:f},stow:{value:function(){return UIBar.stow()}},unstow:{value:function(){return UIBar.unstow()}},setStoryElements:{value:function(){return UIBar.update()}},isOpen:{value:function(){return Dialog.isOpen.apply(Dialog,arguments)}},body:{value:function(){return Dialog.body()}},setup:{value:function(){return Dialog.setup.apply(Dialog,arguments)}},addClickHandler:{value:function(){return Dialog.addClickHandler.apply(Dialog,arguments)}},open:{value:function(){return Dialog.open.apply(Dialog,arguments)}},close:{value:function(){return Dialog.close.apply(Dialog,arguments)}},resize:{value:function(){return Dialog.resize()}},buildDialogAutoload:{value:s},buildDialogJumpto:{value:u},buildDialogRestart:{value:l},buildDialogSaves:{value:c},buildDialogSettings:{value:d},buildDialogShare:{value:f},buildLinkListFromPassage:{value:e}}))}(),UIBar=function(){function e(){c&&(c.hide(),jQuery(document).off(".ui-bar"),jQuery(document.head).find("#style-ui-bar").remove(),c.remove(),c=null)}function t(){return c&&c.hide(),this}function r(){if(!document.getElementById("ui-bar")){var e=function(){var e=L10n.get("uiBarToggle"),t=L10n.get("uiBarBackward"),r=L10n.get("uiBarJumpto"),n=L10n.get("uiBarForward");return jQuery(document.createDocumentFragment()).append('<div id="ui-bar"><div id="ui-bar-tray"><button id="ui-bar-toggle" tabindex="0" title="'+e+'" aria-label="'+e+'"></button><div id="ui-bar-history"><button id="history-backward" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="history-jumpto" tabindex="0" title="'+r+'" aria-label="'+r+'"></button><button id="history-forward" tabindex="0" title="'+n+'" aria-label="'+n+'"></button></div></div><div id="ui-bar-body"><header id="title" role="banner"><div id="story-banner"></div><h1 id="story-title"></h1><div id="story-subtitle"></div><div id="story-title-separator"></div><p id="story-author"></p></header><div id="story-caption"></div><nav id="menu" role="navigation"><ul id="menu-story"></ul><ul id="menu-core"><li id="menu-item-saves"><a tabindex="0">'+L10n.get("savesTitle")+'</a></li><li id="menu-item-settings"><a tabindex="0">'+L10n.get("settingsTitle")+'</a></li><li id="menu-item-restart"><a tabindex="0">'+L10n.get("restartTitle")+'</a></li><li id="menu-item-share"><a tabindex="0">'+L10n.get("shareTitle")+"</a></li></ul></nav></div></div>")}();c=jQuery(e.find("#ui-bar").get(0)),e.insertBefore("body>script#script-sugarcube"),jQuery(document).on(":historyupdate.ui-bar",function(e,t){return function(){e.ariaDisabled(State.length<2),t.ariaDisabled(State.length===State.size)}}(jQuery("#history-backward"),jQuery("#history-forward")))}}function n(){return c&&"none"===c.css("display")}function a(){return c&&c.hasClass("stowed")}function i(){return c&&c.show(),this}function o(){c&&(("boolean"==typeof Config.ui.stowBarInitially?Config.ui.stowBarInitially:jQuery(window).width()<=Config.ui.stowBarInitially)&&function(){var e=jQuery(c).add("#story");e.addClass("no-transition"),c.addClass("stowed"),setTimeout(function(){return e.removeClass("no-transition")},Engine.minDomActionDelay)}(),jQuery("#ui-bar-toggle").ariaClick({label:L10n.get("uiBarToggle")},function(){return c.toggleClass("stowed")}),Config.history.controls?(jQuery("#history-backward").ariaDisabled(State.length<2).ariaClick({label:L10n.get("uiBarBackward")},function(){return Engine.backward()}),Story.lookup("tags","bookmark").length>0?jQuery("#history-jumpto").ariaClick({label:L10n.get("uiBarJumpto")},function(){return UI.jumpto()}):jQuery("#history-jumpto").remove(),jQuery("#history-forward").ariaDisabled(State.length===State.size).ariaClick({label:L10n.get("uiBarForward")},function(){return Engine.forward()})):jQuery("#ui-bar-history").remove(),jQuery("#story-title").text(Story.title),Story.has("StoryCaption")||jQuery("#story-caption").remove(),Story.has("StoryMenu")||jQuery("#menu-story").remove(),Config.ui.updateStoryElements||l(),jQuery("#menu-item-saves a").ariaClick(function(e){e.preventDefault(),UI.buildSaves(),Dialog.open()}).text(L10n.get("savesTitle")),Setting.isEmpty()?jQuery("#menu-item-settings").remove():jQuery("#menu-item-settings a").ariaClick(function(e){e.preventDefault(),UI.buildSettings(),Dialog.open()}).text(L10n.get("settingsTitle")),jQuery("#menu-item-restart a").ariaClick(function(e){e.preventDefault(),UI.buildRestart(),Dialog.open()}).text(L10n.get("restartTitle")),Story.has("StoryShare")?jQuery("#menu-item-share a").ariaClick(function(e){e.preventDefault(),UI.buildShare(),Dialog.open()}).text(L10n.get("shareTitle")):jQuery("#menu-item-share").remove())}function s(e){if(c&&!c.hasClass("stowed")){var t=void 0;e&&(t=jQuery("#story"),t.addClass("no-transition"),c.addClass("no-transition")),c.addClass("stowed"),e&&setTimeout(function(){t.removeClass("no-transition"),c.removeClass("no-transition")},Engine.minDomActionDelay)}return this}function u(e){if(c&&c.hasClass("stowed")){var t=void 0;e&&(t=jQuery("#story"),t.addClass("no-transition"),c.addClass("no-transition")),c.removeClass("stowed"),e&&setTimeout(function(){t.removeClass("no-transition"),c.removeClass("no-transition")},Engine.minDomActionDelay)}return this}function l(){if(c){setPageElement("story-banner","StoryBanner"),setPageElement("story-subtitle","StorySubtitle"),setPageElement("story-author","StoryAuthor"),setPageElement("story-caption","StoryCaption");var e=document.getElementById("menu-story");if(null!==e&&(jQuery(e).empty(),Story.has("StoryMenu")))try{UI.assembleLinkList("StoryMenu",e)}catch(e){console.error(e),Alert.error("StoryMenu",e.message)}}}var c=null;return Object.freeze(Object.defineProperties({},{destroy:{value:e},hide:{value:t},init:{value:r},isHidden:{value:n},isStowed:{value:a},show:{value:i},start:{value:o},stow:{value:s},unstow:{value:u},update:{value:l},setStoryElements:{value:l}}))}(),DebugBar=function(){function e(){var e=L10n.get("debugBarToggle"),t=L10n.get("debugBarAddWatch"),o=L10n.get("debugBarWatchAll"),u=L10n.get("debugBarWatchNone"),c=L10n.get("debugBarWatchToggle"),h=L10n.get("debugBarViewsToggle");jQuery(document.createDocumentFragment()).append('<div id="debug-bar"><div id="debug-bar-watch" aria-hidden="true" hidden="hidden"><div>'+L10n.get("debugBarNoWatches")+'</div>></div><div><button id="debug-bar-watch-toggle" tabindex="0" title="'+c+'" aria-label="'+c+'">'+L10n.get("debugBarLabelWatch")+'</button><label id="debug-bar-watch-label" for="debug-bar-watch-input">'+L10n.get("debugBarLabelAdd")+'</label><input id="debug-bar-watch-input" name="debug-bar-watch-input" type="text" list="debug-bar-watch-list" tabindex="0"><datalist id="debug-bar-watch-list" aria-hidden="true" hidden="hidden"></datalist><button id="debug-bar-watch-add" tabindex="0" title="'+t+'" aria-label="'+t+'"></button><button id="debug-bar-watch-all" tabindex="0" title="'+o+'" aria-label="'+o+'"></button><button id="debug-bar-watch-none" tabindex="0" title="'+u+'" aria-label="'+u+'"></button></div><div><button id="debug-bar-views-toggle" tabindex="0" title="'+h+'" aria-label="'+h+'">'+L10n.get("debugBarLabelViews")+'</button><label id="debug-bar-turn-label" for="debug-bar-turn-select">'+L10n.get("debugBarLabelTurn")+'</label><select id="debug-bar-turn-select" tabindex="0"></select></div><button id="debug-bar-toggle" tabindex="0" title="'+e+'" aria-label="'+e+'"></button></div><div id="debug-bar-hint"></div>').appendTo("body"),y=jQuery("#debug-bar"),b=jQuery(y.find("#debug-bar-watch").get(0)),w=jQuery(y.find("#debug-bar-watch-list").get(0)),k=jQuery(y.find("#debug-bar-turn-select").get(0));var g=jQuery(y.find("#debug-bar-toggle").get(0)),m=jQuery(y.find("#debug-bar-watch-toggle").get(0)),v=jQuery(y.find("#debug-bar-watch-input").get(0)),E=jQuery(y.find("#debug-bar-watch-add").get(0)),j=jQuery(y.find("#debug-bar-watch-all").get(0)),x=jQuery(y.find("#debug-bar-watch-none").get(0)),O=jQuery(y.find("#debug-bar-views-toggle").get(0));g.ariaClick(function(){S?n():r(),S=!S,l()}),m.ariaClick(function(){b.attr("hidden")?b.removeAttr("aria-hidden hidden"):b.attr({"aria-hidden":!0,hidden:"hidden"}),l()}),v.on(":addwatch",function(){a(this.value.trim()),this.value=""}).on("keypress",function(e){13===e.which&&(e.preventDefault(),v.trigger(":addwatch"))}),E.ariaClick(function(){return v.trigger(":addwatch")}),j.ariaClick(i),x.ariaClick(s),k.on("change",function(){Engine.goTo(Number(this.value))}),O.ariaClick(function(){DebugView.toggle(),l()}),jQuery(document).on(":historyupdate.debug-bar",p).on(":passageend.debug-bar",function(){d(),f()}).on(":enginerestart.debug-bar",function(){session.delete("debugState")})}function t(){u(),c(),p(),d(),f()}function r(){y.css("right","-"+y.outerWidth()+"px"),l()}function n(){y.css("right",0),l()}function a(e){g.test(e)&&(v.pushUnique(e),v.sort(),d(),f(),l())}function i(){Object.keys(State.variables).map(function(e){return v.pushUnique("$"+e)}),Object.keys(State.temporary).map(function(e){return v.pushUnique("_"+e)}),v.sort(),d(),f(),l()}function o(e){v.delete(e),d(),f(),l()}function s(){for(var e=v.length-1;e>=0;--e)v.pop();d(),f(),l()}function u(){if(session.has("debugState")){var e=session.get("debugState");S=e.stowed,v.push.apply(v,_toConsumableArray(e.watchList)),e.watchEnabled?b.removeAttr("aria-hidden hidden"):b.attr({"aria-hidden":!0,hidden:"hidden"}),e.viewsEnabled?DebugView.enable():DebugView.disable()}}function l(){session.set("debugState",{stowed:S,watchList:v,watchEnabled:!b.attr("hidden"),viewsEnabled:DebugView.isEnabled()})}function c(){S?r():n()}function d(){if(0===v.length)return void b.empty().append("<div>"+L10n.get("debugBarNoWatches")+"</div>");for(var e=L10n.get("debugBarDeleteWatch"),t=jQuery(document.createElement("table")),r=jQuery(document.createElement("tbody")),n=0,a=v.length;n<a;++n)!function(t,n){var a=v[t],i=a.slice(1),s="$"===a[0]?State.variables:State.temporary,u=jQuery(document.createElement("tr")),l=jQuery(document.createElement("button")),c=jQuery(document.createElement("code"));l.addClass("watch-delete").attr("data-name",a).ariaClick({one:!0,label:e},function(){return o(a)}),c.text(h(s[i])),jQuery(document.createElement("td")).append(l).appendTo(u),jQuery(document.createElement("td")).text(a).appendTo(u),jQuery(document.createElement("td")).append(c).appendTo(u),u.appendTo(r)}(n);t.append(r),b.empty().append(t)}function f(){var e=Object.keys(State.variables),t=Object.keys(State.temporary);if(0===e.length&&0===t.length)return void w.empty();var r=[].concat(_toConsumableArray(e.map(function(e){return"$"+e})),_toConsumableArray(t.map(function(e){return"_"+e}))).sort(),n=document.createDocumentFragment();r.delete(v);for(var a=0,i=r.length;a<i;++a)jQuery(document.createElement("option")).val(r[a]).appendTo(n);w.empty().append(n)}function p(){for(var e=State.size,t=State.expired.length,r=document.createDocumentFragment(),n=0;n<e;++n)jQuery(document.createElement("option")).val(n).text(t+n+1+". "+Util.escape(State.history[n].title)).appendTo(r);k.empty().ariaDisabled(e<2).append(r).val(State.activeIndex)}function h(e){if(null===e)return"null";switch(void 0===e?"undefined":_typeof(e)){case"number":if(Number.isNaN(e))return"NaN";if(!Number.isFinite(e))return"Infinity";case"boolean":case"symbol":case"undefined":return String(e);case"string":return JSON.stringify(e);case"function":return"Function"}var t=Util.toStringTag(e);if("Date"===t)return"Date {"+e.toLocaleString()+"}";if("RegExp"===t)return"RegExp "+e.toString();var r=[];if(e instanceof Array||e instanceof Set){for(var n=e instanceof Array?e:Array.from(e),a=0,i=n.length;a<i;++a)r.push(n.hasOwnProperty(a)?h(n[a]):"<empty>");return Object.keys(n).filter(function(e){return!m.test(e)}).forEach(function(e){return r.push(h(e)+": "+h(n[e]))}),t+"("+n.length+") ["+r.join(", ")+"]"}return e instanceof Map?(e.forEach(function(e,t){return r.push(h(t)+" → "+h(e))}),t+"("+e.size+") {"+r.join(", ")+"}"):(Object.keys(e).forEach(function(t){return r.push(h(t)+": "+h(e[t]))}),t+" {"+r.join(", ")+"}")}var g=new RegExp("^"+Patterns.variable+"$"),m=/^\d+$/,v=[],y=null,b=null,w=null,k=null,S=!0;return Object.freeze(Object.defineProperties({},{init:{value:e},start:{value:t},stow:{value:r},unstow:{value:n},watch:{value:a},watchAll:{value:i},unwatch:{value:o},unwatchAll:{value:s}}))}(),LoadScreen=function(){function e(){jQuery(document).on("readystatechange.SugarCube",function(){o.size>0||("complete"===document.readyState?"loading"===jQuery(document.documentElement).attr("data-init")&&(Config.loadDelay>0?setTimeout(function(){0===o.size&&r()},Math.max(Engine.minDomActionDelay,Config.loadDelay)):r()):n())})}function t(){jQuery(document).off("readystatechange.SugarCube"),o.clear(),r()}function r(){jQuery(document.documentElement).removeAttr("data-init")}function n(){jQuery(document.documentElement).attr("data-init","loading")}function a(){return++s,o.add(s),n(),s}function i(e){if(null==e)throw new Error("LoadScreen.unlock called with a null or undefined ID");o.has(e)&&o.delete(e),0===o.size&&jQuery(document).trigger("readystatechange")}var o=new Set,s=0;return Object.freeze(Object.defineProperties({},{init:{value:e},clear:{value:t},hide:{value:r},show:{value:n},lock:{value:a},unlock:{value:i}}))}(),version=Object.freeze({title:"SugarCube",major:2,minor:30,patch:0,prerelease:null,build:9082,date:new Date("2019-09-26T20:43:20.257Z"),extensions:{},toString:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.major+"."+this.minor+"."+this.patch+e+"+"+this.build},short:function(){var e=this.prerelease?"-"+this.prerelease:"";return this.title+" (v"+this.major+"."+this.minor+"."+this.patch+e+")"},long:function(){return this.title+" v"+this.toString()+" ("+this.date.toUTCString()+")"}}),TempState={},macros={},postdisplay={},postrender={},predisplay={},prehistory={},prerender={},session=null,settings={},setup={},storage=null,browser=Browser,config=Config,has=Has,History=State,state=State,tale=Story,TempVariables=State.temporary;window.SugarCube={},jQuery(function(){try{var e=LoadScreen.lock();LoadScreen.init(),document.normalize&&document.normalize(),Story.load(),storage=SimpleStore.create(Story.domId,!0),session=SimpleStore.create(Story.domId,!1),Dialog.init(),UIBar.init(),Engine.init(),Story.init(),L10n.init(),session.has("rcWarn")||"cookie"!==storage.name||(session.set("rcWarn",1),window.alert(L10n.get("warningNoWebStorage"))),Save.init(),Setting.init(),Macro.init(),Engine.start(),Config.debug&&DebugBar.init();var t=$(window),r=setInterval(function(){t.width()&&(clearInterval(r),setTimeout(function(){UIBar.start(),Config.debug&&DebugBar.start(),LoadScreen.unlock(e)},Engine.minDomActionDelay))},Engine.minDomActionDelay);window.SugarCube={Browser:Browser,Config:Config,Dialog:Dialog,Engine:Engine,Has:Has,L10n:L10n,Macro:Macro,Passage:Passage,Save:Save,Scripting:Scripting,Setting:Setting,SimpleAudio:SimpleAudio,State:State,Story:Story,UI:UI,UIBar:UIBar,DebugBar:DebugBar,Util:Util,Visibility:Visibility,Wikifier:Wikifier,session:session,settings:settings,setup:setup,storage:storage,version:version}}catch(e){return console.error(e),LoadScreen.clear(),Alert.fatal(null,e.message,e)}})}(window,window.document,jQuery);}
	</script>
</body>
</html>
